<!doctype html>
<html lang="ko" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>PDF â†’ JPG/PNG | ConvertFiles24</title>
  <meta name="description" content="Convert PDF pages to JPG/PNG in your browser. 100% local processing (no server upload)." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --radius:16px;
      --pad:16px;
      --border:1px solid rgba(255,255,255,.12);
      --blue: 47,109,246;
      --ease: cubic-bezier(.2,.8,.2,1);
    }
    *{ box-sizing:border-box; }
    html, body{ width:100%; max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", sans-serif;
      background:#0b0f17;
      color:#e9eef7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    body:not(.loaded) .card, body:not(.loaded) .top{ opacity:0; transform: translateY(8px); }
    body.loaded .top{ animation: cfFadeUp .35s var(--ease) both; }
    body.loaded .card{ animation: cfFadeUp .38s var(--ease) both; }
    @keyframes cfFadeUp{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
      body:not(.loaded) .card, body:not(.loaded) .top{ opacity:1; transform:none; }
    }

    .wrap{
      max-width:980px;
      width:100%;
      margin:0 auto;
      padding:14px 14px 44px;
      overflow-x: clip;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:12px;
      min-width:0;
    }

    .title{
      margin:0;
      font-weight:900;
      letter-spacing:-0.35px;
      line-height:1.15;
      color:#ffffff;
      font-size:26px;
    }
    .sub{
      margin:8px 0 0;
      color:#a7b3c7;
      font-size:13px;
      line-height:1.45;
    }

    .homeBtn{
      width:100%;
      display:flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px;
      border-radius:999px;
      border:1px solid rgba(47,109,246,.55);
      background:rgba(47,109,246,.18);
      color:#e9eef7;
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      max-width:380px;
      transition: transform .08s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
    }
    .homeBtn:hover{ background:rgba(47,109,246,.24); }
    .homeBtn:active{ transform: scale(.99); }
    .homeBtn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px rgba(var(--blue),.35), 0 10px 24px rgba(0,0,0,.25);
    }

    .pill{
      width:100%;
      border:1px solid rgba(120, 200, 255, .22);
      background:rgba(120, 200, 255, .06);
      border-radius:999px;
      padding:10px 14px;
      color:#cfe6ff;
      font-size:13px;
      font-weight:900;
      display:flex; align-items:center; justify-content:center; gap:10px;
      min-width:0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .langRow{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      min-width:220px;
      max-width:100%;
      margin-left:auto;
    }
    .langLabel{
      font-size:12px;
      font-weight:900;
      color:#9fb0ca;
      letter-spacing:-0.2px;
      display:flex;
      align-items:center;
      gap:8px;
      opacity:.95;
    }
    .langSelect{
      width:220px;
      max-width:100%;
      padding:12px 12px;
      border-radius:999px;
      border:var(--border);
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      outline:none;
      font-weight:900;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease), transform .08s var(--ease);
    }
    .langSelect:focus-visible{
      outline:none;
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.25);
    }
    option{ background:#0b0f17; color:#e9eef7; }

    .card{
      border:var(--border);
      background:rgba(255,255,255,.03);
      border-radius:var(--radius);
      padding:var(--pad);
      margin-top:12px;
      min-width:0;
      max-width:100%;
      overflow-x: clip;
      will-change: transform, opacity;
    }
    .card h2{
      margin:0 0 10px;
      font-size:15px;
      color:#dbe7ff;
      letter-spacing:-0.2px;
      line-height:1.2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:900;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:14px;
      letter-spacing: -0.2px;
      user-select:none;
      transition: transform .08s var(--ease), filter .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
      display:flex; align-items:center; justify-content:center; gap:10px;
      text-decoration:none;
    }
    .btn:hover{ filter: brightness(1.02); }
    .btn:active{ transform: scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; transform:none; filter:none; box-shadow:none; }

    .btn.secondary{
      background: rgba(47,109,246,.14);
      color:#e9eef7;
      border: 1px solid rgba(47,109,246,.30);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .btn.secondary:hover{
      background: rgba(47,109,246,.18);
      border-color: rgba(47,109,246,.36);
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      min-width:0;
    }
    .row > *{
      flex:1;
      min-width:160px;
      max-width:100%;
      min-width:0;
    }

    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; }
    select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      border:var(--border);
      outline:none;
      font-weight:900;
      max-width:100%;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease);
    }
    select:focus-visible{
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.22);
    }

    input[type="file"]{ position:absolute; left:-9999px; width:1px; height:1px; opacity:0; }

    .drop{
      border:1px dashed rgba(255,255,255,0.22);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 18px;
      text-align:center;
      min-height: 190px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      transition: transform .08s var(--ease), border-color .12s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
    }
    .drop.dragover{
      border-color: rgba(47,109,246,.7);
      background: rgba(47,109,246,.10);
      box-shadow: 0 0 0 3px rgba(47,109,246,.18), inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .drop.active{
      border-color: rgba(120, 200, 255, .55);
      background: rgba(120, 200, 255, .08);
    }

    .dropInner{
      max-width: 620px;
      width:100%;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:center;
    }

    .dropIcon{
      width:64px; height:64px;
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .dropIcon svg{ width:34px; height:34px; opacity:.95; }

    .dropTitle{
      font-weight: 900;
      font-size: 18px;
      letter-spacing: -0.2px;
      color:#e9eef7;
      line-height:1.25;
    }
    .dropHint{
      color:#9fb0ca;
      font-size:12px;
      line-height:1.45;
    }

    /* âœ… ì—…ê·¸ë ˆì´ë“œ: ì¹´ìš´íŠ¸ ë°°ì§€ */
    .countBadge{
      position:absolute;
      top:12px;
      right:12px;
      display:none;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border: 1px solid rgba(120, 200, 255, .28);
      background: rgba(120, 200, 255, .10);
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      color:#d7efff;
      font-weight:900;
      font-size:12px;
      max-width: calc(100% - 24px);
      line-height:1;
      user-select:none;
      pointer-events:none;
    }
    .countDot{
      width:8px; height:8px;
      border-radius:999px;
      background: rgba(120,200,255,.9);
      box-shadow: 0 0 0 3px rgba(120,200,255,.18);
      flex:0 0 auto;
    }
    .countText{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* âœ… ì—…ê·¸ë ˆì´ë“œ: ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ */
    .fileList{
      width:100%;
      margin-top:10px;
      display:none;
      flex-direction:column;
      gap:10px;
      max-height: 260px;
      overflow:auto;
      padding-right:2px;
    }
    .fileList::-webkit-scrollbar{ width:10px; }
    .fileList::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
      border-radius: 999px;
    }

    .fileRow{
      width:100%;
      display:flex;
      align-items:center;
      gap:12px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      text-align:left;
      overflow:hidden;
    }
    .fileBadge{
      width:42px; height:42px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(47,109,246,.14);
      border: 1px solid rgba(47,109,246,.30);
      flex:0 0 auto;
    }
    .fileBadge svg{ width:22px; height:22px; }
    .fileMeta{ min-width:0; flex:1; }
    .fileName{
      font-weight:900;
      font-size:13px;
      color:#e9eef7;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .fileSize{
      margin-top:2px;
      font-size:12px;
      color:#9fb0ca;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .tag{
      flex:0 0 auto;
      font-weight:900;
      font-size:12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:#dbe7ff;
    }

    /* âœ… ì—…ê·¸ë ˆì´ë“œ: ê°œë³„ ì‚­ì œ/ì •ë ¬ ë²„íŠ¼ */
    .miniBtn{
      flex:0 0 auto;
      width:36px; height:36px;
      border-radius:12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:#e9eef7;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
    }
    .miniBtn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }
    .miniBtn:active{ transform: scale(.98); }
    .miniBtn:disabled{ opacity:.4; cursor:not-allowed; transform:none; }
    .miniBtn svg{ width:18px; height:18px; }

    .sortWrap{
      display:flex;
      flex-direction:column;
      gap:6px;
      flex:0 0 auto;
    }

    /* âœ… ì—…ê·¸ë ˆì´ë“œ: ì¤‘ë³µ ë°°ì§€ */
    .dupBadge{
      display:none;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius:999px;
      border: 1px solid rgba(255,200,120,.22);
      background: rgba(255,200,120,.08);
      color:#ffe3c2;
      font-weight:900;
      font-size:11px;
    }

    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .msg.err{ color:#ffb4b4; }
    .msg.ok{ color:#b8ffcc; }

    .footer{
      margin-top:16px;
      color:#94a6c2;
      font-size:12px;
      text-align:center;
    }
    .footer a{ color:#9fb0ca; text-decoration:none; border-bottom:1px dashed rgba(159,176,202,.35); }
    .footer a:hover{ color:#cfe0ff; border-bottom-color:rgba(207,224,255,.6); }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div style="flex:1; min-width:240px;">
        <h1 class="title" id="page_title">PDF â†’ JPG/PNG</h1>
        <p class="sub" id="page_sub">ì—…ë¡œë“œ â†’ ë³€í™˜ â†’ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ. 100% ë¡œì»¬ ì²˜ë¦¬.</p>

        <div style="margin-top:10px;">
          <a class="homeBtn" href="/" id="home_btn">ğŸ  í™ˆìœ¼ë¡œ</a>
        </div>

        <div style="margin-top:10px;">
          <div class="pill">ğŸ”’ <span id="local_processing">ë¡œì»¬ ì²˜ë¦¬ â€” ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ</span></div>
        </div>
      </div>

      <div class="langRow">
        <div class="langLabel">ğŸŒ <span id="lang_label">ì–¸ì–´</span></div>
        <select class="langSelect" id="langSelect" aria-label="Language">
          <option value="en">Global (English)</option>
          <option value="ko" selected>í•œêµ­ì–´</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="es">EspaÃ±ol</option>
        </select>
      </div>
    </div>

    <!-- Upload -->
    <div class="card">
      <h2 id="h_upload">
        <span>PDF ì—…ë¡œë“œ</span>
        <span class="dupBadge" id="dupBadge">âš ï¸ <span id="dupText">ì¤‘ë³µ íŒŒì¼ì´ ì œì™¸ë¨</span></span>
      </h2>

      <div class="drop" id="drop">
        <div class="countBadge" id="dropCount">
          <span class="countDot" aria-hidden="true"></span>
          <span class="countText" id="dropCountText">âœ… PDF 0ê°œ</span>
        </div>

        <div class="dropInner">
          <div class="dropIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M14 2v6h6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M8 13h8M8 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>

          <div class="dropTitle" id="drop_title">ì—¬ê¸°ì— PDFë¥¼ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ íƒ­í•´ì„œ ì—…ë¡œë“œ</div>
          <div class="dropHint" id="drop_hint">íŒ: ê° í˜ì´ì§€ë¥¼ ì´ë¯¸ì§€ë¡œ ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆì–´ìš”.</div>

          <!-- âœ… ë‹¤ì¤‘ ë¦¬ìŠ¤íŠ¸ -->
          <div class="fileList" id="fileList"></div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="row">
        <!-- âœ… Samsung Internetì—ì„œ 100% ì—´ë¦¬ê²Œ: label-for ë°©ì‹ -->
        <label class="btn secondary" for="fileInput" id="pickLabel">ğŸ“„ PDF ì„ íƒ</label>
        <button class="btn secondary" id="clearBtn" type="button" disabled>ğŸ§¹ ë¹„ìš°ê¸°</button>
      </div>

      <!-- âœ… ë‹¤ì¤‘ ì—…ë¡œë“œ -->
      <input id="fileInput" type="file" accept="application/pdf,.pdf" multiple />
      <div class="msg" id="msg"></div>
    </div>

    <!-- Convert -->
    <div class="card">
      <h2 id="h_convert">ë³€í™˜</h2>

      <div class="row">
        <div>
          <label id="lbl_format">í˜•ì‹</label>
          <select id="outFormat">
            <option value="image/jpeg" selected>JPG</option>
            <option value="image/png">PNG</option>
          </select>
        </div>
        <div>
          <label id="lbl_quality">í’ˆì§ˆ</label>
          <select id="quality">
            <option value="0.95">Max (0.95)</option>
            <option value="0.90" selected>High (0.90)</option>
            <option value="0.80">Normal (0.80)</option>
            <option value="0.70">Small (0.70)</option>
          </select>
        </div>
      </div>

      <div class="msg" style="margin-top:10px; color:#9fb0ca;" id="zip_hint">ì—¬ëŸ¬ PDF/ì—¬ëŸ¬ í˜ì´ì§€ë©´ ZIPìœ¼ë¡œ ë¬¶ì–´ì„œ ë‚´ë ¤ë°›ìŠµë‹ˆë‹¤.</div>

      <div style="height:10px;"></div>
      <button class="btn" id="convertBtn" type="button" disabled>ğŸ§© ë³€í™˜ í›„ ë‹¤ìš´ë¡œë“œ</button>
    </div>

    <div class="footer">
      Â© <span id="year"></span> ConvertFiles24 Â·
      <a href="/privacy.html">Privacy</a> Â·
      <a href="/terms.html">Terms</a>
    </div>
  </div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  "use strict";
  const $ = (id)=>document.getElementById(id);
  $("year").textContent = new Date().getFullYear();
  requestAnimationFrame(()=> document.body.classList.add("loaded"));

  // ===== i18n =====
  const STR = {
    ko:{
      title:"PDF â†’ JPG/PNG",
      sub:"ì—…ë¡œë“œ â†’ ë³€í™˜ â†’ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ. 100% ë¡œì»¬ ì²˜ë¦¬.",
      home:"ğŸ  í™ˆìœ¼ë¡œ",
      local:"ë¡œì»¬ ì²˜ë¦¬ â€” ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ",
      lang:"ì–¸ì–´",
      upload:"PDF ì—…ë¡œë“œ",
      dropTitle:"ì—¬ê¸°ì— PDFë¥¼ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ íƒ­í•´ì„œ ì—…ë¡œë“œ",
      dropHint:"íŒ: ì—¬ëŸ¬ PDFë„ í•œ ë²ˆì— ë³€í™˜í•  ìˆ˜ ìˆì–´ìš”.",
      pick:"ğŸ“„ PDF ì„ íƒ",
      clear:"ğŸ§¹ ë¹„ìš°ê¸°",
      convert:"ë³€í™˜",
      format:"í˜•ì‹",
      quality:"í’ˆì§ˆ",
      zip:"ì—¬ëŸ¬ PDF/ì—¬ëŸ¬ í˜ì´ì§€ë©´ ZIPìœ¼ë¡œ ë¬¶ì–´ì„œ ë‚´ë ¤ë°›ìŠµë‹ˆë‹¤.",
      run:"ğŸ§© ë³€í™˜ í›„ ë‹¤ìš´ë¡œë“œ",
      errNoPdf:"PDF íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.",
      errEngine:"PDF ì—”ì§„ ë¡œë“œ ì‹¤íŒ¨ (pdf.js). ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      errZip:"ZIP ì—”ì§„ ë¡œë“œ ì‹¤íŒ¨ (JSZip). ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      errPassword:"ì•”í˜¸ê°€ ê±¸ë¦° PDFëŠ” ë³€í™˜ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆì–´ìš”.",
      okReady:"ì¤€ë¹„ ì™„ë£Œ. ë³€í™˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.",
      okDone:"âœ… ë³€í™˜ ì™„ë£Œ",
      preparing:"ì—”ì§„ ì¤€ë¹„ ì¤‘...",
      converting:"ë³€í™˜ ì¤‘...",
      buildingZip:"ZIP ë§Œë“œëŠ” ì¤‘...",
      addedCount:(n)=>`âœ… PDF ${n}ê°œ ì¶”ê°€ë¨`,
      dupSkipped:(n)=>`ì¤‘ë³µ ${n}ê°œ ì œì™¸ë¨`,
      fileUnit:"ê°œ"
    },
    en:{
      title:"PDF â†’ JPG/PNG",
      sub:"Upload â†’ convert â†’ download images. 100% local processing.",
      home:"ğŸ  Home",
      local:"Processed locally â€” no server upload",
      lang:"Language",
      upload:"PDF Upload",
      dropTitle:"Drop PDFs here or tap to upload",
      dropHint:"Tip: You can convert multiple PDFs at once.",
      pick:"ğŸ“„ Choose PDFs",
      clear:"ğŸ§¹ Clear",
      convert:"Convert",
      format:"Format",
      quality:"Quality",
      zip:"Multiple PDFs/pages will be downloaded as a ZIP.",
      run:"ğŸ§© Convert & Download",
      errNoPdf:"Please select PDFs first.",
      errEngine:"PDF engine failed to load (pdf.js). Refresh and try again.",
      errZip:"ZIP engine failed to load (JSZip). Refresh and try again.",
      errPassword:"Password-protected PDFs may fail.",
      okReady:"Ready. Press Convert.",
      okDone:"âœ… Done",
      preparing:"Preparing engine...",
      converting:"Converting...",
      buildingZip:"Building ZIP...",
      addedCount:(n)=>`âœ… ${n} PDF added`,
      dupSkipped:(n)=>`${n} duplicates skipped`,
      fileUnit:"files"
    },
    es:{
      title:"PDF â†’ JPG/PNG",
      sub:"Sube â†’ convierte â†’ descarga imÃ¡genes. 100% local.",
      home:"ğŸ  Inicio",
      local:"Procesado local â€” sin servidor",
      lang:"Idioma",
      upload:"Subir PDF",
      dropTitle:"Suelta PDFs aquÃ­ o toca para subir",
      dropHint:"Tip: Puedes convertir varios PDFs a la vez.",
      pick:"ğŸ“„ Elegir PDFs",
      clear:"ğŸ§¹ Limpiar",
      convert:"Convertir",
      format:"Formato",
      quality:"Calidad",
      zip:"Varios PDFs/pÃ¡ginas se descargarÃ¡n en ZIP.",
      run:"ğŸ§© Convertir y descargar",
      errNoPdf:"Selecciona PDFs primero.",
      errEngine:"Motor PDF no cargado (pdf.js). Recarga e intÃ©ntalo.",
      errZip:"Motor ZIP no cargado (JSZip). Recarga e intÃ©ntalo.",
      errPassword:"Los PDFs con contraseÃ±a pueden fallar.",
      okReady:"Listo. Pulsa Convertir.",
      okDone:"âœ… Listo",
      preparing:"Preparando motor...",
      converting:"Convirtiendo...",
      buildingZip:"Creando ZIP...",
      addedCount:(n)=>`âœ… ${n} PDF aÃ±adidos`,
      dupSkipped:(n)=>`${n} duplicados omitidos`,
      fileUnit:"archivos"
    },
    ja:{
      title:"PDF â†’ JPG/PNG",
      sub:"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ å¤‰æ› â†’ ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚100% ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã€‚",
      home:"ğŸ  ãƒ›ãƒ¼ãƒ ",
      local:"ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç† â€” ã‚µãƒ¼ãƒãƒ¼ãªã—",
      lang:"è¨€èª",
      upload:"PDF ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      dropTitle:"ã“ã“ã«PDFã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ",
      dropHint:"Tip: è¤‡æ•°PDFã‚‚ã¾ã¨ã‚ã¦å¤‰æ›ã§ãã¾ã™ã€‚",
      pick:"ğŸ“„ PDF ã‚’é¸æŠ",
      clear:"ğŸ§¹ ã‚¯ãƒªã‚¢",
      convert:"å¤‰æ›",
      format:"å½¢å¼",
      quality:"å“è³ª",
      zip:"è¤‡æ•°PDF/è¤‡æ•°ãƒšãƒ¼ã‚¸ã¯ZIPã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚",
      run:"ğŸ§© å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
      errNoPdf:"å…ˆã«PDFã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚",
      errEngine:"PDFã‚¨ãƒ³ã‚¸ãƒ³æœªèª­è¾¼ (pdf.js)ã€‚å†èª­ã¿è¾¼ã¿ã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",
      errZip:"ZIPã‚¨ãƒ³ã‚¸ãƒ³æœªèª­è¾¼ (JSZip)ã€‚å†èª­ã¿è¾¼ã¿ã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",
      errPassword:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãPDFã¯å¤±æ•—ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
      okReady:"æº–å‚™OKã€‚å¤‰æ›ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚",
      okDone:"âœ… å®Œäº†",
      preparing:"ã‚¨ãƒ³ã‚¸ãƒ³æº–å‚™ä¸­...",
      converting:"å¤‰æ›ä¸­...",
      buildingZip:"ZIPä½œæˆä¸­...",
      addedCount:(n)=>`âœ… PDF ${n}å€‹ è¿½åŠ `,
      dupSkipped:(n)=>`é‡è¤‡ ${n}å€‹ é™¤å¤–`,
      fileUnit:"å€‹"
    }
  };

  function detectLang(){
    const qp = (new URL(location.href).searchParams.get("lang")||"").toLowerCase();
    if(STR[qp]) return qp;
    const manual = localStorage.getItem("cf24_lang_manual") === "1";
    const saved = localStorage.getItem("cf24_lang");
    if(manual && saved && STR[saved]) return saved;
    const nav = (navigator.language||"").toLowerCase();
    if(nav.startsWith("ko")) return "ko";
    if(nav.startsWith("ja")) return "ja";
    if(nav.startsWith("es")) return "es";
    return "en";
  }

  let LANG = detectLang();
  function t(){ return STR[LANG] || STR.en; }

  function setLang(lang, isManual=false){
    if(!STR[lang]) lang="en";
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    if(isManual) localStorage.setItem("cf24_lang_manual","1");

    $("langSelect").value = lang;
    document.documentElement.lang = lang;

    $("page_title").textContent = t().title;
    $("page_sub").textContent = t().sub;
    $("home_btn").textContent = t().home;
    $("local_processing").textContent = t().local;
    $("lang_label").textContent = t().lang;

    $("h_upload").childNodes[0].textContent = t().upload;

    $("drop_title").textContent = t().dropTitle;
    $("drop_hint").textContent = t().dropHint;

    $("pickLabel").textContent = t().pick;
    $("clearBtn").textContent = t().clear;

    $("h_convert").textContent = t().convert;
    $("lbl_format").textContent = t().format;
    $("lbl_quality").textContent = t().quality;
    $("zip_hint").textContent = t().zip;
    $("convertBtn").textContent = t().run;

    renderCounters(); // ì–¸ì–´ ë°”ë€” ë•Œ ì¹´ìš´íŠ¸ ë¬¸êµ¬ë„ ê°±ì‹ 
  }
  $("langSelect").addEventListener("change",(e)=>setLang(e.target.value, true));

  // ===== elements =====
  const drop = $("drop");
  const fileInput = $("fileInput");
  const clearBtn = $("clearBtn");
  const convertBtn = $("convertBtn");
  const outFormatEl = $("outFormat");
  const qualityEl = $("quality");
  const msgEl = $("msg");

  const fileListEl = $("fileList");
  const dropCount = $("dropCount");
  const dropCountText = $("dropCountText");
  const dupBadge = $("dupBadge");
  const dupText = $("dupText");

  // ===== state =====
  let pdfFiles = [];
  let isWorking = false;
  let lastDupCount = 0;

  function setMsg(text, cls){
    msgEl.textContent = text || "";
    msgEl.className = "msg " + (cls || "");
  }
  function bytesToSize(bytes){
    if(!bytes && bytes !== 0) return "";
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return `${v.toFixed(i===0?0:2)} ${units[i]}`;
  }
  function isPdfFile(f){
    return f && (f.type === "application/pdf" || (f.name||"").toLowerCase().endsWith(".pdf"));
  }

  function setActiveUI(on){
    drop.classList.toggle("active", !!on);
    clearBtn.disabled = !on || isWorking;
    convertBtn.disabled = !on || isWorking;
  }

  function showDup(count){
    lastDupCount = count || 0;
    if(lastDupCount <= 0){
      dupBadge.style.display = "none";
      return;
    }
    dupText.textContent = t().dupSkipped(lastDupCount);
    dupBadge.style.display = "inline-flex";
    setTimeout(()=>{ dupBadge.style.display="none"; }, 2500);
  }

  function renderCounters(){
    const n = pdfFiles.length;
    if(n > 0){
      dropCountText.textContent = t().addedCount(n);
      dropCount.style.display = "inline-flex";
      fileListEl.style.display = "flex";
    }else{
      dropCount.style.display = "none";
      fileListEl.style.display = "none";
    }
  }

  function renderFileList(){
    fileListEl.innerHTML = "";
    pdfFiles.forEach((f, idx)=>{
      const row = document.createElement("div");
      row.className = "fileRow";
      row.dataset.idx = String(idx);

      row.innerHTML = `
        <div class="fileBadge" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14 2v6h6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </div>

        <div class="fileMeta">
          <div class="fileName" title="${(f.name||"document.pdf").replace(/"/g,"&quot;")}">${f.name || "document.pdf"}</div>
          <div class="fileSize">
            <span>${bytesToSize(f.size)}</span>
            <span style="opacity:.8;">Â·</span>
            <span style="opacity:.9; font-weight:900;">#${idx+1}</span>
          </div>
        </div>

        <div class="tag">PDF</div>

        <div class="sortWrap" aria-label="Sort">
          <button class="miniBtn upBtn" type="button" title="Up" aria-label="Move up">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 5l-6 6h12l-6-6z" fill="currentColor"/>
            </svg>
          </button>
          <button class="miniBtn downBtn" type="button" title="Down" aria-label="Move down">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 19l6-6H6l6 6z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <button class="miniBtn delBtn" type="button" title="Remove" aria-label="Remove">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 7h12M10 7V5h4v2M9 7l1 14h4l1-14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      `;

      fileListEl.appendChild(row);
    });

    // ë²„íŠ¼ ìƒíƒœ(ì²«/ë)
    Array.from(fileListEl.querySelectorAll(".fileRow")).forEach((row, i)=>{
      const up = row.querySelector(".upBtn");
      const down = row.querySelector(".downBtn");
      const del = row.querySelector(".delBtn");
      const disabled = isWorking;

      if(up) up.disabled = disabled || (i === 0);
      if(down) down.disabled = disabled || (i === pdfFiles.length - 1);
      if(del) del.disabled = disabled;
    });

    renderCounters();
    setActiveUI(pdfFiles.length > 0);
  }

  function setFiles(incoming){
    const list = (incoming || []).filter(isPdfFile);
    if(!list.length){
      setMsg(t().errNoPdf, "err");
      return;
    }

    // ì¤‘ë³µ ì œê±°(ì´ë¦„+ì‚¬ì´ì¦ˆ)
    const before = pdfFiles.length;
    const map = new Map();
    pdfFiles.forEach(f=>{
      map.set(`${f.name}__${f.size}`, f);
    });

    let dup = 0;
    list.forEach(f=>{
      const key = `${f.name}__${f.size}`;
      if(map.has(key)) dup++;
      else map.set(key, f);
    });

    pdfFiles = Array.from(map.values());
    const after = pdfFiles.length;

    showDup(dup);
    renderFileList();

    if(after > before) setMsg(t().okReady, "ok");
  }

  function removeAt(idx){
    if(idx < 0 || idx >= pdfFiles.length) return;
    pdfFiles.splice(idx, 1);
    renderFileList();
    if(!pdfFiles.length) setMsg("", "");
  }

  function move(from, to){
    if(from < 0 || from >= pdfFiles.length) return;
    if(to < 0 || to >= pdfFiles.length) return;
    const [item] = pdfFiles.splice(from, 1);
    pdfFiles.splice(to, 0, item);
    renderFileList();
  }

  // ì´ë²¤íŠ¸ ìœ„ì„(ì‚­ì œ/ì •ë ¬)
  fileListEl.addEventListener("click", (e)=>{
    const row = e.target.closest(".fileRow");
    if(!row) return;
    const idx = parseInt(row.dataset.idx || "-1", 10);
    if(Number.isNaN(idx)) return;

    if(e.target.closest(".delBtn")) return removeAt(idx);
    if(e.target.closest(".upBtn")) return move(idx, idx-1);
    if(e.target.closest(".downBtn")) return move(idx, idx+1);
  });

  // ===== Drop / Pick =====
  // (label-forë„ ìˆê³ , drop í´ë¦­ë„ fileInput.clickìœ¼ë¡œ ë°±ì—…)
  drop.addEventListener("click", ()=> fileInput.click());

  ["dragenter","dragover"].forEach(ev=>{
    drop.addEventListener(ev, (e)=>{
      e.preventDefault();
      e.stopPropagation();
      drop.classList.add("dragover");
    });
  });
  ["dragleave","drop"].forEach(ev=>{
    drop.addEventListener(ev, (e)=>{
      e.preventDefault();
      e.stopPropagation();
      drop.classList.remove("dragover");
    });
  });

  drop.addEventListener("drop", (e)=>{
    const list = e.dataTransfer && e.dataTransfer.files ? Array.from(e.dataTransfer.files) : [];
    setFiles(list);
  });

  fileInput.addEventListener("change", ()=>{
    const list = fileInput.files ? Array.from(fileInput.files) : [];
    if(!list.length) return;
    setFiles(list);
    // ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ ë¦¬ì…‹
    fileInput.value = "";
  });

  clearBtn.addEventListener("click", ()=>{
    pdfFiles = [];
    renderFileList();
    setMsg("", "");
  });

  // ===== Robust script loader (LOCAL first, CDN fallback) =====
  function loadScript(url){
    return new Promise((resolve, reject)=>{
      const s = document.createElement("script");
      s.src = url;
      s.async = true;
      s.onload = () => resolve(url);
      s.onerror = () => reject(new Error("Failed: " + url));
      document.head.appendChild(s);
    });
  }

  async function ensurePdfJs(){
    if(window.pdfjsLib) return true;

    // âœ… 1ìˆœìœ„: ë¡œì»¬
    const localCandidates = [
      "../assets/pdfjs/pdf.min.js",
      "/assets/pdfjs/pdf.min.js"
    ];
    for(const url of localCandidates){
      try{
        await loadScript(url);
        if(window.pdfjsLib){
          // worker ê²½ë¡œë„ ë¡œì»¬ë¡œ ê³ ì •
          const workerUrl = url.replace("pdf.min.js","pdf.worker.min.js");
          window.pdfjsLib.GlobalWorkerOptions.workerSrc = workerUrl;
          return true;
        }
      }catch(e){}
    }

    // âœ… 2ìˆœìœ„: CDN
    const candidates = [
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/build/pdf.min.js",
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js",
      "https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"
    ];
    for(const url of candidates){
      try{
        await loadScript(url);
        if(window.pdfjsLib){
          window.pdfjsLib.GlobalWorkerOptions.workerSrc =
            url.replace("pdf.min.js","pdf.worker.min.js");
          return true;
        }
      }catch(e){}
    }
    return false;
  }

  async function ensureJSZip(){
    if(window.JSZip) return true;

    // âœ… 1ìˆœìœ„: ë¡œì»¬
    const localCandidates = [
      "../assets/jszip/jszip.min.js",
      "/assets/jszip/jszip.min.js"
    ];
    for(const url of localCandidates){
      try{
        await loadScript(url);
        if(window.JSZip) return true;
      }catch(e){}
    }

    // âœ… 2ìˆœìœ„: CDN
    const candidates = [
      "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",
      "https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js",
      "https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"
    ];
    for(const url of candidates){
      try{
        await loadScript(url);
        if(window.JSZip) return true;
      }catch(e){}
    }
    return false;
  }

  // ===== Convert (multi) =====
  async function multiConvertAndDownload(files){
    const okPdf = await ensurePdfJs();
    if(!okPdf) throw new Error(t().errEngine);

    const pdfjsLib = window.pdfjsLib;
    const outMime = outFormatEl.value;
    const q = parseFloat(qualityEl.value || "0.9");
    const makePng = (outMime === "image/png");

    const needZip = (files.length > 1);

    if(needZip){
      const okZip = await ensureJSZip();
      if(!okZip) throw new Error(t().errZip);

      const zip = new window.JSZip();

      for(let i=0;i<files.length;i++){
        const file = files[i];
        const arrayBuf = await file.arrayBuffer();

        let pdf;
        try{
          pdf = await pdfjsLib.getDocument({ data: arrayBuf }).promise;
        }catch(e){
          throw new Error(t().errPassword);
        }

        const totalPages = pdf.numPages || 0;
        if(totalPages <= 0) continue;

        const base = (file.name || `pdf_${i+1}`).replace(/\.[^.]+$/, "");
        const folder = zip.folder(base);

        for(let p=1; p<=totalPages; p++){
          setMsg(`(${i+1}/${files.length}) ${base} Â· (${p}/${totalPages}) ${t().converting}`, "");
          const blob = await renderPageToBlob(pdf, p, outMime, q);
          const ext = makePng ? "png" : "jpg";
          const name = `page${String(p).padStart(3,"0")}.${ext}`;
          folder.file(name, blob);
        }
      }

      setMsg(t().buildingZip, "");
      const zipBlob = await zip.generateAsync({ type:"blob" });
      downloadBlob(zipBlob, `pdf_images_${Date.now()}.zip`);
      return;
    }

    // ë‹¨ì¼ PDF: 1í˜ì´ì§€ë©´ ë‹¨ì¼ ì´ë¯¸ì§€, ì—¬ëŸ¬ í˜ì´ì§€ë©´ ZIP
    const file = files[0];
    const arrayBuf = await file.arrayBuffer();

    let pdf;
    try{
      pdf = await pdfjsLib.getDocument({ data: arrayBuf }).promise;
    }catch(e){
      throw new Error(t().errPassword);
    }

    const total = pdf.numPages || 0;
    if(total <= 0) throw new Error("PDF pages not found.");

    const base = (file.name || "pdf").replace(/\.[^.]+$/, "");

    if(total === 1){
      const blob = await renderPageToBlob(pdf, 1, outMime, q);
      const ext = makePng ? "png" : "jpg";
      downloadBlob(blob, `${base}_page1.${ext}`);
      return;
    }

    const okZip = await ensureJSZip();
    if(!okZip) throw new Error(t().errZip);

    const zip = new window.JSZip();
    for(let p=1; p<=total; p++){
      setMsg(`(${p}/${total}) ${t().converting}`, "");
      const blob = await renderPageToBlob(pdf, p, outMime, q);
      const ext = makePng ? "png" : "jpg";
      const name = `${base}_page${String(p).padStart(3,"0")}.${ext}`;
      zip.file(name, blob);
    }

    setMsg(t().buildingZip, "");
    const zipBlob = await zip.generateAsync({ type:"blob" });
    downloadBlob(zipBlob, `${base}_images.zip`);
  }

  async function renderPageToBlob(pdf, pageNum, mime, quality){
    const page = await pdf.getPage(pageNum);

    const test = page.getViewport({ scale: 2.0 });
    const megaPixels = (test.width * test.height) / 1_000_000;
    const scale = megaPixels > 16 ? 1.5 : 2.0;

    const viewport = page.getViewport({ scale });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d", { alpha: (mime !== "image/jpeg") });

    canvas.width = Math.round(viewport.width);
    canvas.height = Math.round(viewport.height);

    if(mime === "image/jpeg"){
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,canvas.width, canvas.height);
    }

    await page.render({ canvasContext: ctx, viewport }).promise;

    return await new Promise((resolve, reject)=>{
      if(mime === "image/png"){
        canvas.toBlob(b=> b ? resolve(b) : reject(new Error("toBlob failed")), "image/png");
      }else{
        canvas.toBlob(b=> b ? resolve(b) : reject(new Error("toBlob failed")), "image/jpeg", quality);
      }
    });
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  convertBtn.addEventListener("click", async ()=>{
    try{
      if(!pdfFiles.length) return setMsg(t().errNoPdf, "err");
      isWorking = true;
      setActiveUI(true);
      renderFileList();

      setMsg(t().preparing, "");
      await multiConvertAndDownload(pdfFiles);

      setMsg(t().okDone, "ok");
    }catch(e){
      setMsg((e && e.message) ? e.message : "Convert failed", "err");
    }finally{
      isWorking = false;
      setActiveUI(pdfFiles.length > 0);
      renderFileList();
    }
  });

  // init
  setLang(LANG, false);
  renderFileList();
});
</script>
</body>
</html>