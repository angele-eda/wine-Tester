<!doctype html>
<html lang="ko" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>PDF ‚Üí JPG/PNG | ConvertFiles24</title>
  <meta name="description" content="Convert PDF pages to JPG/PNG in your browser. 100% local processing (no server upload)." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --radius:16px;
      --pad:16px;
      --border:1px solid rgba(255,255,255,.12);
      --blue: 47,109,246;
      --ease: cubic-bezier(.2,.8,.2,1);
    }
    *{ box-sizing:border-box; }
    html, body{ width:100%; max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", sans-serif;
      background:#0b0f17;
      color:#e9eef7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    body:not(.loaded) .card, body:not(.loaded) .top{ opacity:0; transform: translateY(8px); }
    body.loaded .top{ animation: cfFadeUp .35s var(--ease) both; }
    body.loaded .card{ animation: cfFadeUp .38s var(--ease) both; }
    @keyframes cfFadeUp{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
      body:not(.loaded) .card, body:not(.loaded) .top{ opacity:1; transform:none; }
    }

    .wrap{
      max-width:980px;
      width:100%;
      margin:0 auto;
      padding:14px 14px 44px;
      overflow-x: clip;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:12px;
      min-width:0;
    }

    .title{
      margin:0;
      font-weight:900;
      letter-spacing:-0.35px;
      line-height:1.15;
      color:#ffffff;
      font-size:26px;
    }
    .sub{
      margin:8px 0 0;
      color:#a7b3c7;
      font-size:13px;
      line-height:1.45;
    }

    .homeBtn{
      width:100%;
      display:flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px;
      border-radius:999px;
      border:1px solid rgba(47,109,246,.55);
      background:rgba(47,109,246,.18);
      color:#e9eef7;
      font-weight:800;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      max-width:380px;
      transition: transform .08s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
    }
    .homeBtn:hover{ background:rgba(47,109,246,.24); }
    .homeBtn:active{ transform: scale(.99); }
    .homeBtn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px rgba(var(--blue),.35), 0 10px 24px rgba(0,0,0,.25);
    }

    .pill{
      width:100%;
      border:1px solid rgba(120, 200, 255, .22);
      background:rgba(120, 200, 255, .06);
      border-radius:999px;
      padding:10px 14px;
      color:#cfe6ff;
      font-size:13px;
      font-weight:800;
      display:flex; align-items:center; justify-content:center; gap:10px;
      min-width:0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .langRow{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      min-width:220px;
      max-width:100%;
      margin-left:auto;
    }
    .langLabel{
      font-size:12px;
      font-weight:800;
      color:#9fb0ca;
      letter-spacing:-0.2px;
      display:flex;
      align-items:center;
      gap:8px;
      opacity:.95;
    }
    .langSelect{
      width:220px;
      max-width:100%;
      padding:12px 12px;
      border-radius:999px;
      border:var(--border);
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      outline:none;
      font-weight:800;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease), transform .08s var(--ease);
    }
    .langSelect:focus-visible{
      outline:none;
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.25);
    }
    option{ background:#0b0f17; color:#e9eef7; }

    .card{
      border:var(--border);
      background:rgba(255,255,255,.03);
      border-radius:var(--radius);
      padding:var(--pad);
      margin-top:12px;
      min-width:0;
      max-width:100%;
      overflow-x: clip;
      will-change: transform, opacity;
    }
    .card h2{
      margin:0 0 10px;
      font-size:15px;
      color:#dbe7ff;
      letter-spacing:-0.2px;
      line-height:1.2;
      font-weight:800;
    }

    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:800;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:14px;
      letter-spacing: -0.2px;
      user-select:none;
      transition: transform .08s var(--ease), filter .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
      display:flex; align-items:center; justify-content:center; gap:10px;
      text-decoration:none;
    }
    .btn:hover{ filter: brightness(1.02); }
    .btn:active{ transform: scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; transform:none; filter:none; box-shadow:none; }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      min-width:0;
    }
    .row > *{
      flex:1;
      min-width:160px;
      max-width:100%;
      min-width:0;
    }

    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; font-weight:700; }
    select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      border:var(--border);
      outline:none;
      font-weight:800;
      max-width:100%;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease);
    }
    select:focus-visible{
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.22);
    }

    input[type="file"]{ position:absolute; left:-9999px; width:1px; height:1px; opacity:0; }

    /* ===== Upload action tiles (ÏÉòÌîåÏ≤òÎüº 3Í∞ú Î≤ÑÌäº) ===== */
    .actionTiles{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
      margin: 10px 0 12px;
    }
    @media (max-width: 520px){
      .actionTiles{ gap:10px; }
    }

    .tileBtn{
      appearance:none;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:#e9eef7;
      border-radius: 18px;
      padding: 14px 12px;
      min-height: 80px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-weight:900;
      letter-spacing:-0.2px;
      cursor:pointer;
      user-select:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03), 0 10px 24px rgba(0,0,0,.22);
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
    }
    .tileBtn:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.16);
    }
    .tileBtn:active{ transform: scale(.99); }
    .tileBtn:disabled{
      opacity:.45; cursor:not-allowed; transform:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .tileBtn.primary{
      border-color: rgba(47,109,246,.42);
      background: rgba(47,109,246,.16);
    }
    .tileBtn.primary:hover{
      background: rgba(47,109,246,.20);
      border-color: rgba(47,109,246,.50);
    }
    .tileBtn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px rgba(var(--blue),.22), inset 0 0 0 1px rgba(255,255,255,.03), 0 10px 24px rgba(0,0,0,.22);
    }

    /* labelÎèÑ Î≤ÑÌäºÏ≤òÎüº */
    .tileLabel{
      display:flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      width:100%;
    }

    .tileSubRow{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    /* ===== Drop box ===== */
    .drop{
      border:1px dashed rgba(255,255,255,0.22);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 18px;
      text-align:center;
      min-height: 190px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      transition: transform .08s var(--ease), border-color .12s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
      overflow:hidden;
    }
    .drop.dragover{
      border-color: rgba(47,109,246,.7);
      background: rgba(47,109,246,.10);
      box-shadow: 0 0 0 3px rgba(47,109,246,.18), inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .drop.active{
      border-color: rgba(120, 200, 255, .55);
      background: rgba(120, 200, 255, .08);
    }

    .dropInner{
      max-width: 520px;
      width:100%;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:center;
      padding-top: 2px;
    }

    /* ‚úÖ ÏïÑÏù¥ÏΩò/ÏÉâÍ∞ê ÏÇ¥Î¶¨Í∏∞ */
    .dropIcon{
      width:64px; height:64px;
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 24px rgba(0,0,0,.25), 0 0 0 1px rgba(255,255,255,.03) inset;
    }
    .dropIcon svg{
      width:34px; height:34px;
      opacity: 1;
      color: #eaf1ff;
      filter: drop-shadow(0 2px 10px rgba(47,109,246,.18));
    }

    .dropTitle{
      font-weight: 800;
      font-size: 18px;
      letter-spacing: -0.2px;
      color:#e9eef7;
      line-height:1.25;
    }
    .dropHint{
      color:#9fb0ca;
      font-size:12px;
      line-height:1.45;
      font-weight:600;
    }

    /* ‚úÖ Ïö∞Ï∏° ÏÉÅÎã® Í∞úÏàò Î±ÉÏßÄ */
    .countBadge{
      position:absolute;
      top:12px;
      right:12px;
      display:none;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      box-shadow: 0 8px 22px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.03);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      user-select:none;
    }
    .countBadge.show{ display:inline-flex; }
    .checkDot{
      width:22px; height:22px;
      border-radius:999px;
      background: rgba(35, 209, 116, .92);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 0 0 3px rgba(35, 209, 116, .18);
      flex: 0 0 auto;
    }
    .checkDot svg{ width:14px; height:14px; }
    .countText{
      font-weight:800;
      letter-spacing:-0.2px;
      font-size:13px;
      color:#e9eef7;
      white-space:nowrap;
    }
    .countNum{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:22px;
      height:22px;
      padding:0 8px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      font-weight:800;
      font-size:12px;
      color:#dbe7ff;
    }

    /* ===== list + items (‚úÖ Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ) ===== */
    .miniOk{
      display:flex; align-items:center; gap:10px;
      padding:9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      max-width:100%;
      min-width: 0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .miniOk .checkDot{ width:20px; height:20px; box-shadow: 0 0 0 3px rgba(35, 209, 116, .12); }
    .miniOk .checkDot svg{ width:13px; height:13px; }
    .miniOk .miniText{
      font-weight:800;
      letter-spacing:-0.2px;
      font-size:13px;
      color:#e9eef7;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* ‚úÖ BÎ≤ÑÏ†Ñ: Ïä§Î•¥Î•µ Ï†ëÌûò/ÌéºÏπ® (display Ï†úÍ±∞) */
    .fileListWrap{
      margin-top: 10px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      overflow:hidden;

      max-height:0;
      opacity:0;
      transform: translateY(-4px);
      transition: max-height .28s var(--ease),
                  opacity .2s var(--ease),
                  transform .2s var(--ease);
    }
    .fileListWrap.show{
      max-height: 420px;
      opacity:1;
      transform: translateY(0);
    }

    .fileList{
      max-height: 200px;
      overflow:auto;
      padding: 8px;
      display:flex;
      flex-direction:column;
      gap:8px;
      overscroll-behavior: contain;
    }
    @media (max-width: 520px){
      .fileList{ max-height: 170px; padding: 7px; gap:7px; }
    }

    .fileItem{
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      text-align:left;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }

    .fileBadge{
      width:38px; height:38px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(47,109,246,.12);
      border: 1px solid rgba(47,109,246,.26);
      flex:0 0 auto;
      box-shadow: 0 0 0 1px rgba(255,255,255,.02) inset;
    }
    .fileBadge svg{ width:20px; height:20px; opacity:1; filter: drop-shadow(0 2px 10px rgba(47,109,246,.14)); }

    .fileMeta{
      min-width:0;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .fileName{
      font-weight:650;
      font-size:13px;
      color:#eef3ff;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      letter-spacing:-0.15px;
      line-height:1.15;
    }
    .fileSub{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      min-width:0;
      color:#96a8c4;
      font-size:11.5px;
      font-weight:500;
      letter-spacing:-0.1px;
    }
    .dotSep{ opacity:.55; }

    .tag{
      flex:0 0 auto;
      font-weight:700;
      font-size:11.5px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:#dbe7ff;
    }

    .iconBtn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:#e9eef7;
      width:38px;
      height:38px;
      border-radius: 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
      flex: 0 0 auto;
    }
    .iconBtn:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.16); }
    .iconBtn:active{ transform: scale(.99); }
    .iconBtn svg{ width:18px; height:18px; opacity:1; filter: drop-shadow(0 2px 10px rgba(255,255,255,.06)); }

    .moveCol{
      display:flex;
      flex-direction:column;
      gap:6px;
      flex: 0 0 auto;
    }
    .miniIconBtn{
      width:38px;
      height:38px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:#e9eef7;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
    }
    .miniIconBtn:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.16); }
    .miniIconBtn:active{ transform: scale(.99); }
    .miniIconBtn:disabled{ opacity:.35; cursor:not-allowed; transform:none; }
    .miniIconBtn svg{ width:17px; height:17px; opacity:1; filter: drop-shadow(0 2px 10px rgba(255,255,255,.05)); }

    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; font-weight:600; }
    .msg.err{ color:#ffb4b4; }
    .msg.ok{ color:#b8ffcc; }

    /* ‚úÖ ÏßÑÌñâÎ∞î */
    .msgBox{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .msgRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-width:0;
    }
    .msgText{
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .msgPct{
      flex:0 0 auto;
      font-weight:800;
      font-size:12.5px;
      color:#b8ffcc;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(87,255,154,.28);
      background: rgba(87,255,154,.10);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .progressBar{
      height:10px;
      border-radius:999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .progressFill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, #57ff9a, #2ee59d);
      box-shadow: 0 0 18px rgba(87,255,154,.28);
      transition: width .28s var(--ease);
      position:relative;
    }
    .progressFill::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.18) 45%, rgba(255,255,255,0) 100%);
      transform: translateX(-60%);
      animation: cfShine 1.35s linear infinite;
      opacity:.55;
    }
    @keyframes cfShine{ to{ transform: translateX(160%); } }
    @media (prefers-reduced-motion: reduce){
      .progressFill{ transition:none; }
      .progressFill::after{ animation:none; }
    }

    .optionBlock{
      margin-top:12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
      border-radius: 18px;
      padding: 12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .optionBlock .row{ margin-top:0; }

    .footer{
      margin-top:16px;
      color:#94a6c2;
      font-size:12px;
      text-align:center;
    }
    .footer a{ color:#9fb0ca; text-decoration:none; border-bottom:1px dashed rgba(159,176,202,.35); }
    .footer a:hover{ color:#cfe0ff; border-bottom-color:rgba(207,224,255,.6); }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div style="flex:1; min-width:240px;">
        <h1 class="title" id="page_title">PDF ‚Üí JPG/PNG</h1>
        <p class="sub" id="page_sub">ÏóÖÎ°úÎìú ‚Üí Î≥ÄÌôò ‚Üí Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú. 100% Î°úÏª¨ Ï≤òÎ¶¨.</p>

        <div style="margin-top:10px;">
          <a class="homeBtn" href="/" id="home_btn">üè† ÌôàÏúºÎ°ú</a>
        </div>

        <div style="margin-top:10px;">
          <div class="pill">üîí <span id="local_processing">Î°úÏª¨ Ï≤òÎ¶¨ ‚Äî ÏÑúÎ≤Ñ ÏóÖÎ°úÎìú ÏóÜÏùå</span></div>
        </div>
      </div>

      <div class="langRow">
        <div class="langLabel">üåê <span id="lang_label">Ïñ∏Ïñ¥</span></div>
        <select class="langSelect" id="langSelect" aria-label="Language">
          <option value="en">Global (English)</option>
          <option value="ko" selected>ÌïúÍµ≠Ïñ¥</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
          <option value="es">Espa√±ol</option>
        </select>
      </div>
    </div>

    <!-- Upload -->
    <div class="card">
      <h2 id="h_upload">PDF ÏóÖÎ°úÎìú</h2>

      <div class="actionTiles" aria-label="upload actions">
        <button class="tileBtn" id="toggleListBtn" type="button" disabled>
          <span id="toggleListText">Î™©Î°ù Ïó¥Í∏∞</span>
          <span id="toggleCaret" style="margin-left:8px;">‚ñæ</span>
        </button>

        <label class="tileBtn primary tileLabel" for="fileInput" id="pickLabel">Ôºã PDF Ï∂îÍ∞Ä</label>

        <button class="tileBtn" id="clearBtn" type="button" disabled>üßπ ÎπÑÏö∞Í∏∞</button>
      </div>

      <div class="drop" id="drop" role="button" aria-label="PDF dropzone">
        <div class="countBadge" id="countBadge" aria-live="polite">
          <span class="checkDot" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M20 6L9 17l-5-5" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="countText" id="countText">PDF</span>
          <span class="countNum" id="countNum">0</span>
        </div>

        <div class="dropInner">
          <div class="dropIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M14 2v6h6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M8 13h8M8 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>

          <div class="dropTitle" id="drop_title">Ïó¨Í∏∞Ïóê PDFÎ•º ÎÅåÏñ¥Îã§ ÎÜìÍ±∞ÎÇò ÌÉ≠Ìï¥ÏÑú ÏóÖÎ°úÎìú</div>
          <div class="dropHint" id="drop_hint">ÌåÅ: Ïó¨Îü¨ PDFÎèÑ Ìïú Î≤àÏóê Î≥ÄÌôòÌï† Ïàò ÏûàÏñ¥Ïöî.</div>
        </div>
      </div>

      <div class="tileSubRow">
        <div class="miniOk" id="miniOk" style="display:none;">
          <span class="checkDot" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M20 6L9 17l-5-5" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <div class="miniText" id="miniOkText">PDF 0Í∞ú Ï∂îÍ∞ÄÎê®</div>
        </div>
      </div>

      <div class="fileListWrap" id="fileListWrap" aria-label="File list">
        <div class="fileList" id="fileList"></div>
      </div>

      <input id="fileInput" type="file" accept="application/pdf,.pdf" multiple />
      <div class="msg" id="msg"></div>
    </div>

    <!-- Convert -->
    <div class="card">
      <h2 id="h_convert">Î≥ÄÌôò</h2>

      <div class="row">
        <div>
          <label id="lbl_format">ÌòïÏãù</label>
          <select id="outFormat">
            <option value="image/jpeg" selected>JPG</option>
            <option value="image/png">PNG</option>
          </select>
        </div>
        <div>
          <label id="lbl_quality">ÌíàÏßà</label>
          <select id="quality">
            <option value="0.95">ÏµúÍ≥† (0.95)</option>
            <option value="0.90" selected>ÎÜíÏùå (0.90)</option>
            <option value="0.80">Î≥¥ÌÜµ (0.80)</option>
            <option value="0.70">ÏûëÍ≤å (0.70)</option>
          </select>
        </div>
      </div>

      <div class="optionBlock" aria-label="more options">
        <div class="row">
          <div>
            <label id="lbl_scale">Ï∂úÎ†• ÌÅ¨Í∏∞</label>
            <select id="scale">
              <option value="2.0">ÏÑ†Î™Ö (2x)</option>
              <option value="1.5" selected>Ï∂îÏ≤ú (1.5x)</option>
              <option value="1.0">Í∞ÄÎ≤ºÏõÄ (1x)</option>
            </select>
          </div>
          <div>
            <label id="lbl_bg">Î∞∞Í≤Ω</label>
            <select id="bg">
              <option value="auto" selected>ÏûêÎèô</option>
              <option value="white">Ìù∞ÏÉâ</option>
              <option value="black">Í≤ÄÏ†ï</option>
            </select>
          </div>
          <div>
            <label id="lbl_name">ÌååÏùºÎ™Ö</label>
            <select id="nameRule">
              <option value="original" selected>ÏõêÎ≥∏Î™Ö + ÌéòÏù¥ÏßÄ</option>
              <option value="simple">Í∞ÑÎã®Ìïú ÎÇ†ÏßúÌòï</option>
            </select>
          </div>
        </div>

        <div class="msg" style="margin-top:10px; color:#9fb0ca;" id="opt_hint">
          Ï∂úÎ†• ÌÅ¨Í∏∞Îäî ÏÑ†Î™ÖÎèÑ/Ïö©ÎüâÏóê ÏòÅÌñ•ÏùÑ Ï§çÎãàÎã§.
        </div>
      </div>

      <div class="msg" style="margin-top:10px; color:#9fb0ca;" id="zip_hint">Ïó¨Îü¨ ÌéòÏù¥ÏßÄÎ©¥ ZIPÏúºÎ°ú Î¨∂Ïñ¥ÏÑú ÎÇ¥Î†§Î∞õÏäµÎãàÎã§.</div>

      <div style="height:10px;"></div>
      <button class="btn" id="convertBtn" type="button" disabled>üß© Î≥ÄÌôò ÌõÑ Îã§Ïö¥Î°úÎìú</button>
    </div>

    <div class="footer">
      ¬© <span id="year"></span> ConvertFiles24 ¬∑
      <a href="/privacy.html">Privacy</a> ¬∑
      <a href="/terms.html">Terms</a>
    </div>
  </div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  "use strict";
  const $ = (id)=>document.getElementById(id);
  $("year").textContent = new Date().getFullYear();
  requestAnimationFrame(()=> document.body.classList.add("loaded"));

  // ===== i18n =====
  const STR = {
    ko:{
      title:"PDF ‚Üí JPG/PNG",
      sub:"ÏóÖÎ°úÎìú ‚Üí Î≥ÄÌôò ‚Üí Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú. 100% Î°úÏª¨ Ï≤òÎ¶¨.",
      home:"üè† ÌôàÏúºÎ°ú",
      local:"Î°úÏª¨ Ï≤òÎ¶¨ ‚Äî ÏÑúÎ≤Ñ ÏóÖÎ°úÎìú ÏóÜÏùå",
      lang:"Ïñ∏Ïñ¥",
      upload:"PDF ÏóÖÎ°úÎìú",
      dropTitle:"Ïó¨Í∏∞Ïóê PDFÎ•º ÎÅåÏñ¥Îã§ ÎÜìÍ±∞ÎÇò ÌÉ≠Ìï¥ÏÑú ÏóÖÎ°úÎìú",
      dropHint:"ÌåÅ: Ïó¨Îü¨ PDFÎèÑ Ìïú Î≤àÏóê Î≥ÄÌôòÌï† Ïàò ÏûàÏñ¥Ïöî.",
      add:"Ôºã PDF Ï∂îÍ∞Ä",
      clear:"üßπ ÎπÑÏö∞Í∏∞",
      listShow:"Î™©Î°ù Ïó¥Í∏∞",
      listHide:"Î™©Î°ù Îã´Í∏∞",
      convert:"Î≥ÄÌôò",
      format:"ÌòïÏãù",
      quality:"ÌíàÏßà",
      zip:"Ïó¨Îü¨ ÌéòÏù¥ÏßÄÎ©¥ ZIPÏúºÎ°ú Î¨∂Ïñ¥ÏÑú ÎÇ¥Î†§Î∞õÏäµÎãàÎã§.",
      run:"üß© Î≥ÄÌôò ÌõÑ Îã§Ïö¥Î°úÎìú",
      errNoPdf:"PDF ÌååÏùºÏùÑ Î®ºÏ†Ä Ï∂îÍ∞ÄÌï¥ Ï£ºÏÑ∏Ïöî.",
      errEngine:"PDF ÏóîÏßÑ Î°úÎìú Ïã§Ìå® (pdf.js). ÏÉàÎ°úÍ≥†Ïπ® ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.",
      errZip:"ZIP ÏóîÏßÑ Î°úÎìú Ïã§Ìå® (JSZip). ÏÉàÎ°úÍ≥†Ïπ® ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.",
      errPassword:"ÏïîÌò∏Í∞Ä Í±∏Î¶∞ PDFÎäî Î≥ÄÌôòÏù¥ Ïñ¥Î†§Ïö∏ Ïàò ÏûàÏñ¥Ïöî.",
      okReady:"Ï§ÄÎπÑ ÏôÑÎ£å. Î≥ÄÌôò Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.",
      okDone:"‚úÖ Î≥ÄÌôò ÏôÑÎ£å",
      addedN:(n)=>`PDF ${n}Í∞ú Ï∂îÍ∞ÄÎê®`,
      converting:"Î≥ÄÌôò Ï§ë...",
      preparing:"ÏóîÏßÑ Ï§ÄÎπÑ Ï§ë...",
      buildingZip:"ZIP ÎßåÎìúÎäî Ï§ë...",
      scale:"Ï∂úÎ†• ÌÅ¨Í∏∞",
      bg:"Î∞∞Í≤Ω",
      name:"ÌååÏùºÎ™Ö",
      optHint:"Ï∂úÎ†• ÌÅ¨Í∏∞Îäî ÏÑ†Î™ÖÎèÑ/Ïö©ÎüâÏóê ÏòÅÌñ•ÏùÑ Ï§çÎãàÎã§."
    },
    en:{
      title:"PDF ‚Üí JPG/PNG",
      sub:"Upload ‚Üí convert ‚Üí download images. 100% local processing.",
      home:"üè† Home",
      local:"Processed locally ‚Äî no server upload",
      lang:"Language",
      upload:"PDF Upload",
      dropTitle:"Drop PDFs here or tap to upload",
      dropHint:"Tip: You can convert multiple PDFs at once.",
      add:"Ôºã Add PDFs",
      clear:"üßπ Clear",
      listShow:"Open list",
      listHide:"Hide list",
      convert:"Convert",
      format:"Format",
      quality:"Quality",
      zip:"Multiple pages will be downloaded as a ZIP.",
      run:"üß© Convert & Download",
      errNoPdf:"Please add PDFs first.",
      errEngine:"PDF engine failed to load (pdf.js). Refresh and try again.",
      errZip:"ZIP engine failed to load (JSZip). Refresh and try again.",
      errPassword:"Password-protected PDFs may fail.",
      okReady:"Ready. Press Convert.",
      okDone:"‚úÖ Done",
      addedN:(n)=>`${n} PDF(s) added`,
      converting:"Converting...",
      preparing:"Preparing engine...",
      buildingZip:"Building ZIP...",
      scale:"Output size",
      bg:"Background",
      name:"Filename",
      optHint:"Output size affects clarity and file size."
    },
    es:{
      title:"PDF ‚Üí JPG/PNG",
      sub:"Sube ‚Üí convierte ‚Üí descarga im√°genes. 100% local.",
      home:"üè† Inicio",
      local:"Procesado local ‚Äî sin servidor",
      lang:"Idioma",
      upload:"Subir PDF",
      dropTitle:"Suelta PDFs aqu√≠ o toca para subir",
      dropHint:"Tip: Puedes convertir varios PDFs a la vez.",
      add:"Ôºã A√±adir PDFs",
      clear:"üßπ Limpiar",
      listShow:"Abrir lista",
      listHide:"Ocultar lista",
      convert:"Convertir",
      format:"Formato",
      quality:"Calidad",
      zip:"Varias p√°ginas se descargar√°n en ZIP.",
      run:"üß© Convertir y descargar",
      errNoPdf:"Agrega PDFs primero.",
      errEngine:"Motor PDF no cargado (pdf.js). Recarga e int√©ntalo.",
      errZip:"Motor ZIP no cargado (JSZip). Recarga e int√©ntalo.",
      errPassword:"Los PDFs con contrase√±a pueden fallar.",
      okReady:"Listo. Pulsa Convertir.",
      okDone:"‚úÖ Listo",
      addedN:(n)=>`${n} PDF(s) agregado(s)`,
      converting:"Convirtiendo...",
      preparing:"Preparando motor...",
      buildingZip:"Creando ZIP...",
      scale:"Tama√±o",
      bg:"Fondo",
      name:"Nombre",
      optHint:"El tama√±o afecta claridad y peso."
    },
    ja:{
      title:"PDF ‚Üí JPG/PNG",
      sub:"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ ‚Üí Â§âÊèõ ‚Üí ÁîªÂÉè„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÄÇ100% „É≠„Éº„Ç´„É´Âá¶ÁêÜ„ÄÇ",
      home:"üè† „Éõ„Éº„É†",
      local:"„É≠„Éº„Ç´„É´Âá¶ÁêÜ ‚Äî „Çµ„Éº„Éê„Éº„Å™„Åó",
      lang:"Ë®ÄË™û",
      upload:"PDF „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ",
      dropTitle:"„Åì„Åì„Å´PDF„Çí„Éâ„É≠„ÉÉ„Éó„ÄÅ„Åæ„Åü„ÅØ„Çø„ÉÉ„Éó„Åó„Å¶ÈÅ∏Êäû",
      dropHint:"Tip: Ë§áÊï∞PDF„Çí‰∏ÄÂ∫¶„Å´Â§âÊèõ„Åß„Åç„Åæ„Åô„ÄÇ",
      add:"Ôºã PDF ËøΩÂä†",
      clear:"üßπ „ÇØ„É™„Ç¢",
      listShow:"‰∏ÄË¶ß„ÇíÈñã„Åè",
      listHide:"‰∏ÄË¶ß„ÇíÈñâ„Åò„Çã",
      convert:"Â§âÊèõ",
      format:"ÂΩ¢Âºè",
      quality:"ÂìÅË≥™",
      zip:"Ë§áÊï∞„Éö„Éº„Ç∏„ÅØZIP„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ",
      run:"üß© Â§âÊèõ„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ",
      errNoPdf:"ÂÖà„Å´PDF„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
      errEngine:"PDF„Ç®„É≥„Ç∏„É≥Êú™Ë™≠Ëæº (pdf.js)„ÄÇÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
      errZip:"ZIP„Ç®„É≥„Ç∏„É≥Êú™Ë™≠Ëæº (JSZip)„ÄÇÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
      errPassword:"„Éë„Çπ„ÉØ„Éº„Éâ‰ªò„ÅçPDF„ÅØÂ§±Êïó„Åô„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
      okReady:"Ê∫ñÂÇôOK„ÄÇÂ§âÊèõ„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
      okDone:"‚úÖ ÂÆå‰∫Ü",
      addedN:(n)=>`PDF ${n}‰ª∂ ËøΩÂä†Ê∏à„Åø`,
      converting:"Â§âÊèõ‰∏≠...",
      preparing:"„Ç®„É≥„Ç∏„É≥Ê∫ñÂÇô‰∏≠...",
      buildingZip:"ZIP‰ΩúÊàê‰∏≠...",
      scale:"Âá∫Âäõ„Çµ„Ç§„Ç∫",
      bg:"ËÉåÊôØ",
      name:"„Éï„Ç°„Ç§„É´Âêç",
      optHint:"Âá∫Âäõ„Çµ„Ç§„Ç∫„ÅØÈÆÆÊòé„Åï/ÂÆπÈáè„Å´ÂΩ±Èüø„Åó„Åæ„Åô„ÄÇ"
    }
  };

  function detectLang(){
    const qp = (new URL(location.href).searchParams.get("lang")||"").toLowerCase();
    if(STR[qp]) return qp;

    // ‚úÖ URLÏóê langÍ∞Ä ÏûàÏúºÎ©¥ "ÏàòÎèô"ÏúºÎ°ú Ï∑®Í∏âÌï¥ÏÑú Í≥†Ï†ï (Í≥µÏú†/Ïû¨Î∞©Î¨∏ ÏïàÏ†ï)
    if(qp){
      localStorage.setItem("cf24_lang", qp);
      localStorage.setItem("cf24_lang_manual","1");
    }

    const manual = localStorage.getItem("cf24_lang_manual") === "1";
    const saved = localStorage.getItem("cf24_lang");
    if(manual && saved && STR[saved]) return saved;

    const nav = (navigator.language||"").toLowerCase();
    if(nav.startsWith("ko")) return "ko";
    if(nav.startsWith("ja")) return "ja";
    if(nav.startsWith("es")) return "es";
    return "en";
  }

  let LANG = detectLang();
  const t = ()=> STR[LANG] || STR.en;

  function setLang(lang, isManual=false){
    if(!STR[lang]) lang="en";
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    if(isManual) localStorage.setItem("cf24_lang_manual","1");

    $("langSelect").value = lang;
    document.documentElement.lang = lang;

    $("page_title").textContent = t().title;
    $("page_sub").textContent = t().sub;
    $("home_btn").textContent = t().home;
    $("local_processing").textContent = t().local;
    $("lang_label").textContent = t().lang;

    $("h_upload").textContent = t().upload;
    $("drop_title").textContent = t().dropTitle;
    $("drop_hint").textContent = t().dropHint;

    $("pickLabel").textContent = t().add;
    $("clearBtn").textContent = t().clear;

    $("h_convert").textContent = t().convert;
    $("lbl_format").textContent = t().format;
    $("lbl_quality").textContent = t().quality;
    $("zip_hint").textContent = t().zip;
    $("convertBtn").textContent = t().run;

    $("lbl_scale").textContent = t().scale;
    $("lbl_bg").textContent = t().bg;
    $("lbl_name").textContent = t().name;
    $("opt_hint").textContent = t().optHint;

    // ‚úÖ Î≤àÏó≠ ÎàÑÎùΩ Î∞©ÏßÄ: Î¶¨Ïä§Ìä∏/Î±ÉÏßÄ/ÎØ∏ÎãàÌÖçÏä§Ìä∏ÍπåÏßÄ Í∞ïÏ†ú Ïû¨Î†åÎçî
    renderList();
    refreshBadgeAndTexts();
  }
  $("langSelect").addEventListener("change",(e)=>setLang(e.target.value, true));

  // ===== state =====
  const drop = $("drop");
  const fileInput = $("fileInput");
  const clearBtn = $("clearBtn");
  const convertBtn = $("convertBtn");
  const outFormatEl = $("outFormat");
  const qualityEl = $("quality");
  const scaleEl = $("scale");
  const bgEl = $("bg");
  const nameRuleEl = $("nameRule");
  const msgEl = $("msg");

  const countBadge = $("countBadge");
  const countNum = $("countNum");
  const countText = $("countText");
  const miniOk = $("miniOk");
  const miniOkText = $("miniOkText");
  const toggleListBtn = $("toggleListBtn");
  const fileListWrap = $("fileListWrap");
  const fileList = $("fileList");

  let pdfFiles = []; // { id, file }

  // ‚úÖ msg + progress
  function renderMsg(text, cls, pct){
    msgEl.className = "msg " + (cls || "");
    const hasText = !!(text && String(text).trim());
    const hasPct = (typeof pct === "number" && isFinite(pct));
    if(!hasText && !hasPct){
      msgEl.innerHTML = "";
      return;
    }

    const safeText = escapeHtml(String(text||""));
    const pctClamped = hasPct ? Math.max(0, Math.min(100, Math.round(pct))) : null;

    if(hasPct){
      msgEl.innerHTML = `
        <div class="msgBox">
          <div class="msgRow">
            <div class="msgText">${safeText}</div>
            <div class="msgPct">${pctClamped}%</div>
          </div>
          <div class="progressBar" aria-label="progress">
            <div class="progressFill" id="progressFill" style="width:${pctClamped}%;"></div>
          </div>
        </div>
      `;
    }else{
      msgEl.textContent = text || "";
    }
  }
  function setMsg(text, cls){
    renderMsg(text, cls, null);
  }
  function setProgress(text, pct){
    renderMsg(text, "", pct);
  }

  function bytesToSize(bytes){
    if(!bytes && bytes !== 0) return "";
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return `${v.toFixed(i===0?0:2)} ${units[i]}`;
  }
  function uid(){
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function refreshBadgeAndTexts(){
    const n = pdfFiles.length;

    if(n > 0){
      countBadge.classList.add("show");
      countText.textContent = "PDF";
      countNum.textContent = String(n);
    }else{
      countBadge.classList.remove("show");
      countNum.textContent = "0";
    }

    if(n > 0){
      miniOk.style.display = "flex";
      miniOkText.textContent = t().addedN(n);
    }else{
      miniOk.style.display = "none";
    }

    clearBtn.disabled = (n === 0);
    convertBtn.disabled = (n === 0);
    toggleListBtn.disabled = (n === 0);

    drop.classList.toggle("active", n > 0);

    $("toggleListText").textContent = fileListWrap.classList.contains("show") ? t().listHide : t().listShow;
    $("toggleCaret").textContent = fileListWrap.classList.contains("show") ? "‚ñ¥" : "‚ñæ";
  }

  function renderList(){
    fileList.innerHTML = "";
    pdfFiles.forEach((it, idx)=>{
      const f = it.file;
      const item = document.createElement("div");
      item.className = "fileItem";
      item.dataset.id = it.id;

      item.innerHTML = `
        <div class="fileBadge" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14 2v6h6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </div>

        <div class="fileMeta">
          <div class="fileName" title="${escapeHtml(f.name || "document.pdf")}">${escapeHtml(f.name || "document.pdf")}</div>
          <div class="fileSub">
            <span>${escapeHtml(bytesToSize(f.size))}</span>
            <span class="dotSep">‚Ä¢</span>
            <span>#${idx+1}</span>
          </div>
        </div>

        <span class="tag">PDF</span>

        <div class="moveCol" aria-label="Move">
          <button class="miniIconBtn upBtn" type="button" ${idx===0 ? "disabled":""} aria-label="Move up">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 6l-6 6h12l-6-6z" fill="currentColor"/>
            </svg>
          </button>
          <button class="miniIconBtn downBtn" type="button" ${idx===pdfFiles.length-1 ? "disabled":""} aria-label="Move down">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 18l6-6H6l6 6z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <button class="iconBtn delBtn" type="button" aria-label="Delete">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 6V4h8v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 6l1 16h10l1-16" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M10 11v7M14 11v7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      `;

      item.querySelector(".delBtn").addEventListener("click", ()=>{
        pdfFiles = pdfFiles.filter(x=>x.id !== it.id);
        renderList();
        refreshBadgeAndTexts();

        if(pdfFiles.length === 0){
          fileListWrap.classList.remove("show");
          setMsg("", "");
        }else{
          setMsg(t().okReady, "ok");
        }
      });

      item.querySelector(".upBtn").addEventListener("click", ()=>{
        if(idx<=0) return;
        const tmp = pdfFiles[idx-1];
        pdfFiles[idx-1] = pdfFiles[idx];
        pdfFiles[idx] = tmp;
        renderList();
        refreshBadgeAndTexts();
      });

      item.querySelector(".downBtn").addEventListener("click", ()=>{
        if(idx>=pdfFiles.length-1) return;
        const tmp = pdfFiles[idx+1];
        pdfFiles[idx+1] = pdfFiles[idx];
        pdfFiles[idx] = tmp;
        renderList();
        refreshBadgeAndTexts();
      });

      fileList.appendChild(item);
    });

    refreshBadgeAndTexts();
  }

  function addFiles(fileListObj){
    const arr = Array.from(fileListObj || []);
    const onlyPdf = arr.filter(f=> f && (f.type === "application/pdf" || (f.name||"").toLowerCase().endsWith(".pdf")));
    if(onlyPdf.length === 0) return;

    onlyPdf.forEach(f=> pdfFiles.push({ id: uid(), file: f }));

    renderList();
    setMsg(t().okReady, "ok");
  }

  function escapeHtml(s){
    return String(s||"").replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  // ===== Drop events =====
  drop.addEventListener("click", ()=> { fileInput.click(); });

  ["dragenter","dragover"].forEach(ev=>{
    drop.addEventListener(ev, (e)=>{
      e.preventDefault();
      e.stopPropagation();
      drop.classList.add("dragover");
    });
  });
  ["dragleave","drop"].forEach(ev=>{
    drop.addEventListener(ev, (e)=>{
      e.preventDefault();
      e.stopPropagation();
      drop.classList.remove("dragover");
    });
  });
  drop.addEventListener("drop", (e)=>{
    const files = e.dataTransfer && e.dataTransfer.files;
    if(!files || !files.length) return;
    addFiles(files);
  });

  fileInput.addEventListener("change", ()=>{
    const files = fileInput.files;
    if(!files || !files.length) return;
    addFiles(files);
    fileInput.value = "";
  });

  clearBtn.addEventListener("click", ()=>{
    pdfFiles = [];
    renderList();
    fileListWrap.classList.remove("show");
    setMsg("", "");
  });

  toggleListBtn.addEventListener("click", ()=>{
    const show = !fileListWrap.classList.contains("show");
    fileListWrap.classList.toggle("show", show);
    refreshBadgeAndTexts();
  });

  // ===== Robust script loader (LOCAL first, CDN fallback) =====
  function loadScript(url){
    return new Promise((resolve, reject)=>{
      const s = document.createElement("script");
      s.src = url;
      s.async = true;
      s.onload = () => resolve(url);
      s.onerror = () => reject(new Error("Failed: " + url));
      document.head.appendChild(s);
    });
  }

  async function ensurePdfJs(){
    if(window.pdfjsLib) return true;

    try{
      await loadScript("/assets/pdfjs/pdf.min.js");
      if(window.pdfjsLib){
        window.pdfjsLib.GlobalWorkerOptions.workerSrc = "/assets/pdfjs/pdf.worker.min.js";
        return true;
      }
    }catch(e){}

    const candidates = [
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/build/pdf.min.js",
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js",
      "https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"
    ];
    for(const url of candidates){
      try{
        await loadScript(url);
        if(window.pdfjsLib){
          window.pdfjsLib.GlobalWorkerOptions.workerSrc = url.replace("pdf.min.js","pdf.worker.min.js");
          return true;
        }
      }catch(e){}
    }
    return false;
  }

  async function ensureJSZip(){
    if(window.JSZip) return true;

    try{
      await loadScript("/assets/jszip/jszip.min.js");
      if(window.JSZip) return true;
    }catch(e){}

    const candidates = [
      "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",
      "https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js",
      "https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"
    ];
    for(const url of candidates){
      try{
        await loadScript(url);
        if(window.JSZip) return true;
      }catch(e){}
    }
    return false;
  }

  function pad(n, len=2){ return String(n).padStart(len,"0"); }
  function stamp(){
    const d = new Date();
    return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}_${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
  }
  function makeBaseName(fileName){
    const base = (fileName || "pdf").replace(/\.[^.]+$/, "");
    const rule = nameRuleEl.value || "original";
    if(rule === "simple") return `cf24_${stamp()}`;
    return base;
  }

  // ===== Convert (multi pdf) =====
  async function getPdfPageCount(file){
    const okPdf = await ensurePdfJs();
    if(!okPdf) throw new Error(t().errEngine);

    const pdfjsLib = window.pdfjsLib;
    const arrayBuf = await file.arrayBuffer();
    try{
      const doc = await pdfjsLib.getDocument({ data: arrayBuf }).promise;
      const n = doc.numPages || 0;
      try{ doc.destroy && doc.destroy(); }catch(e){}
      return n;
    }catch(e){
      throw new Error(t().errPassword);
    }
  }

  async function pdfToImagesAndDownload(file, onPageDone){
    const okPdf = await ensurePdfJs();
    if(!okPdf) throw new Error(t().errEngine);

    const pdfjsLib = window.pdfjsLib;
    const arrayBuf = await file.arrayBuffer();

    let pdf;
    try{
      pdf = await pdfjsLib.getDocument({ data: arrayBuf }).promise;
    }catch(e){
      throw new Error(t().errPassword);
    }

    const total = pdf.numPages || 0;
    if(total <= 0) throw new Error("PDF pages not found.");

    const outMime = outFormatEl.value;
    const q = parseFloat(qualityEl.value || "0.9");
    const scaleUser = parseFloat(scaleEl.value || "1.5");
    const bgMode = bgEl.value || "auto";

    const makePng = (outMime === "image/png");
    const base = makeBaseName(file.name || "pdf");
    const ext = makePng ? "png" : "jpg";
    const out = [];

    if(total === 1){
      const blob = await renderPageToBlob(pdf, 1, outMime, q, scaleUser, bgMode);
      out.push({ blob, name: `${base}_page1.${ext}` });
      if(onPageDone) onPageDone(1, total);
      return out;
    }

    for(let p=1; p<=total; p++){
      const blob = await renderPageToBlob(pdf, p, outMime, q, scaleUser, bgMode);
      const name = `${base}_page${String(p).padStart(3,"0")}.${ext}`;
      out.push({ blob, name });
      if(onPageDone) onPageDone(p, total);
    }
    return out;
  }

  function resolveBgColor(mime, mode){
    if(mode === "white") return "#ffffff";
    if(mode === "black") return "#000000";
    if(mime === "image/jpeg") return "#ffffff";
    return null;
  }

  async function renderPageToBlob(pdf, pageNum, mime, quality, userScale, bgMode){
    const page = await pdf.getPage(pageNum);

    const baseTest = page.getViewport({ scale: 2.0 });
    const megaPixels = (baseTest.width * baseTest.height) / 1_000_000;
    const safety = megaPixels > 18 ? 0.85 : 1.0;

    const scale = Math.max(1.0, Math.min(2.5, userScale)) * safety;
    const viewport = page.getViewport({ scale });

    const bgColor = resolveBgColor(mime, bgMode);
    const forceOpaque = (bgColor !== null);

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d", { alpha: !forceOpaque && (mime !== "image/jpeg") });

    canvas.width = Math.round(viewport.width);
    canvas.height = Math.round(viewport.height);

    if(bgColor){
      ctx.fillStyle = bgColor;
      ctx.fillRect(0,0,canvas.width, canvas.height);
    }else if(mime === "image/jpeg"){
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,canvas.width, canvas.height);
    }

    await page.render({ canvasContext: ctx, viewport }).promise;

    return await new Promise((resolve, reject)=>{
      if(mime === "image/png"){
        canvas.toBlob(b=> b ? resolve(b) : reject(new Error("toBlob failed")), "image/png");
      }else{
        canvas.toBlob(b=> b ? resolve(b) : reject(new Error("toBlob failed")), "image/jpeg", quality);
      }
    });
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  // ‚úÖ Ïä§Î•¥Î•µ Îã´Í∏∞ (Îã§Ïö¥Î°úÎìú Ìä∏Î¶¨Í±∞Ïóê ÎßâÌûàÏßÄ ÏïäÍ≤å 'Îã§Ïö¥Î°úÎìú Ï†ÑÏóê' Ïã§Ìñâ)
  function forceCloseListNow(){
    if(fileListWrap.classList.contains("show")){
      fileListWrap.classList.remove("show");
      refreshBadgeAndTexts();
    }
  }

  convertBtn.addEventListener("click", async ()=>{
    try{
      if(pdfFiles.length === 0) return setMsg(t().errNoPdf, "err");
      convertBtn.disabled = true;
      clearBtn.disabled = true;
      toggleListBtn.disabled = true;

      setProgress(t().preparing, 2);

      const okPdf = await ensurePdfJs();
      if(!okPdf) throw new Error(t().errEngine);

      const okZip = await ensureJSZip();
      if(!okZip) throw new Error(t().errZip);

      setProgress(t().preparing, 6);
      let totalPages = 0;
      for(let i=0; i<pdfFiles.length; i++){
        const n = await getPdfPageCount(pdfFiles[i].file);
        totalPages += Math.max(1, n||0);
        const pct = 6 + Math.round(((i+1)/pdfFiles.length) * 14);
        setProgress(t().preparing, pct);
      }
      totalPages = Math.max(1, totalPages);

      const zip = new window.JSZip();
      let donePages = 0;

      const totalFiles = pdfFiles.length;
      for(let fi=0; fi<totalFiles; fi++){
        const it = pdfFiles[fi];
        const items = await pdfToImagesAndDownload(it.file, ()=>{
          donePages++;
          const pct = 20 + (donePages / totalPages) * 70;
          setProgress(`(${fi+1}/${totalFiles}) ${t().converting}`, pct);
        });
        items.forEach(({blob, name})=> zip.file(name, blob));
      }

      setProgress(t().buildingZip, 92);
      const zipBlob = await zip.generateAsync({ type:"blob" }, (meta)=>{
        const p = 92 + (Math.max(0, Math.min(1, (meta.percent||0)/100)) * 8);
        setProgress(t().buildingZip, p);
      });

      // ‚úÖ 1) Î®ºÏ†Ä Îã´Í≥†
      forceCloseListNow();

      // ‚úÖ 2) Í∑∏ Îã§Ïùå Îã§Ïö¥Î°úÎìú Ìä∏Î¶¨Í±∞
      downloadBlob(zipBlob, `pdf_images_${Date.now()}.zip`);

      renderMsg(t().okDone, "ok", 100);

    }catch(e){
      const msg = (e && e.message) ? e.message : "Convert failed";
      renderMsg(msg, "err", null);
    }finally{
      convertBtn.disabled = (pdfFiles.length === 0);
      clearBtn.disabled = (pdfFiles.length === 0);
      toggleListBtn.disabled = (pdfFiles.length === 0);
    }
  });

  setLang(LANG, false);
  renderList();
});
</script>
</body>
</html>