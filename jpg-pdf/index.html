<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>JPG to PDF | ConvertFiles24</title>
  <meta name="description" content="Convert JPG/PNG/WebP images to PDF. 100% local processing (no server upload)." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- PDF-lib (create PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

  <style>
    :root{
      --radius:16px;
      --pad:16px;
      --border:1px solid rgba(255,255,255,.12);
      --blue: 47,109,246;
      --ease: cubic-bezier(.2,.8,.2,1);

      --softBlueBg: rgba(120, 200, 255, .06);
      --softBlueBd: rgba(120, 200, 255, .22);
      --softBlueTx: #cfe6ff;
      --softBlueHi: rgba(120, 200, 255, .12);
    }
    *{ box-sizing:border-box; }
    html, body{ width:100%; max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", sans-serif;
      background:#0b0f17;
      color:#e9eef7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    body:not(.loaded) .card, body:not(.loaded) .top{ opacity:0; transform: translateY(8px); }
    body.loaded .top{ animation: cfFadeUp .35s var(--ease) both; }
    body.loaded .card{ animation: cfFadeUp .38s var(--ease) both; }
    @keyframes cfFadeUp{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
      body:not(.loaded) .card, body:not(.loaded) .top{ opacity:1; transform:none; }
    }

    .wrap{ max-width:980px; width:100%; margin:0 auto; padding:22px 14px 44px; overflow-x: clip; }
    .top{ display:flex; align-items:flex-start; justify-content:space-between; gap:14px; flex-wrap:wrap; margin-bottom:14px; min-width:0; }
    .title{ margin:0; font-weight:900; letter-spacing:-0.35px; line-height:1.15; color:#fff; font-size:22px; }
    .sub{ margin:8px 0 0; color:#a7b3c7; font-size:13px; line-height:1.45; }

    .homeBtn{
      width:100%; display:flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px; border-radius:999px;
      border:1px solid rgba(47,109,246,.55);
      background:rgba(47,109,246,.18);
      color:#e9eef7; font-weight:900; cursor:pointer; text-decoration:none; user-select:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      max-width:380px;
      transition: transform .08s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
    }
    .homeBtn:hover{ background:rgba(47,109,246,.24); }
    .homeBtn:active{ transform: scale(.99); }
    .homeBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.35), 0 10px 24px rgba(0,0,0,.25); }

    .langRow{ display:flex; flex-direction:column; align-items:flex-end; gap:8px; min-width:220px; max-width:100%; margin-left:auto; }
    .langLabel{ font-size:12px; font-weight:900; color:#9fb0ca; letter-spacing:-0.2px; display:flex; align-items:center; gap:8px; opacity:.95; }
    .langSelect{
      width:220px; max-width:100%; padding:12px 12px; border-radius:999px;
      border:var(--border); background:rgba(255,255,255,.06); color:#e9eef7; outline:none; font-weight:900;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease), transform .08s var(--ease);
    }
    .langSelect:focus-visible{ outline:none; border-color: rgba(var(--blue), .55); box-shadow: 0 0 0 3px rgba(var(--blue),.25); }
    option{ background:#0b0f17; color:#e9eef7; }

    .pill{
      width:100%; border:1px solid rgba(120, 200, 255, .22);
      background:rgba(120, 200, 255, .06);
      border-radius:999px; padding:10px 14px; color:#cfe6ff; font-size:13px; font-weight:900;
      display:flex; align-items:center; justify-content:center; gap:10px; min-width:0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .card{ border:var(--border); background:rgba(255,255,255,.03); border-radius:var(--radius); padding:var(--pad); margin-top:12px; min-width:0; max-width:100%; overflow-x: clip; }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; letter-spacing:-0.2px; }

    /* âœ… ê¸°ë³¸ rowëŠ” ê·¸ëŒ€ë¡œ */
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; min-width:0; }
    .row > *{ flex:1; min-width:160px; max-width:100%; }

    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:900;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:14px;
      letter-spacing: -0.2px;
      user-select:none;
      transition: transform .08s var(--ease), filter .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease);
    }
    .btn.secondary{
      background: var(--softBlueBg);
      border: 1px solid var(--softBlueBd);
      color: var(--softBlueTx);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .btn.secondary:hover{ background: var(--softBlueHi); }
    .btn:hover{ filter: brightness(1.03); }
    .btn:active{ transform: scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.25); }
    .btn:disabled{
      opacity:1; cursor:not-allowed; transform:none; box-shadow:none;
      filter: saturate(.7);
      background: linear-gradient(180deg, rgba(47,109,246,.40), rgba(47,109,246,.30));
      color:#ffffff;
    }
    .btn.secondary:disabled{
      filter:none;
      background: rgba(120, 200, 255, .05);
      border: 1px solid rgba(120, 200, 255, .16);
      color: rgba(207, 230, 255, .70);
      box-shadow:none;
    }

    input[type="file"]{ display:none; }

    /* âœ… ì—…ë¡œë“œ ë²„íŠ¼ë§Œ: ê°€ë¡œ 1ì¤„ 3ê°œ ê³ ì • */
    .uploadRow{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
      align-items:stretch;
    }
    .uploadRow .btn{ min-width:0; }

    /* Drop */
    .drop{
      border:1px dashed rgba(255,255,255,.18);
      border-radius:14px; padding:18px;
      background:rgba(255,255,255,.02);
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition: background .15s var(--ease), border-color .15s var(--ease), box-shadow .15s var(--ease), transform .05s var(--ease);
      position: relative;
      min-height: 170px;
      display:flex; align-items:center; justify-content:center;
      max-width:100%;
      overflow:hidden;
    }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); box-shadow: 0 0 0 3px rgba(106,169,255,.10) inset; }
    .drop:active{ transform: scale(0.998); }
    .drop:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.25); }

    .drop.hasFiles{
      border-color: rgba(120,200,255,.32);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 18px 40px rgba(0,0,0,.18);
      background: rgba(255,255,255,.025);
    }

    .dropEmoji{ font-size:42px; line-height:1; margin:10px 0 8px; filter: drop-shadow(0 10px 22px rgba(0,0,0,.28)); }
    .hint{ margin-top:10px; color:#9fb0ca; font-size:12px; line-height:1.5; }
    .small{ color:#a7b3c7; font-size:12px; line-height:1.5; }

    .countBadge{
      position:absolute;
      top:10px; right:10px;
      display:none;
      align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(120,200,255,.26);
      background: rgba(120,200,255,.08);
      color:#cfe6ff;
      font-size:12px;
      font-weight:900;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      user-select:none;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }
    .countBadge .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(47,109,246,.9);
      box-shadow: 0 0 0 3px rgba(47,109,246,.15);
    }

    .fileBar{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .fileBarLeft{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:#a7b3c7; font-size:12px; font-weight:900;
    }
    .toggleBtn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.045);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:800;
      font-size:12px;
      letter-spacing: -0.15px;
      text-rendering: geometricPrecision;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
    }
    .toggleBtn:hover{ background: rgba(255,255,255,.06); }
    .toggleBtn:active{ transform: scale(.99); }
    .toggleBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }

    .fileList{
      margin-top:10px;
      display:none;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .fileList.show{ display:block; }

    /* âœ… ë†’ì´ ì¤„ì´ê¸°: stretch â†’ center */
    .fileItem{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
    }
    .fileItem + .fileItem{ margin-top:10px; }
    .fileLeft{ min-width:0; flex: 1; }
    .fileName{ font-weight:800; color:#e9eef7; letter-spacing:-0.2px; word-break: break-word; }

    /* âœ… ë©”íƒ€ ì¤„ì—ì„œ Page pill ë¶™ì¼ ê±°ë¼ inline-flexë¡œ ìì—°ìŠ¤ëŸ½ê²Œ */
    .fileMeta{
      margin-top:4px;
      color:#a7b3c7;
      font-size:12px;
      line-height:1.45;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    /* âœ… ì˜¤ë¥¸ìª½: ê°€ë¡œ 1ì¤„ ë²„íŠ¼ */
    .fileRight{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:8px;
      min-width: 0;
      flex: 0 0 auto;
    }

    .iconBtn{
      appearance:none; border:none; cursor:pointer;
      padding:8px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:900;
      font-size:12px;
      line-height:1;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
      min-width: 38px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .iconBtn:hover{ background: rgba(255,255,255,.07); }
    .iconBtn:active{ transform: scale(.99); }
    .iconBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }
    .iconBtn.danger{
      background: rgba(255, 110, 110, .08);
      border-color: rgba(255, 110, 110, .22);
      color: #ffd6d6;
    }
    .iconBtn.danger:hover{
      background: rgba(255, 110, 110, .12);
      border-color: rgba(255, 110, 110, .30);
    }
    .iconBtn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
      filter:none;
    }

    /* âœ… Page pill (ì™¼ìª½ í•˜ë‹¨: Page ê³ ì • + ìˆ«ìë§Œ ë³€ê²½) */
    .pagePill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:#cfe0ff;
      font-size:11px;
      font-weight:900;
      white-space:nowrap;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .pagePill .pageLabel{ opacity:.85; }
    .pagePill .pageNum{ opacity:1; }

    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; }
    select, input[type="text"], input[type="number"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      border:var(--border);
      outline:none;
      font-weight:900;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease);
    }
    select:focus-visible, input:focus-visible{
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.22);
    }

    /* âœ… Margin details (collapsible) */
    .detailsBox{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .detailsSummary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      user-select:none;
    }
    .detailsSummary::-webkit-details-marker{ display:none; }
    .sumLeft{
      display:flex;
      align-items:baseline;
      gap:10px;
      min-width:0;
    }
    .sumTitle{
      font-weight:900;
      color:#dbe7ff;
      letter-spacing:-0.2px;
      white-space:nowrap;
    }
    .sumValue{
      font-weight:900;
      color:#cfe6ff;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(120,200,255,.20);
      background: rgba(120,200,255,.06);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      white-space:nowrap;
    }
    .sumHint{
      color:#9fb0ca;
      font-weight:900;
      white-space:nowrap;
    }
    .detailsBody{
      padding:12px;
      border-top:1px solid rgba(255,255,255,.08);
    }

    .pillRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .miniBtn{
      flex:1; min-width: 180px;
      appearance:none; border:none; cursor:pointer;
      padding:12px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      text-align:left;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
    }
    .miniBtn:hover{ background: rgba(255,255,255,.07); }
    .miniBtn:active{ transform: scale(.99); }
    .miniBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue), .55); }
    .miniBtn[aria-pressed="true"]{
      background: rgba(47,109,246,.16);
      border-color: rgba(47,109,246,.55);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .miniBtnTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .miniBtnName{ font-weight:900; letter-spacing:-0.2px; }
    .badge{
      font-size:11px; font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:#cfe0ff;
      white-space:nowrap;
    }
    .miniDesc{ margin-top:6px; color:#a7b3c7; font-size:12px; line-height:1.45; }

    /* âœ… Timestamp: í…ìŠ¤íŠ¸ ON/OFF ë²„íŠ¼ */
    .tsToggle{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      min-width:190px;
      user-select:none;
      max-width:100%;
      overflow:hidden;
    }
    .tsToggle .label{
      font-size:12px; font-weight:900; color:#dbe7ff;
      letter-spacing:-0.2px;
      display:flex; align-items:center; gap:8px;
      white-space:nowrap;
      min-width:0;
    }
    .tsToggleRight{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      flex:0 0 auto;
      min-width:0;
    }
    .tsBtn{
      appearance:none;
      cursor:pointer;
      border-radius:999px;
      padding:8px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color:#cfe6ff;
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
    }
    .tsBtn:hover{ background: rgba(255,255,255,.06); }
    .tsBtn:active{ transform: scale(.99); }
    .tsBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }
    .tsBtn[aria-pressed="true"]{
      background: rgba(47,109,246,.20);
      border-color: rgba(47,109,246,.55);
      color:#e9f0ff;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .tsBtn[aria-pressed="false"]{
      background: rgba(255,110,110,.06);
      border-color: rgba(255,110,110,.22);
      color: rgba(255,214,214,.92);
    }

    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .msg.err{ color:#ffb4b4; }
    .msg.ok{ color:#b8ffcc; }

    .meta{ color:#b7c3d9; font-size:13px; line-height:1.5; word-break:break-word; min-width:0; }
    .meta b{ color:#e9eef7; }

    .legal{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      color:#a7b3c7;
      font-size:12px;
      line-height:1.55;
    }
    .legal b{ color:#dbe7ff; }

    .footer{ margin-top:16px; color:#94a6c2; font-size:12px; text-align:center; }
    .footer a{ color:#9fb0ca; text-decoration:none; border-bottom:1px dashed rgba(159,176,202,.35); }
    .footer a:hover{ color:#cfe0ff; border-bottom-color:rgba(207,224,255,.6); }

    .bar{
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      margin-top:8px;
      display:none;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: rgba(47,109,246,.9);
      transition: width .15s var(--ease);
    }

    /* PC two-column feel for settings */
    @media (min-width: 860px){
      .settingsGrid{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:10px;
        align-items:start;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div style="flex:1; min-width:240px;">
        <h1 class="title" id="page_title">JPG â†’ PDF</h1>
        <p class="sub" id="page_sub">Upload â†’ reorder â†’ convert â†’ download. 100% local processing.</p>

        <div style="margin-top:10px;">
          <a class="homeBtn" href="/" id="home_btn">ğŸ  Home</a>
        </div>

        <div style="margin-top:10px;">
          <div class="pill">ğŸ”’ <span id="local_processing">Processed locally â€” no server upload</span></div>
        </div>
      </div>

      <div class="langRow">
        <div class="langLabel">ğŸŒ <span id="lang_label">Language</span></div>
        <select class="langSelect" id="langSelect" aria-label="Language">
          <option value="en">Global (English)</option>
          <option value="ko">í•œêµ­ì–´</option>
          <option value="es">EspaÃ±ol</option>
          <option value="ja">æ—¥æœ¬èª</option>
        </select>
      </div>
    </div>

    <div class="card">
      <h2 id="h_step1">Image Upload</h2>

      <!-- âœ… ì—…ë¡œë“œ ë²„íŠ¼: ê°€ë¡œ 1ì¤„ 3ê°œ -->
      <div class="uploadRow">
        <button class="btn secondary" id="pickBtn" type="button">ğŸ–¼ï¸ Choose images</button>
        <button class="btn secondary" id="addBtn" type="button" disabled>â• Add</button>
        <button class="btn secondary" id="clearBtn" type="button" disabled>ğŸ§¹ Clear</button>
      </div>

      <div style="height:10px;"></div>

      <div class="drop" id="drop" role="button" tabindex="0" aria-label="Upload images">
        <div class="countBadge" id="countBadge">
          <span class="dot" aria-hidden="true"></span>
          <span id="countText">0</span>
        </div>
        <div style="width:100%;">
          <div style="font-weight:900; margin-bottom:6px;" id="drop_title">Drop images here<br/>or tap to upload</div>
          <div class="dropEmoji" aria-hidden="true">ğŸ–¼ï¸</div>
          <div class="hint" id="drop_hint">JPG/PNG/WebP â†’ PDF. No server upload.</div>
        </div>
      </div>

      <div class="fileBar">
        <div class="fileBarLeft">
          <span id="selectedPill">âœ… <span id="selectedCount">0</span></span>
        </div>
        <button class="toggleBtn" id="toggleListBtn" type="button" disabled>â–¾ Show list</button>
      </div>

      <div class="fileList" id="fileList" aria-label="File list"></div>

      <div class="msg" id="msg"></div>
      <div class="bar" id="bar"><div id="barFill"></div></div>
    </div>

    <div class="card">
      <h2 id="h_step2">PDF Settings</h2>

      <div class="settingsGrid">
        <div>
          <label id="lbl_page">Page size</label>
          <select id="pageSize" disabled>
            <option value="A4" selected>A4 (210Ã—297mm)</option>
            <option value="LETTER">Letter (8.5Ã—11in)</option>
          </select>
          <div class="small" id="page_hint">A4 is best for documents.</div>
        </div>

        <div>
          <label id="lbl_orient">Orientation</label>
          <select id="orientation" disabled>
            <option value="AUTO" selected>Auto</option>
            <option value="PORTRAIT">Portrait</option>
            <option value="LANDSCAPE">Landscape</option>
          </select>
          <div class="small" id="orient_hint">Auto matches each image.</div>
        </div>

        <div>
          <label id="lbl_fit">Fit mode</label>
          <select id="fitMode" disabled>
            <option value="FIT" selected>Fit (keep all)</option>
            <option value="FILL">Fill (crop)</option>
            <option value="STRETCH">Stretch</option>
          </select>
          <div class="small" id="fit_hint">Fit keeps the whole image.</div>
        </div>

        <div>
          <label id="lbl_bg">Background</label>
          <select id="bgColor" disabled>
            <option value="#FFFFFF" selected>White</option>
            <option value="#000000">Black</option>
            <option value="#F3F4F6">Light gray</option>
          </select>
          <div class="small" id="bg_hint">Used for margins/empty space.</div>
        </div>
      </div>

      <div style="height:10px;"></div>

      <!-- âœ… íŒŒì¼ëª… + íƒ€ì„ìŠ¤íƒ¬í”„(í…ìŠ¤íŠ¸ ë²„íŠ¼) -->
      <div class="row" style="align-items:flex-start;">
        <div>
          <label id="lbl_name">Filename</label>
          <input id="outName" type="text" placeholder="images_to_pdf" value="images_to_pdf" />
          <div class="small" id="name_hint">Timestamp can be appended automatically.</div>
        </div>

        <div>
          <label>&nbsp;</label>
          <div class="tsToggle" role="group" aria-label="Timestamp toggle">
            <div class="label">ğŸ•’ <span id="ts_label">Timestamp</span></div>
            <div class="tsToggleRight">
              <button class="tsBtn" id="tsBtn" type="button" aria-pressed="true">ON</button>
            </div>
          </div>
        </div>
      </div>

      <div style="height:10px;"></div>

      <div>
        <label id="lbl_margin">Margin (mm)</label>

        <details class="detailsBox" id="marginDetails">
          <summary class="detailsSummary" id="marginSummary">
            <span class="sumLeft">
              <span class="sumTitle" id="marginTitle">Margin</span>
              <span class="sumValue"><span id="marginValueText">6</span>mm</span>
            </span>
            <span class="sumHint" id="marginHintInline">â–¾</span>
          </summary>

          <div class="detailsBody">
            <div class="pillRow" style="margin-bottom:10px;">
              <button class="miniBtn" id="m0" type="button" aria-pressed="false">
                <div class="miniBtnTop"><div class="miniBtnName" id="m0_name">0 (None)</div><div class="badge">0</div></div>
                <div class="miniDesc" id="m0_desc">No margin</div>
              </button>
              <button class="miniBtn" id="m6" type="button" aria-pressed="true">
                <div class="miniBtnTop"><div class="miniBtnName" id="m6_name">6 (Default)</div><div class="badge">6</div></div>
                <div class="miniDesc" id="m6_desc">Nice for documents</div>
              </button>
              <button class="miniBtn" id="m12" type="button" aria-pressed="false">
                <div class="miniBtnTop"><div class="miniBtnName" id="m12_name">12 (Wide)</div><div class="badge">12</div></div>
                <div class="miniDesc" id="m12_desc">More whitespace</div>
              </button>
            </div>

            <input id="marginMm" type="number" min="0" max="30" step="1" value="6" />
            <div class="small" id="margin_hint">You can also type a value (0â€“30).</div>
          </div>
        </details>
      </div>

      <div style="height:12px;"></div>

      <div class="row">
        <button class="btn" id="convertBtn" type="button" disabled>â¬‡ï¸ Convert & Download PDF</button>
      </div>

      <div class="legal" id="legal_box">
        <b>Notice</b><br/>
        Images are processed locally in your browser. Always verify the output for important documents.
      </div>

      <div style="height:12px;"></div>
      <div class="meta" id="meta"><b>Status</b><br/>Upload images to start.</div>
    </div>

    <div class="footer">
      Â© <span id="year"></span> ConvertFiles24 Â·
      <a href="/privacy.html">Privacy</a> Â·
      <a href="/terms.html">Terms</a>
    </div>
  </div>

  <input id="pickInput" type="file" accept="image/jpeg,image/png,image/webp" multiple>

<script>
(() => {
  "use strict";

  // âœ… ë‹¨ì¼ $ë§Œ ì‚¬ìš© (ì¤‘ë³µ ì„ ì–¸ ì œê±°)
  const $ = (id)=>document.getElementById(id);

  $("year").textContent = new Date().getFullYear();
  requestAnimationFrame(()=> document.body.classList.add("loaded"));

  const STR = {
    ko:{
      page_title:"JPG â†’ PDF",
      page_sub:"ì—…ë¡œë“œ â†’ ìˆœì„œì •ë¦¬ â†’ ë³€í™˜ â†’ ë‹¤ìš´ë¡œë“œ. 100% ë¡œì»¬ ì²˜ë¦¬.",
      home:"ğŸ  í™ˆìœ¼ë¡œ",
      local:"ë¡œì»¬ ì²˜ë¦¬ â€” ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ",
      lang_label:"ì–¸ì–´",

      h1:"ì´ë¯¸ì§€ ì—…ë¡œë“œ",
      pick:"ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„ íƒ",
      add:"â• ì¶”ê°€",
      clear:"ğŸ§¹ ë¹„ìš°ê¸°",
      drop_title:"ì—¬ê¸°ì— ì´ë¯¸ì§€ë¥¼ ëŒì–´ë‹¤ ë†“ê±°ë‚˜<br/>íƒ­í•´ì„œ ì—…ë¡œë“œ",
      drop_hint:"JPG/PNG/WebP â†’ PDF. ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ.",
      toggle_open:"â–¾ ëª©ë¡ ì—´ê¸°",
      toggle_close:"â–´ ëª©ë¡ ìˆ¨ê¸°ê¸°",
      selected:(n)=>`âœ… ì„ íƒë¨: ${n}ê°œ`,

      h2:"PDF ì„¤ì •",
      lbl_page:"í˜ì´ì§€ í¬ê¸°",
      page_hint:"ë¬¸ì„œìš©ì€ A4ê°€ ì¢‹ì•„ìš”.",
      lbl_orient:"ë°©í–¥",
      orient_hint:"ìë™ì€ ì´ë¯¸ì§€ì— ë§ì¶° ì„ íƒí•´ìš”.",
      lbl_fit:"ë§ì¶¤ ë°©ì‹",
      fit_hint:"Fitì€ ì´ë¯¸ì§€ê°€ ì˜ë¦¬ì§€ ì•Šì•„ìš”.",
      lbl_bg:"ë°°ê²½ìƒ‰",
      bg_hint:"ì—¬ë°±/ë¹ˆ ê³µê°„ì— ì‚¬ìš©ë¼ìš”.",

      lbl_margin:"ì—¬ë°±(mm)",
      marginTitle:"ì—¬ë°±",
      margin_hint:"ì§ì ‘ ì…ë ¥ë„ ê°€ëŠ¥(0â€“30).",
      m0_name:"0 (ì—†ìŒ)",
      m0_desc:"ì—¬ë°± ì—†ìŒ",
      m6_name:"6 (ê¸°ë³¸)",
      m6_desc:"ë¬¸ì„œì— ë³´ê¸° ì¢‹ì•„ìš”",
      m12_name:"12 (ë„‰ë„‰)",
      m12_desc:"ì—¬ë°±ì´ ë” ë„“ì–´ìš”",

      lbl_name:"íŒŒì¼ëª…",
      name_hint:"íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ìë™ìœ¼ë¡œ ë¶™ì¼ ìˆ˜ ìˆì–´ìš”.",
      ts_label:"íƒ€ì„ìŠ¤íƒ¬í”„",
      ts_on:"ON",
      ts_off:"OFF",

      go:"â¬‡ï¸ PDF ë³€í™˜ & ë‹¤ìš´ë¡œë“œ",
      legal_title:"ì•ˆë‚´",
      legal_body:"ì´ë¯¸ì§€ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì¤‘ìš”í•œ ë¬¸ì„œëŠ” ê²°ê³¼ë¬¼ì„ ê¼­ í™•ì¸í•˜ì„¸ìš”.",
      meta_idle:"<b>ìƒíƒœ</b><br/>ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.",
      meta_loaded:(n)=>`<b>ìƒíƒœ</b><br/>${n}ê°œ ì´ë¯¸ì§€ ì¤€ë¹„ ì™„ë£Œ`,
      msg_need:"ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.",
      msg_work:"ì‘ì—… ì¤‘â€¦ ì´ íƒ­ì„ ë‹«ì§€ ë§ˆì„¸ìš”.",
      msg_done:"âœ… ì™„ë£Œ",
      msg_fail:"ë³€í™˜ ì‹¤íŒ¨",

      del:"ì‚­ì œ",
      up:"ìœ„ë¡œ",
      down:"ì•„ë˜ë¡œ",

      opt_auto:"Auto",
      opt_portrait:"Portrait",
      opt_landscape:"Landscape",
      opt_fit:"Fit (keep all)",
      opt_fill:"Fill (crop)",
      opt_stretch:"Stretch",
      opt_white:"White",
      opt_black:"Black",
      opt_gray:"Light gray"
    },
    en:{
      page_title:"JPG â†’ PDF",
      page_sub:"Upload â†’ reorder â†’ convert â†’ download. 100% local processing.",
      home:"ğŸ  Home",
      local:"Processed locally â€” no server upload",
      lang_label:"Language",

      h1:"Image Upload",
      pick:"ğŸ–¼ï¸ Choose images",
      add:"â• Add",
      clear:"ğŸ§¹ Clear",
      drop_title:"Drop images here<br/>or tap to upload",
      drop_hint:"JPG/PNG/WebP â†’ PDF. No server upload.",
      toggle_open:"â–¾ Show list",
      toggle_close:"â–´ Hide list",
      selected:(n)=>`âœ… Selected: ${n}`,

      h2:"PDF Settings",
      lbl_page:"Page size",
      page_hint:"A4 is best for documents.",
      lbl_orient:"Orientation",
      orient_hint:"Auto matches each image.",
      lbl_fit:"Fit mode",
      fit_hint:"Fit keeps the whole image.",
      lbl_bg:"Background",
      bg_hint:"Used for margins/empty space.",

      lbl_margin:"Margin (mm)",
      marginTitle:"Margin",
      margin_hint:"You can also type a value (0â€“30).",
      m0_name:"0 (None)",
      m0_desc:"No margin",
      m6_name:"6 (Default)",
      m6_desc:"Nice for documents",
      m12_name:"12 (Wide)",
      m12_desc:"More whitespace",

      lbl_name:"Filename",
      name_hint:"Timestamp can be appended automatically.",
      ts_label:"Timestamp",
      ts_on:"ON",
      ts_off:"OFF",

      go:"â¬‡ï¸ Convert & Download PDF",
      legal_title:"Notice",
      legal_body:"Images are processed locally in your browser. Always verify the output for important documents.",
      meta_idle:"<b>Status</b><br/>Upload images to start.",
      meta_loaded:(n)=>`<b>Status</b><br/>${n} image(s) ready`,
      msg_need:"Please upload images first.",
      msg_work:"Workingâ€¦ keep this tab open.",
      msg_done:"âœ… Done",
      msg_fail:"Conversion failed.",

      del:"Delete",
      up:"Up",
      down:"Down",

      opt_auto:"Auto",
      opt_portrait:"Portrait",
      opt_landscape:"Landscape",
      opt_fit:"Fit (keep all)",
      opt_fill:"Fill (crop)",
      opt_stretch:"Stretch",
      opt_white:"White",
      opt_black:"Black",
      opt_gray:"Light gray"
    },
    es:{
      page_title:"JPG â†’ PDF",
      page_sub:"Sube â†’ ordena â†’ convierte â†’ descarga. 100% procesamiento local.",
      home:"ğŸ  Inicio",
      local:"Procesado localmente â€” sin subir al servidor",
      lang_label:"Idioma",

      h1:"Subir imÃ¡genes",
      pick:"ğŸ–¼ï¸ Elegir imÃ¡genes",
      add:"â• AÃ±adir",
      clear:"ğŸ§¹ Limpiar",
      drop_title:"Suelta imÃ¡genes aquÃ­<br/>o toca para subir",
      drop_hint:"JPG/PNG/WebP â†’ PDF. Sin subir al servidor.",
      toggle_open:"â–¾ Ver lista",
      toggle_close:"â–´ Ocultar lista",
      selected:(n)=>`âœ… Seleccionadas: ${n}`,

      h2:"Ajustes de PDF",
      lbl_page:"TamaÃ±o de pÃ¡gina",
      page_hint:"A4 es mejor para documentos.",
      lbl_orient:"OrientaciÃ³n",
      orient_hint:"Auto se ajusta a cada imagen.",
      lbl_fit:"Ajuste",
      fit_hint:"Fit mantiene toda la imagen.",
      lbl_bg:"Fondo",
      bg_hint:"Para mÃ¡rgenes/espacio vacÃ­o.",

      lbl_margin:"Margen (mm)",
      marginTitle:"Margen",
      margin_hint:"TambiÃ©n puedes escribir un valor (0â€“30).",
      m0_name:"0 (Sin)",
      m0_desc:"Sin margen",
      m6_name:"6 (Por defecto)",
      m6_desc:"Ideal para documentos",
      m12_name:"12 (Amplio)",
      m12_desc:"MÃ¡s espacio",

      lbl_name:"Nombre de archivo",
      name_hint:"Se puede aÃ±adir marca de tiempo automÃ¡ticamente.",
      ts_label:"Timestamp",
      ts_on:"ON",
      ts_off:"OFF",

      go:"â¬‡ï¸ Convertir y descargar PDF",
      legal_title:"Aviso",
      legal_body:"Las imÃ¡genes se procesan localmente en tu navegador. Verifica el resultado si es importante.",
      meta_idle:"<b>Estado</b><br/>Sube imÃ¡genes para empezar.",
      meta_loaded:(n)=>`<b>Estado</b><br/>${n} imagen(es) listas`,
      msg_need:"Primero sube imÃ¡genes.",
      msg_work:"Trabajandoâ€¦ no cierres esta pestaÃ±a.",
      msg_done:"âœ… Hecho",
      msg_fail:"FallÃ³ la conversiÃ³n.",

      del:"Eliminar",
      up:"Arriba",
      down:"Abajo",

      opt_auto:"Auto",
      opt_portrait:"Retrato",
      opt_landscape:"Paisaje",
      opt_fit:"Fit (mantener todo)",
      opt_fill:"Fill (recortar)",
      opt_stretch:"Estirar",
      opt_white:"Blanco",
      opt_black:"Negro",
      opt_gray:"Gris claro"
    },
    ja:{
      page_title:"JPG â†’ PDF",
      page_sub:"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ ä¸¦ã¹æ›¿ãˆ â†’ å¤‰æ› â†’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚100% ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã€‚",
      home:"ğŸ  ãƒ›ãƒ¼ãƒ ",
      local:"ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç† â€” ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãªã—",
      lang_label:"è¨€èª",

      h1:"ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      pick:"ğŸ–¼ï¸ ç”»åƒã‚’é¸æŠ",
      add:"â• è¿½åŠ ",
      clear:"ğŸ§¹ ã‚¯ãƒªã‚¢",
      drop_title:"ã“ã“ã«ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹<br/>ã‚¿ãƒƒãƒ—ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      drop_hint:"JPG/PNG/WebP â†’ PDFã€‚ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãªã—ã€‚",
      toggle_open:"â–¾ ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º",
      toggle_close:"â–´ ãƒªã‚¹ãƒˆã‚’éš ã™",
      selected:(n)=>`âœ… é¸æŠ: ${n}`,

      h2:"PDFè¨­å®š",
      lbl_page:"ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º",
      page_hint:"æ–‡æ›¸ã«ã¯A4ãŒãŠã™ã™ã‚ã€‚",
      lbl_orient:"å‘ã",
      orient_hint:"è‡ªå‹•ã¯ç”»åƒã«åˆã‚ã›ã¾ã™ã€‚",
      lbl_fit:"ãƒ•ã‚£ãƒƒãƒˆæ–¹å¼",
      fit_hint:"Fitã¯ç”»åƒã‚’åˆ‡ã‚Šã¾ã›ã‚“ã€‚",
      lbl_bg:"èƒŒæ™¯è‰²",
      bg_hint:"ä½™ç™½/ç©ºç™½ã«ä½¿ç”¨ã€‚",

      lbl_margin:"ä½™ç™½(mm)",
      marginTitle:"ä½™ç™½",
      margin_hint:"æ•°å€¤å…¥åŠ›ã‚‚å¯èƒ½ (0â€“30)ã€‚",
      m0_name:"0 (ãªã—)",
      m0_desc:"ä½™ç™½ãªã—",
      m6_name:"6 (æ¨™æº–)",
      m6_desc:"æ–‡æ›¸å‘ã‘",
      m12_name:"12 (åºƒã‚)",
      m12_desc:"ä½™ç™½ãŒåºƒã„",

      lbl_name:"ãƒ•ã‚¡ã‚¤ãƒ«å",
      name_hint:"ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è‡ªå‹•ä»˜ä¸ã§ãã¾ã™ã€‚",
      ts_label:"Timestamp",
      ts_on:"ON",
      ts_off:"OFF",

      go:"â¬‡ï¸ PDF å¤‰æ› & ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
      legal_title:"æ¡ˆå†…",
      legal_body:"ç”»åƒã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã•ã‚Œã¾ã™ã€‚é‡è¦ãªæ–‡æ›¸ã¯å¿…ãšçµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
      meta_idle:"<b>çŠ¶æ…‹</b><br/>ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨é–‹å§‹ã§ãã¾ã™ã€‚",
      meta_loaded:(n)=>`<b>çŠ¶æ…‹</b><br/>${n}æšã®ç”»åƒãŒæº–å‚™ã§ãã¾ã—ãŸ`,
      msg_need:"å…ˆã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚",
      msg_work:"å‡¦ç†ä¸­â€¦ ã“ã®ã‚¿ãƒ–ã‚’é–‰ã˜ãªã„ã§ãã ã•ã„ã€‚",
      msg_done:"âœ… å®Œäº†",
      msg_fail:"å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",

      del:"å‰Šé™¤",
      up:"ä¸Šã¸",
      down:"ä¸‹ã¸",

      opt_auto:"Auto",
      opt_portrait:"ç¸¦",
      opt_landscape:"æ¨ª",
      opt_fit:"Fit (å…¨ä½“)",
      opt_fill:"Fill (ãƒˆãƒªãƒŸãƒ³ã‚°)",
      opt_stretch:"ä¼¸ç¸®",
      opt_white:"ç™½",
      opt_black:"é»’",
      opt_gray:"è–„ã„ã‚°ãƒ¬ãƒ¼"
    }
  };

  function getQueryLang(){
    try{
      const u = new URL(location.href);
      const q = (u.searchParams.get("lang")||"").toLowerCase();
      if(q && STR[q]) return q;
    }catch(e){}
    return null;
  }
  function detectLang(){
    const q = getQueryLang();
    if(q) return q;
    const saved = localStorage.getItem("cf24_lang");
    if(saved && STR[saved]) return saved;
    const nav = (navigator.language || "").toLowerCase();
    if(nav.startsWith("ko")) return "ko";
    if(nav.startsWith("ja")) return "ja";
    if(nav.startsWith("es")) return "es";
    return "en";
  }
  let LANG = detectLang();
  function t(){ return STR[LANG] || STR.en; }

  const pickInput = $("pickInput");
  const pickBtn = $("pickBtn");
  const addBtn = $("addBtn");
  const clearBtn = $("clearBtn");
  const drop = $("drop");
  const msgEl = $("msg");
  const metaEl = $("meta");
  const convertBtn = $("convertBtn");
  const bar = $("bar");
  const barFill = $("barFill");

  const countBadge = $("countBadge");
  const countText = $("countText");
  const selectedCount = $("selectedCount");
  const selectedPill = $("selectedPill");
  const fileList = $("fileList");
  const toggleListBtn = $("toggleListBtn");

  // Settings
  const pageSizeEl = $("pageSize");
  const orientEl = $("orientation");
  const fitEl = $("fitMode");
  const bgEl = $("bgColor");
  const marginMmEl = $("marginMm");
  const outNameEl = $("outName");

  // margin presets
  const m0 = $("m0"), m6 = $("m6"), m12 = $("m12");
  const marginValueText = $("marginValueText");
  const marginDetails = $("marginDetails");
  const marginHintInline = $("marginHintInline");

  // âœ… timestamp text button
  const tsBtn = $("tsBtn");

  function esc(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }
  function setMsg(text, cls){
    msgEl.textContent = text || "";
    msgEl.className = "msg " + (cls || "");
  }
  function setProg(pct){
    bar.style.display = "block";
    barFill.style.width = Math.max(0, Math.min(100, pct)) + "%";
  }
  function hideProg(){
    bar.style.display = "none";
    barFill.style.width = "0%";
  }

  let files = [];
  let listOpen = false;

  // timestamp ON/OFF (persist)
  let tsOn = (localStorage.getItem("cf24_jpgpdf_ts") ?? "1") === "1";

  function syncTsUI(){
    if(!tsBtn) return;
    tsBtn.setAttribute("aria-pressed", tsOn ? "true" : "false");
    tsBtn.textContent = tsOn ? (t().ts_on || "ON") : (t().ts_off || "OFF");
  }
  function toggleTimestamp(){
    tsOn = !tsOn;
    localStorage.setItem("cf24_jpgpdf_ts", tsOn ? "1" : "0");
    syncTsUI();
  }
  if(tsBtn){
    tsBtn.addEventListener("click", toggleTimestamp);
    tsBtn.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" || e.key === " "){ e.preventDefault(); toggleTimestamp(); }
    });
  }

  // Margin details arrow sync
  if(marginDetails && marginHintInline){
    const sync = ()=>{ marginHintInline.textContent = marginDetails.open ? "â–´" : "â–¾"; };
    marginDetails.addEventListener("toggle", sync);
    sync();
  }

  function openPicker(){
    pickInput.value="";
    pickInput.click();
  }
  pickBtn.addEventListener("click", openPicker);
  addBtn.addEventListener("click", openPicker);

  drop.addEventListener("click", openPicker);
  drop.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){ e.preventDefault(); openPicker(); }
  });
  ["dragenter","dragover"].forEach(evt=>{
    drop.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add("drag"); });
  });
  ["dragleave","drop"].forEach(evt=>{
    drop.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove("drag"); });
  });
  drop.addEventListener("drop", (e)=>{
    const fl = e.dataTransfer.files;
    if(fl && fl.length) loadFiles(Array.from(fl));
  });

  pickInput.addEventListener("change", (e)=>{
    const fl = e.target.files;
    if(fl && fl.length) loadFiles(Array.from(fl));
  });

  clearBtn.addEventListener("click", ()=>{
    files = [];
    listOpen = false;
    fileList.classList.remove("show");
    hideProg();
    setMsg("", "");
    updateUI();
    updateFileList();
  });

  toggleListBtn.addEventListener("click", ()=>{
    if(!files.length) return;
    listOpen = !listOpen;
    if(listOpen) fileList.classList.add("show");
    else fileList.classList.remove("show");
    updateToggleText();
  });

  function updateToggleText(){
    toggleListBtn.textContent = listOpen ? t().toggle_close : t().toggle_open;
  }

  /* âœ… í•µì‹¬: ì™¼ìª½ ë©”íƒ€ì— Page, ì˜¤ë¥¸ìª½ì€ X â†‘ â†“ ê°€ë¡œ 1ì¤„ */
  function updateFileList(){
    fileList.innerHTML = "";
    files.forEach((f, idx)=>{
      const item = document.createElement("div");
      item.className = "fileItem";
      const kind = (f.type || "").includes("png") ? "PNG" : (f.type || "").includes("webp") ? "WebP" : "JPG";
      item.innerHTML = `
        <div class="fileLeft">
          <div class="fileName">${esc(f.name)}</div>
          <div class="fileMeta">
            <span>${kind} Â· ${Math.round(f.w)}Ã—${Math.round(f.h)}</span>
            <span class="pagePill"><span class="pageLabel">Page</span><span class="pageNum">${idx+1}</span></span>
          </div>
        </div>
        <div class="fileRight">
          <button class="iconBtn danger" data-act="del" data-idx="${idx}" aria-label="${esc(t().del)}">âœ•</button>
          <button class="iconBtn" data-act="up" data-idx="${idx}" aria-label="${esc(t().up)}">â†‘</button>
          <button class="iconBtn" data-act="down" data-idx="${idx}" aria-label="${esc(t().down)}">â†“</button>
        </div>
      `;
      fileList.appendChild(item);
    });

    const btns = fileList.querySelectorAll("button[data-act]");
    btns.forEach(b=>{
      const act = b.getAttribute("data-act");
      const i = parseInt(b.getAttribute("data-idx"),10);
      if(act === "up" && i === 0) b.disabled = true;
      if(act === "down" && i === files.length - 1) b.disabled = true;
    });
  }

  fileList.addEventListener("click", (e)=>{
    const btn = e.target.closest("button[data-act]");
    if(!btn) return;
    const act = btn.getAttribute("data-act");
    const idx = parseInt(btn.getAttribute("data-idx"),10);
    if(Number.isNaN(idx)) return;

    if(act === "del"){
      files.splice(idx, 1);
    }else if(act === "up" && idx > 0){
      const tmp = files[idx-1];
      files[idx-1] = files[idx];
      files[idx] = tmp;
    }else if(act === "down" && idx < files.length-1){
      const tmp = files[idx+1];
      files[idx+1] = files[idx];
      files[idx] = tmp;
    }

    if(files.length === 0){
      listOpen = false;
      fileList.classList.remove("show");
    }
    updateFileList();
    updateUI();
  });

  async function loadImageMeta(buf, mime){
    const blob = new Blob([buf], { type: mime || "image/jpeg" });
    const url = URL.createObjectURL(blob);
    try{
      const img = new Image();
      img.decoding = "async";
      const p = new Promise((resolve, reject)=>{
        img.onload = ()=>resolve({ w: img.naturalWidth || img.width, h: img.naturalHeight || img.height });
        img.onerror = ()=>reject(new Error("Image decode failed"));
      });
      img.src = url;
      return await p;
    }finally{
      setTimeout(()=> URL.revokeObjectURL(url), 500);
    }
  }

  async function loadFiles(fileArr){
    try{
      setMsg("", "");
      hideProg();

      const imgs = fileArr.filter(f => f && (f.type.startsWith("image/") || /\.(jpg|jpeg|png|webp)$/i.test(f.name)));
      if(!imgs.length) throw new Error("No images selected");

      for(const f of imgs){
        const buf = await f.arrayBuffer();
        const meta = await loadImageMeta(buf, f.type);
        files.push({ name: f.name || "image.jpg", type: f.type || "image/jpeg", bytes: buf, w: meta.w, h: meta.h });
      }

      const MAX = 40;
      if(files.length > MAX) files = files.slice(0, MAX);

      updateFileList();
      updateUI();

    }catch(e){
      const detail = (e && e.message) ? e.message : String(e);
      setMsg((t().msg_fail || "Failed") + " (" + detail + ")", "err");
      hideProg();
      updateUI();
    }
  }

  function setLang(lang){
    if(!STR[lang]) lang = "en";
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    $("langSelect").value = lang;
    document.documentElement.lang = lang;

    $("page_title").textContent = t().page_title;
    $("page_sub").textContent = t().page_sub;
    $("home_btn").textContent = t().home;
    $("local_processing").textContent = t().local;
    $("lang_label").textContent = t().lang_label;

    $("h_step1").textContent = t().h1;
    pickBtn.textContent = t().pick;
    addBtn.textContent = t().add;
    clearBtn.textContent = t().clear;
    $("drop_title").innerHTML = t().drop_title;
    $("drop_hint").textContent = t().drop_hint;

    $("h_step2").textContent = t().h2;
    $("lbl_page").textContent = t().lbl_page;
    $("page_hint").textContent = t().page_hint;
    $("lbl_orient").textContent = t().lbl_orient;
    $("orient_hint").textContent = t().orient_hint;
    $("lbl_fit").textContent = t().lbl_fit;
    $("fit_hint").textContent = t().fit_hint;
    $("lbl_bg").textContent = t().lbl_bg;
    $("bg_hint").textContent = t().bg_hint;

    $("lbl_margin").textContent = t().lbl_margin;
    $("marginTitle").textContent = t().marginTitle;
    $("margin_hint").textContent = t().margin_hint;
    $("m0_name").textContent = t().m0_name;
    $("m0_desc").textContent = t().m0_desc;
    $("m6_name").textContent = t().m6_name;
    $("m6_desc").textContent = t().m6_desc;
    $("m12_name").textContent = t().m12_name;
    $("m12_desc").textContent = t().m12_desc;

    $("lbl_name").textContent = t().lbl_name;
    $("name_hint").textContent = t().name_hint;
    $("ts_label").textContent = t().ts_label;

    convertBtn.textContent = t().go;
    $("legal_box").innerHTML = "<b>" + esc(t().legal_title) + "</b><br/>" + esc(t().legal_body);

    // options text (keep values)
    orientEl.options[0].textContent = t().opt_auto;
    orientEl.options[1].textContent = t().opt_portrait;
    orientEl.options[2].textContent = t().opt_landscape;

    fitEl.options[0].textContent = t().opt_fit;
    fitEl.options[1].textContent = t().opt_fill;
    fitEl.options[2].textContent = t().opt_stretch;

    bgEl.options[0].textContent = t().opt_white;
    bgEl.options[1].textContent = t().opt_black;
    bgEl.options[2].textContent = t().opt_gray;

    syncTsUI();
    updateUI();
    updateFileList();
  }
  $("langSelect").addEventListener("change", (e)=> setLang(e.target.value));

  function updateUI(){
    const n = files.length;

    selectedCount.textContent = String(n);
    selectedPill.textContent = t().selected(n);
    countText.textContent = String(n);

    if(n > 0){
      countBadge.style.display = "inline-flex";
      drop.classList.add("hasFiles");

      addBtn.disabled = false;
      clearBtn.disabled = false;
      toggleListBtn.disabled = false;
      convertBtn.disabled = false;

      pageSizeEl.disabled = false;
      orientEl.disabled = false;
      fitEl.disabled = false;
      bgEl.disabled = false;
      marginMmEl.disabled = false;
      outNameEl.disabled = false;

      metaEl.innerHTML = t().meta_loaded(n);
    }else{
      countBadge.style.display = "none";
      drop.classList.remove("hasFiles");

      addBtn.disabled = true;
      clearBtn.disabled = true;
      toggleListBtn.disabled = true;
      convertBtn.disabled = true;

      pageSizeEl.disabled = true;
      orientEl.disabled = true;
      fitEl.disabled = true;
      bgEl.disabled = true;
      marginMmEl.disabled = true;
      outNameEl.disabled = true;

      metaEl.innerHTML = t().meta_idle;
    }

    updateToggleText();
    if(!listOpen) fileList.classList.remove("show");
    if(n === 0) fileList.classList.remove("show");
  }

  // Margin presets + direct input
  function setMarginPreset(mm){
    mm = Math.max(0, Math.min(30, Math.round(mm)));
    marginMmEl.value = String(mm);
    marginValueText.textContent = String(mm);

    m0.setAttribute("aria-pressed", mm === 0 ? "true" : "false");
    m6.setAttribute("aria-pressed", mm === 6 ? "true" : "false");
    m12.setAttribute("aria-pressed", mm === 12 ? "true" : "false");
    localStorage.setItem("cf24_jpgpdf_margin", String(mm));
  }
  m0.addEventListener("click", ()=> setMarginPreset(0));
  m6.addEventListener("click", ()=> setMarginPreset(6));
  m12.addEventListener("click", ()=> setMarginPreset(12));
  marginMmEl.addEventListener("input", ()=>{
    const v = parseInt(marginMmEl.value || "0", 10);
    if(Number.isFinite(v)) setMarginPreset(v);
  });

  function stamp(){
    return new Date().toISOString().replace(/[:.]/g,"-");
  }
  function buildPdfName(){
    const base = (outNameEl.value || "images_to_pdf").trim().replace(/\s+/g, "_").replace(/[^\w\-]+/g, "_");
    if(!tsOn) return `${base}.pdf`;
    return `${base}_${stamp()}.pdf`;
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  // Page sizes in points (PDF points)
  function pageSizePoints(kind){
    if(kind === "LETTER") return { w: 612, h: 792 };
    return { w: 595.28, h: 841.89 };
  }
  function mmToPt(mm){ return mm * 72 / 25.4; }

  function decideOrientation(imgW, imgH, mode){
    if(mode === "PORTRAIT") return "PORTRAIT";
    if(mode === "LANDSCAPE") return "LANDSCAPE";
    return (imgW >= imgH) ? "LANDSCAPE" : "PORTRAIT";
  }

  function drawFit(pageW, pageH, marginPt, imgW, imgH, fitMode){
    const availW = Math.max(1, pageW - marginPt*2);
    const availH = Math.max(1, pageH - marginPt*2);

    let drawW, drawH;
    const imgRatio = imgW / imgH;
    const boxRatio = availW / availH;

    if(fitMode === "STRETCH"){
      drawW = availW; drawH = availH;
      return { x: marginPt, y: marginPt, w: drawW, h: drawH, crop: null };
    }

    if(fitMode === "FIT"){
      if(imgRatio > boxRatio){
        drawW = availW;
        drawH = availW / imgRatio;
      }else{
        drawH = availH;
        drawW = availH * imgRatio;
      }
      const x = marginPt + (availW - drawW)/2;
      const y = marginPt + (availH - drawH)/2;
      return { x, y, w: drawW, h: drawH, crop: null };
    }

    // FILL (crop)
    if(imgRatio > boxRatio){
      drawH = availH;
      drawW = availH * imgRatio;
    }else{
      drawW = availW;
      drawH = availW / imgRatio;
    }
    const x = marginPt + (availW - drawW)/2;
    const y = marginPt + (availH - drawH)/2;
    return { x, y, w: drawW, h: drawH, crop: null };
  }

  async function convertToPdf(){
    const { PDFDocument, rgb } = window.PDFLib;
    const pdf = await PDFDocument.create();

    const ps = pageSizePoints(pageSizeEl.value);
    const marginPt = mmToPt(parseInt(marginMmEl.value || "6", 10) || 0);
    const orientMode = orientEl.value;
    const fitMode = fitEl.value;
    const bgHex = bgEl.value || "#FFFFFF";

    const bg = (() => {
      const h = bgHex.replace("#","").trim();
      const r = parseInt(h.slice(0,2),16)/255;
      const g = parseInt(h.slice(2,4),16)/255;
      const b = parseInt(h.slice(4,6),16)/255;
      return rgb(r,g,b);
    })();

    for(let i=0;i<files.length;i++){
      setProg(Math.round((i)/files.length*85) + 10);

      const f = files[i];
      const isPng = (f.type || "").includes("png");
      const isWebp = (f.type || "").includes("webp");

      const o = decideOrientation(f.w, f.h, orientMode);
      const pageW = (o === "LANDSCAPE") ? ps.h : ps.w;
      const pageH = (o === "LANDSCAPE") ? ps.w : ps.h;

      const page = pdf.addPage([pageW, pageH]);
      page.drawRectangle({ x:0, y:0, width:pageW, height:pageH, color:bg });

      let img;
      if(isPng){
        img = await pdf.embedPng(new Uint8Array(f.bytes));
      }else if(isWebp){
        const blob = new Blob([f.bytes], { type: "image/webp" });
        const url = URL.createObjectURL(blob);
        try{
          const im = new Image();
          await new Promise((res, rej)=>{ im.onload=res; im.onerror=rej; im.src=url; });
          const c = document.createElement("canvas");
          c.width = im.naturalWidth; c.height = im.naturalHeight;
          const ctx = c.getContext("2d", { alpha:false });
          ctx.fillStyle = "#fff";
          ctx.fillRect(0,0,c.width,c.height);
          ctx.drawImage(im,0,0);
          const jpgBlob = await new Promise((resolve)=> c.toBlob(resolve, "image/jpeg", 0.92));
          const jpgBuf = await jpgBlob.arrayBuffer();
          img = await pdf.embedJpg(new Uint8Array(jpgBuf));
        } finally {
          setTimeout(()=>URL.revokeObjectURL(url), 500);
        }
      }else{
        img = await pdf.embedJpg(new Uint8Array(f.bytes));
      }

      const iw = img.width, ih = img.height;
      const d = drawFit(pageW, pageH, marginPt, iw, ih, fitMode);
      page.drawImage(img, { x:d.x, y:d.y, width:d.w, height:d.h });
    }

    const bytes = await pdf.save({ useObjectStreams:true });
    return new Blob([bytes], { type:"application/pdf" });
  }

  convertBtn.addEventListener("click", async ()=>{
    try{
      if(!files.length) return setMsg(t().msg_need, "err");

      convertBtn.disabled = true;
      pickBtn.disabled = true;
      addBtn.disabled = true;
      clearBtn.disabled = true;
      toggleListBtn.disabled = true;

      pageSizeEl.disabled = true;
      orientEl.disabled = true;
      fitEl.disabled = true;
      bgEl.disabled = true;
      marginMmEl.disabled = true;
      outNameEl.disabled = true;

      setMsg(t().msg_work, "");
      setProg(1);

      const outBlob = await convertToPdf();
      setProg(96);
      downloadBlob(outBlob, buildPdfName());
      setProg(100);
      setMsg(t().msg_done, "ok");

    }catch(e){
      const detail = (e && e.message) ? e.message : String(e);
      setMsg((t().msg_fail || "Failed") + " (" + detail + ")", "err");
      hideProg();
    }finally{
      const has = files.length > 0;
      convertBtn.disabled = !has;
      pickBtn.disabled = false;
      addBtn.disabled = !has;
      clearBtn.disabled = !has;
      toggleListBtn.disabled = !has;

      pageSizeEl.disabled = !has;
      orientEl.disabled = !has;
      fitEl.disabled = !has;
      bgEl.disabled = !has;
      marginMmEl.disabled = !has;
      outNameEl.disabled = !has;

      syncTsUI();
    }
  });

  // init
  function init(){
    const savedMargin = parseInt(localStorage.getItem("cf24_jpgpdf_margin") || "6", 10);
    setMarginPreset(Number.isFinite(savedMargin) ? savedMargin : 6);

    pageSizeEl.value = "A4";
    orientEl.value = "AUTO";
    fitEl.value = "FIT";
    bgEl.value = "#FFFFFF";

    setLang(LANG);
    syncTsUI();
    updateUI();
  }
  init();
})();
</script>
</body>
</html>