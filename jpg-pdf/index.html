<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>JPG to PDF | ConvertFiles24</title>
  <meta name="description" content="Convert JPG/PNG images to a single PDF. Also merge PDFs. 100% local processing (no server upload)." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- PDF-lib -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

  <style>
    :root{
      --radius:16px;
      --pad:16px;
      --border:1px solid rgba(255,255,255,.12);
      --blue: 47,109,246;
      --ease: cubic-bezier(.2,.8,.2,1);

      --softBlueBg: rgba(120, 200, 255, .06);
      --softBlueBd: rgba(120, 200, 255, .22);
      --softBlueTx: #cfe6ff;
      --softBlueHi: rgba(120, 200, 255, .12);
    }
    *{ box-sizing:border-box; }
    html, body{ width:100%; max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", sans-serif;
      background:#0b0f17;
      color:#e9eef7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    body:not(.loaded) .card, body:not(.loaded) .top{ opacity:0; transform: translateY(8px); }
    body.loaded .top{ animation: cfFadeUp .35s var(--ease) both; }
    body.loaded .card{ animation: cfFadeUp .38s var(--ease) both; }
    @keyframes cfFadeUp{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
      body:not(.loaded) .card, body:not(.loaded) .top{ opacity:1; transform:none; }
    }

    .wrap{ max-width:980px; width:100%; margin:0 auto; padding:22px 14px 44px; overflow-x: clip; }
    .top{ display:flex; align-items:flex-start; justify-content:space-between; gap:14px; flex-wrap:wrap; margin-bottom:14px; min-width:0; }
    .title{ margin:0; font-weight:900; letter-spacing:-0.35px; line-height:1.15; color:#fff; font-size:22px; }
    .sub{ margin:8px 0 0; color:#a7b3c7; font-size:13px; line-height:1.45; }

    .homeBtn{
      width:100%; display:flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px; border-radius:999px;
      border:1px solid rgba(47,109,246,.55);
      background:rgba(47,109,246,.18);
      color:#e9eef7; font-weight:900; cursor:pointer; text-decoration:none; user-select:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      max-width:380px;
      transition: transform .08s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
    }
    .homeBtn:hover{ background:rgba(47,109,246,.24); }
    .homeBtn:active{ transform: scale(.99); }
    .homeBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.35), 0 10px 24px rgba(0,0,0,.25); }

    .langRow{ display:flex; flex-direction:column; align-items:flex-end; gap:8px; min-width:220px; max-width:100%; margin-left:auto; }
    .langLabel{ font-size:12px; font-weight:900; color:#9fb0ca; letter-spacing:-0.2px; display:flex; align-items:center; gap:8px; opacity:.95; }
    .langSelect{
      width:220px; max-width:100%; padding:12px 12px; border-radius:999px;
      border:var(--border); background:rgba(255,255,255,.06); color:#e9eef7; outline:none; font-weight:900;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease), transform .08s var(--ease);
    }
    .langSelect:focus-visible{ outline:none; border-color: rgba(var(--blue), .55); box-shadow: 0 0 0 3px rgba(var(--blue),.25); }
    option{ background:#0b0f17; color:#e9eef7; }

    .pill{
      width:100%; border:1px solid rgba(120, 200, 255, .22);
      background:rgba(120, 200, 255, .06);
      border-radius:999px; padding:10px 14px; color:#cfe6ff; font-size:13px; font-weight:900;
      display:flex; align-items:center; justify-content:center; gap:10px; min-width:0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .card{ border:var(--border); background:rgba(255,255,255,.03); border-radius:var(--radius); padding:var(--pad); margin-top:12px; min-width:0; max-width:100%; overflow-x: clip; }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; letter-spacing:-0.2px; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; min-width:0; }
    .row > *{ flex:1; min-width:160px; max-width:100%; min-width:0; }

    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:900;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:14px;
      letter-spacing: -0.2px;
      user-select:none;
      transition: transform .08s var(--ease), filter .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease);
    }
    .btn.secondary{
      background: var(--softBlueBg);
      border: 1px solid var(--softBlueBd);
      color: var(--softBlueTx);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .btn.secondary:hover{ background: var(--softBlueHi); }
    .btn:hover{ filter: brightness(1.03); }
    .btn:active{ transform: scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.25); }
    .btn:disabled{
      opacity:1; cursor:not-allowed; transform:none; box-shadow:none;
      filter: saturate(.7);
      background: linear-gradient(180deg, rgba(47,109,246,.40), rgba(47,109,246,.30));
      color:#ffffff;
    }
    .btn.secondary:disabled{
      filter:none;
      background: rgba(120, 200, 255, .05);
      border: 1px solid rgba(120, 200, 255, .16);
      color: rgba(207, 230, 255, .70);
      box-shadow:none;
    }

    input[type="file"]{ display:none; }

    /* Tabs */
    .tabs{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:999px;
      padding:8px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .tabBtn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 14px;
      border-radius:999px;
      background: rgba(255,255,255,.045);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:900;
      font-size:12px;
      letter-spacing: -0.15px;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
      flex:1;
      min-width: 170px;
      text-align:center;
    }
    .tabBtn:hover{ background: rgba(255,255,255,.06); }
    .tabBtn:active{ transform: scale(.99); }
    .tabBtn[aria-pressed="true"]{
      background: rgba(47,109,246,.16);
      border-color: rgba(47,109,246,.55);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .tabBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }

    /* Drop */
    .drop{
      border:1px dashed rgba(255,255,255,.18);
      border-radius:14px; padding:18px;
      background:rgba(255,255,255,.02);
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition: background .15s var(--ease), border-color .15s var(--ease), box-shadow .15s var(--ease), transform .05s var(--ease);
      position: relative;
      min-height: 170px;
      display:flex; align-items:center; justify-content:center;
      max-width:100%;
      overflow:hidden;
    }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); box-shadow: 0 0 0 3px rgba(106,169,255,.10) inset; }
    .drop:active{ transform: scale(0.998); }
    .drop:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.25); }

    .drop.hasFiles{
      border-color: rgba(120,200,255,.32);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 18px 40px rgba(0,0,0,.18);
      background: rgba(255,255,255,.025);
    }

    .dropEmoji{ font-size:42px; line-height:1; margin:10px 0 8px; filter: drop-shadow(0 10px 22px rgba(0,0,0,.28)); }
    .hint{ margin-top:10px; color:#9fb0ca; font-size:12px; line-height:1.5; }
    .small{ color:#a7b3c7; font-size:12px; line-height:1.5; }

    .countBadge{
      position:absolute;
      top:10px; right:10px;
      display:none;
      align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(120,200,255,.26);
      background: rgba(120,200,255,.08);
      color:#cfe6ff;
      font-size:12px;
      font-weight:900;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      user-select:none;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }
    .countBadge .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(47,109,246,.9);
      box-shadow: 0 0 0 3px rgba(47,109,246,.15);
    }

    .fileBar{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .fileBarLeft{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:#a7b3c7; font-size:12px; font-weight:900;
    }

    /* âœ… ëª©ë¡ í† ê¸€: ëœ ë‘”íƒí•˜ê²Œ(ê°€ëŠ˜ê³  ì‘ê²Œ) */
    .toggleBtn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:700;          /* ëœ êµµê²Œ */
      font-size:11.5px;         /* ì•½ê°„ ì‘ê²Œ */
      letter-spacing: -0.12px;
      text-rendering: geometricPrecision;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
    }
    .toggleBtn:hover{ background: rgba(255,255,255,.06); }
    .toggleBtn:active{ transform: scale(.99); }
    .toggleBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }

    .fileList{
      margin-top:10px;
      display:none;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .fileList.show{ display:block; }

    .fileItem{
      display:flex; align-items:stretch; justify-content:space-between; gap:10px;
      padding:10px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
    }
    .fileItem + .fileItem{ margin-top:10px; }

    .fileLeft{ min-width:0; flex: 1; }
    /* âœ… ëª©ë¡ ê¸€ì: ì‘ê³  ê°€ëŠ˜ê²Œ */
    .fileName{
      font-weight:700;          /* ëœ êµµê²Œ */
      color:#e9eef7;
      letter-spacing:-0.16px;
      word-break: break-word;
      font-size:12.8px;         /* ì‘ê²Œ */
      line-height:1.32;
    }
    .fileMeta{
      margin-top:6px;
      color:#a7b3c7;
      font-size:11.5px;         /* ì‘ê²Œ */
      line-height:1.45;
      font-weight:600;
    }

    /* ì˜¤ë¥¸ìª½ ë²„íŠ¼ ìŠ¤íƒ */
    .fileRight{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      min-width: 64px;
    }
    .miniPill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:#cfe0ff;
      font-size:11px;
      font-weight:800;
      white-space:nowrap;
      height: fit-content;
    }
    .iconStack{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:stretch;
      width: 54px;
    }
    .iconBtn{
      appearance:none; border:none; cursor:pointer;
      padding:8px 0;
      border-radius:12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:900;
      font-size:12px;
      line-height:1;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
    }
    .iconBtn:hover{ background: rgba(255,255,255,.07); }
    .iconBtn:active{ transform: scale(.99); }
    .iconBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }
    .iconBtn.danger{
      background: rgba(255, 110, 110, .08);
      border-color: rgba(255, 110, 110, .22);
      color: #ffd6d6;
    }
    .iconBtn.danger:hover{
      background: rgba(255, 110, 110, .12);
      border-color: rgba(255, 110, 110, .30);
    }
    .iconBtn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
      filter:none;
    }

    /* ë“œë˜ê·¸ í•¸ë“¤(PCìš©) */
    .dragHandle{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:#cfe0ff;
      font-size:11px;
      font-weight:800;
      user-select:none;
      cursor: grab;
    }
    .dragHandle:active{ cursor: grabbing; }
    .fileItem[draggable="true"]{ }
    .fileItem.dragging{ opacity:.45; }
    .fileItem.dragOver{ outline: 2px solid rgba(47,109,246,.35); outline-offset: 2px; }

    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; }
    select, input[type="text"], input[type="number"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      border:var(--border);
      outline:none;
      font-weight:800;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease);
    }
    input[type="number"]{ font-weight:900; }
    select:focus-visible, input:focus-visible{
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.22);
    }

    .pillRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .miniBtn{
      flex:1; min-width:160px;
      appearance:none; border:none; cursor:pointer;
      padding:11px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      text-align:left;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
    }
    .miniBtn:hover{ background: rgba(255,255,255,.07); }
    .miniBtn:active{ transform: scale(.99); }
    .miniBtn[aria-pressed="true"]{
      background: rgba(47,109,246,.16);
      border-color: rgba(47,109,246,.55);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .miniBtnTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .miniBtnName{ font-weight:900; letter-spacing:-0.2px; }
    .badge{
      font-size:11px; font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:#cfe0ff;
      white-space:nowrap;
    }
    .miniDesc{ margin-top:6px; color:#a7b3c7; font-size:12px; line-height:1.45; font-weight:700; }

    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .msg.err{ color:#ffb4b4; }
    .msg.ok{ color:#b8ffcc; }

    .meta{ color:#b7c3d9; font-size:13px; line-height:1.5; word-break:break-word; min-width:0; }
    .meta b{ color:#e9eef7; }

    .legal{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      color:#a7b3c7;
      font-size:12px;
      line-height:1.55;
    }
    .legal b{ color:#dbe7ff; }

    .footer{ margin-top:16px; color:#94a6c2; font-size:12px; text-align:center; }
    .footer a{ color:#9fb0ca; text-decoration:none; border-bottom:1px dashed rgba(159,176,202,.35); }
    .footer a:hover{ color:#cfe0ff; border-bottom-color:rgba(207,224,255,.6); }

    .bar{
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      margin-top:8px;
      display:none;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: rgba(47,109,246,.9);
      transition: width .15s var(--ease);
    }

    @media (max-width:520px){
      .tabBtn{ min-width: 0; }
      .row > *{ min-width: 140px; }
      .iconStack{ width: 52px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div style="flex:1; min-width:240px;">
        <h1 class="title" id="page_title">JPG â†’ PDF</h1>
        <p class="sub" id="page_sub">Upload â†’ reorder â†’ convert â†’ download. 100% local processing.</p>

        <div style="margin-top:10px;">
          <a class="homeBtn" href="/" id="home_btn">ğŸ  Home</a>
        </div>

        <div style="margin-top:10px;">
          <div class="pill">ğŸ”’ <span id="local_processing">Processed locally â€” no server upload</span></div>
        </div>
      </div>

      <div class="langRow">
        <div class="langLabel">ğŸŒ <span id="lang_label">Language</span></div>
        <select class="langSelect" id="langSelect" aria-label="Language">
          <option value="en">Global (English)</option>
          <option value="ko">í•œêµ­ì–´</option>
        </select>
      </div>
    </div>

    <div class="card">
      <div class="tabs" aria-label="Mode tabs">
        <button class="tabBtn" id="tab_images" type="button" aria-pressed="true">ğŸ–¼ï¸ JPG/PNG â†’ PDF</button>
        <button class="tabBtn" id="tab_merge" type="button" aria-pressed="false">ğŸ§© PDF í•©ì¹˜ê¸°</button>
      </div>
      <div class="small" id="mode_hint" style="margin-top:10px;">Select images, reorder, then export to PDF.</div>
    </div>

    <!-- Upload -->
    <div class="card">
      <h2 id="h_step1">Upload</h2>

      <div class="row">
        <button class="btn secondary" id="pickBtn" type="button">ğŸ–¼ï¸ Choose Images</button>
        <button class="btn secondary" id="addBtn" type="button" disabled>â• Add</button>
        <button class="btn secondary" id="clearBtn" type="button" disabled>ğŸ§¹ Clear</button>
      </div>

      <div style="height:10px;"></div>

      <div class="drop" id="drop" role="button" tabindex="0" aria-label="Upload files">
        <div class="countBadge" id="countBadge">
          <span class="dot" aria-hidden="true"></span>
          <span id="countText">0</span>
        </div>
        <div style="width:100%;">
          <div style="font-weight:900; margin-bottom:6px;" id="drop_title">Drop files here<br/>or tap to upload</div>
          <div class="dropEmoji" aria-hidden="true" id="drop_emoji">ğŸ–¼ï¸</div>
          <div class="hint" id="drop_hint">JPG/PNG â†’ PDF. No server upload.</div>
        </div>
      </div>

      <div class="fileBar">
        <div class="fileBarLeft">
          <span id="selectedPill">âœ… <span id="selectedCount">0</span></span>
        </div>
        <button class="toggleBtn" id="toggleListBtn" type="button" disabled>â–¾ Show list</button>
      </div>

      <div class="fileList" id="fileList" aria-label="File list"></div>

      <div class="msg" id="msg"></div>
      <div class="bar" id="bar"><div id="barFill"></div></div>
    </div>

    <!-- Settings (Images -> PDF) -->
    <div class="card" id="imgSettingsCard">
      <h2 id="h_step2">PDF Settings</h2>

      <!-- (1) í’ˆì§ˆ í”„ë¦¬ì…‹ -->
      <div class="pillRow" style="margin-bottom:12px;">
        <button class="miniBtn" id="q_std" type="button" aria-pressed="false">
          <div class="miniBtnTop">
            <div class="miniBtnName" id="q1_name">âš¡ Standard</div>
            <div class="badge" id="q1_badge">0.82</div>
          </div>
          <div class="miniDesc" id="q1_desc">Fast, good enough for sharing.</div>
        </button>
        <button class="miniBtn" id="q_crisp" type="button" aria-pressed="true">
          <div class="miniBtnTop">
            <div class="miniBtnName" id="q2_name">âœ¨ Crisp (Recommended)</div>
            <div class="badge" id="q2_badge">0.92</div>
          </div>
          <div class="miniDesc" id="q2_desc">Sharper photos, moderate size.</div>
        </button>
        <button class="miniBtn" id="q_max" type="button" aria-pressed="false">
          <div class="miniBtnTop">
            <div class="miniBtnName" id="q3_name">ğŸ† Max</div>
            <div class="badge" id="q3_badge">1.00</div>
          </div>
          <div class="miniDesc" id="q3_desc">Best quality, larger file.</div>
        </button>
      </div>

      <div class="row">
        <div>
          <label id="lbl_page">Page size</label>
          <select id="pageSize">
            <option value="a4" selected>A4 (210Ã—297mm)</option>
            <option value="letter">Letter (8.5Ã—11")</option>
            <option value="auto">Auto (image size)</option>
          </select>
          <div class="small" id="page_hint">Documents usually use A4.</div>
        </div>
        <div>
          <label id="lbl_orient">Orientation</label>
          <select id="orientation">
            <option value="auto" selected>Auto</option>
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
          </select>
          <div class="small" id="orient_hint">Auto chooses best direction per image.</div>
        </div>
      </div>

      <div style="height:10px;"></div>

      <div class="row">
        <div>
          <label id="lbl_fit">Fit mode</label>
          <select id="fitMode">
            <option value="contain" selected>Fit (keep all)</option>
            <option value="cover">Fill (crop)</option>
            <option value="stretch">Stretch</option>
          </select>
          <div class="small" id="fit_hint">Fit keeps the whole image visible.</div>
        </div>
        <div>
          <label id="lbl_bg">Background</label>
          <select id="bgColor">
            <option value="#ffffff" selected>White</option>
            <option value="#000000">Black</option>
            <option value="#0b0f17">Dark (site)</option>
          </select>
          <div class="small" id="bg_hint">Used for margins / empty areas.</div>
        </div>
      </div>

      <div style="height:10px;"></div>

      <!-- (4) ì—¬ë°± í”„ë¦¬ì…‹ + ì»¤ìŠ¤í…€ -->
      <div class="row">
        <div>
          <label id="lbl_margin">Margin (mm)</label>
          <div class="pillRow" style="margin-bottom:10px;">
            <button class="miniBtn" id="m0" type="button" aria-pressed="false">
              <div class="miniBtnTop"><div class="miniBtnName" id="m0_name">0 (None)</div><div class="badge">0</div></div>
              <div class="miniDesc" id="m0_desc">No border.</div>
            </button>
            <button class="miniBtn" id="m6" type="button" aria-pressed="true">
              <div class="miniBtnTop"><div class="miniBtnName" id="m6_name">6 (Default)</div><div class="badge">6</div></div>
              <div class="miniDesc" id="m6_desc">Looks cleaner for documents.</div>
            </button>
            <button class="miniBtn" id="m12" type="button" aria-pressed="false">
              <div class="miniBtnTop"><div class="miniBtnName" id="m12_name">12 (Wide)</div><div class="badge">12</div></div>
              <div class="miniDesc" id="m12_desc">More breathing space.</div>
            </button>
          </div>
          <input id="marginMm" type="number" min="0" max="30" step="1" value="6" />
          <div class="small" id="margin_hint">You can type custom value (0â€“30).</div>
        </div>
        <!-- (5) íŒŒì¼ëª… -->
        <div>
          <label id="lbl_name">File name</label>
          <input id="outName" type="text" placeholder="images_to_pdf" value="images_to_pdf" />
          <div class="small" id="name_hint">Weâ€™ll add timestamp automatically.</div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="row">
        <button class="btn" id="convertBtn" type="button" disabled>â¬‡ï¸ Convert & Download PDF</button>
      </div>

      <div class="legal" id="legal_box">
        <b>Notice</b><br/>
        Images are processed locally in your browser. Verify the output before submitting important documents.
      </div>

      <div style="height:12px;"></div>
      <div class="meta" id="meta"><b>Status</b><br/>Upload files to start.</div>
    </div>

    <!-- Settings (PDF Merge) -->
    <div class="card" id="mergeSettingsCard" style="display:none;">
      <h2 id="h_merge">Merge</h2>

      <div class="row">
        <div>
          <label id="lbl_merge_name">Merged file name</label>
          <input id="mergeName" type="text" placeholder="merged_pdf" value="merged_pdf" />
          <div class="small" id="merge_name_hint">Weâ€™ll add timestamp automatically.</div>
        </div>
        <div>
          <label id="lbl_merge_tip">Tip</label>
          <div class="small" id="merge_tip" style="padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.02);">
            Reorder PDFs in the list, then merge.
          </div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="row">
        <button class="btn" id="mergeBtn" type="button" disabled>â¬‡ï¸ Merge & Download PDF</button>
      </div>

      <div class="legal" id="merge_legal">
        <b>Notice</b><br/>
        PDFs are merged locally â€” no upload.
      </div>
    </div>

    <div class="footer">
      Â© <span id="year"></span> ConvertFiles24 Â·
      <a href="/privacy.html">Privacy</a> Â·
      <a href="/terms.html">Terms</a>
    </div>
  </div>

  <input id="pickInput" type="file" multiple>

<script>
(() => {
  "use strict";
  const $ = (id)=>document.getElementById(id);
  $("year").textContent = new Date().getFullYear();
  requestAnimationFrame(()=> document.body.classList.add("loaded"));

  const STR = {
    ko:{
      page_title:"JPG â†’ PDF",
      page_sub:"ì—…ë¡œë“œ â†’ ìˆœì„œì •ë¦¬ â†’ ë³€í™˜ â†’ ë‹¤ìš´ë¡œë“œ. 100% ë¡œì»¬ ì²˜ë¦¬.",
      home:"ğŸ  í™ˆìœ¼ë¡œ",
      local:"ë¡œì»¬ ì²˜ë¦¬ â€” ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ",
      lang_label:"ì–¸ì–´",

      mode_img:"ğŸ–¼ï¸ JPG/PNG â†’ PDF",
      mode_merge:"ğŸ§© PDF í•©ì¹˜ê¸°",
      mode_hint_img:"ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê³  ìˆœì„œë¥¼ ì •í•œ ë’¤ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.",
      mode_hint_merge:"ì—¬ëŸ¬ PDFë¥¼ ì„ íƒí•˜ê³  ìˆœì„œë¥¼ ì •í•œ ë’¤ í•˜ë‚˜ë¡œ í•©ì¹˜ì„¸ìš”.",

      h1:"íŒŒì¼ ì—…ë¡œë“œ",
      pick_img:"ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„ íƒ",
      pick_pdf:"ğŸ“„ PDF ì„ íƒ",
      add:"â• ì¶”ê°€",
      clear:"ğŸ§¹ ë¹„ìš°ê¸°",

      drop_img_title:"ì—¬ê¸°ì— ì´ë¯¸ì§€ë¥¼ ëŒì–´ë‹¤ ë†“ê±°ë‚˜<br/>íƒ­í•´ì„œ ì—…ë¡œë“œ",
      drop_pdf_title:"ì—¬ê¸°ì— PDFë¥¼ ëŒì–´ë‹¤ ë†“ê±°ë‚˜<br/>íƒ­í•´ì„œ ì—…ë¡œë“œ",
      drop_img_hint:"JPG/PNG â†’ PDF. ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ.",
      drop_pdf_hint:"PDF í•©ì¹˜ê¸°. ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ.",

      toggle_open:"â–¾ ëª©ë¡ ì—´ê¸°",
      toggle_close:"â–´ ëª©ë¡ ìˆ¨ê¸°ê¸°",
      selected:(n)=>`âœ… ì„ íƒë¨: ${n}ê°œ`,

      pages:"í˜ì´ì§€",
      dims:"í¬ê¸°",
      type_img:"ì´ë¯¸ì§€",
      type_pdf:"PDF",

      del:"ì‚­ì œ",
      up:"ìœ„ë¡œ",
      down:"ì•„ë˜ë¡œ",
      drag:"ë“œë˜ê·¸",

      h2:"PDF ì„¤ì •",
      q1:"âš¡ í‘œì¤€",
      q1d:"ë¹ ë¥´ê³  ê³µìœ ìš©ìœ¼ë¡œ ì¶©ë¶„",
      q2:"âœ¨ ì„ ëª…(ì¶”ì²œ)",
      q2d:"ë” ì„ ëª…, ì ë‹¹í•œ ìš©ëŸ‰",
      q3:"ğŸ† ìµœê³ ",
      q3d:"ìµœê³  í™”ì§ˆ, ìš©ëŸ‰ í¼",

      lbl_page:"í˜ì´ì§€ í¬ê¸°",
      page_hint:"ë¬¸ì„œìš©ì€ A4ê°€ ì¢‹ì•„ìš”.",
      lbl_orient:"ë°©í–¥",
      orient_hint:"ìë™ì€ ì´ë¯¸ì§€ì— ë§ì¶° ì„ íƒí•´ìš”.",
      lbl_fit:"ë§ì¶¤ ë°©ì‹",
      fit_hint:"Fitì€ ì´ë¯¸ì§€ê°€ ì˜ë¦¬ì§€ ì•Šì•„ìš”.",
      lbl_bg:"ë°°ê²½ìƒ‰",
      bg_hint:"ì—¬ë°±/ë¹ˆ ê³µê°„ì— ì‚¬ìš©ë¼ìš”.",
      lbl_margin:"ì—¬ë°±(mm)",
      margin_hint:"ì§ì ‘ ì…ë ¥ë„ ê°€ëŠ¥(0â€“30).",
      lbl_name:"íŒŒì¼ëª…",
      name_hint:"ë’¤ì— ì‹œê°„í‘œì‹œê°€ ìë™ìœ¼ë¡œ ë¶™ì–´ìš”.",

      m0:"0 (ì—†ìŒ)", m0d:"ì—¬ë°± ì—†ìŒ",
      m6:"6 (ê¸°ë³¸)", m6d:"ë¬¸ì„œì— ë³´ê¸° ì¢‹ì•„ìš”",
      m12:"12 (ë„‰ë„‰)", m12d:"ì—¬ë°±ì´ ë” ë„“ì–´ìš”",

      btn_convert:"â¬‡ï¸ PDF ë³€í™˜ & ë‹¤ìš´ë¡œë“œ",
      legal_title:"ì•ˆë‚´",
      legal_body:"ì´ë¯¸ì§€ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì¤‘ìš”í•œ ë¬¸ì„œëŠ” ê²°ê³¼ë¬¼ì„ ê¼­ í™•ì¸í•˜ì„¸ìš”.",

      merge_title:"í•©ì¹˜ê¸°",
      merge_name:"í•©ì¹œ íŒŒì¼ëª…",
      merge_name_hint:"ë’¤ì— ì‹œê°„í‘œì‹œê°€ ìë™ìœ¼ë¡œ ë¶™ì–´ìš”.",
      merge_tip:"ëª©ë¡ì—ì„œ ìˆœì„œë¥¼ ì¡°ì •í•œ ë’¤ í•©ì¹˜ì„¸ìš”.",
      merge_btn:"â¬‡ï¸ PDF í•©ì¹˜ê¸° & ë‹¤ìš´ë¡œë“œ",
      merge_legal:"PDFëŠ” ë¡œì»¬ì—ì„œ í•©ì³ì§‘ë‹ˆë‹¤ â€” ì—…ë¡œë“œ ì—†ìŒ.",

      meta_idle:"<b>ìƒíƒœ</b><br/>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.",
      meta_loaded:(n)=>`<b>ìƒíƒœ</b><br/>${n}ê°œ ì¤€ë¹„ ì™„ë£Œ`,
      msg_need:"ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.",
      msg_work:"ì‘ì—… ì¤‘â€¦ ì´ íƒ­ì„ ë‹«ì§€ ë§ˆì„¸ìš”.",
      msg_done:"âœ… ì™„ë£Œ",
      msg_fail:"ì‹¤íŒ¨",
    },
    en:{
      page_title:"JPG â†’ PDF",
      page_sub:"Upload â†’ reorder â†’ convert â†’ download. 100% local processing.",
      home:"ğŸ  Home",
      local:"Processed locally â€” no server upload",
      lang_label:"Language",

      mode_img:"ğŸ–¼ï¸ JPG/PNG â†’ PDF",
      mode_merge:"ğŸ§© Merge PDFs",
      mode_hint_img:"Select images, reorder, then export to a single PDF.",
      mode_hint_merge:"Select multiple PDFs, reorder, then merge into one.",

      h1:"Upload",
      pick_img:"ğŸ–¼ï¸ Choose Images",
      pick_pdf:"ğŸ“„ Choose PDFs",
      add:"â• Add",
      clear:"ğŸ§¹ Clear",

      drop_img_title:"Drop images here<br/>or tap to upload",
      drop_pdf_title:"Drop PDFs here<br/>or tap to upload",
      drop_img_hint:"JPG/PNG â†’ PDF. No server upload.",
      drop_pdf_hint:"Merge PDFs. No server upload.",

      toggle_open:"â–¾ Show list",
      toggle_close:"â–´ Hide list",
      selected:(n)=>`âœ… Selected: ${n}`,

      pages:"Pages",
      dims:"Size",
      type_img:"Image",
      type_pdf:"PDF",

      del:"Delete",
      up:"Up",
      down:"Down",
      drag:"Drag",

      h2:"PDF Settings",
      q1:"âš¡ Standard",
      q1d:"Fast, good for sharing",
      q2:"âœ¨ Crisp (Recommended)",
      q2d:"Sharper, moderate size",
      q3:"ğŸ† Max",
      q3d:"Best quality, larger file",

      lbl_page:"Page size",
      page_hint:"A4 is common for documents.",
      lbl_orient:"Orientation",
      orient_hint:"Auto chooses best direction per image.",
      lbl_fit:"Fit mode",
      fit_hint:"Fit keeps the whole image visible.",
      lbl_bg:"Background",
      bg_hint:"Used for margins / empty areas.",
      lbl_margin:"Margin (mm)",
      margin_hint:"You can type custom value (0â€“30).",
      lbl_name:"File name",
      name_hint:"Timestamp will be appended automatically.",

      m0:"0 (None)", m0d:"No border",
      m6:"6 (Default)", m6d:"Looks clean for docs",
      m12:"12 (Wide)", m12d:"More breathing space",

      btn_convert:"â¬‡ï¸ Convert & Download PDF",
      legal_title:"Notice",
      legal_body:"Images are processed locally in your browser. Verify output before submitting important documents.",

      merge_title:"Merge",
      merge_name:"Merged file name",
      merge_name_hint:"Timestamp will be appended automatically.",
      merge_tip:"Reorder PDFs in the list, then merge.",
      merge_btn:"â¬‡ï¸ Merge & Download PDF",
      merge_legal:"PDFs are merged locally â€” no upload.",

      meta_idle:"<b>Status</b><br/>Upload files to start.",
      meta_loaded:(n)=>`<b>Status</b><br/>${n} item(s) ready`,
      msg_need:"Please upload files first.",
      msg_work:"Workingâ€¦ keep this tab open.",
      msg_done:"âœ… Done",
      msg_fail:"Failed",
    }
  };

  function getQueryLang(){
    try{
      const u = new URL(location.href);
      const q = (u.searchParams.get("lang")||"").toLowerCase();
      if(q && STR[q]) return q;
    }catch(e){}
    return null;
  }
  function detectLang(){
    const q = getQueryLang();
    if(q) return q;
    const saved = localStorage.getItem("cf24_lang");
    if(saved && STR[saved]) return saved;
    const nav = (navigator.language || "").toLowerCase();
    if(nav.startsWith("ko")) return "ko";
    return "en";
  }
  let LANG = detectLang();
  function t(){ return STR[LANG] || STR.en; }

  function esc(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  const pickInput = $("pickInput");
  const pickBtn = $("pickBtn");
  const addBtn = $("addBtn");
  const clearBtn = $("clearBtn");
  const drop = $("drop");
  const msgEl = $("msg");
  const metaEl = $("meta");
  const bar = $("bar");
  const barFill = $("barFill");

  const countBadge = $("countBadge");
  const countText = $("countText");
  const selectedCount = $("selectedCount");
  const selectedPill = $("selectedPill");
  const fileList = $("fileList");
  const toggleListBtn = $("toggleListBtn");

  // Tabs
  const tabImages = $("tab_images");
  const tabMerge = $("tab_merge");
  const modeHint = $("mode_hint");

  // Settings cards
  const imgSettingsCard = $("imgSettingsCard");
  const mergeSettingsCard = $("mergeSettingsCard");

  // Image->PDF settings
  const pageSizeEl = $("pageSize");
  const orientationEl = $("orientation");
  const fitModeEl = $("fitMode");
  const bgColorEl = $("bgColor");
  const marginMmEl = $("marginMm");
  const outNameEl = $("outName");
  const convertBtn = $("convertBtn");

  // Quality preset buttons
  const qStd = $("q_std");
  const qCrisp = $("q_crisp");
  const qMax = $("q_max");

  // Margin preset buttons
  const m0 = $("m0");
  const m6 = $("m6");
  const m12 = $("m12");

  // Merge
  const mergeBtn = $("mergeBtn");
  const mergeNameEl = $("mergeName");

  // state
  // items: { kind:'img'|'pdf', name, file, bytes?, w?, h?, pages? }
  let items = [];
  let listOpen = false;
  let MODE = "images"; // 'images' | 'merge'
  let JPEG_QUALITY = 0.92;

  function setMsg(text, cls){
    msgEl.textContent = text || "";
    msgEl.className = "msg " + (cls || "");
  }
  function setProg(pct){
    bar.style.display = "block";
    barFill.style.width = Math.max(0, Math.min(100, pct)) + "%";
  }
  function hideProg(){
    bar.style.display = "none";
    barFill.style.width = "0%";
  }

  function stamp(){
    return new Date().toISOString().replace(/[:.]/g,"-");
  }
  function safeBaseName(raw){
    const s = (raw || "").trim().replace(/[\\/:*?"<>|]+/g, "_");
    return s ? s : "convertfiles24";
  }
  function buildOutPdfName(base){
    return `${safeBaseName(base)}_${stamp()}.pdf`;
  }

  function setLang(lang){
    if(!STR[lang]) lang = "en";
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    $("langSelect").value = lang;
    document.documentElement.lang = lang;

    $("page_title").textContent = t().page_title;
    $("page_sub").textContent = t().page_sub;
    $("home_btn").textContent = t().home;
    $("local_processing").textContent = t().local;
    $("lang_label").textContent = t().lang_label;

    tabImages.textContent = t().mode_img;
    tabMerge.textContent = t().mode_merge;

    $("h_step1").textContent = t().h1;

    $("h_step2").textContent = t().h2;

    $("q1_name").textContent = t().q1;
    $("q1_desc").textContent = t().q1d;
    $("q2_name").textContent = t().q2;
    $("q2_desc").textContent = t().q2d;
    $("q3_name").textContent = t().q3;
    $("q3_desc").textContent = t().q3d;

    $("lbl_page").textContent = t().lbl_page;
    $("page_hint").textContent = t().page_hint;
    $("lbl_orient").textContent = t().lbl_orient;
    $("orient_hint").textContent = t().orient_hint;
    $("lbl_fit").textContent = t().lbl_fit;
    $("fit_hint").textContent = t().fit_hint;
    $("lbl_bg").textContent = t().lbl_bg;
    $("bg_hint").textContent = t().bg_hint;
    $("lbl_margin").textContent = t().lbl_margin;
    $("margin_hint").textContent = t().margin_hint;
    $("lbl_name").textContent = t().lbl_name;
    $("name_hint").textContent = t().name_hint;

    $("m0_name").textContent = t().m0;
    $("m0_desc").textContent = t().m0d;
    $("m6_name").textContent = t().m6;
    $("m6_desc").textContent = t().m6d;
    $("m12_name").textContent = t().m12;
    $("m12_desc").textContent = t().m12d;

    $("h_merge").textContent = t().merge_title;
    $("lbl_merge_name").textContent = t().merge_name;
    $("merge_name_hint").textContent = t().merge_name_hint;
    $("merge_tip").textContent = t().merge_tip;
    $("mergeBtn").textContent = t().merge_btn;
    $("merge_legal").innerHTML = "<b>" + esc(t().legal_title) + "</b><br/>" + esc(t().merge_legal);

    $("legal_box").innerHTML = "<b>" + esc(t().legal_title) + "</b><br/>" + esc(t().legal_body);

    updateModeUI();
    updateUI();
    updateFileList();
  }
  $("langSelect").addEventListener("change", (e)=> setLang(e.target.value));

  // MODE
  function setMode(next){
    MODE = next === "merge" ? "merge" : "images";
    localStorage.setItem("cf24_jpgpdf_mode", MODE);

    tabImages.setAttribute("aria-pressed", MODE === "images" ? "true" : "false");
    tabMerge.setAttribute("aria-pressed", MODE === "merge" ? "true" : "false");

    // clear existing selections when mode changes (safer UX)
    items = [];
    listOpen = false;
    fileList.classList.remove("show");
    hideProg();
    setMsg("", "");

    updateModeUI();
    updateUI();
    updateFileList();
  }

  function updateModeUI(){
    if(MODE === "images"){
      modeHint.textContent = t().mode_hint_img;
      pickBtn.textContent = t().pick_img;
      addBtn.textContent = t().add;
      $("drop_title").innerHTML = t().drop_img_title;
      $("drop_hint").textContent = t().drop_img_hint;
      $("drop_emoji").textContent = "ğŸ–¼ï¸";
      imgSettingsCard.style.display = "";
      mergeSettingsCard.style.display = "none";
      pickInput.accept = "image/jpeg,image/png";
    }else{
      modeHint.textContent = t().mode_hint_merge;
      pickBtn.textContent = t().pick_pdf;
      addBtn.textContent = t().add;
      $("drop_title").innerHTML = t().drop_pdf_title;
      $("drop_hint").textContent = t().drop_pdf_hint;
      $("drop_emoji").textContent = "ğŸ§©";
      imgSettingsCard.style.display = "none";
      mergeSettingsCard.style.display = "";
      pickInput.accept = "application/pdf";
    }
  }

  tabImages.addEventListener("click", ()=> setMode("images"));
  tabMerge.addEventListener("click", ()=> setMode("merge"));

  // Picker / Drop
  function openPicker(){
    pickInput.value = "";
    pickInput.click();
  }
  pickBtn.addEventListener("click", openPicker);
  addBtn.addEventListener("click", openPicker);

  drop.addEventListener("click", openPicker);
  drop.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){ e.preventDefault(); openPicker(); }
  });
  ["dragenter","dragover"].forEach(evt=>{
    drop.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add("drag"); });
  });
  ["dragleave","drop"].forEach(evt=>{
    drop.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove("drag"); });
  });
  drop.addEventListener("drop", (e)=>{
    const fl = e.dataTransfer.files;
    if(fl && fl.length) loadFiles(Array.from(fl));
  });

  pickInput.addEventListener("change", (e)=>{
    const fl = e.target.files;
    if(fl && fl.length) loadFiles(Array.from(fl));
  });

  clearBtn.addEventListener("click", ()=>{
    items = [];
    listOpen = false;
    fileList.classList.remove("show");
    hideProg();
    setMsg("", "");
    updateUI();
    updateFileList();
  });

  toggleListBtn.addEventListener("click", ()=>{
    if(!items.length) return;
    listOpen = !listOpen;
    if(listOpen) fileList.classList.add("show");
    else fileList.classList.remove("show");
    updateToggleText();
  });

  function updateToggleText(){
    toggleListBtn.textContent = listOpen ? t().toggle_close : t().toggle_open;
  }

  // (1) Quality preset
  const Q_PRESETS = {
    std:   { q: 0.82 },
    crisp: { q: 0.92 },
    max:   { q: 1.00 }
  };
  let qKey = localStorage.getItem("cf24_imgpdf_quality") || "crisp";
  if(!Q_PRESETS[qKey]) qKey = "crisp";

  function applyQPreset(key){
    if(!Q_PRESETS[key]) key = "crisp";
    qKey = key;
    localStorage.setItem("cf24_imgpdf_quality", key);

    qStd.setAttribute("aria-pressed", key==="std" ? "true" : "false");
    qCrisp.setAttribute("aria-pressed", key==="crisp" ? "true" : "false");
    qMax.setAttribute("aria-pressed", key==="max" ? "true" : "false");

    JPEG_QUALITY = Q_PRESETS[key].q;
    $("q1_badge").textContent = Q_PRESETS.std.q.toFixed(2);
    $("q2_badge").textContent = Q_PRESETS.crisp.q.toFixed(2);
    $("q3_badge").textContent = Q_PRESETS.max.q.toFixed(2);
  }
  qStd.addEventListener("click", ()=>applyQPreset("std"));
  qCrisp.addEventListener("click", ()=>applyQPreset("crisp"));
  qMax.addEventListener("click", ()=>applyQPreset("max"));

  // (4) Margin presets
  function setMarginPreset(mm){
    mm = Math.max(0, Math.min(30, Math.round(mm)));
    marginMmEl.value = String(mm);

    m0.setAttribute("aria-pressed", mm===0 ? "true" : "false");
    m6.setAttribute("aria-pressed", mm===6 ? "true" : "false");
    m12.setAttribute("aria-pressed", mm===12 ? "true" : "false");
  }
  m0.addEventListener("click", ()=>setMarginPreset(0));
  m6.addEventListener("click", ()=>setMarginPreset(6));
  m12.addEventListener("click", ()=>setMarginPreset(12));
  marginMmEl.addEventListener("input", ()=>{
    const mm = parseInt(marginMmEl.value||"0",10);
    setMarginPreset(Number.isFinite(mm)? mm : 6);
  });

  // Helpers: read image dims
  function getImageInfoFromFile(file){
    return new Promise((resolve, reject)=>{
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = ()=>{
        const w = img.naturalWidth || img.width;
        const h = img.naturalHeight || img.height;
        URL.revokeObjectURL(url);
        resolve({ w, h });
      };
      img.onerror = ()=>{
        URL.revokeObjectURL(url);
        reject(new Error("Image load failed"));
      };
      img.src = url;
    });
  }

  async function loadFiles(fileArr){
    try{
      setMsg("", "");
      hideProg();

      const MAX = 30;
      let accepted = [];

      if(MODE === "images"){
        accepted = fileArr.filter(f => f && (f.type === "image/jpeg" || f.type === "image/png" || /\.(jpe?g|png)$/i.test(f.name)));
        if(!accepted.length) throw new Error("No images selected");
      }else{
        accepted = fileArr.filter(f => f && (f.type === "application/pdf" || /\.pdf$/i.test(f.name)));
        if(!accepted.length) throw new Error("No PDFs selected");
      }

      for(const f of accepted){
        if(items.length >= MAX) break;

        if(MODE === "images"){
          const info = await getImageInfoFromFile(f);
          items.push({ kind:"img", name: f.name || "image", file: f, w: info.w, h: info.h });
        }else{
          const buf = await f.arrayBuffer();
          // quick pages count: pdf-lib can load and count pages
          const pdfDoc = await window.PDFLib.PDFDocument.load(buf, { ignoreEncryption: true });
          items.push({ kind:"pdf", name: f.name || "document.pdf", file: f, bytes: buf, pages: pdfDoc.getPageCount() });
        }
      }

      updateFileList();
      updateUI();

    }catch(e){
      const detail = (e && e.message) ? e.message : String(e);
      setMsg((t().msg_fail || "Failed") + " (" + detail + ")", "err");
      hideProg();
      updateUI();
    }
  }

  function updateUI(){
    const n = items.length;

    selectedCount.textContent = String(n);
    selectedPill.textContent = t().selected(n);
    countText.textContent = String(n);

    if(n > 0){
      countBadge.style.display = "inline-flex";
      drop.classList.add("hasFiles");
      addBtn.disabled = false;
      clearBtn.disabled = false;
      toggleListBtn.disabled = false;
      metaEl.innerHTML = t().meta_loaded(n);
      if(MODE === "images"){
        convertBtn.disabled = false;
        mergeBtn.disabled = true;
      }else{
        convertBtn.disabled = true;
        mergeBtn.disabled = false;
      }
    }else{
      countBadge.style.display = "none";
      drop.classList.remove("hasFiles");
      addBtn.disabled = true;
      clearBtn.disabled = true;
      toggleListBtn.disabled = true;
      convertBtn.disabled = true;
      mergeBtn.disabled = true;
      metaEl.innerHTML = t().meta_idle;
    }

    updateToggleText();
    if(!listOpen) fileList.classList.remove("show");
    if(n === 0) fileList.classList.remove("show");
  }

  // List rendering
  function humanDims(w,h){ return `${w}Ã—${h}`; }

  function updateFileList(){
    fileList.innerHTML = "";

    items.forEach((it, idx)=>{
      const item = document.createElement("div");
      item.className = "fileItem";
      item.setAttribute("data-idx", String(idx));
      item.draggable = true; // PC drag reorder

      const metaLine = (it.kind === "img")
        ? `${t().type_img} Â· ${t().dims}: ${humanDims(it.w, it.h)}`
        : `${t().type_pdf} Â· ${t().pages}: ${it.pages}`;

      // âœ… x ìœ„ ìˆ«ì(2p ê°™ì€) â€œì—†ì•°â€ â€” í˜ì´ì§€ìˆ˜ëŠ” ì•„ë˜ metaë¡œë§Œ
      item.innerHTML = `
        <div class="fileLeft">
          <div class="fileName">${esc(it.name)}</div>
          <div class="fileMeta">${esc(metaLine)}</div>
        </div>
        <div class="fileRight">
          <div class="dragHandle" title="${esc(t().drag)}">â ¿ ${esc(t().drag)}</div>
          <div class="iconStack">
            <button class="iconBtn danger" data-act="del" data-idx="${idx}" aria-label="${esc(t().del)}">âœ•</button>
            <button class="iconBtn" data-act="up" data-idx="${idx}" aria-label="${esc(t().up)}">â†‘</button>
            <button class="iconBtn" data-act="down" data-idx="${idx}" aria-label="${esc(t().down)}">â†“</button>
          </div>
        </div>
      `;
      fileList.appendChild(item);
    });

    // edge arrow disable
    const btns = fileList.querySelectorAll("button[data-act]");
    btns.forEach(b=>{
      const act = b.getAttribute("data-act");
      const i = parseInt(b.getAttribute("data-idx"),10);
      if(act === "up" && i === 0) b.disabled = true;
      if(act === "down" && i === items.length - 1) b.disabled = true;
    });
  }

  // click actions
  fileList.addEventListener("click", (e)=>{
    const btn = e.target.closest("button[data-act]");
    if(!btn) return;
    const act = btn.getAttribute("data-act");
    const idx = parseInt(btn.getAttribute("data-idx"),10);
    if(Number.isNaN(idx)) return;

    if(act === "del"){
      items.splice(idx, 1);
    }else if(act === "up" && idx > 0){
      const tmp = items[idx-1];
      items[idx-1] = items[idx];
      items[idx] = tmp;
    }else if(act === "down" && idx < items.length-1){
      const tmp = items[idx+1];
      items[idx+1] = items[idx];
      items[idx] = tmp;
    }

    if(items.length === 0){
      listOpen = false;
      fileList.classList.remove("show");
    }

    updateFileList();
    updateUI();
  });

  // (2) Drag reorder (PC)
  let dragFrom = null;
  fileList.addEventListener("dragstart", (e)=>{
    const el = e.target.closest(".fileItem");
    if(!el) return;
    dragFrom = parseInt(el.getAttribute("data-idx"),10);
    el.classList.add("dragging");
    e.dataTransfer.effectAllowed = "move";
    try{ e.dataTransfer.setData("text/plain", String(dragFrom)); }catch(_){}
  });

  fileList.addEventListener("dragend", (e)=>{
    const el = e.target.closest(".fileItem");
    if(el) el.classList.remove("dragging");
    fileList.querySelectorAll(".fileItem").forEach(x=>x.classList.remove("dragOver"));
    dragFrom = null;
  });

  fileList.addEventListener("dragover", (e)=>{
    e.preventDefault();
    const over = e.target.closest(".fileItem");
    if(!over) return;
    fileList.querySelectorAll(".fileItem").forEach(x=>x.classList.remove("dragOver"));
    over.classList.add("dragOver");
  });

  fileList.addEventListener("drop", (e)=>{
    e.preventDefault();
    const over = e.target.closest(".fileItem");
    if(!over) return;
    const to = parseInt(over.getAttribute("data-idx"),10);
    const from = (dragFrom ?? parseInt((()=>{ try{return e.dataTransfer.getData("text/plain");}catch(_){return "";} })(),10));

    if(Number.isNaN(from) || Number.isNaN(to) || from === to) return;

    const [moved] = items.splice(from, 1);
    items.splice(to, 0, moved);
    updateFileList();
    updateUI();
  });

  // PDF building helpers
  function mmToPt(mm){ return mm * 72 / 25.4; }
  function pageSizeToPt(sizeKey){
    // returns [wPt,hPt] for portrait
    if(sizeKey === "letter") return [612, 792]; // 8.5x11in @72dpi
    // a4
    return [595.276, 841.890];
  }

  async function fileToUint8(file){
    const buf = await file.arrayBuffer();
    return new Uint8Array(buf);
  }

  async function imageFileToEmbedBytes(file, quality){
    // If JPEG and quality == 1.00 -> keep original bytes
    const isJpg = (file.type === "image/jpeg" || /\.jpe?g$/i.test(file.name));
    const isPng = (file.type === "image/png" || /\.png$/i.test(file.name));

    if(isJpg && quality >= 0.999){
      const u8 = await fileToUint8(file);
      return { kind:"jpg", bytes:u8 };
    }

    // Convert to JPEG via canvas at selected quality
    const url = URL.createObjectURL(file);
    const img = new Image();
    img.decoding = "async";
    await new Promise((res, rej)=>{
      img.onload = res;
      img.onerror = ()=>rej(new Error("Image decode failed"));
      img.src = url;
    });

    const w = img.naturalWidth || img.width;
    const h = img.naturalHeight || img.height;

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d", { alpha:false });
    canvas.width = Math.max(1, w);
    canvas.height = Math.max(1, h);
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img, 0, 0);

    const blob = await new Promise((resolve)=> canvas.toBlob(resolve, "image/jpeg", Math.max(0.5, Math.min(1, quality))));
    URL.revokeObjectURL(url);
    if(!blob) throw new Error("canvas.toBlob failed");

    const bytes = new Uint8Array(await blob.arrayBuffer());
    try{ canvas.width = 1; canvas.height = 1; }catch(_){}
    return { kind:"jpg", bytes };
  }

  function computeFitRect(imgW, imgH, boxW, boxH, mode){
    const iw = imgW, ih = imgH, bw = boxW, bh = boxH;
    if(mode === "stretch"){
      return { x:0, y:0, w:bw, h:bh };
    }
    const rImg = iw/ih;
    const rBox = bw/bh;

    let w, h;
    if(mode === "cover"){
      // fill: crop
      if(rImg > rBox){
        h = bh; w = bh * rImg;
      }else{
        w = bw; h = bw / rImg;
      }
    }else{
      // contain: fit all
      if(rImg > rBox){
        w = bw; h = bw / rImg;
      }else{
        h = bh; w = bh * rImg;
      }
    }
    const x = (bw - w)/2;
    const y = (bh - h)/2;
    return { x, y, w, h };
  }

  function shouldLandscape(imgW, imgH, baseW, baseH){
    // choose landscape if it reduces cropping/empty more: compare aspect closeness
    const rImg = imgW/imgH;
    const rP = baseW/baseH;
    const rL = baseH/baseW;
    const dP = Math.abs(Math.log(rImg / rP));
    const dL = Math.abs(Math.log(rImg / rL));
    return dL < dP;
  }

  async function convertImagesToPdf(){
    if(!items.length) throw new Error("No images");

    const { PDFDocument, rgb } = window.PDFLib;
    const pdfDoc = await PDFDocument.create();

    const sizeKey = pageSizeEl.value || "a4";
    const orient = orientationEl.value || "auto";
    const fitMode = fitModeEl.value || "contain";
    const bg = bgColorEl.value || "#ffffff";
    const marginMm = Math.max(0, Math.min(30, parseInt(marginMmEl.value||"6",10) || 0));
    const marginPt = mmToPt(marginMm);

    // background rgb
    function hexToRgb(hex){
      const h = String(hex||"").replace("#","");
      const n = parseInt(h.length===3 ? h.split("").map(c=>c+c).join("") : h, 16);
      const r = ((n>>16)&255)/255, g = ((n>>8)&255)/255, b = (n&255)/255;
      return { r, g, b };
    }
    const bgc = hexToRgb(bg);

    for(let i=0;i<items.length;i++){
      const it = items[i];
      if(it.kind !== "img") continue;

      setProg(Math.round((i/items.length)*80)+10);

      const embed = await imageFileToEmbedBytes(it.file, JPEG_QUALITY);
      const jpg = await pdfDoc.embedJpg(embed.bytes);

      let pageW, pageH;

      if(sizeKey === "auto"){
        // auto uses image pixel dimensions as points (works fine for viewing; print size may vary)
        pageW = it.w;
        pageH = it.h;
      }else{
        const [wPt, hPt] = pageSizeToPt(sizeKey);
        pageW = wPt;
        pageH = hPt;
      }

      // orientation handling
      if(sizeKey !== "auto"){
        if(orient === "landscape"){ [pageW, pageH] = [pageH, pageW]; }
        else if(orient === "auto"){
          const baseW = pageW, baseH = pageH;
          if(shouldLandscape(it.w, it.h, baseW, baseH)){
            [pageW, pageH] = [pageH, pageW];
          }
        }
      }else{
        // auto size: keep as image orientation
        if(orient === "landscape" && pageH > pageW) [pageW, pageH] = [pageH, pageW];
        if(orient === "portrait" && pageW > pageH) [pageW, pageH] = [pageH, pageW];
      }

      const page = pdfDoc.addPage([pageW, pageH]);

      // background fill
      page.drawRectangle({ x:0, y:0, width:pageW, height:pageH, color: rgb(bgc.r,bgc.g,bgc.b) });

      const boxW = Math.max(1, pageW - marginPt*2);
      const boxH = Math.max(1, pageH - marginPt*2);
      const rect = computeFitRect(it.w, it.h, boxW, boxH, fitMode);

      // pdf origin bottom-left
      const x = marginPt + rect.x;
      const y = marginPt + rect.y;

      page.drawImage(jpg, { x, y, width: rect.w, height: rect.h });
    }

    setProg(95);
    const bytes = await pdfDoc.save({ useObjectStreams:true });
    return new Blob([bytes], { type:"application/pdf" });
  }

  async function mergePdfs(){
    if(!items.length) throw new Error("No PDFs");
    const { PDFDocument } = window.PDFLib;
    const out = await PDFDocument.create();

    for(let i=0;i<items.length;i++){
      setProg(Math.round((i/items.length)*80)+10);
      const it = items[i];
      if(it.kind !== "pdf") continue;

      const src = await PDFDocument.load(it.bytes, { ignoreEncryption:true });
      const pages = await out.copyPages(src, src.getPageIndices());
      pages.forEach(p => out.addPage(p));
    }
    setProg(95);
    const bytes = await out.save({ useObjectStreams:true });
    return new Blob([bytes], { type:"application/pdf" });
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  async function withLock(fn){
    convertBtn.disabled = true;
    mergeBtn.disabled = true;
    pickBtn.disabled = true;
    addBtn.disabled = true;
    clearBtn.disabled = true;
    toggleListBtn.disabled = true;
    pageSizeEl.disabled = true;
    orientationEl.disabled = true;
    fitModeEl.disabled = true;
    bgColorEl.disabled = true;
    marginMmEl.disabled = true;
    outNameEl.disabled = true;
    mergeNameEl.disabled = true;

    setMsg(t().msg_work, "");
    setProg(1);

    try{
      await fn();
      setProg(100);
      setMsg(t().msg_done, "ok");
    }catch(e){
      const detail = (e && e.message) ? e.message : String(e);
      setMsg((t().msg_fail || "Failed") + " (" + detail + ")", "err");
      hideProg();
    }finally{
      const has = items.length > 0;
      pickBtn.disabled = false;
      addBtn.disabled = !has;
      clearBtn.disabled = !has;
      toggleListBtn.disabled = !has;

      pageSizeEl.disabled = false;
      orientationEl.disabled = false;
      fitModeEl.disabled = false;
      bgColorEl.disabled = false;
      marginMmEl.disabled = false;
      outNameEl.disabled = false;
      mergeNameEl.disabled = false;

      if(MODE === "images"){
        convertBtn.disabled = !has;
        mergeBtn.disabled = true;
      }else{
        mergeBtn.disabled = !has;
        convertBtn.disabled = true;
      }
    }
  }

  convertBtn.addEventListener("click", ()=>{
    if(!items.length) return setMsg(t().msg_need, "err");
    if(MODE !== "images") return;
    withLock(async ()=>{
      const blob = await convertImagesToPdf();
      downloadBlob(blob, buildOutPdfName(outNameEl.value));
    });
  });

  mergeBtn.addEventListener("click", ()=>{
    if(!items.length) return setMsg(t().msg_need, "err");
    if(MODE !== "merge") return;
    withLock(async ()=>{
      const blob = await mergePdfs();
      downloadBlob(blob, buildOutPdfName(mergeNameEl.value));
    });
  });

  // init
  applyQPreset(qKey);
  setMarginPreset(parseInt(localStorage.getItem("cf24_imgpdf_margin")||"6",10) || 6);
  marginMmEl.addEventListener("change", ()=>{
    localStorage.setItem("cf24_imgpdf_margin", String(parseInt(marginMmEl.value||"6",10) || 6));
  });

  // restore mode
  const savedMode = localStorage.getItem("cf24_jpgpdf_mode");
  MODE = (savedMode === "merge") ? "merge" : "images";
  setLang(LANG);
  updateModeUI();

  // apply mode without clearing (we already clear in setMode, so just set UI states)
  tabImages.setAttribute("aria-pressed", MODE === "images" ? "true" : "false");
  tabMerge.setAttribute("aria-pressed", MODE === "merge" ? "true" : "false");
  updateUI();
})();
</script>
</body>
</html>