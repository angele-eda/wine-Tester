<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- âœ… SEO -->
  <title>ConvertFiles24 â€“ Free Converter (Images & PDF)</title>
  <meta name="description" content="Convert images to JPG/PNG/WebP/PDF and merge PDFs instantly â€” processed locally in your browser." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <!-- Fonts (Inter + Noto Sans KR) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <!-- Android / PWA -->
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0b0f17">

  <!-- âœ… Canonical -->
  <link rel="canonical" href="https://convertfiles24.com/" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NH19QJHQKL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-NH19QJHQKL');
  </script>

  <!-- âœ… Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ConvertFiles24 - Converter (Images & PDF)" />
  <meta property="og:description" content="Convert images, create PDFs, merge PDFs â€” processed locally in your browser." />
  <meta property="og:url" content="https://convertfiles24.com/" />

  <!-- âœ… Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ConvertFiles24 - Converter (Images & PDF)" />
  <meta name="twitter:description" content="Convert images, create PDFs, merge PDFs â€” processed locally in your browser." />

  <!-- âœ… JSON-LD -->
  <script type="application/ld+json" id="jsonld">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"ConvertFiles24",
    "applicationCategory":"MultimediaApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "url":"https://convertfiles24.com/"
  }
  </script>

  <!-- âœ… Libraries (Local in browser) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    :root{
      --bg:#0b0f17;
      --card:rgba(255,255,255,.03);
      --card2:rgba(255,255,255,.04);
      --border:1px solid rgba(255,255,255,.12);
      --border2:1px solid rgba(255,255,255,.10);
      --text:#e9eef7;
      --muted:#a7b3c7;
      --muted2:#94a6c2;
      --blue:rgba(47,109,246,.78);
      --blue2:rgba(47,109,246,.14);
      --radius:16px;
      --radius2:18px;
      --pad:16px;
      --shadow:0 18px 40px rgba(0,0,0,.35);
    }
    *{ box-sizing:border-box; }
    html,body{ width:100%; max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
      font-kerning: normal;
      font-optical-sizing: auto;
    }
    a{ color:inherit; text-decoration:none; }
    button, input, select, textarea{ font-family: inherit; -webkit-font-smoothing: antialiased; text-rendering: geometricPrecision; }

    /* ===== Layout ===== */
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding: 14px 14px 56px;
    }

    /* ===== Header (commercial) ===== */
    .header{
      position: sticky;
      top:0;
      z-index:50;
      background: linear-gradient(to bottom, rgba(11,15,23,.92), rgba(11,15,23,.68));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .headerInner{
      max-width:1100px;
      margin:0 auto;
      padding: 12px 14px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .logoMark{
      width:36px; height:36px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      user-select:none;
    }
    .brandText{
      display:flex;
      flex-direction:column;
      line-height:1.1;
      min-width:0;
    }
    .brandName{
      font-weight:900;
      letter-spacing:-0.35px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandTag{
      font-size:12px;
      color: rgba(167,179,199,.95);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-top:3px;
    }

    .headerRight{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .langWrap{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding:8px 10px;
      border-radius:999px;
    }
    .langIcon{ opacity:.95; }
    .langLabel{
      font-size:12px;
      font-weight:900;
      color:#9fb0ca;
      letter-spacing:-0.2px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .langSelect{
      border:none;
      background: transparent;
      color: var(--text);
      font-weight:900;
      outline:none;
      font-size:12px;
      padding:0 2px;
      max-width:140px;
    }
    .langSelect option{ background:#0b0f17; color:#e9eef7; }

    .menuBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius:999px;
      padding:9px 12px;
      cursor:pointer;
      font-weight:900;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .08s ease, background .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .menuBtn:hover{ background: rgba(255,255,255,.10); }
    .menuBtn:active{ transform: scale(.99); }

    /* ===== Drawer ===== */
    .drawerOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
      display:none;
      z-index:80;
    }
    .drawer{
      position:fixed;
      top:0; right:0;
      height:100%;
      width:min(420px, 92vw);
      background: rgba(15,20,32,.96);
      border-left:1px solid rgba(255,255,255,.10);
      box-shadow: -10px 0 30px rgba(0,0,0,.45);
      transform: translateX(105%);
      transition: transform .18s ease;
      z-index:90;
      display:flex;
      flex-direction:column;
    }
    .drawerHeader{
      padding:14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .drawerTitle{
      font-weight:900;
      letter-spacing:-0.25px;
    }
    .drawerClose{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:900;
    }
    .drawerBody{
      padding:14px;
      overflow:auto;
    }
    .drawerSectionTitle{
      font-size:12px;
      font-weight:900;
      color:#9fb0ca;
      margin: 4px 0 10px;
      letter-spacing:-0.2px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .drawerList{
      display:grid;
      gap:10px;
      margin-bottom:14px;
    }
    .navCard{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius:16px;
      padding:12px 12px;
      display:flex;
      align-items:center;
      gap:12px;
      transition: background .12s ease, transform .08s ease;
    }
    .navCard:hover{ background: rgba(255,255,255,.07); }
    .navCard:active{ transform: scale(.99); }
    .navIcon{
      width:40px; height:40px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:center;
      font-size:18px;
      flex:0 0 auto;
    }
    .navText{ min-width:0; }
    .navTitle{ font-weight:900; letter-spacing:-0.25px; }
    .navDesc{ margin-top:2px; font-size:12px; color:rgba(167,179,199,.92); }

    .drawerFoot{
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.08);
      color:rgba(148,166,194,.95);
      font-size:12px;
      text-align:center;
    }
    .drawerFoot a{
      color:#9fb0ca;
      border-bottom:1px dashed rgba(159,176,202,.35);
    }
    .drawerFoot a:hover{ color:#cfe0ff; border-bottom-color:rgba(207,224,255,.6); }

    .drawerOpen .drawerOverlay{ display:block; }
    .drawerOpen .drawer{ transform: translateX(0); }

    /* ===== Hero / product-like ===== */
    .hero{
      padding: 14px 0 10px;
    }
    .heroTitle{
      margin: 8px 0 0;
      font-weight: 900;
      letter-spacing: -0.45px;
      line-height: 1.1;
      font-size: 26px;
      color:#ffffff;
    }
    @media (min-width: 1024px){ .heroTitle{ font-size: 36px; } }
    .heroSub{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .heroBadges{
      margin-top: 12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .pill{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      font-weight:900;
      color:#cfe0ff;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      white-space:nowrap;
    }
    .pill strong{ color:#e9eef7; }

    /* ===== Tools grid (commercial) ===== */
    .toolsGrid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){ .toolsGrid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 520px){ .toolsGrid{ grid-template-columns: 1fr; } }

    .toolCard{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 14px;
      display:flex;
      align-items:center;
      gap:12px;
      transition: background .12s ease, transform .08s ease, border-color .12s ease;
      min-width:0;
    }
    .toolCard:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.14);
    }
    .toolCard:active{ transform: scale(.995); }
    .toolIco{
      width:44px; height:44px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:center;
      font-size:20px;
      flex:0 0 auto;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .toolTxt{ min-width:0; }
    .toolName{
      font-weight:900;
      letter-spacing:-0.25px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toolDesc{
      margin-top:3px;
      font-size:12px;
      color: rgba(167,179,199,.92);
      line-height:1.35;
      overflow:hidden;
      text-overflow:ellipsis;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }
    .toolTag{
      margin-left:auto;
      font-size:10px;
      font-weight:900;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(47,109,246,.26);
      background: rgba(47,109,246,.12);
      color: rgba(233,238,247,.92);
      white-space:nowrap;
      flex:0 0 auto;
    }
    .toolTag.muted{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color:#cfe0ff;
    }

    /* ===== Convert section ===== */
    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:12px;
    }
    @media (max-width: 860px){ .grid{ grid-template-columns:1fr; } }

    .card{
      border:var(--border);
      background:var(--card);
      border-radius:var(--radius);
      padding:var(--pad);
      min-width:0;
    }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; letter-spacing:-0.2px; }

    .drop{
      border:1px dashed rgba(255,255,255,.18);
      border-radius:14px;
      padding:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      background:rgba(255,255,255,.02);
      min-width:0;
      cursor:pointer;
      user-select:none;
      transition: background .15s, border-color .15s, box-shadow .15s, transform .05s;
      position: relative;
      min-height: 240px;
    }
    @media (max-width: 480px){ .drop{ min-height: 210px; } }
    .drop:active{ transform: scale(0.998); }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); }
    .drop.active{
      border-color: rgba(47,109,246,.55);
      background: rgba(47,109,246,.08);
      box-shadow: 0 0 0 1px rgba(47,109,246,.18), var(--shadow);
    }
    .dropEmoji{
      font-size:42px;
      line-height:1;
      margin:12px 0 8px;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,.28));
    }

    .localBadge{
      margin-top:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:8px 12px;
      border-radius:12px;
      border:1px solid rgba(80,120,255,0.18);
      background: rgba(80,120,255,0.08);
      color:#bcd1ff;
      font-size:13px;
      font-weight:900;
      letter-spacing:-0.2px;
      user-select:none;
    }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      background: var(--blue);
      color: rgba(233,238,247,.92);
      font-weight:900;
      padding:12px 14px;
      border-radius:14px;
      width:100%;
      font-size:15px;
      letter-spacing: -0.2px;
      transition: transform .08s ease, filter .12s ease, background .12s ease, box-shadow .12s ease, opacity .12s ease;
    }
    .btn:hover{ filter: brightness(1.03); }
    .btn:active{ transform: scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(47,109,246,.22); }
    .btn:disabled{
      cursor:not-allowed;
      opacity: 1;
      background: rgba(47,109,246,.26);
      color: rgba(233,238,247,.62);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      transform:none;
      filter:none;
    }
    .btn.secondary{
      background: rgba(47,109,246,.12);
      color: rgba(233,238,247,.86);
      border: 1px solid rgba(47,109,246,.26);
    }
    .btn.secondary:hover{ background: rgba(47,109,246,.16); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex:1; min-width:160px; }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input[type="file"]{ display:none; }

    select, input[type="number"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:var(--text);
      border:var(--border);
      outline:none;
      font-weight:900;
    }
    option{ background:#0b0f17; color:#e9eef7; }

    .previewHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .previewActions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    .miniBtn{
      border:var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      transition: transform .08s ease, background .12s ease, opacity .12s ease;
    }
    .miniBtn:hover{ background:rgba(255,255,255,.10); }
    .miniBtn:active{ transform: scale(.99); }
    .miniBtn:disabled{ opacity:.45; cursor:not-allowed; }

    .preview{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:12px;
      align-items:center;
      min-width:0;
    }
    .thumb{
      width:140px; height:140px;
      border-radius:14px;
      border:var(--border);
      background:rgba(255,255,255,.03);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    @media (min-width: 1024px){
      .preview{ grid-template-columns: 180px 1fr; }
      .thumb{ width:180px; height:180px; }
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .meta{
      color:#b7c3d9;
      font-size:13px;
      line-height:1.5;
      min-width:0;
      word-break:break-word;
    }
    .meta b{ color:var(--text); }
    .hint{ margin-top:10px; color:#9fb0ca; font-size:12px; line-height:1.5; }
    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .err{ color:#ffb4b4; }
    .ok{ color:#b8ffcc; }

    .list{
      margin-top:12px;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top:12px;
      display:none;
    }
    .listTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .pillMini{
      font-size:12px;
      color:#b8c6dc;
      border:var(--border);
      padding:7px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.04);
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .toggle{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .chk{
      display:inline-flex;
      gap:8px;
      align-items:center;
      border:var(--border);
      background:rgba(255,255,255,.04);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
      font-size:12px;
      color:#cfe0ff;
      white-space:nowrap;
      transition: opacity .12s ease;
    }
    .chk input{ width:16px; height:16px; }

    .fileRow{
      display:flex; gap:8px; align-items:center;
      padding:10px 10px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      background:rgba(255,255,255,.02);
      margin-bottom:8px;
      overflow:hidden;
    }
    .fileName{
      flex:1; min-width:0;
      font-size:13px; color:#dbe7ff;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .mini{ display:flex; gap:6px; align-items:center; }
    .iconBtn{
      border:var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:900;
      line-height:1;
      min-width:42px;
      transition: background .12s ease, transform .08s ease, opacity .12s ease;
    }
    .iconBtn:hover{ background:rgba(255,255,255,.10); }
    .iconBtn:active{ transform: scale(.99); }
    .iconBtn:disabled{ opacity:.45; cursor:not-allowed; }
    .note{ font-size:12px; color:var(--muted); margin-top:8px; }

    .detailsBox{
      margin-top:10px;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top:10px;
    }
    details{
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:10px 12px;
      background: rgba(255,255,255,.02);
    }
    summary{
      cursor:pointer;
      font-weight:900;
      color:#dbe7ff;
      list-style:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .detailsBody{
      margin-top:8px;
      color:#9fb0ca;
      font-size:12px;
      line-height:1.55;
    }

    /* Samsung browser dashed border fix */
    html[data-samsung="true"] .drop{
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
    }
    html[data-samsung="true"] .drop::before{
      content:"";
      position:absolute;
      inset: 10px;
      border: 1px dashed rgba(255,255,255,0.35);
      border-radius: 14px;
      pointer-events:none;
    }

    /* Footer */
    .footer{
      margin-top:16px;
      color:var(--muted2);
      font-size:12px;
      text-align:center;
    }
    .footer a{
      color:#9fb0ca;
      text-decoration:none;
      border-bottom:1px dashed rgba(159,176,202,.35);
    }
    .footer a:hover{
      color:#cfe0ff;
      border-bottom-color:rgba(207,224,255,.6);
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <div class="headerInner">
      <div class="brand" aria-label="ConvertFiles24 home">
        <div class="logoMark" aria-hidden="true">C</div>
        <div class="brandText">
          <div class="brandName">ConvertFiles24</div>
          <div class="brandTag" id="brand_tag">Local converter Â· No upload</div>
        </div>
      </div>

      <div class="headerRight">
        <div class="langWrap" aria-label="Language selector">
          <span class="langLabel"><span class="langIcon">ğŸŒ</span> <span id="lang_label">Language</span></span>
          <select class="langSelect" id="langSelect" aria-label="Language">
            <option value="en">English</option>
            <option value="es">EspaÃ±ol</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="ko">í•œêµ­ì–´</option>
          </select>
        </div>

        <button class="menuBtn" id="openMenu" type="button" aria-haspopup="dialog" aria-controls="drawer">
          â˜° <span id="menu_text">Menu</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Drawer -->
  <div class="drawerOverlay" id="drawerOverlay"></div>
  <aside class="drawer" id="drawer" role="dialog" aria-modal="true" aria-label="Menu">
    <div class="drawerHeader">
      <div class="drawerTitle" id="drawer_title">Tools</div>
      <button class="drawerClose" id="closeMenu" type="button">âœ•</button>
    </div>
    <div class="drawerBody">
      <div class="drawerSectionTitle">ğŸ§° <span id="drawer_tools_title">Tools</span></div>
      <div class="drawerList" id="drawerTools"></div>

      <div class="drawerSectionTitle">ğŸ“„ <span id="drawer_policy_title">Policy</span></div>
      <div class="drawerList">
        <a class="navCard" href="/privacy.html">
          <div class="navIcon">ğŸ”’</div>
          <div class="navText">
            <div class="navTitle" id="drawer_privacy">Privacy</div>
            <div class="navDesc" id="drawer_privacy_desc">Local processing (no server upload)</div>
          </div>
        </a>
        <a class="navCard" href="/terms.html">
          <div class="navIcon">âœ…</div>
          <div class="navText">
            <div class="navTitle" id="drawer_terms">Terms</div>
            <div class="navDesc" id="drawer_terms_desc">Service terms & notices</div>
          </div>
        </a>
      </div>
    </div>
    <div class="drawerFoot">
      Â© <span id="year"></span> ConvertFiles24 Â· <a href="/privacy.html">Privacy</a> Â· <a href="/terms.html">Terms</a>
    </div>
  </aside>

  <div class="wrap">
    <!-- Hero -->
    <section class="hero">
      <h1 class="heroTitle">ConvertFiles24</h1>
      <p class="heroSub" id="subtitle"></p>

      <div class="heroBadges">
        <div class="pill">ğŸ”’ <strong id="badge_local">100% Local</strong> Â· <span id="badge_noupload">No server upload</span></div>
        <div class="pill">âš¡ <strong id="badge_fast">Fast</strong> Â· <span id="badge_browser">Works in your browser</span></div>
        <div class="pill">ğŸ†“ <strong id="badge_free">Free</strong> Â· <span id="badge_noinstall">No install</span></div>
      </div>

      <!-- Tools grid (above converter) -->
      <div class="toolsGrid" id="toolsGrid"></div>
    </section>

    <!-- Converter -->
    <div class="grid" id="convertSection">
      <!-- Left -->
      <div class="card">
        <h2 id="h_upload"></h2>

        <div class="drop" id="drop" role="button" tabindex="0" aria-label="Choose files">
          <div style="width:100%;">
            <div style="font-weight:800; margin-bottom:6px; white-space:pre-line;" id="drop_title"></div>
            <div class="dropEmoji" aria-hidden="true">ğŸ“</div>
            <input id="file" type="file" multiple accept="image/*,application/pdf" />
            <div class="hint" id="drop_hint"></div>
          </div>
        </div>

        <div class="localBadge" id="localBadge">
          ğŸ”’ <span id="localBadgeText">100% Local processing Â· No server upload</span>
        </div>

        <div class="list" id="multiPanel">
          <div class="listTitle">
            <div class="pillMini" id="multiCount"></div>
            <div class="toggle">
              <label class="chk" id="zipChkLabel" title="Download multiple outputs as ZIP">
                <input type="checkbox" id="zipMode" />
                <span id="zip_label"></span>
              </label>
              <label class="chk" id="a4ChkLabel" title="PDF page size A4 normalization (when merging PDFs)">
                <input type="checkbox" id="a4Mode" />
                <span id="a4_label"></span>
              </label>
            </div>
          </div>

          <div id="fileList"></div>
          <div class="note" id="multi_note"></div>
        </div>

        <div style="height:12px;"></div>

        <div class="previewHead">
          <h2 id="h_preview" style="margin:0;"></h2>
          <div class="previewActions">
            <button class="miniBtn" id="addMoreBtn" type="button" disabled>
              â• <span id="addMoreLabel">Add more</span>
            </button>
            <button class="miniBtn" id="cropBtn" type="button" disabled title="Open edit page">
              âœï¸ <span id="cropLabel">Edit</span>
            </button>
          </div>
        </div>

        <div class="preview">
          <div class="thumb" id="thumb"></div>
          <div class="meta" id="meta"></div>
        </div>

        <div class="msg" id="msg"></div>
      </div>

      <!-- Right -->
      <div class="card">
        <h2 id="h_settings"></h2>

        <div class="row">
          <div>
            <label id="lbl_format"></label>
            <select id="format">
              <option value="image/jpeg">JPG</option>
              <option value="image/png">PNG</option>
              <option value="image/webp">WebP</option>
              <option value="application/pdf">PDF</option>
            </select>
          </div>
          <div>
            <label id="lbl_quality"></label>
            <select id="quality">
              <option value="0.95" id="q_095"></option>
              <option value="0.9" selected id="q_090"></option>
              <option value="0.8" id="q_080"></option>
              <option value="0.7" id="q_070"></option>
            </select>
          </div>
        </div>

        <div style="height:10px;"></div>

        <div class="row">
          <div>
            <label id="lbl_w"></label>
            <input id="w" type="number" min="1" />
          </div>
          <div>
            <label id="lbl_h"></label>
            <input id="h" type="number" min="1" />
          </div>
        </div>

        <div class="hint" id="size_hint"></div>

        <div style="height:12px;"></div>

        <h2 id="h_download"></h2>
        <button class="btn" id="convert" disabled></button>
        <div style="height:10px;"></div>
        <button class="btn secondary" id="reset" disabled></button>

        <div class="detailsBox">
          <details>
            <summary id="privacy_summary"></summary>
            <div class="detailsBody" id="privacy_body"></div>
          </details>
          <div style="height:10px;"></div>
          <details>
            <summary id="pdfzip_summary"></summary>
            <div class="detailsBody" id="pdfzip_body"></div>
          </details>
        </div>
      </div>
    </div>

    <div class="footer">
      Â© <span id="year2"></span> ConvertFiles24 Â· Powered by GitHub Pages Â·
      <a href="/privacy.html">Privacy</a> Â·
      <a href="/terms.html">Terms</a>
    </div>
  </div>

<script>
(() => {
  "use strict";

  if (/SamsungBrowser/i.test(navigator.userAgent)) {
    document.documentElement.dataset.samsung = "true";
  }

  const $ = (id) => document.getElementById(id);

  const fileInput   = $("file");
  const drop        = $("drop");
  const thumb       = $("thumb");
  const meta        = $("meta");
  const msg         = $("msg");
  const btnConvert  = $("convert");
  const btnReset    = $("reset");
  const selFormat   = $("format");
  const selQuality  = $("quality");
  const inW         = $("w");
  const inH         = $("h");

  const multiPanel  = $("multiPanel");
  const multiCount  = $("multiCount");
  const fileListEl  = $("fileList");
  const zipModeEl   = $("zipMode");
  const a4ModeEl    = $("a4Mode");
  const zipChkLabel = $("zipChkLabel");
  const a4ChkLabel  = $("a4ChkLabel");

  const cropBtn      = $("cropBtn");
  const cropLabel    = $("cropLabel");
  const addMoreBtn   = $("addMoreBtn");
  const addMoreLabel = $("addMoreLabel");

  const langSelectEl = $("langSelect");
  const localBadgeTextEl = $("localBadgeText");

  $("year").textContent = new Date().getFullYear();
  $("year2").textContent = new Date().getFullYear();

  // ========= Tools (links) =========
  // í´ë”ëª… ê¸°ì¤€ìœ¼ë¡œ ì—°ê²°
  const TOOLS = [
    { key:"pdf_merge",  href:"/pdf-merge/",   icon:"ğŸ§©", tag:"PDF",  name:{en:"PDF Merge", ko:"PDF í•©ì¹˜ê¸°", ja:"PDF çµåˆ", es:"Unir PDF"}, desc:{en:"Combine multiple PDFs into one.", ko:"ì—¬ëŸ¬ PDFë¥¼ í•˜ë‚˜ë¡œ í•©ì³ìš”.", ja:"è¤‡æ•°PDFã‚’1ã¤ã«ã€‚", es:"Combina varios PDFs en uno."}},
    { key:"pdf_split",  href:"/split-pdf/",   icon:"âœ‚ï¸", tag:"PDF",  name:{en:"PDF Split", ko:"PDF ë¶„ë¦¬", ja:"PDF åˆ†å‰²", es:"Dividir PDF"}, desc:{en:"Split pages quickly.", ko:"í˜ì´ì§€ë¥¼ ë¹ ë¥´ê²Œ ë¶„ë¦¬í•´ìš”.", ja:"ãƒšãƒ¼ã‚¸ã‚’åˆ†å‰²ã€‚", es:"Divide pÃ¡ginas rÃ¡pidamente."}},
    { key:"pdf_comp",   href:"/compress-pdf/",icon:"ğŸ—œï¸", tag:"PDF",  name:{en:"PDF Compress", ko:"PDF ì••ì¶•", ja:"PDF åœ§ç¸®", es:"Comprimir PDF"}, desc:{en:"Reduce file size.", ko:"ìš©ëŸ‰ì„ ì¤„ì—¬ìš”.", ja:"å®¹é‡ã‚’å‰Šæ¸›ã€‚", es:"Reduce el tamaÃ±o."}},
    { key:"pdf_jpg",    href:"/pdf-jpg/",     icon:"ğŸ–¼ï¸", tag:"PDF",  name:{en:"PDF â†’ JPG", ko:"PDF â†’ JPG", ja:"PDF â†’ JPG", es:"PDF â†’ JPG"}, desc:{en:"Convert PDF pages to images.", ko:"PDF í˜ì´ì§€ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•´ìš”.", ja:"PDFãƒšãƒ¼ã‚¸ã‚’ç”»åƒã«ã€‚", es:"Convierte pÃ¡ginas a imÃ¡genes."}},
    { key:"img_edit",   href:"/edit/",        icon:"âœï¸", tag:"Image",name:{en:"Image Edit", ko:"ì´ë¯¸ì§€ í¸ì§‘", ja:"ç”»åƒç·¨é›†", es:"Editar imagen"}, desc:{en:"Crop/rotate then convert.", ko:"ìë¥´ê¸°/íšŒì „ í›„ ë³€í™˜í•´ìš”.", ja:"ãƒˆãƒªãƒŸãƒ³ã‚°/å›è»¢ã€‚", es:"Recorta/gira y convierte."}},
    { key:"id_photo",   href:"/id-photo/",    icon:"ğŸªª", tag:"NEW",  name:{en:"ID Photo", ko:"ì¦ëª…ì‚¬ì§„", ja:"è¨¼æ˜å†™çœŸ", es:"Foto carnet"}, desc:{en:"Passport/ID sizes.", ko:"ì—¬ê¶Œ/ì¦ëª… ê·œê²©.", ja:"è¨¼æ˜/ãƒ‘ã‚¹ãƒãƒ¼ãƒˆè¦æ ¼ã€‚", es:"TamaÃ±os de ID/pasaporte."}}
  ];

  const STR = {
    en: {
      seoTitle: "ConvertFiles24 â€“ Free Converter (Images & PDF)",
      seoDesc: "Convert images to JPG/PNG/WebP/PDF and merge PDFs instantly â€” processed locally in your browser.",
      ogTitle: "ConvertFiles24 - Converter (Images & PDF)",
      ogDesc: "Convert images, create PDFs, merge PDFs â€” processed locally in your browser.",
      brand_tag: "Local converter Â· No upload",
      menu: "Menu",
      drawer_title: "Tools",
      drawer_tools_title: "Tools",
      drawer_policy_title: "Policy",
      drawer_privacy: "Privacy",
      drawer_privacy_desc: "Local processing (no server upload)",
      drawer_terms: "Terms",
      drawer_terms_desc: "Service terms & notices",

      subtitle: 'Convert <b>images</b> to <b>JPG / PNG / WebP / PDF</b> and merge <b>PDF + PDF</b>. (No server upload)',
      lang_label: "Language",
      badge_local: "100% Local",
      badge_noupload: "No server upload",
      badge_fast: "Fast",
      badge_browser: "Works in your browser",
      badge_free: "Free",
      badge_noinstall: "No install",

      h_upload: "Upload",
      drop_title: "Drop files here\nor tap to select files",
      drop_hint: "Supports: JPG, PNG, WebP, PDF â€¢ Multiple selection supported",
      local_badge: "100% Local processing Â· No server upload",

      h_preview: "Preview",
      add_more: "Add more",
      crop: "Edit",
      thumb_label: "Preview",
      meta_idle: "Select files to see details.",

      h_settings: "Settings",
      lbl_format: "Output",
      lbl_quality: "Quality (JPG/WebP only)",
      q_095: "Max (0.95)",
      q_090: "High (0.90)",
      q_080: "Normal (0.80)",
      q_070: "Small (0.70)",
      lbl_w: "Width (px) (blank = original)",
      lbl_h: "Height (px) (blank = original)",
      ph_w: "e.g., 1200",
      ph_h: "e.g., 800",
      size_hint: "If you enter only one side, aspect ratio is preserved automatically.",

      h_download: "Download",
      convert: "Convert & Download",
      reset: "Reset",

      privacy_summary: "ğŸ”’ Privacy / Local processing",
      privacy_body: "Files are processed locally in your browser (no server upload).",
      pdfzip_summary: "PDF vs ZIP",
      pdfzip_body: "â€¢ PDF: Merge multiple pages into ONE PDF.<br/>â€¢ ZIP: Download multiple converted files as ONE .zip",

      zip_label: "ZIP download",
      a4_label: "A4 normalize (PDF merge)",
      multi_note: "Tip: Use â–²â–¼ to reorder and ğŸ—‘ï¸ to remove before converting/merging.",
      msg_loading: "Loadingâ€¦",
      msg_ready: "Ready! Click Convert & Download.",
      msg_png_q: "PNG is lossless; quality setting does not apply.",
      msg_pdf_one: "Imageâ†’PDF will be saved. (Multiple images become one merged PDF.)",
      msg_pdf_merge: "PDF+PDF merge will output a single merged PDF.",
      err_only_supported: "Only images and PDFs are supported.",
      err_preview: "Failed to preview.",
      err_convert: "Conversion failed. Try different files/options.",
      err_pdf_lib: "PDF library is not ready. Please refresh and try again.",
      err_pdf_locked: "This PDF may be password-protected or corrupted. Please unlock it and try again.",
      err_heic: "HEIC/HEIF may not work on some browsers. Please save as JPG/PNG and try again.",
      dl_start: (name, size) => `Download started: ${name} (${size})`,
      meta_img: (name, type, size, w, h) =>
        `Name: <b>${name}</b><br/>Type: <b>${type}</b><br/>Size: <b>${size}</b><br/>Resolution: <b>${w} Ã— ${h}</b>`,
      meta_pdf: (name, size) =>
        `Name: <b>${name}</b><br/>Type: <b>application/pdf</b><br/>Size: <b>${size}</b>`,
      multi_count: (n) => `Selected: ${n} file(s)`
    },
    ko: {
      seoTitle: "ConvertFiles24 â€“ ë¬´ë£Œ ë³€í™˜ê¸° (ì´ë¯¸ì§€ & PDF)",
      seoDesc: "ì´ë¯¸ì§€ë¥¼ JPG/PNG/WebP/PDFë¡œ ë³€í™˜í•˜ê³  PDF+PDF ë³‘í•©ê¹Œì§€ â€” ëª¨ë‘ ë¸Œë¼ìš°ì € ë¡œì»¬ ì²˜ë¦¬.",
      ogTitle: "ConvertFiles24 - ì´ë¯¸ì§€ & PDF ë³€í™˜",
      ogDesc: "ì´ë¯¸ì§€ ë³€í™˜, PDF ìƒì„±, PDF ë³‘í•© â€” ì„œë²„ ì—…ë¡œë“œ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì²˜ë¦¬",
      brand_tag: "ë¡œì»¬ ë³€í™˜ Â· ì—…ë¡œë“œ ì—†ìŒ",
      menu: "ë©”ë‰´",
      drawer_title: "ë„êµ¬",
      drawer_tools_title: "ë„êµ¬",
      drawer_policy_title: "ì •ì±…",
      drawer_privacy: "ê°œì¸ì •ë³´",
      drawer_privacy_desc: "ë¡œì»¬ ì²˜ë¦¬(ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ)",
      drawer_terms: "ì´ìš©ì•½ê´€",
      drawer_terms_desc: "ì„œë¹„ìŠ¤ ì•½ê´€/ê³µì§€",

      subtitle: 'ì´ë¯¸ì§€ë¥¼ <b>JPG / PNG / WebP / PDF</b>ë¡œ ë³€í™˜í•˜ê³  <b>PDF+PDF</b>ë„ í•©ì¹  ìˆ˜ ìˆì–´ìš”. (ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ)',
      lang_label: "ì–¸ì–´",
      badge_local: "100% ë¡œì»¬",
      badge_noupload: "ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ",
      badge_fast: "ë¹ ë¦„",
      badge_browser: "ë¸Œë¼ìš°ì €ì—ì„œ ì‘ë™",
      badge_free: "ë¬´ë£Œ",
      badge_noinstall: "ì„¤ì¹˜ ì—†ìŒ",

      h_upload: "ì—…ë¡œë“œ",
      drop_title: "ì—¬ê¸°ì— íŒŒì¼ì„ ëŒì–´ë‹¤ ë†“ê±°ë‚˜\në˜ëŠ” íƒ­í•´ì„œ íŒŒì¼ ì„ íƒ",
      drop_hint: "ì§€ì›: JPG, PNG, WebP, PDF â€¢ ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥",
      local_badge: "100% ë¡œì»¬ ì²˜ë¦¬ Â· ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ",

      h_preview: "ë¯¸ë¦¬ë³´ê¸°",
      add_more: "ì¶”ê°€í•˜ê¸°",
      crop: "í¸ì§‘",
      thumb_label: "ë¯¸ë¦¬ë³´ê¸°",
      meta_idle: "íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.",

      h_settings: "ì„¤ì •",
      lbl_format: "ì¶œë ¥",
      lbl_quality: "í’ˆì§ˆ (JPG/WebPë§Œ)",
      q_095: "ìµœê³ (0.95)",
      q_090: "ë†’ìŒ(0.90)",
      q_080: "ë³´í†µ(0.80)",
      q_070: "ì••ì¶•(0.70)",
      lbl_w: "ê°€ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)",
      lbl_h: "ì„¸ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)",
      ph_w: "ì˜ˆ: 1200",
      ph_h: "ì˜ˆ: 800",
      size_hint: "ê°€ë¡œ/ì„¸ë¡œë¥¼ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ë¹„ìœ¨ ìœ ì§€ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.",

      h_download: "ë‹¤ìš´ë¡œë“œ",
      convert: "ë³€í™˜ / í•©ì¹˜ê¸°",
      reset: "ì´ˆê¸°í™”",

      privacy_summary: "ğŸ”’ ê°œì¸ì •ë³´ / ë¡œì»¬ ì²˜ë¦¬ ì•ˆë‚´",
      privacy_body: "íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šê³  ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ ì²˜ë¦¬ë©ë‹ˆë‹¤.",
      pdfzip_summary: "PDF vs ZIP",
      pdfzip_body: "â€¢ PDF: ì—¬ëŸ¬ í˜ì´ì§€ë¥¼ 1ê°œ PDFë¡œ í•©ì¹¨<br/>â€¢ ZIP: ì—¬ëŸ¬ ë³€í™˜ íŒŒì¼ì„ 1ê°œ zipìœ¼ë¡œ ë°›ê¸°",

      zip_label: "ZIP ë°›ê¸°",
      a4_label: "A4 í†µì¼(PDF ë³‘í•©)",
      multi_note: "íŒ: â–²â–¼ë¡œ ìˆœì„œ ë³€ê²½, ğŸ—‘ï¸ë¡œ ì‚­ì œ í›„ ë³€í™˜/í•©ì¹˜ê¸° í•˜ì„¸ìš”.",
      msg_loading: "ë¡œë”© ì¤‘â€¦",
      msg_ready: "ì¤€ë¹„ ì™„ë£Œ! ë³€í™˜ / í•©ì¹˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.",
      msg_png_q: "PNGëŠ” ë¬´ì†ì‹¤ì´ë¼ í’ˆì§ˆ ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•Šì•„ìš”.",
      msg_pdf_one: "ì´ë¯¸ì§€â†’PDFëŠ” ì €ì¥ë©ë‹ˆë‹¤. (ì—¬ëŸ¬ ì´ë¯¸ì§€ëŠ” 1ê°œ PDFë¡œ í•©ì³ì§‘ë‹ˆë‹¤.)",
      msg_pdf_merge: "PDF+PDF ë³‘í•©ì€ 1ê°œì˜ í•©ì³ì§„ PDFë¡œ ì €ì¥ë©ë‹ˆë‹¤.",
      err_only_supported: "ì´ë¯¸ì§€ì™€ PDFë§Œ ì§€ì›í•©ë‹ˆë‹¤.",
      err_preview: "ë¯¸ë¦¬ë³´ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”.",
      err_convert: "ë³€í™˜ ì‹¤íŒ¨. ë‹¤ë¥¸ íŒŒì¼/ì˜µì…˜ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      err_pdf_lib: "PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´ìš”. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      err_pdf_locked: "PDFê°€ ì•”í˜¸ë¡œ ì ê²¼ê±°ë‚˜ ì†ìƒëœ ê²ƒ ê°™ì•„ìš”. ì ê¸ˆ í•´ì œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      err_heic: "HEIC/HEIFëŠ” ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì•ˆ ë  ìˆ˜ ìˆì–´ìš”. JPG/PNGë¡œ ì €ì¥ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      dl_start: (name, size) => `ë‹¤ìš´ë¡œë“œ ì‹œì‘: ${name} (${size})`,
      meta_img: (name, type, size, w, h) =>
        `íŒŒì¼ëª…: <b>${name}</b><br/>í˜•ì‹: <b>${type}</b><br/>í¬ê¸°: <b>${size}</b><br/>í•´ìƒë„: <b>${w} Ã— ${h}</b>`,
      meta_pdf: (name, size) =>
        `íŒŒì¼ëª…: <b>${name}</b><br/>í˜•ì‹: <b>application/pdf</b><br/>í¬ê¸°: <b>${size}</b>`,
      multi_count: (n) => `ì„ íƒë¨: ${n}ê°œ`
    },
    ja: {
      seoTitle: "ConvertFiles24 â€“ ç„¡æ–™å¤‰æ› (ç”»åƒ & PDF)",
      seoDesc: "ç”»åƒã‚’JPG/PNG/WebP/PDFã«å¤‰æ›ã—ã€PDF+PDFçµåˆã‚‚å¯èƒ½ â€” ã™ã¹ã¦ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã€‚",
      ogTitle: "ConvertFiles24 - ç”»åƒ & PDF å¤‰æ›",
      ogDesc: "ç”»åƒå¤‰æ›ã€PDFä½œæˆã€PDFçµåˆ â€” ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—",
      brand_tag: "ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ› Â· ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãªã—",
      menu: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼",
      drawer_title: "ãƒ„ãƒ¼ãƒ«",
      drawer_tools_title: "ãƒ„ãƒ¼ãƒ«",
      drawer_policy_title: "ãƒãƒªã‚·ãƒ¼",
      drawer_privacy: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼",
      drawer_privacy_desc: "ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†(é€ä¿¡ãªã—)",
      drawer_terms: "åˆ©ç”¨è¦ç´„",
      drawer_terms_desc: "è¦ç´„/ãŠçŸ¥ã‚‰ã›",

      subtitle: 'ç”»åƒã‚’ <b>JPG / PNG / WebP / PDF</b> ã«å¤‰æ›ã—ã€<b>PDF+PDF</b> çµåˆã‚‚ã§ãã¾ã™ã€‚ï¼ˆã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—ï¼‰',
      lang_label: "è¨€èª",
      badge_local: "ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†",
      badge_noupload: "ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—",
      badge_fast: "é«˜é€Ÿ",
      badge_browser: "ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œ",
      badge_free: "ç„¡æ–™",
      badge_noinstall: "ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦",

      h_upload: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      drop_title: "ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—\nã¾ãŸã¯ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ",
      drop_hint: "å¯¾å¿œ: JPG, PNG, WebP, PDF â€¢ è¤‡æ•°é¸æŠOK",
      local_badge: "ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç† Â· ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—",

      h_preview: "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
      add_more: "è¿½åŠ ",
      crop: "ç·¨é›†",
      thumb_label: "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
      meta_idle: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã¨æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",

      h_settings: "è¨­å®š",
      lbl_format: "å‡ºåŠ›",
      lbl_quality: "å“è³ªï¼ˆJPG/WebPã®ã¿ï¼‰",
      q_095: "æœ€é«˜(0.95)",
      q_090: "é«˜(0.90)",
      q_080: "æ¨™æº–(0.80)",
      q_070: "åœ§ç¸®(0.70)",
      lbl_w: "å¹…(px)ï¼ˆç©ºæ¬„=å…ƒã‚µã‚¤ã‚ºï¼‰",
      lbl_h: "é«˜ã•(px)ï¼ˆç©ºæ¬„=å…ƒã‚µã‚¤ã‚ºï¼‰",
      ph_w: "ä¾‹: 1200",
      ph_h: "ä¾‹: 800",
      size_hint: "ç‰‡æ–¹ã ã‘å…¥åŠ›ã™ã‚‹ã¨ã€æ¯”ç‡ã‚’ç¶­æŒã—ã¦è‡ªå‹•è¨ˆç®—ã—ã¾ã™ã€‚",

      h_download: "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
      convert: "å¤‰æ› / çµåˆ",
      reset: "ãƒªã‚»ãƒƒãƒˆ",

      privacy_summary: "ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ / ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†",
      privacy_body: "ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ã•ã‚Œãšã€ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚",
      pdfzip_summary: "PDF ã¨ ZIP",
      pdfzip_body: "â€¢ PDF: è¤‡æ•°ãƒšãƒ¼ã‚¸ã‚’1ã¤ã«çµåˆ<br/>â€¢ ZIP: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’zipã§å—ã‘å–ã‚‹",

      zip_label: "ZIPã§å—ã‘å–ã‚‹",
      a4_label: "A4çµ±ä¸€(PDFçµåˆ)",
      multi_note: "ãƒ’ãƒ³ãƒˆ: â–²â–¼ã§é †åºå¤‰æ›´ã€ğŸ—‘ï¸ã§å‰Šé™¤ã—ã¦ã‹ã‚‰å®Ÿè¡Œã§ãã¾ã™ã€‚",
      msg_loading: "èª­ã¿è¾¼ã¿ä¸­â€¦",
      msg_ready: "æº–å‚™å®Œäº†ï¼å¤‰æ› / çµåˆã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚",
      msg_png_q: "PNGã¯ç„¡åŠ£åŒ–ã®ãŸã‚ã€å“è³ªè¨­å®šã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚",
      msg_pdf_one: "ç”»åƒâ†’PDFã¯ä¿å­˜ã•ã‚Œã¾ã™ã€‚ï¼ˆè¤‡æ•°ç”»åƒã¯1ã¤ã®PDFã«çµåˆï¼‰",
      msg_pdf_merge: "PDF+PDFçµåˆã¯1ã¤ã®çµåˆPDFã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚",
      err_only_supported: "ç”»åƒã¨PDFã®ã¿å¯¾å¿œã§ã™ã€‚",
      err_preview: "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",
      err_convert: "å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«/è¨­å®šã§ãŠè©¦ã—ãã ã•ã„ã€‚",
      err_pdf_lib: "PDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæº–å‚™ã§ãã¦ã„ã¾ã›ã‚“ã€‚æ›´æ–°ã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",
      err_pdf_locked: "PDFãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·ã¾ãŸã¯ç ´æã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚è§£é™¤ã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",
      err_heic: "HEIC/HEIFã¯ä¸€éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§éå¯¾å¿œã§ã™ã€‚JPG/PNGã§ä¿å­˜ã—ã¦ãŠè©¦ã—ãã ã•ã„ã€‚",
      dl_start: (name, size) => `ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹: ${name} (${size})`,
      meta_img: (name, type, size, w, h) =>
        `ãƒ•ã‚¡ã‚¤ãƒ«å: <b>${name}</b><br/>å½¢å¼: <b>${type}</b><br/>ã‚µã‚¤ã‚º: <b>${size}</b><br/>è§£åƒåº¦: <b>${w} Ã— ${h}</b>`,
      meta_pdf: (name, size) =>
        `ãƒ•ã‚¡ã‚¤ãƒ«å: <b>${name}</b><br/>å½¢å¼: <b>application/pdf</b><br/>ã‚µã‚¤ã‚º: <b>${size}</b>`,
      multi_count: (n) => `é¸æŠ: ${n}ä»¶`
    },
    es: {
      seoTitle: "ConvertFiles24 â€“ Convertidor Gratis (ImÃ¡genes y PDF)",
      seoDesc: "Convierte imÃ¡genes a JPG/PNG/WebP/PDF y une PDFs al instante â€” todo se procesa localmente en tu navegador.",
      ogTitle: "ConvertFiles24 - Convertidor (ImÃ¡genes y PDF)",
      ogDesc: "Convierte imÃ¡genes, crea PDFs y une PDFs â€” sin subir archivos al servidor.",
      brand_tag: "Conversor local Â· Sin subidas",
      menu: "MenÃº",
      drawer_title: "Herramientas",
      drawer_tools_title: "Herramientas",
      drawer_policy_title: "PolÃ­tica",
      drawer_privacy: "Privacidad",
      drawer_privacy_desc: "Procesamiento local (sin servidor)",
      drawer_terms: "TÃ©rminos",
      drawer_terms_desc: "TÃ©rminos y avisos",

      subtitle: 'Convierte imÃ¡genes a <b>JPG / PNG / WebP / PDF</b> y une <b>PDF+PDF</b>. (Sin subir archivos)',
      lang_label: "Idioma",
      badge_local: "100% Local",
      badge_noupload: "Sin subir",
      badge_fast: "RÃ¡pido",
      badge_browser: "En tu navegador",
      badge_free: "Gratis",
      badge_noinstall: "Sin instalar",

      h_upload: "Subir",
      drop_title: "Suelta los archivos aquÃ­\no toca para seleccionarlos",
      drop_hint: "Soporta: JPG, PNG, WebP, PDF â€¢ SelecciÃ³n mÃºltiple",
      local_badge: "Procesamiento local Â· Sin subir al servidor",

      h_preview: "Vista previa",
      add_more: "AÃ±adir",
      crop: "Editar",
      thumb_label: "Vista previa",
      meta_idle: "Elige archivos para ver detalles.",

      h_settings: "Ajustes",
      lbl_format: "Salida",
      lbl_quality: "Calidad (solo JPG/WebP)",
      q_095: "MÃ¡x (0.95)",
      q_090: "Alta (0.90)",
      q_080: "Normal (0.80)",
      q_070: "PequeÃ±a (0.70)",
      lbl_w: "Ancho (px) (vacÃ­o = original)",
      lbl_h: "Alto (px) (vacÃ­o = original)",
      ph_w: "p. ej., 1200",
      ph_h: "p. ej., 800",
      size_hint: "Si introduces solo un lado, se mantiene la proporciÃ³n automÃ¡ticamente.",

      h_download: "Descargar",
      convert: "Convertir / Unir",
      reset: "Reiniciar",

      privacy_summary: "ğŸ”’ Privacidad / Procesamiento local",
      privacy_body: "Los archivos no se suben al servidor; se procesan localmente en tu navegador.",
      pdfzip_summary: "PDF vs ZIP",
      pdfzip_body: "â€¢ PDF: Une varias pÃ¡ginas en un PDF<br/>â€¢ ZIP: Descarga varios archivos en un .zip",

      zip_label: "Descargar en ZIP",
      a4_label: "Normalizar a A4 (unir PDF)",
      multi_note: "Consejo: Usa â–²â–¼ para reordenar y ğŸ—‘ï¸ para eliminar antes de convertir/unir.",
      msg_loading: "Cargandoâ€¦",
      msg_ready: "Â¡Listo! Pulsa Convertir / Unir.",
      msg_png_q: "PNG es sin pÃ©rdida; la calidad no aplica.",
      msg_pdf_one: "Imagenâ†’PDF se guardarÃ¡. (Varias imÃ¡genes se combinan en un solo PDF.)",
      msg_pdf_merge: "Unir PDF+PDF generarÃ¡ un solo PDF combinado.",
      err_only_supported: "Solo se admiten imÃ¡genes y PDFs.",
      err_preview: "FallÃ³ la vista previa.",
      err_convert: "FallÃ³ la conversiÃ³n. Prueba con otros archivos/opciones.",
      err_pdf_lib: "La librerÃ­a PDF no estÃ¡ lista. Actualiza y reintenta.",
      err_pdf_locked: "Este PDF puede estar protegido con contraseÃ±a o daÃ±ado. DesbloquÃ©alo y reintenta.",
      err_heic: "HEIC/HEIF puede no funcionar en algunos navegadores. Guarda como JPG/PNG y reintenta.",
      dl_start: (name, size) => `Descarga iniciada: ${name} (${size})`,
      meta_img: (name, type, size, w, h) =>
        `Nombre: <b>${name}</b><br/>Tipo: <b>${type}</b><br/>TamaÃ±o: <b>${size}</b><br/>ResoluciÃ³n: <b>${w} Ã— ${h}</b>`,
      meta_pdf: (name, size) =>
        `Nombre: <b>${name}</b><br/>Tipo: <b>application/pdf</b><br/>TamaÃ±o: <b>${size}</b>`,
      multi_count: (n) => `Seleccionados: ${n}`
    }
  };

  const META_DESC = document.querySelector('meta[name="description"]');
  const OG_TITLE = document.querySelector('meta[property="og:title"]');
  const OG_DESC  = document.querySelector('meta[property="og:description"]');
  const TW_TITLE = document.querySelector('meta[name="twitter:title"]');
  const TW_DESC  = document.querySelector('meta[name="twitter:description"]');
  const JSONLD   = document.getElementById('jsonld');

  function getQueryLang(){
    try{
      const u = new URL(location.href);
      const q = (u.searchParams.get("lang")||"").toLowerCase();
      if(q && STR[q]) return q;
    }catch(e){}
    return null;
  }

  function detectLang(){
    const q = getQueryLang();
    if(q) return q;

    const saved = localStorage.getItem("cf24_lang");
    if(saved && STR[saved]) return saved;

    const nav = (navigator.language || "").toLowerCase();
    if(nav.startsWith("ja")) return "ja";
    if(nav.startsWith("ko")) return "ko";
    if(nav.startsWith("es")) return "es";
    return "en";
  }

  let LANG = detectLang();

  function humanSize(bytes){
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return `${v.toFixed(i===0?0:1)} ${units[i]}`;
  }

  function setMessage(text, type){
    msg.textContent = text || "";
    msg.className = "msg " + (type || "");
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function extLower(name){
    return (name || "").toLowerCase().split(".").pop();
  }

  function isImage(file){
    const t = (file.type || "").toLowerCase();
    if(t.startsWith("image/")) return true;
    const ext = extLower(file.name);
    return ["jpg","jpeg","png","webp","gif","bmp","heic","heif"].includes(ext);
  }

  function isPDF(file){
    const t = (file.type || "").toLowerCase();
    if(t === "application/pdf") return true;
    return extLower(file.name) === "pdf";
  }

  function mimeToExt(mime){
    if(mime === "image/jpeg") return "jpg";
    if(mime === "image/png") return "png";
    if(mime === "image/webp") return "webp";
    if(mime === "application/pdf") return "pdf";
    return "bin";
  }

  function buildName(baseName, ext){
    const base = (baseName || "file").replace(/\.[^.]+$/, "");
    const stamp = new Date().toISOString().replace(/[:.]/g,"-");
    return `${base}_${stamp}.${ext}`;
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  function syncLangSelect(){
    if(!langSelectEl) return;
    langSelectEl.value = LANG;
  }

  function withLang(url){
    const u = new URL(url, location.origin);
    u.searchParams.set("lang", LANG);
    return u.pathname + "?" + u.searchParams.toString();
  }

  // ===== Build tools UI (grid + drawer) =====
  function buildTools(){
    const grid = $("toolsGrid");
    const drawerTools = $("drawerTools");
    if(!grid || !drawerTools) return;

    grid.innerHTML = "";
    drawerTools.innerHTML = "";

    const t = STR[LANG] || STR.en;

    TOOLS.forEach(tool => {
      const name = tool.name[LANG] || tool.name.en;
      const desc = tool.desc[LANG] || tool.desc.en;

      // Grid card
      const a = document.createElement("a");
      a.className = "toolCard";
      a.href = withLang(tool.href);

      const ico = document.createElement("div");
      ico.className = "toolIco";
      ico.textContent = tool.icon;

      const txt = document.createElement("div");
      txt.className = "toolTxt";
      const n = document.createElement("div");
      n.className = "toolName";
      n.textContent = name;
      const d = document.createElement("div");
      d.className = "toolDesc";
      d.textContent = desc;
      txt.appendChild(n);
      txt.appendChild(d);

      const tag = document.createElement("div");
      tag.className = "toolTag " + (tool.tag === "NEW" ? "" : "muted");
      tag.textContent = (tool.tag === "NEW") ? "âœ¨ NEW" : tool.tag;

      a.appendChild(ico);
      a.appendChild(txt);
      a.appendChild(tag);
      grid.appendChild(a);

      // Drawer nav card
      const b = document.createElement("a");
      b.className = "navCard";
      b.href = withLang(tool.href);

      const di = document.createElement("div");
      di.className = "navIcon";
      di.textContent = tool.icon;

      const dt = document.createElement("div");
      dt.className = "navText";
      const dn = document.createElement("div");
      dn.className = "navTitle";
      dn.textContent = name;
      const dd = document.createElement("div");
      dd.className = "navDesc";
      dd.textContent = desc;
      dt.appendChild(dn);
      dt.appendChild(dd);

      b.appendChild(di);
      b.appendChild(dt);
      drawerTools.appendChild(b);
    });

    // update drawer titles
    $("drawer_title").textContent = t.drawer_title;
    $("drawer_tools_title").textContent = t.drawer_tools_title;
    $("drawer_policy_title").textContent = t.drawer_policy_title;
    $("drawer_privacy").textContent = t.drawer_privacy;
    $("drawer_privacy_desc").textContent = t.drawer_privacy_desc;
    $("drawer_terms").textContent = t.drawer_terms;
    $("drawer_terms_desc").textContent = t.drawer_terms_desc;
  }

  // ===== Drawer interaction =====
  const root = document.documentElement;
  const overlay = $("drawerOverlay");
  const openMenu = $("openMenu");
  const closeMenu = $("closeMenu");

  function openDrawer(){
    root.classList.add("drawerOpen");
    try{ overlay.focus(); }catch(e){}
  }
  function closeDrawer(){
    root.classList.remove("drawerOpen");
  }

  openMenu.addEventListener("click", openDrawer);
  closeMenu.addEventListener("click", closeDrawer);
  overlay.addEventListener("click", closeDrawer);
  window.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closeDrawer();
  });

  // =========================
  // State
  // =========================
  let files = [];
  let activeIndex = 0;

  function renderTexts(){
    const t = STR[LANG] || STR.en;

    document.documentElement.lang = LANG;

    document.title = t.seoTitle;
    if(META_DESC) META_DESC.setAttribute("content", t.seoDesc);
    if(OG_TITLE)  OG_TITLE.setAttribute("content", t.ogTitle);
    if(OG_DESC)   OG_DESC.setAttribute("content", t.ogDesc);
    if(TW_TITLE)  TW_TITLE.setAttribute("content", t.ogTitle);
    if(TW_DESC)   TW_DESC.setAttribute("content", t.ogDesc);

    if(JSONLD){
      try{
        const obj = JSON.parse(JSONLD.textContent);
        obj.name = "ConvertFiles24";
        obj.url = (document.querySelector('link[rel="canonical"]')?.href) || obj.url;
        JSONLD.textContent = JSON.stringify(obj);
      }catch(e){}
    }

    $("brand_tag").textContent = t.brand_tag;
    $("menu_text").textContent = t.menu;

    $("subtitle").innerHTML = t.subtitle;
    $("lang_label").textContent = t.lang_label;

    $("badge_local").textContent = t.badge_local;
    $("badge_noupload").textContent = t.badge_noupload;
    $("badge_fast").textContent = t.badge_fast;
    $("badge_browser").textContent = t.badge_browser;
    $("badge_free").textContent = t.badge_free;
    $("badge_noinstall").textContent = t.badge_noinstall;

    $("h_upload").textContent = t.h_upload;
    $("drop_title").textContent = t.drop_title;
    $("drop_hint").textContent = t.drop_hint;
    if(localBadgeTextEl) localBadgeTextEl.textContent = t.local_badge;

    $("h_preview").textContent = t.h_preview;
    addMoreLabel.textContent = t.add_more;
    cropLabel.textContent = t.crop;

    $("h_settings").textContent = t.h_settings;
    $("lbl_format").textContent = t.lbl_format;
    $("lbl_quality").textContent = t.lbl_quality;

    $("q_095").textContent = t.q_095;
    $("q_090").textContent = t.q_090;
    $("q_080").textContent = t.q_080;
    $("q_070").textContent = t.q_070;

    $("lbl_w").textContent = t.lbl_w;
    $("lbl_h").textContent = t.lbl_h;
    inW.placeholder = t.ph_w;
    inH.placeholder = t.ph_h;
    $("size_hint").textContent = t.size_hint;

    $("h_download").textContent = t.h_download;
    btnConvert.textContent = t.convert;
    btnReset.textContent = t.reset;

    $("privacy_summary").textContent = t.privacy_summary;
    $("privacy_body").innerHTML = t.privacy_body;
    $("pdfzip_summary").textContent = t.pdfzip_summary;
    $("pdfzip_body").innerHTML = t.pdfzip_body;

    $("zip_label").textContent = t.zip_label;
    $("a4_label").textContent = t.a4_label;
    $("multi_note").textContent = t.multi_note;

    if(files.length === 0){
      meta.textContent = t.meta_idle;
      thumb.innerHTML = `<span style="color:#90a3c1; font-size:12px;">${t.thumb_label}</span>`;
    }

    if(multiCount) multiCount.textContent = t.multi_count(files.length);

    syncLangSelect();
    buildTools();
  }

  function setLang(lang){
    if(!STR[lang]) lang = "en";
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);

    try{
      const u = new URL(location.href);
      u.searchParams.set("lang", LANG);
      history.replaceState({}, "", u.toString());
    }catch(e){}

    renderTexts();
    updateQualityState();
    renderFileList();
    updateCropState();
    updateZipAvailability();
  }

  langSelectEl.addEventListener("change", ()=> setLang(langSelectEl.value));

  function renderFileList(){
    if(files.length <= 1){
      multiPanel.style.display = "none";
    } else {
      multiPanel.style.display = "block";
    }

    const t = STR[LANG] || STR.en;
    multiCount.textContent = t.multi_count(files.length);

    fileListEl.innerHTML = "";
    files.forEach((item, idx) => {
      const row = document.createElement("div");
      row.className = "fileRow";

      const name = document.createElement("div");
      name.className = "fileName";
      name.title = item.file.name;
      name.textContent = item.file.name;

      const mini = document.createElement("div");
      mini.className = "mini";

      const up = document.createElement("button");
      up.className = "iconBtn";
      up.type = "button";
      up.textContent = "â–²";
      up.disabled = idx === 0;
      up.addEventListener("click", (e)=>{ e.stopPropagation(); move(idx, idx-1); });

      const down = document.createElement("button");
      down.className = "iconBtn";
      down.type = "button";
      down.textContent = "â–¼";
      down.disabled = idx === files.length-1;
      down.addEventListener("click", (e)=>{ e.stopPropagation(); move(idx, idx+1); });

      const del = document.createElement("button");
      del.className = "iconBtn";
      del.type = "button";
      del.textContent = "ğŸ—‘ï¸";
      del.addEventListener("click", (e)=>{ e.stopPropagation(); removeAt(idx); });

      mini.appendChild(up);
      mini.appendChild(down);
      mini.appendChild(del);

      row.appendChild(name);
      row.appendChild(mini);

      row.addEventListener("click", ()=>{
        activeIndex = idx;
        previewActive();
      });

      fileListEl.appendChild(row);
    });
  }

  function move(from, to){
    if(to < 0 || to >= files.length) return;
    const t = files[from];
    files.splice(from,1);
    files.splice(to,0,t);
    if(activeIndex === from) activeIndex = to;
    renderFileList();
    previewActive();
    updateZipAvailability();
  }

  function removeAt(idx){
    files.splice(idx,1);
    if(activeIndex >= files.length) activeIndex = Math.max(0, files.length-1);
    renderFileList();
    if(files.length === 0){
      resetAll();
      return;
    }
    previewActive();
    updateZipAvailability();
  }

  function updateCropState(){
    addMoreBtn.disabled = (files.length === 0);
    if(files.length === 1 && files[0] && isImage(files[0].file)){
      cropBtn.disabled = false;
      return;
    }
    cropBtn.disabled = true;
  }

  async function previewActive(){
    const t = STR[LANG] || STR.en;

    if(files.length === 0){
      renderTexts();
      btnConvert.disabled = true;
      btnReset.disabled = true;
      updateCropState();
      updateZipAvailability();
      return;
    }

    const f = files[activeIndex]?.file;
    if(!f) return;

    btnConvert.disabled = false;
    btnReset.disabled = false;

    if(isImage(f)){
      const ext = extLower(f.name);
      if(ext === "heic" || ext === "heif"){
        setMessage(t.err_heic, "err");
      }else{
        setMessage(t.msg_loading, "");
      }

      const url = URL.createObjectURL(f);
      const img = new Image();
      img.onload = () => {
        URL.revokeObjectURL(url);
        thumb.innerHTML = "";
        thumb.appendChild(img);

        const w = img.naturalWidth || 0;
        const h = img.naturalHeight || 0;

        meta.innerHTML = t.meta_img(
          escapeHtml(f.name),
          escapeHtml((f.type || "image/*")),
          humanSize(f.size),
          w, h
        );

        if(!(ext === "heic" || ext === "heif")) setMessage(t.msg_ready, "ok");
        updateCropState();
        updateZipAvailability();
      };
      img.onerror = () => {
        URL.revokeObjectURL(url);
        thumb.innerHTML = "";
        meta.textContent = t.err_preview;
        setMessage(t.err_preview, "err");
        updateCropState();
        updateZipAvailability();
      };
      img.src = url;
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.objectFit = "cover";
      return;
    }

    if(isPDF(f)){
      thumb.innerHTML = `<div style="font-weight:900; font-size:22px; color:#cfe0ff;">PDF</div>`;
      meta.innerHTML = t.meta_pdf(escapeHtml(f.name), humanSize(f.size));
      setMessage(t.msg_ready, "ok");
      updateCropState();
      updateZipAvailability();
      return;
    }

    meta.textContent = t.err_only_supported;
    setMessage(t.err_only_supported, "err");
    btnConvert.disabled = true;
    updateCropState();
    updateZipAvailability();
  }

  function appendFiles(selected){
    const t = STR[LANG] || STR.en;
    if(!selected || selected.length === 0) return;

    const arr = Array.from(selected);
    const ok = arr.filter(f => isImage(f) || isPDF(f));
    if(ok.length === 0){
      setMessage(t.err_only_supported, "err");
      return;
    }

    const base = files.slice();
    ok.forEach((file, i)=>{
      base.push({ file, id: `${Date.now()}_${Math.random().toString(16).slice(2)}_${i}` });
    });
    files = base;

    drop.classList.add("active");
    btnReset.disabled = false;
    btnConvert.disabled = (files.length === 0);

    renderFileList();
    renderTexts();
    previewActive();
    updateQualityState();
    updateCropState();
    updateZipAvailability();
  }

  async function handleFiles(selected){
    const t = STR[LANG] || STR.en;
    if(!selected || selected.length === 0) return;

    files = [];
    activeIndex = 0;

    appendFiles(selected);

    const mime = selFormat.value;

    if(mime === "image/png"){
      setMessage(t.msg_png_q, "");
    } else if(mime === "application/pdf"){
      if(files.some(x=>isPDF(x.file))) setMessage(t.msg_pdf_merge, "");
      else setMessage(t.msg_pdf_one, "");
    } else {
      setMessage(t.msg_ready, "ok");
    }

    updateZipAvailability();
  }

  function openFilePicker(){
    try{
      fileInput.value = "";
      fileInput.focus();
      fileInput.click();
    }catch(e){
      const tmp = document.createElement("input");
      tmp.type = "file";
      tmp.accept = "image/*,application/pdf";
      tmp.multiple = true;
      tmp.style.position = "fixed";
      tmp.style.left = "-9999px";
      document.body.appendChild(tmp);
      tmp.addEventListener("change", (ev)=>{
        handleFiles(ev.target.files);
        document.body.removeChild(tmp);
      }, { once:true });
      tmp.click();
    }
  }

  function openFilePickerAppend(){
    const tmp = document.createElement("input");
    tmp.type = "file";
    tmp.accept = "image/*,application/pdf";
    tmp.multiple = true;
    tmp.style.position = "fixed";
    tmp.style.left = "-9999px";
    document.body.appendChild(tmp);
    tmp.addEventListener("change", (ev)=>{
      appendFiles(ev.target.files);
      document.body.removeChild(tmp);
    }, { once:true });
    tmp.click();
  }

  addMoreBtn.addEventListener("click", openFilePickerAppend);

  drop.addEventListener("click", openFilePicker);
  drop.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      openFilePicker();
    }
  });

  fileInput.addEventListener("change", (e)=> handleFiles(e.target.files));

  ["dragenter","dragover"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      drop.classList.add("drag");
    });
  });
  ["dragleave","drop"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      drop.classList.remove("drag");
    });
  });
  drop.addEventListener("drop", (e) => {
    const fs = e.dataTransfer.files;
    handleFiles(fs);
  });

  function updateQualityState(){
    const mime = selFormat.value;
    const disableQuality = (mime === "image/png" || mime === "application/pdf");
    selQuality.disabled = disableQuality;
    selQuality.style.opacity = disableQuality ? ".6" : "1";
  }

  // ZIP logic (same as your stable version)
  function updateZipAvailability(){
    const outMime = selFormat.value;
    const images = files.filter(x => isImage(x.file));
    const pdfs   = files.filter(x => isPDF(x.file));

    zipModeEl.disabled = false;

    const shouldAutoZip = (outMime !== "application/pdf" && images.length >= 2);
    if(shouldAutoZip && zipModeEl.checked === false){
      zipModeEl.checked = true;
    }

    if(outMime === "application/pdf" && zipModeEl.checked){
      a4ModeEl.checked = false;
      a4ModeEl.disabled = true;
      if(a4ChkLabel){
        a4ChkLabel.style.opacity = ".55";
        a4ChkLabel.style.cursor = "not-allowed";
      }
    } else {
      a4ModeEl.disabled = false;
      if(a4ChkLabel){
        a4ChkLabel.style.opacity = "1";
        a4ChkLabel.style.cursor = "pointer";
      }
    }

    if(zipChkLabel){
      zipChkLabel.style.opacity = "1";
      zipChkLabel.style.cursor = "pointer";
    }

    void pdfs;
  }

  selFormat.addEventListener("change", ()=>{
    updateQualityState();
    updateZipAvailability();

    const t = STR[LANG] || STR.en;
    const mime = selFormat.value;

    if(mime === "image/png"){
      setMessage(t.msg_png_q, "");
    } else if(mime === "application/pdf"){
      if(files.some(x=>isPDF(x.file))) setMessage(t.msg_pdf_merge, "");
      else setMessage(t.msg_pdf_one, "");
    } else if(files.length){
      setMessage(t.msg_ready, "ok");
    } else {
      setMessage("", "");
    }
  });

  zipModeEl.addEventListener("change", updateZipAvailability);

  function getTargetSize(origW, origH){
    const w = parseInt(inW.value, 10);
    const h = parseInt(inH.value, 10);
    if(!w && !h) return { w: origW, h: origH };
    if(w && !h) return { w, h: Math.round(w * (origH / origW)) };
    if(!w && h) return { w: Math.round(h * (origW / origH)), h };
    return { w, h };
  }

  async function imageToCanvasBlob(file, outMime, quality){
    const url = URL.createObjectURL(file);
    const img = new Image();

    await new Promise((resolve, reject)=>{
      img.onload = () => resolve(true);
      img.onerror = () => reject(new Error("image load fail"));
      img.src = url;
    });

    URL.revokeObjectURL(url);

    const origW = img.naturalWidth || 0;
    const origH = img.naturalHeight || 0;
    const { w, h } = getTargetSize(origW, origH);

    const canvas = document.createElement("canvas");
    canvas.width = Math.max(1, w);
    canvas.height = Math.max(1, h);

    const ctx = canvas.getContext("2d", { alpha:true });
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const blob = await new Promise((resolve)=>{
      if(outMime === "image/png"){
        canvas.toBlob(resolve, outMime);
      } else {
        canvas.toBlob(resolve, outMime, quality);
      }
    });

    if(!blob) throw new Error("toBlob failed");
    return { blob, canvas, w: canvas.width, h: canvas.height };
  }

  async function imagesToSinglePDF(imageItems){
    const t = STR[LANG] || STR.en;
    if(!window.PDFLib) throw new Error(t.err_pdf_lib);

    const { PDFDocument } = window.PDFLib;
    const pdfDoc = await PDFDocument.create();

    for(const it of imageItems){
      const { canvas, w, h } = await imageToCanvasBlob(it.file, "image/png", 1);
      const pngBlob = await new Promise((resolve)=> canvas.toBlob(resolve, "image/png"));
      if(!pngBlob) throw new Error(t.err_convert);

      const pngBytes = new Uint8Array(await pngBlob.arrayBuffer());
      const imgEmbed = await pdfDoc.embedPng(pngBytes);

      const page = pdfDoc.addPage([w, h]);
      page.drawImage(imgEmbed, { x:0, y:0, width:w, height:h });
    }

    const bytes = await pdfDoc.save();
    return new Blob([bytes], { type:"application/pdf" });
  }

  async function mergePDFs(pdfItems, normalizeA4){
    const t = STR[LANG] || STR.en;
    if(!window.PDFLib) throw new Error(t.err_pdf_lib);

    const { PDFDocument, PageSizes } = window.PDFLib;
    const outDoc = await PDFDocument.create();
    const [a4w, a4h] = PageSizes.A4;

    for(const it of pdfItems){
      const f = it.file;
      try{
        const buf = await f.arrayBuffer();
        const srcDoc = await PDFDocument.load(buf, { ignoreEncryption: false });

        if(normalizeA4){
          const srcPages = srcDoc.getPages();
          for(let i=0;i<srcPages.length;i++){
            const embedded = await outDoc.embedPage(srcPages[i]);
            const w = embedded.width;
            const h = embedded.height;
            const scale = Math.min(a4w / w, a4h / h);
            const drawW = w * scale;
            const drawH = h * scale;
            const x = (a4w - drawW) / 2;
            const y = (a4h - drawH) / 2;

            const page = outDoc.addPage([a4w, a4h]);
            page.drawPage(embedded, { x, y, width: drawW, height: drawH });
          }
        }else{
          const copied = await outDoc.copyPages(srcDoc, srcDoc.getPageIndices());
          copied.forEach(p => outDoc.addPage(p));
        }
      }catch(e){
        throw new Error(t.err_pdf_locked);
      }
    }

    const bytes = await outDoc.save();
    return new Blob([bytes], { type:"application/pdf" });
  }

  async function convertImagesToZIP(imageItems, outMime, quality){
    if(!window.JSZip) throw new Error("ZIP library is not ready.");
    const zip = new window.JSZip();

    for(const it of imageItems){
      const f = it.file;
      const { blob } = await imageToCanvasBlob(f, outMime, quality);

      const ext = mimeToExt(outMime);
      const base = (f.name || "image").replace(/\.[^.]+$/, "");
      const stamp = new Date().toISOString().replace(/[:.]/g,"-");
      zip.file(`${base}_${stamp}.${ext}`, blob);
    }

    return await zip.generateAsync({ type:"blob" });
  }

  async function zipOriginalPDFs(pdfItems){
    if(!window.JSZip) throw new Error("ZIP library is not ready.");
    const zip = new window.JSZip();

    for(const it of pdfItems){
      const f = it.file;
      const buf = await f.arrayBuffer();
      zip.file(f.name || buildName("file","pdf"), buf);
    }

    return await zip.generateAsync({ type:"blob" });
  }

  async function onConvert(){
    const t = STR[LANG] || STR.en;
    if(files.length === 0){
      setMessage(t.err_only_supported, "err");
      return;
    }

    btnConvert.disabled = true;
    setMessage(t.msg_loading, "");

    const outMime = selFormat.value;
    const quality = parseFloat(selQuality.value);

    const images = files.filter(x => isImage(x.file));
    const pdfs   = files.filter(x => isPDF(x.file));

    try{
      if(outMime === "application/pdf"){
        if(pdfs.length >= 1){
          if(pdfs.length >= 2 && zipModeEl.checked){
            const zipBlob = await zipOriginalPDFs(pdfs);
            const name = buildName("pdf_files", "zip");
            downloadBlob(zipBlob, name);
            setMessage(t.dl_start(name, humanSize(zipBlob.size)), "ok");
            btnConvert.disabled = false;
            return;
          }

          const merged = await mergePDFs(pdfs, !!a4ModeEl.checked);
          const name = buildName("merged_pdf", "pdf");
          downloadBlob(merged, name);
          setMessage(t.dl_start(name, humanSize(merged.size)), "ok");
          btnConvert.disabled = false;
          return;
        }

        if(images.length >= 1){
          const pdfBlob = await imagesToSinglePDF(images);
          const name = buildName(images.length >= 2 ? "images_to_pdf" : "image_to_pdf", "pdf");
          downloadBlob(pdfBlob, name);
          setMessage(t.dl_start(name, humanSize(pdfBlob.size)), "ok");
          btnConvert.disabled = false;
          return;
        }

        throw new Error(t.err_only_supported);
      }

      if(images.length === 0){
        throw new Error(t.err_only_supported);
      }

      if(images.length >= 2 && zipModeEl.checked){
        const zipBlob = await convertImagesToZIP(images, outMime, quality);
        const name = buildName("converted_images", "zip");
        downloadBlob(zipBlob, name);
        setMessage(t.dl_start(name, humanSize(zipBlob.size)), "ok");
        btnConvert.disabled = false;
        return;
      }

      const first = images[0].file;
      const { blob } = await imageToCanvasBlob(first, outMime, quality);
      const name = buildName(first.name, mimeToExt(outMime));
      downloadBlob(blob, name);
      setMessage(t.dl_start(name, humanSize(blob.size)), "ok");
      btnConvert.disabled = false;

    }catch(e){
      const errText = (e && e.message) ? e.message : (STR[LANG]||STR.en).err_convert;
      setMessage(errText, "err");
      btnConvert.disabled = false;
    }
  }

  function resetAll(){
    files = [];
    activeIndex = 0;

    fileInput.value = "";
    drop.classList.remove("active");

    btnConvert.disabled = true;
    btnReset.disabled = true;

    inW.value = "";
    inH.value = "";

    zipModeEl.checked = false;
    a4ModeEl.checked = false;

    setMessage("", "");

    renderTexts();
    renderFileList();
    updateCropState();
    updateZipAvailability();
  }

  btnConvert.addEventListener("click", onConvert);
  btnReset.addEventListener("click", resetAll);

  // High-res handoff to /edit via IndexedDB (same as your stable version)
  const CF24_IDB_NAME = "cf24_blob_store_v1";
  const CF24_IDB_STORE = "blobs";

  function idbOpen(){
    return new Promise((resolve, reject)=>{
      if(!("indexedDB" in window)) return reject(new Error("IndexedDB not supported"));
      const req = indexedDB.open(CF24_IDB_NAME, 1);
      req.onupgradeneeded = () => {
        const db = req.result;
        if(!db.objectStoreNames.contains(CF24_IDB_STORE)){
          db.createObjectStore(CF24_IDB_STORE);
        }
      };
      req.onsuccess = () => resolve(req.result);
      req.onerror = () => reject(req.error || new Error("IDB open fail"));
    });
  }

  async function idbPut(key, blob){
    const db = await idbOpen();
    return new Promise((resolve, reject)=>{
      const tx = db.transaction(CF24_IDB_STORE, "readwrite");
      const store = tx.objectStore(CF24_IDB_STORE);
      store.put(blob, key);
      tx.oncomplete = () => { try{ db.close(); }catch(e){} resolve(true); };
      tx.onerror = () => { try{ db.close(); }catch(e){} reject(tx.error || new Error("IDB put fail")); };
      tx.onabort = () => { try{ db.close(); }catch(e){} reject(tx.error || new Error("IDB put abort")); };
    });
  }

  cropBtn.addEventListener("click", async ()=>{
    if(files.length !== 1) return;
    const f = files[0]?.file;
    if(!f || !isImage(f)) return;

    const key = `cf24_blob_${Date.now()}_${Math.random().toString(16).slice(2)}`;

    try{
      await idbPut(key, f);

      sessionStorage.setItem("cf24_edit_source", "idb");
      sessionStorage.setItem("cf24_edit_key", key);
      sessionStorage.setItem("cf24_edit_name", f.name || "image");

      sessionStorage.setItem("cf24_idphoto_source", "idb");
      sessionStorage.setItem("cf24_idphoto_key", key);
      sessionStorage.setItem("cf24_idphoto_name", f.name || "image");

      location.href = withLang("/edit/");
      return;

    }catch(e){
      try{
        const dataUrl = await new Promise((resolve, reject)=>{
          const r = new FileReader();
          r.onload = ()=> resolve(r.result);
          r.onerror = ()=> reject(new Error("read fail"));
          r.readAsDataURL(f);
        });

        sessionStorage.setItem("cf24_edit_img", String(dataUrl));
        sessionStorage.setItem("cf24_edit_name", f.name || "image");
        sessionStorage.setItem("cf24_idphoto_img", String(dataUrl));
        sessionStorage.setItem("cf24_idphoto_name", f.name || "image");

        location.href = withLang("/edit/");
      }catch(err){
        location.href = withLang("/edit/");
      }
    }
  });

  // Init
  setLang(LANG);
  resetAll();
})();
</script>
</body>
</html>