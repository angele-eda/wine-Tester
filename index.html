<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ConvertFiles24 - ì´ë¯¸ì§€ ë³€í™˜</title>
  <meta name="description" content="ì´ë¯¸ì§€ ì—…ë¡œë“œ í›„ JPG/PNG/WebPë¡œ ë³€í™˜í•˜ê³  ë°”ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”." />
  <style>
    :root { --radius:16px; --pad:16px; --border:1px solid rgba(255,255,255,.12); }
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif;
      background:#0b0f17; color:#e9eef7;
    }
    .wrap{ max-width:980px; margin:0 auto; padding:22px 14px 44px; }
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom:14px;
    }
    h1{ margin:0; font-size:20px; letter-spacing:-.2px; }
    .sub{ margin:6px 0 0; color:#a7b3c7; font-size:13px; line-height:1.45; }
    .badge{
      font-size:12px; color:#b8c6dc; border:var(--border); padding:8px 10px; border-radius:999px;
      background:rgba(255,255,255,.04);
      display:inline-flex; align-items:center; gap:6px;
    }
    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:12px; }
    @media (max-width: 860px){ .grid{ grid-template-columns:1fr; } }
    .card{
      border:var(--border); background:rgba(255,255,255,.03); border-radius:var(--radius);
      padding:var(--pad);
    }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; }
    .drop{
      border:1px dashed rgba(255,255,255,.18); border-radius:14px; padding:18px;
      display:flex; align-items:center; justify-content:center; text-align:center;
      background:rgba(255,255,255,.02);
    }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); }
    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:700;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:15px;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.secondary{ background:rgba(255,255,255,.10); color:#e9eef7; border:var(--border); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex:1; min-width:160px; }
    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; }
    input[type="file"]{ display:none; }
    select, input[type="number"], input[type="text"]{
      width:100%; box-sizing:border-box; padding:12px 12px; border-radius:14px;
      background:rgba(255,255,255,.06); color:#e9eef7; border:var(--border);
      outline:none;
    }
    .preview{
      display:grid; grid-template-columns: 140px 1fr; gap:12px; align-items:center;
    }
    .thumb{
      width:140px; height:140px; border-radius:14px; border:var(--border);
      background:rgba(255,255,255,.03); display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .meta{ color:#b7c3d9; font-size:13px; line-height:1.5; }
    .meta b{ color:#e9eef7; }
    .hint{ margin-top:10px; color:#9fb0ca; font-size:12px; line-height:1.5; }
    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .err{ color:#ffb4b4; }
    .ok{ color:#b8ffcc; }
    .footer{ margin-top:14px; color:#94a6c2; font-size:12px; text-align:center; }
    a{ color:#8fb8ff; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* language buttons */
    .lang-switch { display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; }
    .lang-btn{
      cursor:pointer;
      user-select:none;
      border:var(--border);
      background:rgba(255,255,255,.04);
      color:#b8c6dc;
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
    }
    .lang-btn.active{
      background:rgba(47,109,246,.25);
      border-color:rgba(47,109,246,.55);
      color:#dbe7ff;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 data-i18n="title">ConvertFiles24</h1>
        <p class="sub">
          <span data-i18n="subtitle">
            ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•œ ë’¤ <b>JPG / PNG / WebP</b>ë¡œ ë³€í™˜í•˜ê³  ë°”ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”. (ì„œë²„ ì—…ë¡œë“œ ì—†ì´ ë‚´ ë¸Œë¼ìš°ì €ì—ì„œ ì²˜ë¦¬)
          </span>
        </p>
      </div>

      <div style="display:flex; gap:8px; align-items:flex-start; flex-wrap:wrap; justify-content:flex-end;">
        <div class="lang-switch" aria-label="Language switch">
          <button class="lang-btn" type="button" data-lang="en">EN</button>
          <button class="lang-btn" type="button" data-lang="ja">æ—¥æœ¬èª</button>
          <button class="lang-btn" type="button" data-lang="ko">KO</button>
        </div>
        <div class="badge" id="domainBadge" data-i18n="badge_domain">ë„ë©”ì¸ ì—°ê²° ì¤‘â€¦</div>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Upload & Preview -->
      <div class="card">
        <h2 data-i18n="step1">1) ì—…ë¡œë“œ</h2>

        <div class="drop" id="drop">
          <div>
            <div style="font-weight:700; margin-bottom:8px;" data-i18n="drop_text">ì—¬ê¸°ì— íŒŒì¼ì„ ëŒì–´ë†“ê±°ë‚˜</div>

            <label for="file" style="display:inline-block; cursor:pointer;">
              <span class="btn secondary" style="display:inline-block; width:auto; padding:10px 14px;" data-i18n="btn_select">íŒŒì¼ ì„ íƒ</span>
            </label>

            <input id="file" type="file" accept="image/*" />

            <div class="hint" data-i18n="support">ì§€ì›: JPG, PNG, WebP ë“± ì´ë¯¸ì§€ / ëª¨ë°”ì¼ì—ì„œë„ ì„ íƒ ê°€ëŠ¥</div>
          </div>
        </div>

        <div style="height:12px;"></div>

        <h2 data-i18n="step2">2) ë¯¸ë¦¬ë³´ê¸°</h2>
        <div class="preview">
          <div class="thumb" id="thumb"><span style="color:#90a3c1; font-size:12px;" data-i18n="thumb">ë¯¸ë¦¬ë³´ê¸°</span></div>
          <div class="meta" id="meta" data-i18n="meta_placeholder">
            íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
          </div>
        </div>

        <div class="msg" id="msg"></div>
      </div>

      <!-- Right: Settings -->
      <div class="card">
        <h2 data-i18n="step3">3) ë³€í™˜ ì„¤ì •</h2>

        <div class="row">
          <div>
            <label data-i18n="label_format">ì¶œë ¥ í˜•ì‹</label>
            <select id="format">
              <option value="image/jpeg">JPG</option>
              <option value="image/png">PNG</option>
              <option value="image/webp">WebP</option>
            </select>
          </div>
          <div>
            <label data-i18n="label_quality">í’ˆì§ˆ (JPG/WebPë§Œ)</label>
            <select id="quality">
              <option value="0.95" data-i18n="q_best">ìµœê³ (0.95)</option>
              <option value="0.9" selected data-i18n="q_high">ë†’ìŒ(0.90)</option>
              <option value="0.8" data-i18n="q_mid">ë³´í†µ(0.80)</option>
              <option value="0.7" data-i18n="q_low">ì••ì¶•(0.70)</option>
            </select>
          </div>
        </div>

        <div style="height:10px;"></div>

        <div class="row">
          <div>
            <label data-i18n="label_w">ê°€ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)</label>
            <input id="w" type="number" min="1" placeholder="ì˜ˆ: 1200" />
          </div>
          <div>
            <label data-i18n="label_h">ì„¸ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)</label>
            <input id="h" type="number" min="1" placeholder="ì˜ˆ: 800" />
          </div>
        </div>

        <div class="hint" data-i18n="hint_ratio">ê°€ë¡œ/ì„¸ë¡œë¥¼ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ë¹„ìœ¨ ìœ ì§€ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>

        <div style="height:12px;"></div>

        <h2 data-i18n="step4">4) ë‹¤ìš´ë¡œë“œ</h2>
        <button class="btn" id="convert" disabled data-i18n="btn_convert">ë³€í™˜ & ë‹¤ìš´ë¡œë“œ</button>
        <div style="height:10px;"></div>
        <button class="btn secondary" id="reset" disabled data-i18n="btn_reset">ì´ˆê¸°í™”</button>

        <div class="hint">
          <span data-i18n="privacy_line1">ğŸ”’ ê°œì¸ì •ë³´: ì—…ë¡œë“œëœ íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span><br/>
          <span data-i18n="privacy_line2">âš ï¸ PDF ë³€í™˜ ë“± â€œì„œë²„ ì²˜ë¦¬â€ê°€ í•„ìš”í•œ ê¸°ëŠ¥ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”.</span>
        </div>
      </div>
    </div>

    <div class="footer">
      Â© <span id="year"></span> ConvertFiles24 Â· <span data-i18n="powered">Powered by GitHub Pages</span>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // ---------- i18n ----------
  const i18n = {
    en: {
      title: "ConvertFiles24",
      subtitle: "Upload an image and convert to <b>JPG / PNG / WebP</b>. Everything runs in your browser (no server upload).",
      badge_domain: "Connecting domainâ€¦",
      step1: "1) Upload",
      drop_text: "Drop a file here or",
      btn_select: "Select file",
      support: "Supported: JPG, PNG, WebP (mobile supported)",
      step2: "2) Preview",
      thumb: "Preview",
      meta_placeholder: "Select a file to see details.",
      step3: "3) Convert settings",
      label_format: "Output format",
      label_quality: "Quality (JPG/WebP only)",
      q_best: "Best (0.95)",
      q_high: "High (0.90)",
      q_mid: "Medium (0.80)",
      q_low: "Smaller (0.70)",
      label_w: "Width(px) (blank = original)",
      label_h: "Height(px) (blank = original)",
      hint_ratio: "If only one side is set, the other is calculated to keep aspect ratio.",
      step4: "4) Download",
      btn_convert: "Convert & Download",
      btn_reset: "Reset",
      privacy_line1: "ğŸ”’ Privacy: Your files are not uploaded to a server.",
      privacy_line2: "âš ï¸ PDF conversion and other server-side features can be added later.",
      powered: "Powered by GitHub Pages",

      // runtime messages
      msg_only_image: "Only image files are allowed.",
      msg_loading: "Loading imageâ€¦",
      msg_ready: "Ready! Click the button to download.",
      msg_process_fail: "Can't process this image. Try another file.",
      msg_preview_fail: "Failed to preview the image.",
      msg_upload_first: "Please upload an image first.",
      msg_converting: "Convertingâ€¦",
      msg_convert_fail: "Conversion failed. Try other settings.",
      msg_png_quality: "PNG is lossless, so quality setting doesn't apply.",
      msg_download_start: "Download started: "
    },
    ja: {
      title: "ConvertFiles24",
      subtitle: "ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ <b>JPG / PNG / WebP</b> ã«å¤‰æ›ã—ã€ã™ãã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—ï¼‰ã€‚",
      badge_domain: "ãƒ‰ãƒ¡ã‚¤ãƒ³æ¥ç¶šä¸­â€¦",
      step1: "1) ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      drop_text: "ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯",
      btn_select: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ",
      support: "å¯¾å¿œ: JPG / PNG / WebPï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰",
      step2: "2) ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
      thumb: "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
      meta_placeholder: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã¨æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",
      step3: "3) å¤‰æ›è¨­å®š",
      label_format: "å‡ºåŠ›å½¢å¼",
      label_quality: "ç”»è³ªï¼ˆJPG/WebPã®ã¿ï¼‰",
      q_best: "æœ€é«˜ (0.95)",
      q_high: "é«˜ (0.90)",
      q_mid: "æ¨™æº– (0.80)",
      q_low: "åœ§ç¸® (0.70)",
      label_w: "å¹…(px)ï¼ˆç©ºæ¬„ï¼å…ƒã‚µã‚¤ã‚ºï¼‰",
      label_h: "é«˜ã•(px)ï¼ˆç©ºæ¬„ï¼å…ƒã‚µã‚¤ã‚ºï¼‰",
      hint_ratio: "ç‰‡æ–¹ã ã‘å…¥åŠ›ã™ã‚‹ã¨ã€æ¯”ç‡ã‚’ä¿ã£ã¦è‡ªå‹•è¨ˆç®—ã—ã¾ã™ã€‚",
      step4: "4) ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
      btn_convert: "å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
      btn_reset: "ãƒªã‚»ãƒƒãƒˆ",
      privacy_line1: "ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚",
      privacy_line2: "âš ï¸ PDFå¤‰æ›ãªã©ã‚µãƒ¼ãƒãƒ¼å‡¦ç†ãŒå¿…è¦ãªæ©Ÿèƒ½ã¯å¾Œã§è¿½åŠ ã§ãã¾ã™ã€‚",
      powered: "GitHub Pagesã§æä¾›",

      // runtime messages
      msg_only_image: "ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚",
      msg_loading: "ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­â€¦",
      msg_ready: "æº–å‚™å®Œäº†ï¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚",
      msg_process_fail: "ã“ã®ç”»åƒã‚’å‡¦ç†ã§ãã¾ã›ã‚“ã€‚åˆ¥ã®ç”»åƒã§è©¦ã—ã¦ãã ã•ã„ã€‚",
      msg_preview_fail: "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",
      msg_upload_first: "å…ˆã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚",
      msg_converting: "å¤‰æ›ä¸­â€¦",
      msg_convert_fail: "å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ¥ã®è¨­å®šã§è©¦ã—ã¦ãã ã•ã„ã€‚",
      msg_png_quality: "PNGã¯ãƒ­ã‚¹ãƒ¬ã‚¹ã®ãŸã‚ã€ç”»è³ªè¨­å®šã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚",
      msg_download_start: "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹: "
    },
    ko: {
      title: "ConvertFiles24",
      subtitle: "ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•œ ë’¤ <b>JPG / PNG / WebP</b>ë¡œ ë³€í™˜í•˜ê³  ë°”ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”. (ì„œë²„ ì—…ë¡œë“œ ì—†ì´ ë‚´ ë¸Œë¼ìš°ì €ì—ì„œ ì²˜ë¦¬)",
      badge_domain: "ë„ë©”ì¸ ì—°ê²° ì¤‘â€¦",
      step1: "1) ì—…ë¡œë“œ",
      drop_text: "ì—¬ê¸°ì— íŒŒì¼ì„ ëŒì–´ë†“ê±°ë‚˜",
      btn_select: "íŒŒì¼ ì„ íƒ",
      support: "ì§€ì›: JPG, PNG, WebP ë“± ì´ë¯¸ì§€ / ëª¨ë°”ì¼ì—ì„œë„ ì„ íƒ ê°€ëŠ¥",
      step2: "2) ë¯¸ë¦¬ë³´ê¸°",
      thumb: "ë¯¸ë¦¬ë³´ê¸°",
      meta_placeholder: "íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.",
      step3: "3) ë³€í™˜ ì„¤ì •",
      label_format: "ì¶œë ¥ í˜•ì‹",
      label_quality: "í’ˆì§ˆ (JPG/WebPë§Œ)",
      q_best: "ìµœê³ (0.95)",
      q_high: "ë†’ìŒ(0.90)",
      q_mid: "ë³´í†µ(0.80)",
      q_low: "ì••ì¶•(0.70)",
      label_w: "ê°€ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)",
      label_h: "ì„¸ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)",
      hint_ratio: "ê°€ë¡œ/ì„¸ë¡œë¥¼ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ë¹„ìœ¨ ìœ ì§€ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.",
      step4: "4) ë‹¤ìš´ë¡œë“œ",
      btn_convert: "ë³€í™˜ & ë‹¤ìš´ë¡œë“œ",
      btn_reset: "ì´ˆê¸°í™”",
      privacy_line1: "ğŸ”’ ê°œì¸ì •ë³´: ì—…ë¡œë“œëœ íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
      privacy_line2: "âš ï¸ PDF ë³€í™˜ ë“± â€œì„œë²„ ì²˜ë¦¬â€ê°€ í•„ìš”í•œ ê¸°ëŠ¥ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”.",
      powered: "Powered by GitHub Pages",

      // runtime messages
      msg_only_image: "ì´ë¯¸ì§€ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
      msg_loading: "ì´ë¯¸ì§€ ë¡œë”© ì¤‘â€¦",
      msg_ready: "ì¤€ë¹„ ì™„ë£Œ! ë³€í™˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.",
      msg_process_fail: "ì´ë¯¸ì§€ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ì–´ìš”. ë‹¤ë¥¸ ì´ë¯¸ì§€ë¡œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      msg_preview_fail: "ë¯¸ë¦¬ë³´ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”.",
      msg_upload_first: "ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.",
      msg_converting: "ë³€í™˜ ì¤‘â€¦",
      msg_convert_fail: "ë³€í™˜ ì‹¤íŒ¨. ë‹¤ë¥¸ ì˜µì…˜ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
      msg_png_quality: "PNGëŠ” ë¬´ì†ì‹¤ì´ë¼ í’ˆì§ˆ ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•Šì•„ìš”.",
      msg_download_start: "ë‹¤ìš´ë¡œë“œ ì‹œì‘: "
    }
  };

  let currentLang = "ko";
  const t = (key) => (i18n[currentLang] && i18n[currentLang][key]) ? i18n[currentLang][key] : (i18n.en[key] || "");

  function setActiveLangButton(lang){
    document.querySelectorAll(".lang-btn[data-lang]").forEach(btn => {
      btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
    });
  }

  function applyLang(lang){
    currentLang = (i18n[lang] ? lang : "en");
    document.documentElement.lang = currentLang;

    // translate UI
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      const val = t(key);
      // allow <b> in subtitle
      el.innerHTML = val;
    });

    setActiveLangButton(currentLang);

    // update <title> / meta description (SEO)
    const titles = {
      en: "ConvertFiles24 - Image Converter",
      ja: "ConvertFiles24 - ç”»åƒå¤‰æ›",
      ko: "ConvertFiles24 - ì´ë¯¸ì§€ ë³€í™˜"
    };
    const descs = {
      en: "Upload images and convert to JPG/PNG/WebP. Runs in your browser.",
      ja: "ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ JPG/PNG/WebP ã«å¤‰æ›ã—ã€ã™ãã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚",
      ko: "ì´ë¯¸ì§€ ì—…ë¡œë“œ í›„ JPG/PNG/WebPë¡œ ë³€í™˜í•˜ê³  ë°”ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”."
    };
    document.title = titles[currentLang] || titles.en;
    const metaDesc = document.querySelector('meta[name="description"]');
    if(metaDesc) metaDesc.setAttribute("content", descs[currentLang] || descs.en);

    // remember
    localStorage.setItem("lang", currentLang);

    // refresh placeholder texts for inputs (optional)
    const w = document.getElementById("w");
    const h = document.getElementById("h");
    if (w && !w.value) w.placeholder = (currentLang === "ja" ? "ä¾‹: 1200" : currentLang === "en" ? "e.g. 1200" : "ì˜ˆ: 1200");
    if (h && !h.value) h.placeholder = (currentLang === "ja" ? "ä¾‹: 800" : currentLang === "en" ? "e.g. 800" : "ì˜ˆ: 800");
  }

  function detectLang(){
    const saved = localStorage.getItem("lang");
    if(saved && i18n[saved]) return saved;

    const browser = (navigator.language || "en").toLowerCase();
    if(browser.startsWith("ja")) return "ja";
    if(browser.startsWith("ko")) return "ko";
    return "en";
  }

  // language button click
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".lang-btn[data-lang]");
    if(!btn) return;
    applyLang(btn.getAttribute("data-lang"));
  });

  // ---------- original app logic ----------
  const fileInput = $("file");
  const drop = $("drop");
  const thumb = $("thumb");
  const meta = $("meta");
  const msg = $("msg");
  const btnConvert = $("convert");
  const btnReset = $("reset");
  const selFormat = $("format");
  const selQuality = $("quality");
  const inW = $("w");
  const inH = $("h");
  const domainBadge = $("domainBadge");

  $("year").textContent = new Date().getFullYear();

  // Domain badge
  try {
    const host = location.host || "";
    domainBadge.textContent = host ? ("ì ‘ì†: " + host) : "ë„ë©”ì¸ í™•ì¸ ë¶ˆê°€";
  } catch (e) {}

  let currentFile = null;
  let imageBitmap = null;
  let originalInfo = { w: 0, h: 0 };

  function humanSize(bytes){
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return `${v.toFixed(i===0?0:1)} ${units[i]}`;
  }

  function setMessage(text, type){
    msg.textContent = text || "";
    msg.className = "msg " + (type || "");
  }

  function resetAll(){
    currentFile = null;
    imageBitmap = null;
    originalInfo = { w: 0, h: 0 };
    fileInput.value = "";
    thumb.innerHTML = `<span style="color:#90a3c1; font-size:12px;" data-i18n="thumb">${t("thumb") || "ë¯¸ë¦¬ë³´ê¸°"}</span>`;
    meta.innerHTML = t("meta_placeholder") || "íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
    btnConvert.disabled = true;
    btnReset.disabled = true;
    inW.value = "";
    inH.value = "";
    setMessage("");
  }

  async function loadFile(file){
    if(!file) return;
    if(!file.type.startsWith("image/")){
      setMessage(t("msg_only_image"), "err");
      return;
    }

    currentFile = file;
    btnReset.disabled = false;
    setMessage(t("msg_loading"), "");

    // preview image
    const url = URL.createObjectURL(file);
    const img = new Image();
    img.onload = async () => {
      URL.revokeObjectURL(url);

      originalInfo.w = img.naturalWidth;
      originalInfo.h = img.naturalHeight;

      thumb.innerHTML = "";
      thumb.appendChild(img);

      // localize meta labels
      const L = {
        ko: { name:"íŒŒì¼ëª…", type:"í˜•ì‹", size:"í¬ê¸°", res:"í•´ìƒë„" },
        en: { name:"Name",   type:"Type", size:"Size", res:"Resolution" },
        ja: { name:"ãƒ•ã‚¡ã‚¤ãƒ«å", type:"å½¢å¼", size:"ã‚µã‚¤ã‚º", res:"è§£åƒåº¦" }
      }[currentLang] || { name:"Name", type:"Type", size:"Size", res:"Resolution" };

      meta.innerHTML =
        `${L.name}: <b>${escapeHtml(file.name)}</b><br/>` +
        `${L.type}: <b>${escapeHtml(file.type || "unknown")}</b><br/>` +
        `${L.size}: <b>${humanSize(file.size)}</b><br/>` +
        `${L.res}: <b>${originalInfo.w} Ã— ${originalInfo.h}</b>`;

      try{
        imageBitmap = await createImageBitmap(file);
        btnConvert.disabled = false;
        setMessage(t("msg_ready"), "ok");
      }catch(e){
        btnConvert.disabled = true;
        setMessage(t("msg_process_fail"), "err");
      }
    };
    img.onerror = () => {
      URL.revokeObjectURL(url);
      setMessage(t("msg_preview_fail"), "err");
    };
    img.src = url;
    img.style.width = "100%";
    img.style.height = "100%";
    img.style.objectFit = "cover";
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function getTargetSize(){
    const w = parseInt(inW.value, 10);
    const h = parseInt(inH.value, 10);

    if(!w && !h) return { w: originalInfo.w, h: originalInfo.h };

    // keep aspect ratio if one missing
    if(w && !h){
      return { w, h: Math.round(w * (originalInfo.h / originalInfo.w)) };
    }
    if(!w && h){
      return { w: Math.round(h * (originalInfo.w / originalInfo.h)), h };
    }
    return { w, h };
  }

  function mimeToExt(mime){
    if(mime === "image/jpeg") return "jpg";
    if(mime === "image/png") return "png";
    if(mime === "image/webp") return "webp";
    return "bin";
  }

  function buildOutputName(){
    const base = (currentFile.name || "image").replace(/\.[^.]+$/, "");
    const ext = mimeToExt(selFormat.value);
    const { w, h } = getTargetSize();
    const tag = (w===originalInfo.w && h===originalInfo.h) ? "" : `_${w}x${h}`;
    return `${base}${tag}.${ext}`;
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  async function convertAndDownload(){
    if(!currentFile || !imageBitmap){
      setMessage(t("msg_upload_first"), "err");
      return;
    }

    btnConvert.disabled = true;
    setMessage(t("msg_converting"), "");

    const mime = selFormat.value;
    const quality = parseFloat(selQuality.value);
    const { w, h } = getTargetSize();

    // draw to canvas
    const canvas = document.createElement("canvas");
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext("2d", { alpha: true });
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
    ctx.drawImage(imageBitmap, 0, 0, w, h);

    // toBlob
    const blob = await new Promise((resolve) => {
      if(mime === "image/png"){
        canvas.toBlob(resolve, mime);
      }else{
        canvas.toBlob(resolve, mime, quality);
      }
    });

    if(!blob){
      setMessage(t("msg_convert_fail"), "err");
      btnConvert.disabled = false;
      return;
    }

    const outName = buildOutputName();
    downloadBlob(blob, outName);

    setMessage(`${t("msg_download_start")}${outName} (${humanSize(blob.size)})`, "ok");
    btnConvert.disabled = false;
  }

  // Drag & drop
  ["dragenter","dragover"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      drop.classList.add("drag");
    });
  });
  ["dragleave","drop"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      drop.classList.remove("drag");
    });
  });
  drop.addEventListener("drop", (e) => {
    const f = e.dataTransfer.files && e.dataTransfer.files[0];
    if(f) loadFile(f);
  });

  fileInput.addEventListener("change", (e) => {
    const f = e.target.files && e.target.files[0];
    if(f) loadFile(f);
  });

  btnConvert.addEventListener("click", convertAndDownload);
  btnReset.addEventListener("click", resetAll);

  // If PNG selected, quality is irrelevant but keep UI; just hint message
  selFormat.addEventListener("change", () => {
    if(selFormat.value === "image/png"){
      setMessage(t("msg_png_quality"), "");
    } else if(currentFile) {
      setMessage(t("msg_ready"), "ok");
    } else {
      setMessage("");
    }
  });

  // init order: set language first, then reset UI texts
  applyLang(detectLang());
  resetAll();
})();
</script>
</body>
</html>