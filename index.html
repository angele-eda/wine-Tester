<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>ConvertFiles24 â€“ Free Converter (JPG, PNG, WebP, PDF, ZIP)</title>
  <meta name="description" content="Convert images (JPG/PNG/WebP) and merge PDFs â€” processed locally in your browser. Optional ZIP download." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <!-- Canonical -->
  <link rel="canonical" href="https://convertfiles24.com/" />

  <!-- hreflang (OK: canonicalê³¼ ì¶©ëŒ ì•„ë‹˜) -->
  <link rel="alternate" hreflang="en" href="https://convertfiles24.com/" />
  <link rel="alternate" hreflang="ja" href="https://convertfiles24.com/?lang=ja" />
  <link rel="alternate" hreflang="ko" href="https://convertfiles24.com/?lang=ko" />
  <link rel="alternate" hreflang="es" href="https://convertfiles24.com/?lang=es" />
  <link rel="alternate" hreflang="x-default" href="https://convertfiles24.com/" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ConvertFiles24 - Converter" />
  <meta property="og:description" content="Convert images and merge PDFs locally. Optional ZIP download." />
  <meta property="og:url" content="https://convertfiles24.com/" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ConvertFiles24 - Converter" />
  <meta name="twitter:description" content="Convert images and merge PDFs locally. Optional ZIP download." />

  <!-- JSON-LD -->
  <script type="application/ld+json" id="jsonld">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"ConvertFiles24",
    "applicationCategory":"MultimediaApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "url":"https://convertfiles24.com/"
  }
  </script>

  <!-- Libraries (browser local) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    :root{
      --bg:#0b0f17;
      --fg:#e9eef7;
      --muted:#a7b3c7;
      --border:1px solid rgba(255,255,255,.12);
      --card:rgba(255,255,255,.03);
      --card2:rgba(255,255,255,.04);
      --radius:18px;
      --pad:16px;
      --blue:#2f6df6;
      --blue2:rgba(47,109,246,.22);
      --blue3:rgba(47,109,246,.55);
      --danger:#ffb4b4;
      --ok:#b8ffcc;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif;
      background:var(--bg);
      color:var(--fg);
      overflow-x:hidden; /* âœ… ì˜†ìœ¼ë¡œ ë²—ì–´ë‚¨ ë°©ì§€ */
    }

    .wrap{ max-width:980px; margin:0 auto; padding:22px 14px 44px; }
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .brand{ min-width:240px; }
    h1{ margin:0; font-size:22px; letter-spacing:-.2px; }
    .sub{ margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.55; }

    /* language buttons */
    .langbar{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:nowrap; /* âœ… PCì—ì„œ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      max-width:100%;
      overflow-x:auto; /* í˜¹ì‹œ ì¢ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
      -webkit-overflow-scrolling:touch;
      padding-bottom:2px;
    }
    .langbtn{
      white-space:nowrap;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      font-weight:800;
      color:#b8c6dc;
      border:var(--border);
      padding:9px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.04);
      cursor:pointer;
      user-select:none;
      flex:0 0 auto;
    }
    .langbtn .flag{ font-size:15px; line-height:1; }
    .langbtn.active{
      color:var(--fg);
      background:var(--blue2);
      border-color:var(--blue3);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      width:100%;
      max-width:100%;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      border:var(--border);
      background:var(--card);
      border-radius:var(--radius);
      padding:var(--pad);
      width:100%;
      max-width:100%;
      overflow:hidden; /* âœ… ë‚´ë¶€ ìš”ì†Œê°€ íŠ€ì–´ë‚˜ì˜¤ë©´ ì˜ë¼ì¤Œ */
    }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; }
    .divider{ height:1px; background:rgba(255,255,255,.08); margin:14px 0; }

    .drop{
      border:1px dashed rgba(255,255,255,.18);
      border-radius:14px;
      padding:18px;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      background:rgba(255,255,255,.02);
    }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      background:var(--blue);
      color:white;
      font-weight:800;
      padding:12px 14px;
      border-radius:14px;
      width:100%;
      font-size:15px;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.secondary{
      background:rgba(255,255,255,.10);
      color:var(--fg);
      border:var(--border);
    }
    .btn.small{
      width:auto;
      padding:10px 14px;
      font-size:14px;
      border-radius:12px;
    }

    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input[type="file"]{ display:none; }

    select, input[type="number"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:var(--fg);
      border:var(--border);
      outline:none;
      max-width:100%;
    }
    select{
      background-color:#0b0f17;
      border:1px solid rgba(255,255,255,.2);
    }
    option{ background-color:#0b0f17; color:var(--fg); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex:1; min-width:160px; }

    .hint{
      margin-top:10px;
      color:#9fb0ca;
      font-size:12px;
      line-height:1.55;
      word-break:keep-all;
    }
    .msg{
      margin-top:10px;
      font-size:13px;
      color:#cfe0ff;
      word-break:break-word;
    }
    .err{ color:var(--danger); }
    .ok{ color:var(--ok); }

    /* preview */
    .preview{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:12px;
      align-items:center;
      width:100%;
      max-width:100%;
    }
    @media (max-width: 480px){
      .preview{ grid-template-columns: 120px 1fr; }
    }
    .thumb{
      width:140px; height:140px;
      border-radius:14px;
      border:var(--border);
      background:rgba(255,255,255,.03);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    @media (max-width: 480px){
      .thumb{ width:120px; height:120px; }
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .meta{ color:#b7c3d9; font-size:13px; line-height:1.55; }
    .meta b{ color:var(--fg); }

    /* file list (order/delete) */
    .listTitle{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .miniInfo{ color:#93a6c2; font-size:12px; }
    .fileList{ margin-top:10px; display:flex; flex-direction:column; gap:10px; }
    .fileItem{
      border:var(--border);
      background:var(--card2);
      border-radius:16px;
      padding:10px;
      display:flex;
      gap:10px;
      align-items:center;
      width:100%;
      max-width:100%;
      overflow:hidden;
    }
    .fileItem .miniThumb{
      width:56px; height:56px;
      border-radius:12px;
      border:var(--border);
      background:rgba(255,255,255,.03);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      flex:0 0 auto;
    }
    .fileItem .miniThumb img{ width:100%; height:100%; object-fit:cover; }
    .fileItem .info{
      min-width:0;
      flex:1;
    }
    .fileItem .name{
      font-weight:800;
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .fileItem .subinfo{
      font-size:12px;
      color:#9fb0ca;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .fileItem .actions{
      display:flex;
      gap:8px;
      flex:0 0 auto;
    }
    .iconBtn{
      appearance:none;
      border:var(--border);
      background:rgba(0,0,0,.12);
      color:var(--fg);
      width:44px; height:44px;
      border-radius:14px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      font-size:18px;
      font-weight:900;
    }
    .iconBtn:disabled{ opacity:.45; cursor:not-allowed; }
    .iconBtn.danger{ color:#ffd0d0; }

    /* toggles */
    .checkRow{
      margin-top:12px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .checkWrap{
      display:flex;
      gap:12px;
      align-items:center;
      border:var(--border);
      background:rgba(255,255,255,.03);
      padding:12px 12px;
      border-radius:16px;
      width:100%;
    }
    .checkWrap input{ width:18px; height:18px; }
    .checkWrap .checkText{ font-weight:800; }
    .checkWrap .checkHint{ color:#9fb0ca; font-size:12px; line-height:1.4; }

    .footer{
      margin-top:14px;
      color:#94a6c2;
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>ConvertFiles24</h1>
        <p class="sub" id="subtitle"></p>
      </div>

      <div class="langbar" aria-label="Language selector">
        <div class="langbtn" data-lang="en"><span class="flag">ğŸ‡ºğŸ‡¸</span>EN</div>
        <div class="langbtn" data-lang="ja"><span class="flag">ğŸ‡¯ğŸ‡µ</span>æ—¥æœ¬èª</div>
        <div class="langbtn" data-lang="ko"><span class="flag">ğŸ‡°ğŸ‡·</span>KO</div>
        <div class="langbtn" data-lang="es"><span class="flag">ğŸ‡ªğŸ‡¸</span>ES</div>
      </div>
    </div>

    <div class="grid">
      <!-- Left -->
      <div class="card">
        <h2 id="h_upload"></h2>

        <div class="drop" id="drop">
          <div style="width:100%;">
            <div style="font-weight:900; margin-bottom:8px;" id="drop_title"></div>

            <!-- âœ… ëª¨ë°”ì¼ íŒŒì¼ì„ íƒ íŠ¸ë¦¬ê±° ê°•í™”: button í´ë¦­ìœ¼ë¡œ input.click() -->
            <button class="btn secondary small" id="pick_real" type="button"></button>
            <input id="file" type="file" accept="image/*,application/pdf" multiple />

            <div class="hint" id="drop_hint"></div>

            <div class="divider"></div>

            <div class="hint" id="diff_hint"></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="listTitle">
          <h2 style="margin:0;" id="h_order"></h2>
          <div class="miniInfo" id="order_help"></div>
        </div>
        <div class="fileList" id="file_list"></div>

        <div class="divider"></div>

        <h2 id="h_preview"></h2>
        <div class="preview">
          <div class="thumb" id="thumb"></div>
          <div class="meta" id="meta"></div>
        </div>

        <div class="msg" id="msg"></div>
      </div>

      <!-- Right -->
      <div class="card">
        <h2 id="h_settings"></h2>

        <div class="row">
          <div>
            <label id="lbl_format"></label>
            <select id="format">
              <option value="image/jpeg">JPG</option>
              <option value="image/png">PNG</option>
              <option value="image/webp">WebP</option>
              <option value="application/pdf">PDF</option>
            </select>
          </div>

          <div>
            <label id="lbl_quality"></label>
            <select id="quality">
              <option value="0.95" id="q_095"></option>
              <option value="0.9" selected id="q_090"></option>
              <option value="0.8" id="q_080"></option>
              <option value="0.7" id="q_070"></option>
            </select>
          </div>
        </div>

        <div style="height:10px;"></div>

        <div class="row">
          <div>
            <label id="lbl_w"></label>
            <input id="w" type="number" min="1" />
          </div>
          <div>
            <label id="lbl_h"></label>
            <input id="h" type="number" min="1" />
          </div>
        </div>

        <div class="hint" id="size_hint"></div>

        <div class="checkRow" id="pdf_options_wrap" style="display:none;">
          <div style="width:100%;">
            <label id="lbl_pdf_mode"></label>
            <select id="pdf_mode">
              <option value="single" id="pdfm_single"></option>
              <option value="merge" id="pdfm_merge"></option>
            </select>

            <div style="height:10px;"></div>

            <div class="checkWrap">
              <input id="a4_normalize" type="checkbox" />
              <div>
                <div class="checkText" id="lbl_a4"></div>
                <div class="checkHint" id="hint_a4"></div>
              </div>
            </div>

            <div class="hint" id="pdf_warn"></div>
          </div>
        </div>

        <div class="checkRow" id="zip_wrap">
          <div class="checkWrap">
            <input id="zip_bundle" type="checkbox" />
            <div>
              <div class="checkText" id="lbl_zip"></div>
              <div class="checkHint" id="hint_zip"></div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <h2 id="h_download"></h2>
        <button class="btn" id="convert" disabled></button>
        <div style="height:10px;"></div>
        <button class="btn secondary" id="reset" disabled></button>

        <div class="hint" id="privacy_hint"></div>
      </div>
    </div>

    <div class="footer">
      Â© <span id="year"></span> ConvertFiles24 Â· Powered by GitHub Pages
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const fileInput = $("file");
  const pickReal  = $("pick_real");
  const drop      = $("drop");
  const thumb     = $("thumb");
  const meta      = $("meta");
  const msg       = $("msg");
  const fileList  = $("file_list");

  const btnConvert = $("convert");
  const btnReset   = $("reset");

  const selFormat  = $("format");
  const selQuality = $("quality");
  const inW = $("w");
  const inH = $("h");

  const pdfWrap     = $("pdf_options_wrap");
  const selPdfMode  = $("pdf_mode");
  const chkA4       = $("a4_normalize");
  const zipWrap     = $("zip_wrap");
  const chkZip      = $("zip_bundle");

  $("year").textContent = new Date().getFullYear();

  // =========================
  // i18n (KO/EN/JA/ES)
  // =========================
  const STR = {
    ko: {
      seoTitle: "ConvertFiles24 - ë³€í™˜ê¸°",
      seoDesc: "ì´ë¯¸ì§€(JPG/PNG/WebP) ë³€í™˜ + PDF ë³‘í•© â€” ì„œë²„ ì—…ë¡œë“œ ì—†ì´ ë¸Œë¼ìš°ì € ë¡œì»¬ ì²˜ë¦¬. ZIP ë‹¤ìš´ë¡œë“œ ì„ íƒ ê°€ëŠ¥.",
      ogTitle: "ConvertFiles24 - ë³€í™˜ê¸°",
      ogDesc: "ì´ë¯¸ì§€ ë³€í™˜ ë° PDF ë³‘í•©ì„ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ ì²˜ë¦¬í•©ë‹ˆë‹¤. ZIP ë‹¤ìš´ë¡œë“œ ì„ íƒ ê°€ëŠ¥.",

      subtitle: 'ì´ë¯¸ì§€ë¥¼ <b>JPG / PNG / WebP</b>ë¡œ ë³€í™˜í•˜ê±°ë‚˜, ì—¬ëŸ¬ íŒŒì¼ì„ <b>PDFë¡œ í•©ì¹˜ê¸° / PDF+PDF ë³‘í•©</b>í•  ìˆ˜ ìˆì–´ìš”. (ì„œë²„ ì—…ë¡œë“œ ì—†ì´ ë¡œì»¬ ì²˜ë¦¬)',
      h_upload: '1) ì—…ë¡œë“œ',
      drop_title: 'ì—¬ê¸°ì— íŒŒì¼ì„ ëŒì–´ë†“ê±°ë‚˜',
      pick_btn: 'íŒŒì¼ ì„ íƒ',
      drop_hint: 'ì§€ì›: JPG, PNG, WebP, PDF / ì—¬ëŸ¬ ì¥ ì„ íƒ ê°€ëŠ¥',
      diff_hint: 'â€¢ ZIP: ì—¬ëŸ¬ íŒŒì¼ ë³€í™˜ ê²°ê³¼ë¥¼ 1ê°œ ZIPìœ¼ë¡œ ë¬¶ê¸°\nâ€¢ PDF: ì—¬ëŸ¬ ì´ë¯¸ì§€/ì—¬ëŸ¬ PDFë¥¼ 1ê°œ PDFë¡œ í•©ì¹˜ê¸°',
      h_order: 'í˜ì´ì§€ ìˆœì„œ / ì‚­ì œ',
      order_help: 'â†‘â†“ë¡œ ìˆœì„œ ë³€ê²½, ğŸ—‘ï¸ë¡œ ì‚­ì œ (PDF ë³‘í•©ì€ ì´ ìˆœì„œë¥¼ ë”°ë¦„)',
      h_preview: '2) ë¯¸ë¦¬ë³´ê¸°',
      thumb_label: 'ë¯¸ë¦¬ë³´ê¸°',
      meta_idle: 'íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.',

      h_settings: '3) ë³€í™˜ ì„¤ì •',
      lbl_format: 'ì¶œë ¥ í˜•ì‹',
      lbl_quality: 'í’ˆì§ˆ (JPG/WebPë§Œ)',
      q_095: 'ìµœê³ (0.95)',
      q_090: 'ë†’ìŒ(0.90)',
      q_080: 'ë³´í†µ(0.80)',
      q_070: 'ì••ì¶•(0.70)',

      lbl_w: 'ê°€ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)',
      lbl_h: 'ì„¸ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)',
      ph_w: 'ì˜ˆ: 1200',
      ph_h: 'ì˜ˆ: 800',
      size_hint: 'ê°€ë¡œ/ì„¸ë¡œë¥¼ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ë¹„ìœ¨ ìœ ì§€ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.',

      lbl_pdf_mode: 'PDF ë™ì‘',
      pdfm_single: '1ì¥ PDF (ì²« íŒŒì¼ë§Œ)',
      pdfm_merge: 'ì—¬ëŸ¬ íŒŒì¼ â†’ í•œ PDFë¡œ í•©ì¹˜ê¸°',
      lbl_a4: 'PDF í˜ì´ì§€ í¬ê¸° A4ë¡œ í†µì¼',
      hint_a4: 'ì¼œë©´ ëª¨ë“  í˜ì´ì§€ë¥¼ A4ì— ë§ì¶° ì¶•ì†Œ/í™•ëŒ€í•˜ì—¬ ì¤‘ì•™ ë°°ì¹˜í•©ë‹ˆë‹¤.',
      pdf_warn: 'â€» ì•”í˜¸(PASSWORD)ê°€ ê±¸ë¦° PDFëŠ” ë³‘í•©í•  ìˆ˜ ì—†ì–´ìš”. ë¹„ë°€ë²ˆí˜¸ í•´ì œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',

      lbl_zip: 'ì—¬ëŸ¬ íŒŒì¼ ê²°ê³¼ë¥¼ ZIPìœ¼ë¡œ ë¬¶ê¸°',
      hint_zip: 'ì—¬ëŸ¬ ì¥ì„ JPG/PNG/WebPë¡œ ë°”ê¿€ ë•Œ ZIPì„ ì¼œë©´ í•œ ë²ˆì— ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆì–´ìš”.',

      h_download: '4) ë‹¤ìš´ë¡œë“œ',
      convert: 'ë³€í™˜ & ë‹¤ìš´ë¡œë“œ',
      reset: 'ì´ˆê¸°í™”',
      privacy_hint: 'ğŸ”’ ê°œì¸ì •ë³´: ì—…ë¡œë“œëœ íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br/>âœ… ë³€í™˜/ë³‘í•©ì€ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ ì²˜ë¦¬ë©ë‹ˆë‹¤.',

      msg_loading: 'ì½ëŠ” ì¤‘â€¦',
      msg_ready_multi: (n)=> `ì¤€ë¹„ ì™„ë£Œ! (${n}ê°œ ì„ íƒë¨)`,
      msg_ready_single: 'ì¤€ë¹„ ì™„ë£Œ! ë³€í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.',
      msg_png_q: 'PNGëŠ” ë¬´ì†ì‹¤ì´ë¼ í’ˆì§ˆ ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•Šì•„ìš”.',
      msg_pdf_multi_hint: 'PDFë¡œ ì €ì¥ ì‹œ, ì—¬ëŸ¬ íŒŒì¼ì„ ì„ íƒí–ˆë‹¤ë©´ â€œí•œ PDFë¡œ í•©ì¹˜ê¸°â€ë¥¼ ì„ íƒí•˜ì„¸ìš”.',
      err_none: 'ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.',
      err_only_type: 'ì´ë¯¸ì§€ ë˜ëŠ” PDFë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      err_preview: 'ë¯¸ë¦¬ë³´ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”.',
      err_convert: 'ë³€í™˜/ë³‘í•© ì‹¤íŒ¨. ë‹¤ë¥¸ íŒŒì¼ ë˜ëŠ” ì˜µì…˜ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',
      err_pdf_password: 'ì•”í˜¸ê°€ ê±¸ë¦° PDFëŠ” ë³‘í•©í•  ìˆ˜ ì—†ì–´ìš”. ë¹„ë°€ë²ˆí˜¸ í•´ì œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',
      converting: 'ì²˜ë¦¬ ì¤‘â€¦',

      zip_confirm_title: "ZIP ê¶Œì¥",
      zip_confirm_body: "ì—¬ëŸ¬ íŒŒì¼ì€ ë¸Œë¼ìš°ì € ì •ì±… ë•Œë¬¸ì— 1ê°œë§Œ ë‹¤ìš´ë¡œë“œë  ìˆ˜ ìˆì–´ìš”.\nZIPìœ¼ë¡œ í•œ ë²ˆì— ë°›ì„ê¹Œìš”?",
      dl_started: (name, size)=> `ë‹¤ìš´ë¡œë“œ ì‹œì‘: ${name} (${size})`,
      meta_tpl: (name, type, size, extra) =>
        `íŒŒì¼ëª…: <b>${name}</b><br/>í˜•ì‹: <b>${type}</b><br/>í¬ê¸°: <b>${size}</b>${extra ? `<br/>${extra}` : ""}`
    },

    en: {
      seoTitle: "ConvertFiles24 - Converter",
      seoDesc: "Convert images (JPG/PNG/WebP) and merge PDFs â€” processed locally in your browser. Optional ZIP download.",
      ogTitle: "ConvertFiles24 - Converter",
      ogDesc: "Convert images and merge PDFs locally. Optional ZIP download.",

      subtitle: 'Convert images to <b>JPG / PNG / WebP</b>, or merge multiple files into <b>one PDF (PDF+PDF supported)</b>. (All processed locally)',
      h_upload: '1) Upload',
      drop_title: 'Drag & drop files here, or',
      pick_btn: 'Choose files',
      drop_hint: 'Supports JPG, PNG, WebP, PDF / Multiple selection allowed',
      diff_hint: 'â€¢ ZIP: bundle multiple converted outputs into one ZIP\nâ€¢ PDF: merge multiple images/PDFs into one PDF',
      h_order: 'Page order / delete',
      order_help: 'Use â†‘â†“ to reorder, ğŸ—‘ï¸ to delete (PDF merge follows this order)',
      h_preview: '2) Preview',
      thumb_label: 'Preview',
      meta_idle: 'Select files to see details.',

      h_settings: '3) Conversion settings',
      lbl_format: 'Output format',
      lbl_quality: 'Quality (JPG/WebP only)',
      q_095: 'Max (0.95)',
      q_090: 'High (0.90)',
      q_080: 'Normal (0.80)',
      q_070: 'Small (0.70)',

      lbl_w: 'Width (px) (blank = original)',
      lbl_h: 'Height (px) (blank = original)',
      ph_w: 'e.g., 1200',
      ph_h: 'e.g., 800',
      size_hint: 'If you enter only one side, the aspect ratio is preserved automatically.',

      lbl_pdf_mode: 'PDF behavior',
      pdfm_single: 'Single-page PDF (first file only)',
      pdfm_merge: 'Merge multiple files into one PDF',
      lbl_a4: 'Normalize PDF pages to A4',
      hint_a4: 'When enabled, each page is scaled to fit A4 and centered.',
      pdf_warn: 'Note: Password-protected PDFs cannot be merged. Remove the password and try again.',

      lbl_zip: 'Bundle multiple outputs into ZIP',
      hint_zip: 'For multiple JPG/PNG/WebP outputs, enabling ZIP lets you download all at once.',

      h_download: '4) Download',
      convert: 'Convert & Download',
      reset: 'Reset',
      privacy_hint: 'ğŸ”’ Privacy: Your files are never uploaded to a server.<br/>âœ… Conversion & merge run locally in your browser.',

      msg_loading: 'Loadingâ€¦',
      msg_ready_multi: (n)=> `Ready! (${n} selected)`,
      msg_ready_single: 'Ready! Click convert to download.',
      msg_png_q: "PNG is lossless, so the quality setting doesn't apply.",
      msg_pdf_multi_hint: 'When output is PDF and multiple files are selected, choose â€œMerge into one PDFâ€.',
      err_none: 'Please select files first.',
      err_only_type: 'Only images or PDFs are supported.',
      err_preview: 'Failed to preview.',
      err_convert: 'Conversion/merge failed. Try different files/options.',
      err_pdf_password: 'Cannot merge password-protected PDFs. Remove the password and try again.',
      converting: 'Processingâ€¦',

      zip_confirm_title: "ZIP recommended",
      zip_confirm_body: "With multiple files, your browser may download only one.\nDownload all as a ZIP instead?",
      dl_started: (name, size)=> `Download started: ${name} (${size})`,
      meta_tpl: (name, type, size, extra) =>
        `Name: <b>${name}</b><br/>Type: <b>${type}</b><br/>Size: <b>${size}</b>${extra ? `<br/>${extra}` : ""}`
    },

    ja: {
      seoTitle: "ConvertFiles24 - å¤‰æ›",
      seoDesc: "ç”»åƒ(JPG/PNG/WebP)å¤‰æ› + PDFçµåˆ â€” ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã€‚ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é¸æŠå¯ã€‚",
      ogTitle: "ConvertFiles24 - å¤‰æ›",
      ogDesc: "ç”»åƒå¤‰æ›ã¨PDFçµåˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã€‚ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é¸æŠå¯ã€‚",

      subtitle: 'ç”»åƒã‚’ <b>JPG / PNG / WebP</b> ã«å¤‰æ›ã€ã¾ãŸã¯è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ <b>1ã¤ã®PDFã«çµåˆï¼ˆPDF+PDFå¯¾å¿œï¼‰</b> ã§ãã¾ã™ã€‚ï¼ˆã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—ï¼‰',
      h_upload: '1) ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
      drop_title: 'ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯',
      pick_btn: 'ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ',
      drop_hint: 'å¯¾å¿œ: JPG, PNG, WebP, PDF / è¤‡æ•°é¸æŠOK',
      diff_hint: 'â€¢ ZIP: è¤‡æ•°ã®å¤‰æ›çµæœã‚’1ã¤ã®ZIPã«ã¾ã¨ã‚ã‚‹\nâ€¢ PDF: è¤‡æ•°ã®ç”»åƒ/PDFã‚’1ã¤ã®PDFã«çµåˆã™ã‚‹',
      h_order: 'é †åº / å‰Šé™¤',
      order_help: 'â†‘â†“ã§é †åºå¤‰æ›´ã€ğŸ—‘ï¸ã§å‰Šé™¤ï¼ˆPDFçµåˆã¯ã“ã®é †åºï¼‰',
      h_preview: '2) ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
      thumb_label: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
      meta_idle: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã¨æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚',

      h_settings: '3) å¤‰æ›è¨­å®š',
      lbl_format: 'å‡ºåŠ›å½¢å¼',
      lbl_quality: 'å“è³ªï¼ˆJPG/WebPã®ã¿ï¼‰',
      q_095: 'æœ€é«˜(0.95)',
      q_090: 'é«˜(0.90)',
      q_080: 'æ¨™æº–(0.80)',
      q_070: 'åœ§ç¸®(0.70)',

      lbl_w: 'å¹…(px)ï¼ˆç©ºæ¬„=å…ƒã‚µã‚¤ã‚ºï¼‰',
      lbl_h: 'é«˜ã•(px)ï¼ˆç©ºæ¬„=å…ƒã‚µã‚¤ã‚ºï¼‰',
      ph_w: 'ä¾‹: 1200',
      ph_h: 'ä¾‹: 800',
      size_hint: 'ç‰‡æ–¹ã ã‘å…¥åŠ›ã™ã‚‹ã¨ã€æ¯”ç‡ã‚’ç¶­æŒã—ã¦è‡ªå‹•è¨ˆç®—ã—ã¾ã™ã€‚',

      lbl_pdf_mode: 'PDFå‹•ä½œ',
      pdfm_single: '1ãƒšãƒ¼ã‚¸PDFï¼ˆæœ€åˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰',
      pdfm_merge: 'è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ« â†’ 1ã¤ã®PDFã«çµåˆ',
      lbl_a4: 'PDFãƒšãƒ¼ã‚¸ã‚’A4ã«çµ±ä¸€',
      hint_a4: 'ONã«ã™ã‚‹ã¨å„ãƒšãƒ¼ã‚¸ã‚’A4ã«åˆã‚ã›ã¦æ‹¡å¤§/ç¸®å°ã—ä¸­å¤®é…ç½®ã—ã¾ã™ã€‚',
      pdf_warn: 'â€» ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãPDFã¯çµåˆã§ãã¾ã›ã‚“ã€‚è§£é™¤ã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',

      lbl_zip: 'è¤‡æ•°å‡ºåŠ›ã‚’ZIPã«ã¾ã¨ã‚ã‚‹',
      hint_zip: 'è¤‡æ•°ã®JPG/PNG/WebPå‡ºåŠ›ã¯ZIPã«ã™ã‚‹ã¨ä¸€æ‹¬ã§ä¿å­˜ã§ãã¾ã™ã€‚',

      h_download: '4) ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
      convert: 'å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
      reset: 'ãƒªã‚»ãƒƒãƒˆ',
      privacy_hint: 'ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚<br/>âœ… å¤‰æ›/çµåˆã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã§ã™ã€‚',

      msg_loading: 'èª­ã¿è¾¼ã¿ä¸­â€¦',
      msg_ready_multi: (n)=> `æº–å‚™å®Œäº†ï¼(${n}ä»¶é¸æŠ)`,
      msg_ready_single: 'æº–å‚™å®Œäº†ï¼å¤‰æ›ãƒœã‚¿ãƒ³ã§ä¿å­˜ã—ã¾ã™ã€‚',
      msg_png_q: 'PNGã¯ç„¡åŠ£åŒ–ã®ãŸã‚ã€å“è³ªè¨­å®šã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚',
      msg_pdf_multi_hint: 'å‡ºåŠ›ãŒPDFã§è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€ã€Œ1ã¤ã®PDFã«çµåˆã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚',
      err_none: 'å…ˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚',
      err_only_type: 'ç”»åƒã¾ãŸã¯PDFã®ã¿å¯¾å¿œã§ã™ã€‚',
      err_preview: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
      err_convert: 'å¤‰æ›/çµåˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«/è¨­å®šã§ãŠè©¦ã—ãã ã•ã„ã€‚',
      err_pdf_password: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãPDFã¯çµåˆã§ãã¾ã›ã‚“ã€‚è§£é™¤ã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
      converting: 'å‡¦ç†ä¸­â€¦',

      zip_confirm_title: "ZIPæ¨å¥¨",
      zip_confirm_body: "è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã§1ã¤ã—ã‹ä¿å­˜ã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\nZIPã«ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã‹ï¼Ÿ",
      dl_started: (name, size)=> `ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹: ${name} (${size})`,
      meta_tpl: (name, type, size, extra) =>
        `ãƒ•ã‚¡ã‚¤ãƒ«å: <b>${name}</b><br/>å½¢å¼: <b>${type}</b><br/>ã‚µã‚¤ã‚º: <b>${size}</b>${extra ? `<br/>${extra}` : ""}`
    },

    es: {
      seoTitle: "ConvertFiles24 - Convertidor",
      seoDesc: "Convierte imÃ¡genes (JPG/PNG/WebP) y une PDFs â€” procesado localmente en tu navegador. ZIP opcional.",
      ogTitle: "ConvertFiles24 - Convertidor",
      ogDesc: "Convierte imÃ¡genes y une PDFs localmente. ZIP opcional.",

      subtitle: 'Convierte imÃ¡genes a <b>JPG / PNG / WebP</b> o une varios archivos en <b>un solo PDF (PDF+PDF)</b>. (Todo local en el navegador)',
      h_upload: '1) Subir',
      drop_title: 'Arrastra y suelta archivos aquÃ­, o',
      pick_btn: 'Elegir archivos',
      drop_hint: 'Soporta JPG, PNG, WebP, PDF / SelecciÃ³n mÃºltiple',
      diff_hint: 'â€¢ ZIP: agrupa mÃºltiples salidas en un ZIP\nâ€¢ PDF: une varias imÃ¡genes/PDF en un PDF',
      h_order: 'Orden / borrar',
      order_help: 'Usa â†‘â†“ para ordenar, ğŸ—‘ï¸ para borrar (la uniÃ³n PDF sigue este orden)',
      h_preview: '2) Vista previa',
      thumb_label: 'Vista previa',
      meta_idle: 'Selecciona archivos para ver detalles.',

      h_settings: '3) Ajustes',
      lbl_format: 'Formato de salida',
      lbl_quality: 'Calidad (solo JPG/WebP)',
      q_095: 'MÃ¡x (0.95)',
      q_090: 'Alta (0.90)',
      q_080: 'Normal (0.80)',
      q_070: 'Compacta (0.70)',

      lbl_w: 'Ancho (px) (vacÃ­o = original)',
      lbl_h: 'Alto (px) (vacÃ­o = original)',
      ph_w: 'p. ej., 1200',
      ph_h: 'p. ej., 800',
      size_hint: 'Si ingresas solo un lado, se mantiene la relaciÃ³n de aspecto automÃ¡ticamente.',

      lbl_pdf_mode: 'Comportamiento PDF',
      pdfm_single: 'PDF de 1 pÃ¡gina (solo primer archivo)',
      pdfm_merge: 'Unir varios archivos en un PDF',
      lbl_a4: 'Normalizar pÃ¡ginas PDF a A4',
      hint_a4: 'Al activarlo, cada pÃ¡gina se ajusta a A4 y se centra.',
      pdf_warn: 'Nota: No se pueden unir PDFs con contraseÃ±a. Quita la contraseÃ±a y vuelve a intentar.',

      lbl_zip: 'Agrupar mÃºltiples salidas en ZIP',
      hint_zip: 'Para mÃºltiples salidas JPG/PNG/WebP, activar ZIP permite descargar todo de una vez.',

      h_download: '4) Descargar',
      convert: 'Convertir y Descargar',
      reset: 'Reiniciar',
      privacy_hint: 'ğŸ”’ Privacidad: tus archivos nunca se suben a un servidor.<br/>âœ… ConversiÃ³n y uniÃ³n se ejecutan localmente en tu navegador.',

      msg_loading: 'Cargandoâ€¦',
      msg_ready_multi: (n)=> `Â¡Listo! (${n} seleccionados)`,
      msg_ready_single: 'Â¡Listo! Haz clic en convertir para descargar.',
      msg_png_q: 'PNG es sin pÃ©rdida, asÃ­ que la calidad no aplica.',
      msg_pdf_multi_hint: 'Si la salida es PDF y hay varios archivos, elige â€œUnir en un PDFâ€.',
      err_none: 'Selecciona archivos primero.',
      err_only_type: 'Solo se admiten imÃ¡genes o PDF.',
      err_preview: 'No se pudo previsualizar.',
      err_convert: 'FallÃ³ la conversiÃ³n/uniÃ³n. Prueba con otros archivos/opciones.',
      err_pdf_password: 'No se pueden unir PDFs con contraseÃ±a. Quita la contraseÃ±a y vuelve a intentar.',
      converting: 'Procesandoâ€¦',

      zip_confirm_title: "Se recomienda ZIP",
      zip_confirm_body: "Con varios archivos, el navegador puede descargar solo uno.\nÂ¿Quieres descargar todo como ZIP?",
      dl_started: (name, size)=> `Descarga iniciada: ${name} (${size})`,
      meta_tpl: (name, type, size, extra) =>
        `Nombre: <b>${name}</b><br/>Tipo: <b>${type}</b><br/>TamaÃ±o: <b>${size}</b>${extra ? `<br/>${extra}` : ""}`
    }
  };

  // =========================
  // Utilities
  // =========================
  function humanSize(bytes){
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return `${v.toFixed(i===0?0:1)} ${units[i]}`;
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }
  function setMessage(text, type){
    msg.textContent = text || "";
    msg.className = "msg " + (type || "");
  }
  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }
  function mimeToExt(mime){
    if(mime === "image/jpeg") return "jpg";
    if(mime === "image/png") return "png";
    if(mime === "image/webp") return "webp";
    if(mime === "application/pdf") return "pdf";
    return "bin";
  }
  function buildStamp(){
    return new Date().toISOString().replace(/[:.]/g,"-");
  }

  // A4 points (PDF uses points; 72dpi)
  const A4_W = 595.28;
  const A4_H = 841.89;

  // =========================
  // Language handling
  // =========================
  const META_DESC = document.querySelector('meta[name="description"]');
  const OG_TITLE  = document.querySelector('meta[property="og:title"]');
  const OG_DESC   = document.querySelector('meta[property="og:description"]');
  const TW_TITLE  = document.querySelector('meta[name="twitter:title"]');
  const TW_DESC   = document.querySelector('meta[name="twitter:description"]');
  const JSONLD    = document.getElementById('jsonld');

  function detectLang(){
    // 1) URL ?lang=xx
    const u = new URL(location.href);
    const q = (u.searchParams.get("lang") || "").toLowerCase();
    if(q && STR[q]) return q;

    // 2) saved
    const saved = localStorage.getItem("cf24_lang");
    if(saved && STR[saved]) return saved;

    // 3) browser
    const nav = (navigator.language || "").toLowerCase();
    if(nav.startsWith("ja")) return "ja";
    if(nav.startsWith("ko")) return "ko";
    if(nav.startsWith("es")) return "es";
    return "en";
  }

  let LANG = detectLang();

  function setActiveLangButtons(lang){
    document.querySelectorAll(".langbtn").forEach(b=>{
      b.classList.toggle("active", b.dataset.lang === lang);
    });
  }

  function renderTexts(){
    const t = STR[LANG];

    document.documentElement.lang = LANG;

    document.title = t.seoTitle;
    if(META_DESC) META_DESC.setAttribute("content", t.seoDesc);
    if(OG_TITLE)  OG_TITLE.setAttribute("content", t.ogTitle);
    if(OG_DESC)   OG_DESC.setAttribute("content", t.ogDesc);
    if(TW_TITLE)  TW_TITLE.setAttribute("content", t.ogTitle);
    if(TW_DESC)   TW_DESC.setAttribute("content", t.ogDesc);

    if(JSONLD){
      try{
        const obj = JSON.parse(JSONLD.textContent);
        obj.name = "ConvertFiles24";
        obj.url = (document.querySelector('link[rel="canonical"]')?.href) || obj.url;
        JSONLD.textContent = JSON.stringify(obj);
      }catch(e){}
    }

    $("subtitle").innerHTML = t.subtitle;

    $("h_upload").textContent = t.h_upload;
    $("drop_title").textContent = t.drop_title;
    pickReal.textContent = t.pick_btn;
    $("drop_hint").textContent = t.drop_hint;
    $("diff_hint").textContent = t.diff_hint;

    $("h_order").textContent = t.h_order;
    $("order_help").textContent = t.order_help;

    $("h_preview").textContent = t.h_preview;
    $("h_settings").textContent = t.h_settings;
    $("lbl_format").textContent = t.lbl_format;
    $("lbl_quality").textContent = t.lbl_quality;

    $("q_095").textContent = t.q_095;
    $("q_090").textContent = t.q_090;
    $("q_080").textContent = t.q_080;
    $("q_070").textContent = t.q_070;

    $("lbl_w").textContent = t.lbl_w;
    $("lbl_h").textContent = t.lbl_h;
    inW.placeholder = t.ph_w;
    inH.placeholder = t.ph_h;
    $("size_hint").textContent = t.size_hint;

    $("lbl_pdf_mode").textContent = t.lbl_pdf_mode;
    $("pdfm_single").textContent = t.pdfm_single;
    $("pdfm_merge").textContent = t.pdfm_merge;
    $("lbl_a4").textContent = t.lbl_a4;
    $("hint_a4").textContent = t.hint_a4;
    $("pdf_warn").textContent = t.pdf_warn;

    $("lbl_zip").textContent = t.lbl_zip;
    $("hint_zip").textContent = t.hint_zip;

    $("h_download").textContent = t.h_download;
    btnConvert.textContent = t.convert;
    btnReset.textContent = t.reset;
    $("privacy_hint").innerHTML = t.privacy_hint;

    // preview idle
    if(selectedFiles.length === 0){
      meta.textContent = t.meta_idle;
      thumb.innerHTML = `<span style="color:#90a3c1; font-size:12px;">${t.thumb_label}</span>`;
    }
  }

  function setLang(lang){
    if(!STR[lang]) return;
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    setActiveLangButtons(lang);
    renderTexts();
    updateUIState();
  }

  document.querySelectorAll(".langbtn").forEach(b=>{
    b.addEventListener("click", ()=> setLang(b.dataset.lang));
  });

  // =========================
  // State: selected files (ordered)
  // =========================
  let selectedFiles = []; // [{file, kind:'image'|'pdf', w,h, pages, thumbUrl}]
  let firstPreviewReady = false;

  function resetAll(){
    selectedFiles = [];
    firstPreviewReady = false;

    fileInput.value = "";
    fileList.innerHTML = "";

    btnConvert.disabled = true;
    btnReset.disabled = true;

    inW.value = "";
    inH.value = "";

    chkZip.checked = false;
    chkA4.checked = false;
    selPdfMode.value = "single";

    setMessage("", "");
    renderTexts();
    updateUIState();
  }

  function updateQualityState(){
    const mime = selFormat.value;
    const disableQuality = (mime === "image/png" || mime === "application/pdf");
    selQuality.disabled = disableQuality;
    selQuality.style.opacity = disableQuality ? ".6" : "1";
  }

  function updateUIState(){
    updateQualityState();

    const outMime = selFormat.value;
    const multi = selectedFiles.length > 1;

    // PDF options visible only when output PDF
    pdfWrap.style.display = (outMime === "application/pdf") ? "block" : "none";

    // ZIP recommended for multi outputs of images/webp/jpg/png
    zipWrap.style.display = (outMime !== "application/pdf") ? "block" : "none";

    // enable convert if we have at least 1 file
    const has = selectedFiles.length > 0;
    btnConvert.disabled = !has;
    btnReset.disabled = !has;

    // message hints
    if(has){
      const t = STR[LANG];
      setMessage(
        multi ? t.msg_ready_multi(selectedFiles.length) : t.msg_ready_single,
        "ok"
      );

      if(outMime === "image/png"){
        // not error, just hint
        // keep ok msg if already ok
      }
    } else {
      setMessage("", "");
    }
  }

  // =========================
  // File list rendering (order / delete)
  // =========================
  function renderFileList(){
    fileList.innerHTML = "";

    selectedFiles.forEach((it, idx)=>{
      const row = document.createElement("div");
      row.className = "fileItem";

      const mini = document.createElement("div");
      mini.className = "miniThumb";
      if(it.kind === "image" && it.thumbUrl){
        const img = new Image();
        img.src = it.thumbUrl;
        mini.appendChild(img);
      } else {
        mini.innerHTML = `<span style="font-size:18px;">ğŸ“„</span>`;
      }

      const info = document.createElement("div");
      info.className = "info";
      const name = document.createElement("div");
      name.className = "name";
      name.textContent = `${idx+1}. ${it.file.name}`;

      const sub = document.createElement("div");
      sub.className = "subinfo";
      const size = humanSize(it.file.size);
      const type = it.kind === "pdf" ? "application/pdf" : (it.file.type || "image");
      let extra = "";
      if(it.kind === "image" && it.w && it.h) extra = ` Â· ${it.w}Ã—${it.h}`;
      if(it.kind === "pdf" && it.pages) extra = ` Â· pages: ${it.pages}`;
      sub.textContent = `${type} Â· ${size}${extra}`;

      info.appendChild(name);
      info.appendChild(sub);

      const actions = document.createElement("div");
      actions.className = "actions";

      const up = document.createElement("button");
      up.className = "iconBtn";
      up.type = "button";
      up.textContent = "â†‘";
      up.disabled = (idx === 0);
      up.addEventListener("click", ()=>{
        moveItem(idx, idx-1);
      });

      const down = document.createElement("button");
      down.className = "iconBtn";
      down.type = "button";
      down.textContent = "â†“";
      down.disabled = (idx === selectedFiles.length-1);
      down.addEventListener("click", ()=>{
        moveItem(idx, idx+1);
      });

      const del = document.createElement("button");
      del.className = "iconBtn danger";
      del.type = "button";
      del.textContent = "ğŸ—‘ï¸";
      del.addEventListener("click", ()=>{
        removeItem(idx);
      });

      actions.appendChild(up);
      actions.appendChild(down);
      actions.appendChild(del);

      row.appendChild(mini);
      row.appendChild(info);
      row.appendChild(actions);

      // clicking a row sets preview to this file
      row.addEventListener("click", (e)=>{
        // ignore clicks on buttons
        if(e.target && e.target.closest("button")) return;
        showPreviewForIndex(idx);
      });

      fileList.appendChild(row);
    });

    if(selectedFiles.length === 0){
      fileList.innerHTML = `<div style="color:#9fb0ca; font-size:12px;">(empty)</div>`;
    }
  }

  function moveItem(from, to){
    if(to < 0 || to >= selectedFiles.length) return;
    const x = selectedFiles.splice(from, 1)[0];
    selectedFiles.splice(to, 0, x);
    renderFileList();
    // keep preview aligned (show moved item)
    showPreviewForIndex(to);
  }

  function removeItem(idx){
    const it = selectedFiles[idx];
    if(it && it.thumbUrl){
      try{ URL.revokeObjectURL(it.thumbUrl); }catch(e){}
    }
    selectedFiles.splice(idx, 1);
    renderFileList();
    updateUIState();
    if(selectedFiles.length > 0){
      showPreviewForIndex(Math.min(idx, selectedFiles.length-1));
    } else {
      renderTexts();
    }
  }

  // =========================
  // Preview
  // =========================
  async function showPreviewForIndex(idx){
    const t = STR[LANG];
    const it = selectedFiles[idx];
    if(!it) return;

    if(it.kind === "image"){
      thumb.innerHTML = "";
      const img = new Image();
      img.src = it.thumbUrl || URL.createObjectURL(it.file);
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.objectFit = "cover";
      thumb.appendChild(img);

      const extra = (it.w && it.h) ? `Resolution: <b>${it.w} Ã— ${it.h}</b>` : "";
      meta.innerHTML = t.meta_tpl(
        escapeHtml(it.file.name),
        escapeHtml(it.file.type || "image"),
        humanSize(it.file.size),
        extra
      );
      firstPreviewReady = true;
      return;
    }

    // PDF preview: show icon and pages count
    thumb.innerHTML = `<span style="font-size:28px;">ğŸ“„</span>`;
    const extra = it.pages ? `Pages: <b>${it.pages}</b>` : "";
    meta.innerHTML = t.meta_tpl(
      escapeHtml(it.file.name),
      "application/pdf",
      humanSize(it.file.size),
      extra
    );
    firstPreviewReady = true;
  }

  // =========================
  // Loading files
  // =========================
  async function readPdfPageCount(file){
    try{
      const bytes = new Uint8Array(await file.arrayBuffer());
      const pdfDoc = await PDFLib.PDFDocument.load(bytes, { ignoreEncryption: false });
      return pdfDoc.getPageCount();
    }catch(e){
      // password or invalid
      return -1;
    }
  }

  async function readImageSize(file){
    return new Promise((resolve)=>{
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = () => {
        resolve({ w: img.naturalWidth, h: img.naturalHeight, url });
      };
      img.onerror = () => {
        try{ URL.revokeObjectURL(url); }catch(e){}
        resolve({ w:0, h:0, url:null });
      };
      img.src = url;
    });
  }

  function isSupported(file){
    if(file.type.startsWith("image/")) return true;
    if(file.type === "application/pdf") return true;
    // some android pdf may have empty type: fallback by extension
    const n = (file.name || "").toLowerCase();
    if(n.endsWith(".pdf")) return true;
    if(n.match(/\.(jpg|jpeg|png|webp)$/)) return true;
    return false;
  }

  function kindOf(file){
    if(file.type === "application/pdf") return "pdf";
    const n = (file.name || "").toLowerCase();
    if(n.endsWith(".pdf")) return "pdf";
    return "image";
  }

  async function addFiles(files){
    const t = STR[LANG];
    if(!files || files.length === 0) return;

    // filter
    const arr = Array.from(files).filter(isSupported);
    if(arr.length === 0){
      setMessage(t.err_only_type, "err");
      return;
    }

    setMessage(t.msg_loading, "");

    for(const f of arr){
      const kind = kindOf(f);

      if(kind === "image"){
        const { w, h, url } = await readImageSize(f);
        selectedFiles.push({
          file: f,
          kind: "image",
          w, h,
          pages: null,
          thumbUrl: url
        });
      } else {
        const pages = await readPdfPageCount(f);
        selectedFiles.push({
          file: f,
          kind: "pdf",
          w: null, h: null,
          pages: pages > 0 ? pages : null,
          thumbUrl: null,
          pdfEncrypted: (pages === -1)
        });
      }
    }

    renderFileList();
    updateUIState();

    // auto preview first item if none
    if(!firstPreviewReady && selectedFiles.length > 0){
      await showPreviewForIndex(0);
    } else if(selectedFiles.length > 0){
      // keep showing last
      await showPreviewForIndex(selectedFiles.length - 1);
    }

    // PDF hint
    if(selFormat.value === "application/pdf" && selectedFiles.length > 1){
      setMessage(t.msg_pdf_multi_hint, "");
    }
  }

  // =========================
  // Drag & drop
  // =========================
  ["dragenter","dragover"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      drop.classList.add("drag");
    });
  });
  ["dragleave","drop"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      drop.classList.remove("drag");
    });
  });
  drop.addEventListener("drop", (e) => {
    const dt = e.dataTransfer;
    if(dt && dt.files) addFiles(dt.files);
  });

  // =========================
  // Mobile file picker trigger ê°•í™”
  // =========================
  function openFilePicker(){
    // ì¼ë¶€ ê¸°ê¸°ì—ì„œ clickì´ ë¬´ì‹œë˜ë©´ focus í›„ click
    try{
      fileInput.value = ""; // ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥
      fileInput.focus({ preventScroll:true });
      // iOS/Android ëŒ€ì‘: setTimeout í•œ ë²ˆ
      setTimeout(()=> fileInput.click(), 0);
    }catch(e){
      try{ fileInput.click(); }catch(e2){}
    }
  }

  pickReal.addEventListener("click", (e)=>{
    e.preventDefault();
    openFilePicker();
  });

  // drop ì˜ì—­ ì „ì²´ë„ ëˆ„ë¥´ë©´ íŒŒì¼ ì„ íƒ(ëª¨ë°”ì¼ í¸ì˜)
  drop.addEventListener("click", (e)=>{
    // ë²„íŠ¼ í´ë¦­ì€ ì¤‘ë³µ ë°©ì§€
    if(e.target && e.target.closest("button")) return;
    openFilePicker();
  });

  fileInput.addEventListener("change", (e) => {
    const files = e.target.files;
    addFiles(files);
  });

  // =========================
  // Size handling (images)
  // =========================
  function getTargetSize(originalW, originalH){
    const w = parseInt(inW.value, 10);
    const h = parseInt(inH.value, 10);

    if(!w && !h) return { w: originalW, h: originalH };
    if(w && !h) return { w, h: Math.round(w * (originalH / originalW)) };
    if(!w && h) return { w: Math.round(h * (originalW / originalH)), h };
    return { w, h };
  }

  // =========================
  // ZIP Aì•ˆ: multiple outputs + ZIP OFF => confirm => auto ON
  // =========================
  function shouldRecommendZip(selectedCount, outMime){
    return selectedCount > 1 && outMime !== "application/pdf";
  }
  function confirmZipIfNeeded(){
    const t = STR[LANG];
    const outMime = selFormat.value;

    if(shouldRecommendZip(selectedFiles.length, outMime) && !chkZip.checked){
      const ok = confirm(`${t.zip_confirm_title}\n\n${t.zip_confirm_body}`);
      if(ok){
        chkZip.checked = true;
        return true;
      }
      return false;
    }
    return true;
  }

  // =========================
  // PDF helpers (A4 normalize)
  // =========================
  function fitRect(srcW, srcH, dstW, dstH){
    const s = Math.min(dstW/srcW, dstH/srcH);
    const w = srcW * s;
    const h = srcH * s;
    const x = (dstW - w)/2;
    const y = (dstH - h)/2;
    return { x, y, w, h, s };
  }

  async function addImageAsPdfPage(pdfDoc, imgBytes, isPng, pageW, pageH, a4Normalize){
    const embed = isPng ? await pdfDoc.embedPng(imgBytes) : await pdfDoc.embedJpg(imgBytes);

    const iw = embed.width;
    const ih = embed.height;

    if(a4Normalize){
      const page = pdfDoc.addPage([A4_W, A4_H]);
      const r = fitRect(iw, ih, A4_W, A4_H);
      page.drawImage(embed, { x:r.x, y:r.y, width:r.w, height:r.h });
    } else {
      // page size = image size in points (good enough)
      const page = pdfDoc.addPage([pageW, pageH]);
      page.drawImage(embed, { x:0, y:0, width:pageW, height:pageH });
    }
  }

  async function appendPdfInto(pdfDocDest, pdfBytes, a4Normalize){
    // password protected => throw
    const src = await PDFLib.PDFDocument.load(pdfBytes, { ignoreEncryption:false });

    const count = src.getPageCount();

    if(!a4Normalize){
      const copied = await pdfDocDest.copyPages(src, src.getPageIndices());
      copied.forEach(p=> pdfDocDest.addPage(p));
      return count;
    }

    // A4 normalize: embed each page and draw onto A4
    for(let i=0;i<count;i++){
      const [p] = await pdfDocDest.copyPages(src, [i]);
      const w = p.getWidth();
      const h = p.getHeight();

      // embed the copied page into XObject
      const embedded = await pdfDocDest.embedPage(p);
      const page = pdfDocDest.addPage([A4_W, A4_H]);
      const r = fitRect(w, h, A4_W, A4_H);
      page.drawPage(embedded, { x:r.x, y:r.y, xScale:r.w/w, yScale:r.h/h });
    }
    return count;
  }

  // =========================
  // Convert core
  // =========================
  async function convertImagesToBlob(mime, quality, imgFile, targetW, targetH){
    // draw into canvas
    const bmp = await createImageBitmap(imgFile);
    const canvas = document.createElement("canvas");
    canvas.width = targetW;
    canvas.height = targetH;

    const ctx = canvas.getContext("2d", { alpha:true });
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
    ctx.drawImage(bmp, 0, 0, targetW, targetH);

    const blob = await new Promise((resolve)=>{
      if(mime === "image/png"){
        canvas.toBlob(resolve, "image/png");
      } else {
        canvas.toBlob(resolve, mime, quality);
      }
    });

    return blob;
  }

  function buildOutputName(baseName, outMime, suffix=""){
    const base = (baseName || "file").replace(/\.[^.]+$/, "");
    const ext = mimeToExt(outMime);
    const stamp = buildStamp();
    return `${base}${suffix}_${stamp}.${ext}`;
  }

  async function handleConvert(){
    const t = STR[LANG];

    if(selectedFiles.length === 0){
      setMessage(t.err_none, "err");
      return;
    }

    // Aì•ˆ: multiple + zip off => recommend zip
    if(!confirmZipIfNeeded()) return;

    btnConvert.disabled = true;
    setMessage(t.converting, "");

    const outMime = selFormat.value;
    const quality = parseFloat(selQuality.value);

    const a4Normalize = chkA4.checked;
    const pdfMode = selPdfMode.value; // single | merge
    const wantZip = chkZip.checked;

    try{
      // ===========
      // CASE 1) output PDF
      // ===========
      if(outMime === "application/pdf"){
        // If multiple and pdfMode == single -> only first file (image or pdf)
        const items = (selectedFiles.length > 1 && pdfMode === "single")
          ? [selectedFiles[0]]
          : selectedFiles;

        // If any pdf is encrypted -> ì•ˆë‚´
        for(const it of items){
          if(it.kind === "pdf" && it.pdfEncrypted){
            setMessage(t.err_pdf_password, "err");
            btnConvert.disabled = false;
            return;
          }
        }

        const pdfDoc = await PDFLib.PDFDocument.create();

        // merge in order: pdf pages or image pages
        for(const it of items){
          if(it.kind === "pdf"){
            const bytes = new Uint8Array(await it.file.arrayBuffer());
            try{
              await appendPdfInto(pdfDoc, bytes, a4Normalize);
            }catch(e){
              setMessage(t.err_pdf_password, "err");
              btnConvert.disabled = false;
              return;
            }
          } else {
            // image -> pdf page
            const imgBytes = new Uint8Array(await it.file.arrayBuffer());
            const isPng = (it.file.type === "image/png") || (it.file.name || "").toLowerCase().endsWith(".png");
            const iw = it.w || 1200;
            const ih = it.h || 1600;

            // if user typed W/H, apply to image pages too (optional but helpful)
            const tgt = getTargetSize(iw, ih);
            const pageW = a4Normalize ? A4_W : tgt.w;
            const pageH = a4Normalize ? A4_H : tgt.h;

            // For non-A4: we draw image into page sized to target
            // Need actual target bitmap bytes: easiest is canvas -> PNG then embedPng
            // Use canvas conversion to PNG so that resizing applies
            const resized = await convertImagesToBlob("image/png", 0.92, it.file, tgt.w, tgt.h);
            const resizedBytes = new Uint8Array(await resized.arrayBuffer());
            await addImageAsPdfPage(pdfDoc, resizedBytes, true, pageW, pageH, a4Normalize);
          }
        }

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type:"application/pdf" });

        const outName = buildOutputName(
          items.length === 1 ? items[0].file.name : "merged",
          "application/pdf",
          (items.length > 1 ? "_merged" : "")
        );

        downloadBlob(blob, outName);
        setMessage(t.dl_started(outName, humanSize(blob.size)), "ok");
        btnConvert.disabled = false;
        return;
      }

      // ===========
      // CASE 2) output image formats (JPG/PNG/WebP)
      // ===========
      // Convert each image file; PDFs are NOT convertible to JPG/PNG/WebP here (keep simple + safe)
      const imagesOnly = selectedFiles.filter(x=>x.kind==="image");
      if(imagesOnly.length === 0){
        setMessage(t.err_only_type, "err");
        btnConvert.disabled = false;
        return;
      }

      // if user selected PDFs together, ignore PDFs for image output (friendly hint)
      const ignoredPdfCount = selectedFiles.filter(x=>x.kind==="pdf").length;
      // (we won't spam message; just proceed)

      const results = []; // {name, blob}
      for(const it of imagesOnly){
        const origW = it.w || 1200;
        const origH = it.h || 1600;
        const tgt = getTargetSize(origW, origH);

        const blob = await convertImagesToBlob(outMime, quality, it.file, tgt.w, tgt.h);

        const suffix = (tgt.w===origW && tgt.h===origH) ? "" : `_${tgt.w}x${tgt.h}`;
        const outName = buildOutputName(it.file.name, outMime, suffix);

        results.push({ name: outName, blob });
      }

      // multiple outputs:
      if(results.length > 1){
        if(wantZip){
          const zip = new JSZip();
          results.forEach(r=> zip.file(r.name, r.blob));
          const zipBlob = await zip.generateAsync({ type:"blob" });
          const zipName = `convertfiles24_${buildStamp()}.zip`;
          downloadBlob(zipBlob, zipName);
          setMessage(t.dl_started(zipName, humanSize(zipBlob.size)), "ok");
        } else {
          // In case user unchecked ZIP but confirmed earlier, this shouldn't happen.
          // But safe fallback: download first only.
          downloadBlob(results[0].blob, results[0].name);
          setMessage(t.dl_started(results[0].name, humanSize(results[0].blob.size)), "ok");
        }
      } else {
        downloadBlob(results[0].blob, results[0].name);
        setMessage(t.dl_started(results[0].name, humanSize(results[0].blob.size)), "ok");
      }

      btnConvert.disabled = false;
    } catch(e){
      console.error(e);
      setMessage(STR[LANG].err_convert, "err");
      btnConvert.disabled = false;
    }
  }

  // =========================
  // Events
  // =========================
  btnConvert.addEventListener("click", handleConvert);
  btnReset.addEventListener("click", resetAll);

  selFormat.addEventListener("change", ()=>{
    updateUIState();

    const t = STR[LANG];
    const mime = selFormat.value;

    if(mime === "image/png"){
      setMessage(t.msg_png_q, "");
    } else if(mime === "application/pdf" && selectedFiles.length > 1){
      setMessage(t.msg_pdf_multi_hint, "");
    } else {
      // keep ok ready message
      if(selectedFiles.length > 0){
        setMessage(
          selectedFiles.length > 1 ? t.msg_ready_multi(selectedFiles.length) : t.msg_ready_single,
          "ok"
        );
      } else {
        setMessage("", "");
      }
    }
  });

  // init
  setLang(detectLang());
  renderFileList();
  updateUIState();
  renderTexts();
})();
</script>
</body>
</html>