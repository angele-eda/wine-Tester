<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ConvertFiles24 â€“ Free Image Converter (JPG, PNG, WebP, PDF)</title>
  <meta name="description" content="Upload images or PDFs, convert to JPG/PNG/WebP/PDF, merge into one PDF, or download multiple results as ZIP â€” processed locally in your browser." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />
  <link rel="canonical" href="https://convertfiles24.com/" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="ConvertFiles24 - Image Converter" />
  <meta property="og:description" content="Convert JPG/PNG/WebP/PDF instantly â€” processed locally in your browser." />
  <meta property="og:url" content="https://convertfiles24.com/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ConvertFiles24 - Image Converter" />
  <meta name="twitter:description" content="Convert JPG/PNG/WebP/PDF instantly â€” processed locally in your browser." />

  <script type="application/ld+json" id="jsonld">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"ConvertFiles24",
    "applicationCategory":"MultimediaApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "url":"https://convertfiles24.com/"
  }
  </script>

  <!-- PDF + ZIP (all local in browser) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    :root { --radius:16px; --pad:16px; --border:1px solid rgba(255,255,255,.12); }
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif;
      background:#0b0f17; color:#e9eef7;
    }
    .wrap{ max-width:1040px; margin:0 auto; padding:22px 14px 44px; }
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom:14px;
    }
    h1{ margin:0; font-size:20px; letter-spacing:-.2px; }
    .sub{ margin:6px 0 0; color:#a7b3c7; font-size:13px; line-height:1.45; }

    /* language bar (no wrap) */
    .langbar{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:nowrap;
      white-space:nowrap;
    }
    .langbtn{
      font-size:12px; font-weight:700;
      color:#b8c6dc; border:var(--border);
      padding:9px 12px; border-radius:999px;
      background:rgba(255,255,255,.04);
      cursor:pointer; user-select:none;
      white-space:nowrap;
    }
    .langbtn.active{
      color:#e9eef7;
      background:rgba(47,109,246,.22);
      border-color:rgba(47,109,246,.55);
    }

    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:12px; }
    @media (max-width: 860px){ .grid{ grid-template-columns:1fr; } }

    .card{
      border:var(--border); background:rgba(255,255,255,.03); border-radius:var(--radius);
      padding:var(--pad);
    }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; }

    .drop{
      border:1px dashed rgba(255,255,255,.18); border-radius:14px; padding:18px;
      display:flex; align-items:center; justify-content:center; text-align:center;
      background:rgba(255,255,255,.02);
      position:relative;
    }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); }

    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:800;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:15px;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.secondary{ background:rgba(255,255,255,.10); color:#e9eef7; border:var(--border); }
    .btn.small{ width:auto; padding:8px 10px; font-size:12px; border-radius:999px; font-weight:800; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex:1; min-width:160px; }

    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; }

    select, input[type="number"]{
      width:100%; box-sizing:border-box; padding:12px 12px; border-radius:14px;
      background:rgba(255,255,255,.06); color:#e9eef7; border:var(--border);
      outline:none;
    }

    /* select option readability */
    select { background-color:#0b0f17; color:#e9eef7; border:1px solid rgba(255,255,255,.2); }
    option { background-color:#0b0f17; color:#e9eef7; }

    .preview{
      display:grid; grid-template-columns: 140px 1fr; gap:12px; align-items:center;
    }
    .thumb{
      width:140px; height:140px; border-radius:14px; border:var(--border);
      background:rgba(255,255,255,.03); display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .meta{ color:#b7c3d9; font-size:13px; line-height:1.5; }
    .meta b{ color:#e9eef7; }

    .hint{ margin-top:10px; color:#9fb0ca; font-size:12px; line-height:1.5; }
    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .err{ color:#ffb4b4; }
    .ok{ color:#b8ffcc; }

    .footer{ margin-top:14px; color:#94a6c2; font-size:12px; text-align:center; }

    /* file input safe hidden (NOT display:none) */
    .file-hidden{
      position:absolute;
      left:-9999px;
      width:1px;height:1px;
      opacity:0;
    }

    /* file list for merge/reorder */
    .list{
      margin-top:12px;
      border:var(--border);
      border-radius:14px;
      overflow:hidden;
      background:rgba(255,255,255,.02);
    }
    .listHeader{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color:#b8c6dc;
      font-size:12px;
    }
    .items{ max-height:260px; overflow:auto; }
    .item{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .item:last-child{ border-bottom:none; }
    .leftInfo{ display:flex; align-items:center; gap:10px; min-width:0; }
    .mini{
      width:44px;height:44px;border-radius:10px;border:var(--border);
      background:rgba(255,255,255,.03);
      overflow:hidden; flex:0 0 auto;
      display:flex; align-items:center; justify-content:center;
      color:#90a3c1; font-size:11px;
    }
    .mini img{ width:100%; height:100%; object-fit:cover; display:block; }
    .fname{
      font-size:12px; color:#e9eef7;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
      max-width:360px;
    }
    .ftype{ font-size:11px; color:#9fb0ca; margin-top:2px; }
    .rightBtns{ display:flex; gap:6px; flex:0 0 auto; }

    .tog{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding:10px 12px;
      border:var(--border);
      border-radius:14px;
      background:rgba(255,255,255,.02);
    }
    .tog input{ transform:scale(1.1); }
    .tog span{ color:#b8c6dc; font-size:12px; }

    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:#b8c6dc;
      font-size:12px;
      margin-top:8px;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>ConvertFiles24</h1>
      <p class="sub" id="subtitle"></p>
    </div>

    <div class="langbar" aria-label="Language selector">
      <div class="langbtn" data-lang="en">EN</div>
      <div class="langbtn" data-lang="es">ES</div>
      <div class="langbtn" data-lang="ja">æ—¥æœ¬èª</div>
      <div class="langbtn" data-lang="ko">KO</div>
    </div>
  </div>

  <div class="grid">
    <!-- Left -->
    <div class="card">
      <h2 id="h_upload"></h2>

      <div class="drop" id="drop">
        <div>
          <div style="font-weight:800; margin-bottom:8px;" id="drop_title"></div>

          <button type="button" class="btn secondary" id="pickRealBtn" style="display:inline-block; width:auto; padding:10px 14px;">
            <span id="pick_btn"></span>
          </button>

          <input
            id="file"
            class="file-hidden"
            type="file"
            accept="image/*,application/pdf"
            multiple
          />

          <div class="hint" id="drop_hint"></div>
          <div class="pill" id="pdfZipInfo"></div>
        </div>
      </div>

      <div class="list" id="fileListWrap" style="display:none;">
        <div class="listHeader">
          <div id="listTitle"></div>
          <div id="listHint"></div>
        </div>
        <div class="items" id="items"></div>
      </div>

      <div style="height:12px;"></div>

      <h2 id="h_preview"></h2>
      <div class="preview">
        <div class="thumb" id="thumb"></div>
        <div class="meta" id="meta"></div>
      </div>

      <div class="msg" id="msg"></div>
    </div>

    <!-- Right -->
    <div class="card">
      <h2 id="h_settings"></h2>

      <div class="row">
        <div>
          <label id="lbl_format"></label>
          <select id="format">
            <option value="image/jpeg">JPG</option>
            <option value="image/png">PNG</option>
            <option value="image/webp">WebP</option>
            <option value="application/pdf">PDF</option>
          </select>
        </div>

        <div>
          <label id="lbl_quality"></label>
          <select id="quality">
            <option value="0.95" id="q_095"></option>
            <option value="0.9" selected id="q_090"></option>
            <option value="0.8" id="q_080"></option>
            <option value="0.7" id="q_070"></option>
          </select>
        </div>
      </div>

      <div style="height:10px;"></div>

      <div class="row">
        <div>
          <label id="lbl_w"></label>
          <input id="w" type="number" min="1" />
        </div>
        <div>
          <label id="lbl_h"></label>
          <input id="h" type="number" min="1" />
        </div>
      </div>

      <div class="hint" id="size_hint"></div>

      <div style="height:12px;"></div>

      <div class="tog" id="zipToggleWrap" style="display:none;">
        <label style="margin:0; display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="zipToggle" />
          <span id="zipLabel"></span>
        </label>
        <span id="zipSub"></span>
      </div>

      <div style="height:12px;"></div>

      <h2 id="h_download"></h2>
      <button class="btn" id="convert" disabled></button>
      <div style="height:10px;"></div>
      <button class="btn secondary" id="reset" disabled></button>

      <div class="hint" id="privacy_hint"></div>
    </div>
  </div>

  <div class="footer">
    Â© <span id="year"></span> ConvertFiles24 Â· Powered by GitHub Pages
  </div>
</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const fileInput   = $("file");
  const pickRealBtn = $("pickRealBtn");
  const drop        = $("drop");
  const thumb       = $("thumb");
  const meta        = $("meta");
  const msg         = $("msg");
  const btnConvert  = $("convert");
  const btnReset    = $("reset");
  const selFormat   = $("format");
  const selQuality  = $("quality");
  const inW         = $("w");
  const inH         = $("h");

  const fileListWrap = $("fileListWrap");
  const itemsEl      = $("items");
  const listTitleEl  = $("listTitle");
  const listHintEl   = $("listHint");
  const zipToggleWrap= $("zipToggleWrap");
  const zipToggle    = $("zipToggle");
  const zipLabel     = $("zipLabel");
  const zipSub       = $("zipSub");
  const pdfZipInfo   = $("pdfZipInfo");

  $("year").textContent = new Date().getFullYear();

  // =========================
  // i18n (KO/EN/JA/ES)
  // =========================
  const STR = {
    ko: {
      subtitle: 'íŒŒì¼ì„ ì˜¬ë¦° ë’¤ <b>JPG / PNG / WebP / PDF</b>ë¡œ ë³€í™˜í•˜ê±°ë‚˜, ì—¬ëŸ¬ ì¥ì„ <b>1ê°œì˜ PDF</b>ë¡œ í•©ì¹  ìˆ˜ ìˆì–´ìš”. (ì„œë²„ ì—…ë¡œë“œ ì—†ì´ ë¸Œë¼ìš°ì € ë¡œì»¬ ì²˜ë¦¬)',
      h_upload: '1) ì—…ë¡œë“œ',
      drop_title: 'ì—¬ê¸°ì— íŒŒì¼ì„ ëŒì–´ë†“ê±°ë‚˜',
      pick_btn: 'íŒŒì¼ ì„ íƒ',
      drop_hint: 'ì§€ì›: JPG, PNG, WebP, PDF / ì—¬ëŸ¬ ì¥ ì„ íƒ ê°€ëŠ¥',
      pdfZipInfo: 'ğŸ“Œ PDF: ì—¬ëŸ¬ ì¥ â†’ 1ê°œ PDFë¡œ í•©ì¹˜ê¸° / ZIP: ì—¬ëŸ¬ íŒŒì¼ ê²°ê³¼ë¥¼ 1ê°œ ZIPìœ¼ë¡œ ë¬¶ê¸°',
      listTitle: 'ì„ íƒëœ íŒŒì¼',
      listHint: 'ìœ„/ì•„ë˜ë¡œ ìˆœì„œ ë³€ê²½ Â· ì‚­ì œ ê°€ëŠ¥',
      h_preview: '2) ë¯¸ë¦¬ë³´ê¸°',
      thumb_label: 'ë¯¸ë¦¬ë³´ê¸°',
      meta_idle: 'íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.',
      h_settings: '3) ë³€í™˜ ì„¤ì •',
      lbl_format: 'ì¶œë ¥ í˜•ì‹',
      lbl_quality: 'í’ˆì§ˆ (JPG/WebPë§Œ)',
      q_095: 'ìµœê³ (0.95)',
      q_090: 'ë†’ìŒ(0.90)',
      q_080: 'ë³´í†µ(0.80)',
      q_070: 'ì••ì¶•(0.70)',
      lbl_w: 'ê°€ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)',
      lbl_h: 'ì„¸ë¡œ(px) (ë¹„ìš°ë©´ ì›ë³¸)',
      ph_w: 'ì˜ˆ: 1200',
      ph_h: 'ì˜ˆ: 800',
      size_hint: 'ê°€ë¡œ/ì„¸ë¡œë¥¼ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë©´ ë¹„ìœ¨ ìœ ì§€ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.',
      zipLabel: 'ì—¬ëŸ¬ íŒŒì¼ ê²°ê³¼ë¥¼ ZIPìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ',
      zipSub: 'JPG/PNG/WebPì—ì„œ ì—¬ëŸ¬ ì¥ ë³€í™˜ ì‹œ ì‚¬ìš©',
      h_download: '4) ë‹¤ìš´ë¡œë“œ',
      convert: 'ë³€í™˜ & ë‹¤ìš´ë¡œë“œ',
      reset: 'ì´ˆê¸°í™”',
      privacy_hint: 'ğŸ”’ ê°œì¸ì •ë³´: íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br/>âœ… ë³€í™˜/í•©ì¹˜ê¸°/ZIP ëª¨ë‘ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ ì²˜ë¦¬ë©ë‹ˆë‹¤.',
      msg_ready_one: 'ì¤€ë¹„ ì™„ë£Œ! ë³€í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.',
      msg_ready_multi_pdf: 'ì—¬ëŸ¬ ì¥ ì„ íƒë¨: PDFë¥¼ ì„ íƒí•˜ë©´ 1ê°œì˜ PDFë¡œ í•©ì³ì„œ ì €ì¥í•©ë‹ˆë‹¤.',
      msg_ready_multi_img: 'ì—¬ëŸ¬ ì¥ ì„ íƒë¨: JPG/PNG/WebPëŠ” ZIP ì˜µì…˜ì„ ì¼œë©´ í•œ ë²ˆì— ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆì–´ìš”.',
      msg_loading: 'íŒŒì¼ ì½ëŠ” ì¤‘â€¦',
      msg_png_q: 'PNGëŠ” ë¬´ì†ì‹¤ì´ë¼ í’ˆì§ˆ ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•Šì•„ìš”.',
      msg_pdf_q: 'PDFëŠ” ì„ íƒí•œ ìˆœì„œëŒ€ë¡œ 1ê°œì˜ PDFë¡œ ì €ì¥ë©ë‹ˆë‹¤.',
      err_no_file: 'ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.',
      err_only_img_for_img: 'JPG/PNG/WebP ë³€í™˜ì€ ì´ë¯¸ì§€ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      err_convert: 'ë³€í™˜ ì‹¤íŒ¨. ë‹¤ë¥¸ ì˜µì…˜ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',
      err_pdf_merge: 'PDF í•©ì¹˜ê¸°/ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',
      dl_zip: (name) => `ZIP ë‹¤ìš´ë¡œë“œ ì‹œì‘: ${name}`,
      dl_one: (name) => `ë‹¤ìš´ë¡œë“œ ì‹œì‘: ${name}`,
      meta_tpl: (name, type, size) => `íŒŒì¼ëª…: <b>${name}</b><br/>í˜•ì‹: <b>${type}</b><br/>í¬ê¸°: <b>${size}</b>`,
      btnUp: 'ìœ„',
      btnDown: 'ì•„ë˜',
      btnDel: 'ì‚­ì œ',
      badgePDF: 'PDF',
      badgeIMG: 'IMG'
    },
    en: {
      subtitle: 'Upload files and convert to <b>JPG / PNG / WebP / PDF</b>, or merge multiple pages into <b>one PDF</b>. (All processed locally in your browser)',
      h_upload: '1) Upload',
      drop_title: 'Drag & drop files here, or',
      pick_btn: 'Choose files',
      drop_hint: 'Supports JPG, PNG, WebP, PDF / Multi-select available',
      pdfZipInfo: 'ğŸ“Œ PDF: merge multiple pages â†’ 1 PDF / ZIP: bundle multiple results â†’ 1 ZIP',
      listTitle: 'Selected files',
      listHint: 'Reorder (up/down) Â· Delete',
      h_preview: '2) Preview',
      thumb_label: 'Preview',
      meta_idle: 'Choose a file to see details.',
      h_settings: '3) Settings',
      lbl_format: 'Output format',
      lbl_quality: 'Quality (JPG/WebP only)',
      q_095: 'Max (0.95)',
      q_090: 'High (0.90)',
      q_080: 'Normal (0.80)',
      q_070: 'Small (0.70)',
      lbl_w: 'Width (px) (blank = original)',
      lbl_h: 'Height (px) (blank = original)',
      ph_w: 'e.g., 1200',
      ph_h: 'e.g., 800',
      size_hint: 'If you enter only one side, the aspect ratio is preserved automatically.',
      zipLabel: 'Download multiple results as ZIP',
      zipSub: 'Use when converting multiple images to JPG/PNG/WebP',
      h_download: '4) Download',
      convert: 'Convert & Download',
      reset: 'Reset',
      privacy_hint: 'ğŸ”’ Privacy: Files are never uploaded.<br/>âœ… Convert / merge / ZIP runs locally in your browser.',
      msg_ready_one: 'Ready! Click convert to download.',
      msg_ready_multi_pdf: 'Multiple selected: choose PDF to merge into one PDF.',
      msg_ready_multi_img: 'Multiple selected: enable ZIP to download results at once.',
      msg_loading: 'Reading filesâ€¦',
      msg_png_q: "PNG is lossless, so quality doesn't apply.",
      msg_pdf_q: 'PDF will be saved as one file in the selected order.',
      err_no_file: 'Please upload files first.',
      err_only_img_for_img: 'JPG/PNG/WebP conversion supports images only.',
      err_convert: 'Conversion failed. Try different options.',
      err_pdf_merge: 'Error while creating/merging PDF. Please try again.',
      dl_zip: (name) => `ZIP download started: ${name}`,
      dl_one: (name) => `Download started: ${name}`,
      meta_tpl: (name, type, size) => `Name: <b>${name}</b><br/>Type: <b>${type}</b><br/>Size: <b>${size}</b>`,
      btnUp: 'Up',
      btnDown: 'Down',
      btnDel: 'Del',
      badgePDF: 'PDF',
      badgeIMG: 'IMG'
    },
    ja: {
      subtitle: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ <b>JPG / PNG / WebP / PDF</b> ã«å¤‰æ›ã€ã¾ãŸã¯è¤‡æ•°ãƒšãƒ¼ã‚¸ã‚’ <b>1ã¤ã®PDF</b> ã«çµåˆã§ãã¾ã™ã€‚ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ï¼‰',
      h_upload: '1) ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
      drop_title: 'ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯',
      pick_btn: 'ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ',
      drop_hint: 'å¯¾å¿œ: JPG, PNG, WebP, PDF / è¤‡æ•°é¸æŠå¯',
      pdfZipInfo: 'ğŸ“Œ PDF: è¤‡æ•°ãƒšãƒ¼ã‚¸â†’1ã¤ã®PDF / ZIP: è¤‡æ•°çµæœâ†’1ã¤ã®ZIP',
      listTitle: 'é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«',
      listHint: 'é †ç•ªå¤‰æ›´(ä¸Š/ä¸‹) Â· å‰Šé™¤',
      h_preview: '2) ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
      thumb_label: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
      meta_idle: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã¨æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚',
      h_settings: '3) è¨­å®š',
      lbl_format: 'å‡ºåŠ›å½¢å¼',
      lbl_quality: 'å“è³ªï¼ˆJPG/WebPã®ã¿ï¼‰',
      q_095: 'æœ€é«˜(0.95)',
      q_090: 'é«˜(0.90)',
      q_080: 'æ¨™æº–(0.80)',
      q_070: 'åœ§ç¸®(0.70)',
      lbl_w: 'å¹…(px)ï¼ˆç©ºæ¬„=å…ƒã‚µã‚¤ã‚ºï¼‰',
      lbl_h: 'é«˜ã•(px)ï¼ˆç©ºæ¬„=å…ƒã‚µã‚¤ã‚ºï¼‰',
      ph_w: 'ä¾‹: 1200',
      ph_h: 'ä¾‹: 800',
      size_hint: 'ç‰‡æ–¹ã ã‘å…¥åŠ›ã™ã‚‹ã¨ã€æ¯”ç‡ã‚’ç¶­æŒã—ã¦è‡ªå‹•è¨ˆç®—ã—ã¾ã™ã€‚',
      zipLabel: 'è¤‡æ•°çµæœã‚’ZIPã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
      zipSub: 'è¤‡æ•°ç”»åƒã‚’JPG/PNG/WebPã«å¤‰æ›ã™ã‚‹æ™‚ã«ä½¿ç”¨',
      h_download: '4) ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
      convert: 'å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
      reset: 'ãƒªã‚»ãƒƒãƒˆ',
      privacy_hint: 'ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚<br/>âœ… å¤‰æ›/çµåˆ/ZIPã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã—ã¾ã™ã€‚',
      msg_ready_one: 'æº–å‚™å®Œäº†ï¼å¤‰æ›ãƒœã‚¿ãƒ³ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚',
      msg_ready_multi_pdf: 'è¤‡æ•°é¸æŠ: PDFã‚’é¸ã¶ã¨1ã¤ã®PDFã«çµåˆã—ã¾ã™ã€‚',
      msg_ready_multi_img: 'è¤‡æ•°é¸æŠ: ZIPã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚',
      msg_loading: 'èª­ã¿è¾¼ã¿ä¸­â€¦',
      msg_png_q: 'PNGã¯ç„¡åŠ£åŒ–ã®ãŸã‚ã€å“è³ªè¨­å®šã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚',
      msg_pdf_q: 'PDFã¯é¸æŠã—ãŸé †ç•ªã§1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚',
      err_no_file: 'å…ˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚',
      err_only_img_for_img: 'JPG/PNG/WebP å¤‰æ›ã¯ç”»åƒã®ã¿å¯¾å¿œã§ã™ã€‚',
      err_convert: 'å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ¥ã®è¨­å®šã§ãŠè©¦ã—ãã ã•ã„ã€‚',
      err_pdf_merge: 'PDFä½œæˆ/çµåˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
      dl_zip: (name) => `ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹: ${name}`,
      dl_one: (name) => `ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹: ${name}`,
      meta_tpl: (name, type, size) => `ãƒ•ã‚¡ã‚¤ãƒ«å: <b>${name}</b><br/>å½¢å¼: <b>${type}</b><br/>ã‚µã‚¤ã‚º: <b>${size}</b>`,
      btnUp: 'ä¸Š',
      btnDown: 'ä¸‹',
      btnDel: 'å‰Šé™¤',
      badgePDF: 'PDF',
      badgeIMG: 'IMG'
    },
    es: {
      subtitle: 'Sube archivos y conviÃ©rtelos a <b>JPG / PNG / WebP / PDF</b>, o combina varias pÃ¡ginas en <b>un solo PDF</b>. (Todo se procesa localmente en tu navegador)',
      h_upload: '1) Subir',
      drop_title: 'Arrastra y suelta archivos aquÃ­, o',
      pick_btn: 'Elegir archivos',
      drop_hint: 'Soporta JPG, PNG, WebP, PDF / SelecciÃ³n mÃºltiple',
      pdfZipInfo: 'ğŸ“Œ PDF: combinar varias pÃ¡ginas â†’ 1 PDF / ZIP: agrupar varios resultados â†’ 1 ZIP',
      listTitle: 'Archivos seleccionados',
      listHint: 'Reordenar (arriba/abajo) Â· Eliminar',
      h_preview: '2) Vista previa',
      thumb_label: 'Vista previa',
      meta_idle: 'Elige un archivo para ver los detalles.',
      h_settings: '3) Ajustes',
      lbl_format: 'Formato de salida',
      lbl_quality: 'Calidad (solo JPG/WebP)',
      q_095: 'MÃ¡x (0.95)',
      q_090: 'Alta (0.90)',
      q_080: 'Normal (0.80)',
      q_070: 'PequeÃ±o (0.70)',
      lbl_w: 'Ancho (px) (vacÃ­o = original)',
      lbl_h: 'Alto (px) (vacÃ­o = original)',
      ph_w: 'ej.: 1200',
      ph_h: 'ej.: 800',
      size_hint: 'Si ingresas solo un lado, se mantiene la proporciÃ³n automÃ¡ticamente.',
      zipLabel: 'Descargar mÃºltiples resultados como ZIP',
      zipSub: 'Ãšsalo al convertir varias imÃ¡genes a JPG/PNG/WebP',
      h_download: '4) Descargar',
      convert: 'Convertir y descargar',
      reset: 'Reiniciar',
      privacy_hint: 'ğŸ”’ Privacidad: los archivos no se suben a un servidor.<br/>âœ… Convertir / combinar / ZIP funciona localmente en tu navegador.',
      msg_ready_one: 'Â¡Listo! Pulsa convertir para descargar.',
      msg_ready_multi_pdf: 'Varios seleccionados: elige PDF para combinarlos en un solo PDF.',
      msg_ready_multi_img: 'Varios seleccionados: activa ZIP para descargar todo junto.',
      msg_loading: 'Leyendo archivosâ€¦',
      msg_png_q: 'PNG es sin pÃ©rdida; la calidad no aplica.',
      msg_pdf_q: 'El PDF se guardarÃ¡ como un solo archivo en el orden seleccionado.',
      err_no_file: 'Primero sube archivos.',
      err_only_img_for_img: 'La conversiÃ³n a JPG/PNG/WebP admite solo imÃ¡genes.',
      err_convert: 'FallÃ³ la conversiÃ³n. Prueba otras opciones.',
      err_pdf_merge: 'Error al crear/combinar PDF. IntÃ©ntalo de nuevo.',
      dl_zip: (name) => `Descarga ZIP iniciada: ${name}`,
      dl_one: (name) => `Descarga iniciada: ${name}`,
      meta_tpl: (name, type, size) => `Nombre: <b>${name}</b><br/>Tipo: <b>${type}</b><br/>TamaÃ±o: <b>${size}</b>`,
      btnUp: 'Arriba',
      btnDown: 'Abajo',
      btnDel: 'Borrar',
      badgePDF: 'PDF',
      badgeIMG: 'IMG'
    }
  };

  function detectLang(){
    const saved = localStorage.getItem("cf24_lang");
    if(saved && STR[saved]) return saved;
    const nav = (navigator.language || "").toLowerCase();
    if(nav.startsWith("ko")) return "ko";
    if(nav.startsWith("ja")) return "ja";
    if(nav.startsWith("es")) return "es";
    return "en";
  }

  let LANG = detectLang();
  function t(){ return STR[LANG]; }

  function setActiveLangButtons(lang){
    document.querySelectorAll(".langbtn").forEach(b=>{
      b.classList.toggle("active", b.dataset.lang === lang);
    });
  }

  const META_DESC = document.querySelector('meta[name="description"]');
  function renderTexts(){
    document.documentElement.lang = LANG;
    setActiveLangButtons(LANG);

    $("subtitle").innerHTML = t().subtitle;

    $("h_upload").textContent = t().h_upload;
    $("drop_title").textContent = t().drop_title;
    $("pick_btn").textContent = t().pick_btn;
    $("drop_hint").textContent = t().drop_hint;
    pdfZipInfo.textContent = t().pdfZipInfo;

    listTitleEl.textContent = t().listTitle;
    listHintEl.textContent  = t().listHint;

    $("h_preview").textContent = t().h_preview;
    $("h_settings").textContent = t().h_settings;
    $("lbl_format").textContent = t().lbl_format;
    $("lbl_quality").textContent = t().lbl_quality;

    $("q_095").textContent = t().q_095;
    $("q_090").textContent = t().q_090;
    $("q_080").textContent = t().q_080;
    $("q_070").textContent = t().q_070;

    $("lbl_w").textContent = t().lbl_w;
    $("lbl_h").textContent = t().lbl_h;
    inW.placeholder = t().ph_w;
    inH.placeholder = t().ph_h;
    $("size_hint").textContent = t().size_hint;

    zipLabel.textContent = t().zipLabel;
    zipSub.textContent   = t().zipSub;

    $("h_download").textContent = t().h_download;
    btnConvert.textContent = t().convert;
    btnReset.textContent = t().reset;
    $("privacy_hint").innerHTML = t().privacy_hint;

    if(META_DESC) META_DESC.setAttribute("content", document.querySelector('meta[name="description"]')?.content || "");
  }

  function setLang(lang){
    if(!STR[lang]) return;
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    renderTexts();
    renderList();
    updateUIState();
    renderPreview();
  }

  document.querySelectorAll(".langbtn").forEach(b=>{
    b.addEventListener("click", ()=> setLang(b.dataset.lang));
  });

  // =========================
  // State
  // =========================
  let files = []; // { id, file, kind: 'image'|'pdf', url?, thumbUrl? }
  let activeIndex = -1;

  function humanSize(bytes){
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return `${v.toFixed(i===0?0:1)} ${units[i]}`;
  }

  function setMessage(text, type){
    msg.textContent = text || "";
    msg.className = "msg " + (type || "");
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function resetAll(){
    // revoke URLs
    files.forEach(x=>{
      if(x.url) URL.revokeObjectURL(x.url);
      if(x.thumbUrl) URL.revokeObjectURL(x.thumbUrl);
    });
    files = [];
    activeIndex = -1;

    fileInput.value = "";
    inW.value = "";
    inH.value = "";
    zipToggle.checked = false;

    btnConvert.disabled = true;
    btnReset.disabled = true;

    fileListWrap.style.display = "none";
    itemsEl.innerHTML = "";

    setMessage("", "");
    renderPreview(true);
    updateUIState();
  }

  // =========================
  // File picking (fix)
  // =========================
  pickRealBtn.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", (e) => {
    const picked = e.target.files ? Array.from(e.target.files) : [];
    if(picked.length) handleFiles(picked);
  });

  // Drag & drop
  ["dragenter","dragover"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      drop.classList.add("drag");
    });
  });
  ["dragleave","drop"].forEach(evt => {
    drop.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      drop.classList.remove("drag");
    });
  });
  drop.addEventListener("drop", (e) => {
    const picked = e.dataTransfer?.files ? Array.from(e.dataTransfer.files) : [];
    if(picked.length) handleFiles(picked);
  });

  // =========================
  // Handle files
  // =========================
  async function handleFiles(picked){
    resetAll(); // replace current selection (simple & clean)

    btnReset.disabled = false;
    setMessage(t().msg_loading, "");

    const mapped = picked.map((f, idx) => {
      const kind = (f.type === "application/pdf") ? "pdf" : (f.type.startsWith("image/") ? "image" : "other");
      return {
        id: `${Date.now()}_${idx}_${Math.random().toString(16).slice(2)}`,
        file: f,
        kind,
        url: URL.createObjectURL(f),
        thumbUrl: null
      };
    }).filter(x => x.kind !== "other");

    files = mapped;
    activeIndex = 0;

    // build thumbnails for images (fast)
    await Promise.all(files.map(async (x) => {
      if(x.kind === "image"){
        x.thumbUrl = x.url; // ok for thumbnail
      }
    }));

    renderList();
    updateUIState();
    renderPreview();
    setReadyMessage();
  }

  function setReadyMessage(){
    if(files.length === 0){
      setMessage("", "");
      return;
    }
    if(files.length === 1){
      setMessage(t().msg_ready_one, "ok");
      return;
    }
    if(selFormat.value === "application/pdf"){
      setMessage(t().msg_ready_multi_pdf, "ok");
    } else {
      setMessage(t().msg_ready_multi_img, "ok");
    }
  }

  // =========================
  // List UI (reorder/delete)
  // =========================
  function moveItem(from, to){
    if(to < 0 || to >= files.length) return;
    const item = files.splice(from, 1)[0];
    files.splice(to, 0, item);
    if(activeIndex === from) activeIndex = to;
    else if(from < activeIndex && to >= activeIndex) activeIndex -= 1;
    else if(from > activeIndex && to <= activeIndex) activeIndex += 1;
    renderList();
    renderPreview();
    setReadyMessage();
  }

  function deleteItem(idx){
    const x = files[idx];
    if(x?.url) URL.revokeObjectURL(x.url);
    if(x?.thumbUrl && x.thumbUrl !== x.url) URL.revokeObjectURL(x.thumbUrl);

    files.splice(idx, 1);
    if(files.length === 0){
      resetAll();
      return;
    }
    if(activeIndex >= files.length) activeIndex = files.length - 1;
    renderList();
    renderPreview();
    updateUIState();
    setReadyMessage();
  }

  function renderList(){
    if(files.length <= 1){
      fileListWrap.style.display = "none";
      itemsEl.innerHTML = "";
      return;
    }
    fileListWrap.style.display = "block";
    itemsEl.innerHTML = "";

    files.forEach((x, idx) => {
      const item = document.createElement("div");
      item.className = "item";

      const left = document.createElement("div");
      left.className = "leftInfo";

      const mini = document.createElement("div");
      mini.className = "mini";
      if(x.kind === "image"){
        const img = new Image();
        img.src = x.thumbUrl || x.url;
        mini.appendChild(img);
      } else {
        mini.textContent = t().badgePDF;
      }

      const info = document.createElement("div");
      info.style.minWidth = "0";
      const nm = document.createElement("div");
      nm.className = "fname";
      nm.textContent = x.file.name;
      const ty = document.createElement("div");
      ty.className = "ftype";
      ty.textContent = `${x.kind.toUpperCase()} Â· ${humanSize(x.file.size)}`;
      info.appendChild(nm);
      info.appendChild(ty);

      left.appendChild(mini);
      left.appendChild(info);

      // click to set active preview
      left.style.cursor = "pointer";
      left.addEventListener("click", () => {
        activeIndex = idx;
        renderPreview();
      });

      const right = document.createElement("div");
      right.className = "rightBtns";

      const up = document.createElement("button");
      up.className = "btn secondary small";
      up.textContent = t().btnUp;
      up.disabled = idx === 0;
      up.addEventListener("click", () => moveItem(idx, idx-1));

      const down = document.createElement("button");
      down.className = "btn secondary small";
      down.textContent = t().btnDown;
      down.disabled = idx === files.length-1;
      down.addEventListener("click", () => moveItem(idx, idx+1));

      const del = document.createElement("button");
      del.className = "btn secondary small";
      del.textContent = t().btnDel;
      del.addEventListener("click", () => deleteItem(idx));

      right.appendChild(up);
      right.appendChild(down);
      right.appendChild(del);

      item.appendChild(left);
      item.appendChild(right);

      itemsEl.appendChild(item);
    });
  }

  // =========================
  // Preview
  // =========================
  function renderPreview(forceIdle=false){
    if(forceIdle || files.length === 0){
      thumb.innerHTML = `<span style="color:#90a3c1; font-size:12px;">${t().thumb_label}</span>`;
      meta.textContent = t().meta_idle;
      return;
    }

    const x = files[activeIndex] || files[0];
    if(!x) return;

    if(x.kind === "image"){
      const img = new Image();
      img.onload = () => {};
      img.src = x.url;
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.objectFit = "cover";
      thumb.innerHTML = "";
      thumb.appendChild(img);
    } else {
      thumb.innerHTML = `<span style="color:#90a3c1; font-size:12px;">${t().badgePDF}</span>`;
    }

    meta.innerHTML = t().meta_tpl(
      escapeHtml(x.file.name),
      escapeHtml(x.file.type || (x.kind === "pdf" ? "application/pdf" : "unknown")),
      humanSize(x.file.size)
    );
  }

  // =========================
  // Conversion helpers
  // =========================
  function getTargetSizeFromImage(imgW, imgH){
    const w = parseInt(inW.value, 10);
    const h = parseInt(inH.value, 10);
    if(!w && !h) return { w: imgW, h: imgH };
    if(w && !h)  return { w, h: Math.round(w * (imgH / imgW)) };
    if(!w && h)  return { w: Math.round(h * (imgW / imgH)), h };
    return { w, h };
  }

  function mimeToExt(mime){
    if(mime === "image/jpeg") return "jpg";
    if(mime === "image/png")  return "png";
    if(mime === "image/webp") return "webp";
    if(mime === "application/pdf") return "pdf";
    return "bin";
  }

  function buildOutputName(baseName, ext){
    const base = (baseName || "file").replace(/\.[^.]+$/, "");
    const stamp = new Date().toISOString().replace(/[:.]/g,"-");
    return `${base}_${stamp}.${ext}`;
  }

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  async function imageFileToBitmap(file){
    // reliable load (avoid createImageBitmap issues on some iOS)
    const url = URL.createObjectURL(file);
    const img = new Image();
    img.decoding = "async";
    img.loading = "eager";
    img.src = url;

    await new Promise((res, rej) => {
      img.onload = () => res();
      img.onerror = () => rej(new Error("image load failed"));
    });
    URL.revokeObjectURL(url);

    // draw to canvas to get pixel data
    const { w, h } = getTargetSizeFromImage(img.naturalWidth, img.naturalHeight);
    const canvas = document.createElement("canvas");
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext("2d", { alpha:true });
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
    ctx.drawImage(img, 0, 0, w, h);
    return { canvas, w, h };
  }

  // =========================
  // UI State
  // =========================
  function updateQualityState(){
    const mime = selFormat.value;
    const disableQuality = (mime === "image/png" || mime === "application/pdf");
    selQuality.disabled = disableQuality;
    selQuality.style.opacity = disableQuality ? ".6" : "1";
  }

  function updateZipState(){
    // ZIP toggle only for image outputs when multiple files
    const mime = selFormat.value;
    const canZip = (files.length >= 2) && (mime !== "application/pdf");
    zipToggleWrap.style.display = canZip ? "flex" : "none";
    if(!canZip) zipToggle.checked = false;
  }

  function updateUIState(){
    updateQualityState();
    updateZipState();
    btnConvert.disabled = (files.length === 0);
    btnReset.disabled = (files.length === 0);
  }

  // =========================
  // Main convert
  // =========================
  async function convertAndDownload(){
    if(files.length === 0){
      setMessage(t().err_no_file, "err");
      return;
    }

    const outMime = selFormat.value;
    updateUIState();

    btnConvert.disabled = true;

    try{
      // PDF output: merge multiple pages into ONE PDF (images + PDFs)
      if(outMime === "application/pdf"){
        setMessage(t().msg_pdf_q, "");

        const { PDFDocument } = window.PDFLib;
        const outPdf = await PDFDocument.create();

        for(const x of files){
          if(x.kind === "pdf"){
            const bytes = new Uint8Array(await x.file.arrayBuffer());
            const src = await PDFDocument.load(bytes);
            const pages = await outPdf.copyPages(src, src.getPageIndices());
            pages.forEach(p => outPdf.addPage(p));
          } else if(x.kind === "image"){
            const { canvas, w, h } = await imageFileToBitmap(x.file);
            const pngBlob = await new Promise(res => canvas.toBlob(res, "image/png"));
            if(!pngBlob) throw new Error("png blob failed");
            const pngBytes = new Uint8Array(await pngBlob.arrayBuffer());

            const imgEmbed = await outPdf.embedPng(pngBytes);
            const page = outPdf.addPage([w, h]);
            page.drawImage(imgEmbed, { x:0, y:0, width:w, height:h });
          }
        }

        const pdfBytes = await outPdf.save();
        const blob = new Blob([pdfBytes], { type: "application/pdf" });
        const name = buildOutputName("merged", "pdf");
        downloadBlob(blob, name);
        setMessage(t().dl_one(name), "ok");
        btnConvert.disabled = false;
        return;
      }

      // Image outputs: if multiple + ZIP checked => zip; else single file only
      const zipMode = (files.length >= 2) && zipToggle.checked;

      if(files.length >= 2 && !zipMode){
        // convert only first, guide user
        setMessage(t().msg_ready_multi_img, "");
      }

      if(zipMode){
        const zip = new JSZip();
        const quality = parseFloat(selQuality.value);
        const ext = mimeToExt(outMime);

        for(const x of files){
          if(x.kind !== "image") continue; // only images for image output
          const { canvas } = await imageFileToBitmap(x.file);

          const blob = await new Promise((resolve) => {
            if(outMime === "image/png"){
              canvas.toBlob(resolve, outMime);
            } else {
              canvas.toBlob(resolve, outMime, quality);
            }
          });
          if(!blob) throw new Error("toBlob failed");

          const fname = (x.file.name || "image").replace(/\.[^.]+$/, "") + "." + ext;
          zip.file(fname, blob);
        }

        const zipBlob = await zip.generateAsync({ type: "blob" });
        const zipName = buildOutputName("converted", "zip");
        downloadBlob(zipBlob, zipName);
        setMessage(t().dl_zip(zipName), "ok");
        btnConvert.disabled = false;
        return;
      }

      // single image conversion (first image only)
      const first = files.find(x => x.kind === "image");
      if(!first){
        setMessage(t().err_only_img_for_img, "err");
        btnConvert.disabled = false;
        return;
      }

      const quality = parseFloat(selQuality.value);
      const { canvas } = await imageFileToBitmap(first.file);

      const blob = await new Promise((resolve) => {
        if(outMime === "image/png"){
          canvas.toBlob(resolve, outMime);
        } else {
          canvas.toBlob(resolve, outMime, quality);
        }
      });

      if(!blob) throw new Error("toBlob failed");

      const outName = buildOutputName(first.file.name, mimeToExt(outMime));
      downloadBlob(blob, outName);
      setMessage(t().dl_one(outName), "ok");
      btnConvert.disabled = false;

    }catch(e){
      console.error(e);
      setMessage(
        selFormat.value === "application/pdf" ? t().err_pdf_merge : t().err_convert,
        "err"
      );
      btnConvert.disabled = false;
    }
  }

  // =========================
  // Events
  // =========================
  btnConvert.addEventListener("click", convertAndDownload);
  btnReset.addEventListener("click", resetAll);

  selFormat.addEventListener("change", () => {
    updateUIState();
    const mime = selFormat.value;
    if(mime === "image/png"){
      setMessage(t().msg_png_q, "");
    } else if(mime === "application/pdf"){
      setMessage(t().msg_pdf_q, "");
    } else {
      setReadyMessage();
    }
  });

  // init
  setLang(detectLang());
  resetAll();
})();
</script>
</body>
</html>