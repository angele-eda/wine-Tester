<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Compress PDF | ConvertFiles24</title>
  <meta name="description" content="Compress PDFs by rebuilding pages as optimized images. 100% local processing (no server upload)." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- pdf.js (primary) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.js"></script>
  <!-- PDF-lib (rebuild PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <!-- JSZip (multiple download) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <style>
    :root{
      --radius:16px;
      --pad:16px;
      --border:1px solid rgba(255,255,255,.12);
      --blue: 47,109,246;
      --ease: cubic-bezier(.2,.8,.2,1);

      --softBlueBg: rgba(120, 200, 255, .06);
      --softBlueBd: rgba(120, 200, 255, .22);
      --softBlueTx: #cfe6ff;
      --softBlueHi: rgba(120, 200, 255, .12);
    }
    *{ box-sizing:border-box; }
    html, body{ width:100%; max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", sans-serif;
      background:#0b0f17;
      color:#e9eef7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    body:not(.loaded) .card, body:not(.loaded) .top{ opacity:0; transform: translateY(8px); }
    body.loaded .top{ animation: cfFadeUp .35s var(--ease) both; }
    body.loaded .card{ animation: cfFadeUp .38s var(--ease) both; }
    @keyframes cfFadeUp{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
      body:not(.loaded) .card, body:not(.loaded) .top{ opacity:1; transform:none; }
    }

    .wrap{ max-width:980px; width:100%; margin:0 auto; padding:22px 14px 44px; overflow-x: clip; }
    .top{ display:flex; align-items:flex-start; justify-content:space-between; gap:14px; flex-wrap:wrap; margin-bottom:14px; min-width:0; }
    .title{ margin:0; font-weight:900; letter-spacing:-0.35px; line-height:1.15; color:#fff; font-size:22px; }
    .sub{ margin:8px 0 0; color:#a7b3c7; font-size:13px; line-height:1.45; }

    .homeBtn{
      width:100%; display:flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px; border-radius:999px;
      border:1px solid rgba(47,109,246,.55);
      background:rgba(47,109,246,.18);
      color:#e9eef7; font-weight:900; cursor:pointer; text-decoration:none; user-select:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      max-width:380px;
      transition: transform .08s var(--ease), background .12s var(--ease), box-shadow .12s var(--ease);
    }
    .homeBtn:hover{ background:rgba(47,109,246,.24); }
    .homeBtn:active{ transform: scale(.99); }
    .homeBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.35), 0 10px 24px rgba(0,0,0,.25); }

    .langRow{ display:flex; flex-direction:column; align-items:flex-end; gap:8px; min-width:220px; max-width:100%; margin-left:auto; }
    .langLabel{ font-size:12px; font-weight:900; color:#9fb0ca; letter-spacing:-0.2px; display:flex; align-items:center; gap:8px; opacity:.95; }
    .langSelect{
      width:220px; max-width:100%; padding:12px 12px; border-radius:999px;
      border:var(--border); background:rgba(255,255,255,.06); color:#e9eef7; outline:none; font-weight:900;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease), transform .08s var(--ease);
    }
    .langSelect:focus-visible{ outline:none; border-color: rgba(var(--blue), .55); box-shadow: 0 0 0 3px rgba(var(--blue),.25); }
    option{ background:#0b0f17; color:#e9eef7; }

    .pill{
      width:100%; border:1px solid rgba(120, 200, 255, .22);
      background:rgba(120, 200, 255, .06);
      border-radius:999px; padding:10px 14px; color:#cfe6ff; font-size:13px; font-weight:900;
      display:flex; align-items:center; justify-content:center; gap:10px; min-width:0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .card{ border:var(--border); background:rgba(255,255,255,.03); border-radius:var(--radius); padding:var(--pad); margin-top:12px; min-width:0; max-width:100%; overflow-x: clip; }
    .card h2{ margin:0 0 10px; font-size:15px; color:#dbe7ff; letter-spacing:-0.2px; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; min-width:0; }
    .row > *{ flex:1; min-width:160px; max-width:100%; min-width:0; }

    .btn{
      appearance:none; border:none; cursor:pointer;
      background:#2f6df6; color:white; font-weight:900;
      padding:12px 14px; border-radius:14px; width:100%;
      font-size:14px;
      letter-spacing: -0.2px;
      user-select:none;
      transition: transform .08s var(--ease), filter .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease);
    }
    .btn.secondary{
      background: var(--softBlueBg);
      border: 1px solid var(--softBlueBd);
      color: var(--softBlueTx);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .btn.secondary:hover{ background: var(--softBlueHi); }
    .btn:hover{ filter: brightness(1.03); }
    .btn:active{ transform: scale(.99); }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.25); }
    .btn:disabled{
      opacity:1; cursor:not-allowed; transform:none; box-shadow:none;
      filter: saturate(.7);
      background: linear-gradient(180deg, rgba(47,109,246,.40), rgba(47,109,246,.30));
      color:#ffffff;
    }
    .btn.secondary:disabled{
      filter:none;
      background: rgba(120, 200, 255, .05);
      border: 1px solid rgba(120, 200, 255, .16);
      color: rgba(207, 230, 255, .70);
      box-shadow:none;
    }

    input[type="file"]{ display:none; }

    /* Drop */
    .drop{
      border:1px dashed rgba(255,255,255,.18);
      border-radius:14px; padding:18px;
      background:rgba(255,255,255,.02);
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition: background .15s var(--ease), border-color .15s var(--ease), box-shadow .15s var(--ease), transform .05s var(--ease);
      position: relative;
      min-height: 170px;
      display:flex; align-items:center; justify-content:center;
      max-width:100%;
      overflow:hidden;
    }
    .drop.drag{ background:rgba(106,169,255,.12); border-color:rgba(106,169,255,.45); box-shadow: 0 0 0 3px rgba(106,169,255,.10) inset; }
    .drop:active{ transform: scale(0.998); }
    .drop:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.25); }

    .drop.hasFiles{
      border-color: rgba(120,200,255,.32);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 18px 40px rgba(0,0,0,.18);
      background: rgba(255,255,255,.025);
    }

    .dropEmoji{ font-size:42px; line-height:1; margin:10px 0 8px; filter: drop-shadow(0 10px 22px rgba(0,0,0,.28)); }
    .hint{ margin-top:10px; color:#9fb0ca; font-size:12px; line-height:1.5; }
    .small{ color:#a7b3c7; font-size:12px; line-height:1.5; }

    .countBadge{
      position:absolute;
      top:10px; right:10px;
      display:none;
      align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(120,200,255,.26);
      background: rgba(120,200,255,.08);
      color:#cfe6ff;
      font-size:12px;
      font-weight:900;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      user-select:none;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }
    .countBadge .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(47,109,246,.9);
      box-shadow: 0 0 0 3px rgba(47,109,246,.15);
    }

    .fileBar{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .fileBarLeft{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:#a7b3c7; font-size:12px; font-weight:900;
    }

    /* âœ… ë‘”íƒí•¨ ì™„í™”: êµµê¸°/ìê°„/ë°°ê²½ ëŒ€ë¹„ ì¡°ì • */
    .toggleBtn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.045);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:800;
      font-size:12px;
      letter-spacing: -0.15px;
      text-rendering: geometricPrecision;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
    }
    .toggleBtn:hover{ background: rgba(255,255,255,.06); }
    .toggleBtn:active{ transform: scale(.99); }
    .toggleBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }

    .fileList{
      margin-top:10px;
      display:none;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .fileList.show{ display:block; }

    .fileItem{
      display:flex; align-items:stretch; justify-content:space-between; gap:10px;
      padding:10px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
    }
    .fileItem + .fileItem{ margin-top:10px; }

    .fileLeft{ min-width:0; flex: 1; }

    /* âœ… ëª©ë¡ ê¸€ì: ì‘ê³  ê°€ëŠ˜ê²Œ (ë‘”íƒí•¨ ì œê±°) */
    .fileName{
      font-weight:600;
      font-size:13px;
      color:#e9eef7;
      letter-spacing:-0.1px;
      line-height:1.35;
      word-break: break-word;
    }
    .fileMeta{
      margin-top:6px;
      color:#a7b3c7;
      font-size:11px;
      line-height:1.45;
      font-weight:500;
    }

    /* âœ… X + ì´ë™ í™”ì‚´í‘œë§Œ ìœ ì§€ (2p/11p ë°°ì§€ ì œê±°) */
    .fileRight{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      min-width: 64px;
    }
    .iconStack{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:stretch;
      width: 54px;
    }
    .iconBtn{
      appearance:none; border:none; cursor:pointer;
      padding:8px 0;
      border-radius:12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      font-weight:900;
      font-size:12px;
      line-height:1;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
      user-select:none;
    }
    .iconBtn:hover{ background: rgba(255,255,255,.07); }
    .iconBtn:active{ transform: scale(.99); }
    .iconBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue),.55); }
    .iconBtn.danger{
      background: rgba(255, 110, 110, .08);
      border-color: rgba(255, 110, 110, .22);
      color: #ffd6d6;
    }
    .iconBtn.danger:hover{
      background: rgba(255, 110, 110, .12);
      border-color: rgba(255, 110, 110, .30);
    }
    .iconBtn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
      filter:none;
    }

    /* Presets */
    .presetWrap{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      margin-bottom:12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .presetTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-size:12px; font-weight:900; color:#cfe0ff;
      letter-spacing:-0.15px;
      margin-bottom:10px;
    }
    .presetHint{ color:#9fb0ca; font-weight:800; font-size:12px; }
    .presetRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .presetBtn{
      flex:1; min-width: 180px;
      appearance:none; border:none; cursor:pointer;
      padding:12px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color:#e9eef7;
      text-align:left;
      transition: transform .08s var(--ease), background .12s var(--ease), border-color .12s var(--ease), box-shadow .12s var(--ease);
    }
    .presetBtn:hover{ background: rgba(255,255,255,.07); }
    .presetBtn:active{ transform: scale(.99); }
    .presetBtn:focus-visible{ outline:none; box-shadow: 0 0 0 3px rgba(var(--blue),.22); border-color: rgba(var(--blue), .55); }
    .presetBtn[aria-pressed="true"]{
      background: rgba(47,109,246,.16);
      border-color: rgba(47,109,246,.55);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .presetTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .presetName{ font-weight:900; letter-spacing:-0.2px; }
    .badge{
      font-size:11px; font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:#cfe0ff;
      white-space:nowrap;
    }
    .presetDesc{ margin-top:6px; color:#a7b3c7; font-size:12px; line-height:1.45; }

    label{ display:block; font-size:12px; color:#a7b3c7; margin-bottom:6px; }
    select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      color:#e9eef7;
      border:var(--border);
      outline:none;
      font-weight:900;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease);
    }
    select:focus-visible{
      border-color: rgba(var(--blue), .55);
      box-shadow: 0 0 0 3px rgba(var(--blue),.22);
    }

    .msg{ margin-top:10px; font-size:13px; color:#cfe0ff; }
    .msg.err{ color:#ffb4b4; }
    .msg.ok{ color:#b8ffcc; }

    .meta{ color:#b7c3d9; font-size:13px; line-height:1.5; word-break:break-word; min-width:0; }
    .meta b{ color:#e9eef7; }

    .legal{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      color:#a7b3c7;
      font-size:12px;
      line-height:1.55;
    }
    .legal b{ color:#dbe7ff; }

    .footer{ margin-top:16px; color:#94a6c2; font-size:12px; text-align:center; }
    .footer a{ color:#9fb0ca; text-decoration:none; border-bottom:1px dashed rgba(159,176,202,.35); }
    .footer a:hover{ color:#cfe0ff; border-bottom-color:rgba(207,224,255,.6); }

    .bar{
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      margin-top:8px;
      display:none;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: rgba(47,109,246,.9);
      transition: width .15s var(--ease);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div style="flex:1; min-width:240px;">
        <h1 class="title" id="page_title">Compress PDF</h1>
        <p class="sub" id="page_sub">Upload â†’ choose preset â†’ compress â†’ download. 100% local processing.</p>

        <div style="margin-top:10px;">
          <a class="homeBtn" href="/" id="home_btn">ğŸ  Home</a>
        </div>

        <div style="margin-top:10px;">
          <div class="pill">ğŸ”’ <span id="local_processing">Processed locally â€” no server upload</span></div>
        </div>
      </div>

      <div class="langRow">
        <div class="langLabel">ğŸŒ <span id="lang_label">Language</span></div>
        <select class="langSelect" id="langSelect" aria-label="Language">
          <option value="en">Global (English)</option>
          <option value="ko">í•œêµ­ì–´</option>
          <option value="es">EspaÃ±ol</option>
          <option value="ja">æ—¥æœ¬èª</option>
        </select>
      </div>
    </div>

    <div class="card">
      <h2 id="h_step1">Upload PDF</h2>

      <div class="row">
        <button class="btn secondary" id="pickBtn" type="button">ğŸ“„ Choose PDF</button>
        <button class="btn secondary" id="addBtn" type="button" disabled>â• Add PDF</button>
        <button class="btn secondary" id="clearBtn" type="button" disabled>ğŸ§¹ Clear</button>
      </div>

      <div style="height:10px;"></div>

      <div class="drop" id="drop" role="button" tabindex="0" aria-label="Upload PDF">
        <div class="countBadge" id="countBadge">
          <span class="dot" aria-hidden="true"></span>
          <span id="countText">0</span>
        </div>
        <div style="width:100%;">
          <div style="font-weight:900; margin-bottom:6px;" id="drop_title">Drop PDF here<br/>or tap to upload</div>
          <div class="dropEmoji" aria-hidden="true">ğŸ—œï¸</div>
          <div class="hint" id="drop_hint">This compresses by rebuilding pages as images (text/search may be lost).</div>
        </div>
      </div>

      <div class="fileBar">
        <div class="fileBarLeft">
          <span id="selectedPill">âœ… <span id="selectedCount">0</span></span>
        </div>
        <button class="toggleBtn" id="toggleListBtn" type="button" disabled>â–¾ Show list</button>
      </div>

      <div class="fileList" id="fileList" aria-label="File list"></div>

      <div class="msg" id="msg"></div>
      <div class="bar" id="bar"><div id="barFill"></div></div>
    </div>

    <div class="card">
      <h2 id="h_step2">Compression</h2>

      <div class="presetWrap" aria-label="Presets">
        <div class="presetTitle">
          <div id="preset_title">ğŸ› Presets</div>
          <div class="presetHint" id="preset_hint">Pick one â€” settings apply automatically</div>
        </div>
        <div class="presetRow">
          <button class="presetBtn" id="preset_crisp" type="button" aria-pressed="false">
            <div class="presetTop">
              <div class="presetName" id="p1_name">âœ¨ Crisp (Recommended)</div>
              <div class="badge" id="p1_badge">2.0 Ã— / 0.85</div>
            </div>
            <div class="presetDesc" id="p1_desc">Best for text & documents. Sharper, may be larger.</div>
          </button>

          <button class="presetBtn" id="preset_balanced" type="button" aria-pressed="true">
            <div class="presetTop">
              <div class="presetName" id="p2_name">âš–ï¸ Balanced</div>
              <div class="badge" id="p2_badge">1.5 Ã— / 0.75</div>
            </div>
            <div class="presetDesc" id="p2_desc">Good default for most PDFs.</div>
          </button>

          <button class="presetBtn" id="preset_small" type="button" aria-pressed="false">
            <div class="presetTop">
              <div class="presetName" id="p3_name">ğŸ—œï¸ Smallest</div>
              <div class="badge" id="p3_badge">1.0 Ã— / 0.60</div>
            </div>
            <div class="presetDesc" id="p3_desc">Smallest size. May look blurry when zoomed.</div>
          </button>
        </div>
      </div>

      <div class="row">
        <div>
          <label id="lbl_quality">Image quality</label>
          <select id="quality" disabled>
            <option value="0.85">High (0.85)</option>
            <option value="0.75" selected>Medium (0.75)</option>
            <option value="0.60">Small (0.60)</option>
          </select>
          <div class="small" id="q_hint">Lower = smaller file.</div>
        </div>
        <div>
          <label id="lbl_scale">Render scale</label>
          <select id="scale" disabled>
            <option value="1.0">1.0 (fast)</option>
            <option value="1.5" selected>1.5 (balanced)</option>
            <option value="2.0">2.0 (sharp)</option>
          </select>
          <div class="small" id="s_hint">Higher = sharper but larger.</div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="row">
        <button class="btn" id="compressBtn" type="button" disabled>â¬‡ï¸ Compress & Download PDF</button>
      </div>

      <div class="legal" id="legal_box">
        <b>Notice</b><br/>
        This tool rebuilds each PDF page as an image to reduce file size. Text selection/search and vector sharpness may be lost.
        Always verify the output. For submissions, contracts, evidence, or important records, keep the original PDF.
      </div>

      <div style="height:12px;"></div>
      <div class="meta" id="meta"><b>Status</b><br/>Upload a PDF to start.</div>
    </div>

    <div class="footer">
      Â© <span id="year"></span> ConvertFiles24 Â·
      <a href="/privacy.html">Privacy</a> Â·
      <a href="/terms.html">Terms</a>
    </div>
  </div>

  <input id="pickInput" type="file" accept="application/pdf" multiple>

<script>
(() => {
  "use strict";
  const $ = (id)=>document.getElementById(id);
  $("year").textContent = new Date().getFullYear();
  requestAnimationFrame(()=> document.body.classList.add("loaded"));

  function loadScript(src){
    return new Promise((resolve, reject)=>{
      const s = document.createElement("script");
      s.src = src;
      s.async = true;
      s.onload = ()=>resolve(true);
      s.onerror = ()=>reject(new Error("Failed to load: " + src));
      document.head.appendChild(s);
    });
  }
  async function ensurePdfjs(){
    if (window.pdfjsLib && typeof window.pdfjsLib.getDocument === "function") return;

    try{ await loadScript("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.js"); }catch(_){}

    if (window.pdfjsLib && typeof window.pdfjsLib.getDocument === "function") {
      try{
        const base = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/";
        window.pdfjsLib.GlobalWorkerOptions.workerSrc = base + "pdf.worker.min.js";
      }catch(_){}
      return;
    }

    await loadScript("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js");
    if (!window.pdfjsLib || typeof window.pdfjsLib.getDocument !== "function"){
      throw new Error("pdf.js failed to initialize");
    }
    try{
      const base = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/";
      window.pdfjsLib.GlobalWorkerOptions.workerSrc = base + "pdf.worker.min.js";
    }catch(_){}
  }

  const STR = {
    ko:{
      page_title:"PDF ì••ì¶•",
      page_sub:"ì—…ë¡œë“œ â†’ í”„ë¦¬ì…‹ ì„ íƒ â†’ ì••ì¶• â†’ ë‹¤ìš´ë¡œë“œ. 100% ë¡œì»¬ ì²˜ë¦¬.",
      home:"ğŸ  í™ˆìœ¼ë¡œ",
      local:"ë¡œì»¬ ì²˜ë¦¬ â€” ì„œë²„ ì—…ë¡œë“œ ì—†ìŒ",
      lang_label:"ì–¸ì–´",
      h1:"PDF ì—…ë¡œë“œ",
      pick:"ğŸ“„ PDF ì„ íƒ",
      add:"â• PDF ì¶”ê°€",
      clear:"ğŸ§¹ ë¹„ìš°ê¸°",
      drop_title:"ì—¬ê¸°ì— PDFë¥¼ ëŒì–´ë‹¤ ë†“ê±°ë‚˜<br/>íƒ­í•´ì„œ ì—…ë¡œë“œ",
      drop_hint:"ì´ë¯¸ì§€ë¡œ ë‹¤ì‹œ ë§Œë“¤ì–´ ì••ì¶•í•©ë‹ˆë‹¤(í…ìŠ¤íŠ¸ ì„ íƒ/ê²€ìƒ‰Â·ì„ ëª…ë„ê°€ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”).",
      toggle_open:"â–¾ ëª©ë¡ ì—´ê¸°",
      toggle_close:"â–´ ëª©ë¡ ìˆ¨ê¸°ê¸°",
      selected:(n)=>`âœ… ì„ íƒë¨: ${n}ê°œ`,

      h2:"ì••ì¶• ì„¤ì •",
      preset_title:"ğŸ› í”„ë¦¬ì…‹",
      preset_hint:"í•˜ë‚˜ë§Œ ê³ ë¥´ë©´ ìë™ìœ¼ë¡œ ì„¤ì •ë¼ìš”",
      p1_name:"âœ¨ ì„ ëª…ë„(ì¶”ì²œ)",
      p1_desc:"ë¬¸ì„œ/ê¸€ììš©. ë” ì„ ëª…í•˜ì§€ë§Œ ìš©ëŸ‰ì´ ì»¤ì§ˆ ìˆ˜ ìˆì–´ìš”.",
      p2_name:"âš–ï¸ ê· í˜•",
      p2_desc:"ëŒ€ë¶€ë¶„ PDFì— ë¬´ë‚œí•œ ê¸°ë³¸ê°’.",
      p3_name:"ğŸ—œï¸ ìš©ëŸ‰ìµœì†Œ",
      p3_desc:"ìš©ëŸ‰ì„ ìµœëŒ€í•œ ì¤„ì—¬ìš”. í™•ëŒ€í•˜ë©´ íë¦´ ìˆ˜ ìˆì–´ìš”.",

      lbl_quality:"ì´ë¯¸ì§€ í’ˆì§ˆ",
      q_hint:"ë‚®ì„ìˆ˜ë¡ ìš©ëŸ‰ì´ ì‘ì•„ì ¸ìš”.",
      lbl_scale:"ë Œë” ìŠ¤ì¼€ì¼",
      s_hint:"ë†’ì„ìˆ˜ë¡ ì„ ëª…í•˜ì§€ë§Œ ì»¤ì§ˆ ìˆ˜ ìˆì–´ìš”.",
      go_one:"â¬‡ï¸ ì••ì¶• PDF ë‹¤ìš´ë¡œë“œ",
      go_zip:"â¬‡ï¸ ì••ì¶• ZIP ë‹¤ìš´ë¡œë“œ",

      legal_title:"ì•ˆë‚´",
      legal_body:"ì´ ë„êµ¬ëŠ” í˜ì´ì§€ë¥¼ ì´ë¯¸ì§€ë¡œ ì¬ìƒì„±í•´ ìš©ëŸ‰ì„ ì¤„ì…ë‹ˆë‹¤. ë”°ë¼ì„œ í…ìŠ¤íŠ¸ ì„ íƒ/ê²€ìƒ‰ê³¼ ë²¡í„° ì„ ëª…ë„ê°€ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”. ê²°ê³¼ë¬¼ì€ ê¼­ í™•ì¸í•´ ì£¼ì„¸ìš”. ì œì¶œÂ·ê³„ì•½Â·ì¦ê±°Â·ì¤‘ìš” ë³´ê´€ ë¬¸ì„œëŠ” ì›ë³¸ PDFë¥¼ ë°˜ë“œì‹œ ë³´ê´€í•˜ì„¸ìš”.",

      meta_idle:"<b>ìƒíƒœ</b><br/>PDFë¥¼ ì—…ë¡œë“œí•˜ë©´ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.",
      meta_loaded:(n)=>`<b>ìƒíƒœ</b><br/>${n}ê°œ PDF ì¤€ë¹„ ì™„ë£Œ`,
      msg_need:"ë¨¼ì € PDFë¥¼ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.",
      msg_work:"ì‘ì—… ì¤‘â€¦ ì´ íƒ­ì„ ë‹«ì§€ ë§ˆì„¸ìš”.",
      msg_done:"âœ… ì™„ë£Œ",
      msg_fail:"PDF ì••ì¶• ì‹¤íŒ¨",

      del:"ì‚­ì œ",
      up:"ìœ„ë¡œ",
      down:"ì•„ë˜ë¡œ"
    },
    en:{
      page_title:"Compress PDF",
      page_sub:"Upload â†’ choose preset â†’ compress â†’ download. 100% local processing.",
      home:"ğŸ  Home",
      local:"Processed locally â€” no server upload",
      lang_label:"Language",
      h1:"Upload PDF",
      pick:"ğŸ“„ Choose PDF",
      add:"â• Add PDF",
      clear:"ğŸ§¹ Clear",
      drop_title:"Drop PDF here<br/>or tap to upload",
      drop_hint:"This compresses by rebuilding pages as images (text/search may be lost).",
      toggle_open:"â–¾ Show list",
      toggle_close:"â–´ Hide list",
      selected:(n)=>`âœ… Selected: ${n}`,

      h2:"Compression",
      preset_title:"ğŸ› Presets",
      preset_hint:"Pick one â€” settings apply automatically",
      p1_name:"âœ¨ Crisp (Recommended)",
      p1_desc:"Best for text & documents. Sharper, may be larger.",
      p2_name:"âš–ï¸ Balanced",
      p2_desc:"Good default for most PDFs.",
      p3_name:"ğŸ—œï¸ Smallest",
      p3_desc:"Smallest size. May look blurry when zoomed.",

      lbl_quality:"Image quality",
      q_hint:"Lower = smaller file.",
      lbl_scale:"Render scale",
      s_hint:"Higher = sharper but larger.",
      go_one:"â¬‡ï¸ Compress & Download PDF",
      go_zip:"â¬‡ï¸ Compress & Download ZIP",

      legal_title:"Notice",
      legal_body:"This tool rebuilds each PDF page as an image to reduce file size. Text selection/search and vector sharpness may be lost. Always verify the output. For submissions, contracts, evidence, or important records, keep the original PDF.",

      meta_idle:"<b>Status</b><br/>Upload PDFs to start.",
      meta_loaded:(n)=>`<b>Status</b><br/>${n} PDF(s) ready`,
      msg_need:"Please upload PDFs first.",
      msg_work:"Workingâ€¦ keep this tab open.",
      msg_done:"âœ… Done",
      msg_fail:"Failed to compress PDF.",

      del:"Delete",
      up:"Up",
      down:"Down"
    }
  };

  function getQueryLang(){
    try{
      const u = new URL(location.href);
      const q = (u.searchParams.get("lang")||"").toLowerCase();
      if(q && STR[q]) return q;
    }catch(e){}
    return null;
  }
  function detectLang(){
    const q = getQueryLang();
    if(q) return q;
    const saved = localStorage.getItem("cf24_lang");
    if(saved && STR[saved]) return saved;
    const nav = (navigator.language || "").toLowerCase();
    if(nav.startsWith("ko")) return "ko";
    return "en";
  }
  let LANG = detectLang();
  function t(){ return STR[LANG] || STR.en; }

  const pickInput = $("pickInput");
  const pickBtn = $("pickBtn");
  const addBtn = $("addBtn");
  const clearBtn = $("clearBtn");
  const drop = $("drop");
  const msgEl = $("msg");
  const metaEl = $("meta");
  const qualityEl = $("quality");
  const scaleEl = $("scale");
  const compressBtn = $("compressBtn");
  const bar = $("bar");
  const barFill = $("barFill");

  const countBadge = $("countBadge");
  const countText = $("countText");
  const selectedCount = $("selectedCount");
  const selectedPill = $("selectedPill");
  const fileList = $("fileList");
  const toggleListBtn = $("toggleListBtn");

  const presetBtns = {
    crisp: $("preset_crisp"),
    balanced: $("preset_balanced"),
    small: $("preset_small")
  };

  function esc(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }
  function setMsg(text, cls){
    msgEl.textContent = text || "";
    msgEl.className = "msg " + (cls || "");
  }
  function setProg(pct){
    bar.style.display = "block";
    barFill.style.width = Math.max(0, Math.min(100, pct)) + "%";
  }
  function hideProg(){
    bar.style.display = "none";
    barFill.style.width = "0%";
  }

  const PRESETS = {
    crisp:   { scale: 2.0, quality: 0.85 },
    balanced:{ scale: 1.5, quality: 0.75 },
    small:   { scale: 1.0, quality: 0.60 }
  };
  let activePreset = localStorage.getItem("cf24_pdf_preset") || "balanced";
  if(!PRESETS[activePreset]) activePreset = "balanced";

  function applyPreset(key, { silent=false } = {}){
    if(!PRESETS[key]) key = "balanced";
    activePreset = key;
    localStorage.setItem("cf24_pdf_preset", key);

    Object.keys(presetBtns).forEach(k=>{
      presetBtns[k].setAttribute("aria-pressed", k === key ? "true" : "false");
    });

    const p = PRESETS[key];
    scaleEl.value = String(p.scale.toFixed(1));
    qualityEl.value = String(p.quality.toFixed(2));

    if(!silent) setMsg("", "");
  }

  function setLang(lang){
    if(!STR[lang]) lang = "en";
    LANG = lang;
    localStorage.setItem("cf24_lang", lang);
    $("langSelect").value = lang;
    document.documentElement.lang = lang;

    $("page_title").textContent = t().page_title;
    $("page_sub").textContent = t().page_sub;
    $("home_btn").textContent = t().home;
    $("local_processing").textContent = t().local;
    $("lang_label").textContent = t().lang_label;

    $("h_step1").textContent = t().h1;
    pickBtn.textContent = t().pick;
    addBtn.textContent = t().add;
    clearBtn.textContent = t().clear;
    $("drop_title").innerHTML = t().drop_title;
    $("drop_hint").textContent = t().drop_hint;

    $("h_step2").textContent = t().h2;
    $("preset_title").textContent = t().preset_title;
    $("preset_hint").textContent = t().preset_hint;
    $("p1_name").textContent = t().p1_name;
    $("p1_desc").textContent = t().p1_desc;
    $("p2_name").textContent = t().p2_name;
    $("p2_desc").textContent = t().p2_desc;
    $("p3_name").textContent = t().p3_name;
    $("p3_desc").textContent = t().p3_desc;

    $("lbl_quality").textContent = t().lbl_quality;
    $("q_hint").textContent = t().q_hint;
    $("lbl_scale").textContent = t().lbl_scale;
    $("s_hint").textContent = t().s_hint;

    $("legal_box").innerHTML = "<b>" + esc(t().legal_title) + "</b><br/>" + esc(t().legal_body);

    updateUI();
    updateFileList(); // ì–¸ì–´ ë³€ê²½ ì‹œ ë²„íŠ¼ aria-label ê°±ì‹ 
  }
  $("langSelect").addEventListener("change", (e)=> setLang(e.target.value));

  // files: { name, bytes:ArrayBuffer, pages:number }
  let files = [];
  let listOpen = false;

  function openPicker(){
    pickInput.value="";
    pickInput.click();
  }
  pickBtn.addEventListener("click", openPicker);
  addBtn.addEventListener("click", openPicker);

  drop.addEventListener("click", openPicker);
  drop.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){ e.preventDefault(); openPicker(); }
  });
  ["dragenter","dragover"].forEach(evt=>{
    drop.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add("drag"); });
  });
  ["dragleave","drop"].forEach(evt=>{
    drop.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove("drag"); });
  });
  drop.addEventListener("drop", (e)=>{
    const fl = e.dataTransfer.files;
    if(fl && fl.length) loadFiles(Array.from(fl));
  });

  pickInput.addEventListener("change", (e)=>{
    const fl = e.target.files;
    if(fl && fl.length) loadFiles(Array.from(fl));
  });

  clearBtn.addEventListener("click", ()=>{
    files = [];
    listOpen = false;
    fileList.classList.remove("show");
    hideProg();
    setMsg("", "");
    updateUI();
    updateFileList();
  });

  toggleListBtn.addEventListener("click", ()=>{
    if(!files.length) return;
    listOpen = !listOpen;
    if(listOpen) fileList.classList.add("show");
    else fileList.classList.remove("show");
    updateToggleText();
  });

  function updateToggleText(){
    toggleListBtn.textContent = listOpen ? t().toggle_close : t().toggle_open;
  }

  function updateFileList(){
    fileList.innerHTML = "";

    files.forEach((f, idx)=>{
      const item = document.createElement("div");
      item.className = "fileItem";
      item.innerHTML = `
        <div class="fileLeft">
          <div class="fileName">${esc(f.name)}</div>
          <div class="fileMeta">Pages: ${f.pages}</div>
        </div>
        <div class="fileRight">
          <div class="iconStack">
            <button class="iconBtn danger" data-act="del" data-idx="${idx}" aria-label="${esc(t().del)}">âœ•</button>
            <button class="iconBtn" data-act="up" data-idx="${idx}" aria-label="${esc(t().up)}">â†‘</button>
            <button class="iconBtn" data-act="down" data-idx="${idx}" aria-label="${esc(t().down)}">â†“</button>
          </div>
        </div>
      `;
      fileList.appendChild(item);
    });

    // disable arrows at edges
    const btns = fileList.querySelectorAll("button[data-act]");
    btns.forEach(b=>{
      const act = b.getAttribute("data-act");
      const i = parseInt(b.getAttribute("data-idx"),10);
      if(act === "up" && i === 0) b.disabled = true;
      if(act === "down" && i === files.length - 1) b.disabled = true;
    });
  }

  // event delegation for list controls
  fileList.addEventListener("click", (e)=>{
    const btn = e.target.closest("button[data-act]");
    if(!btn) return;
    const act = btn.getAttribute("data-act");
    const idx = parseInt(btn.getAttribute("data-idx"),10);
    if(Number.isNaN(idx)) return;

    if(act === "del"){
      files.splice(idx, 1);
    }else if(act === "up" && idx > 0){
      const tmp = files[idx-1];
      files[idx-1] = files[idx];
      files[idx] = tmp;
    }else if(act === "down" && idx < files.length-1){
      const tmp = files[idx+1];
      files[idx+1] = files[idx];
      files[idx] = tmp;
    }

    // keep list open if it was open and still has files
    if(files.length === 0){
      listOpen = false;
      fileList.classList.remove("show");
    }

    updateFileList();
    updateUI();
  });

  async function safeLoadPdfWithPdfjs(buf){
    await ensurePdfjs();
    const u8 = new Uint8Array(buf);
    const copy = new Uint8Array(u8.length);
    copy.set(u8);
    const loadingTask = window.pdfjsLib.getDocument({ data: copy });
    return await loadingTask.promise;
  }

  async function loadFiles(fileArr){
    try{
      setMsg("", "");
      hideProg();

      const onlyPdf = fileArr.filter(f => (f && (f.type === "application/pdf" || /\.pdf$/i.test(f.name))));
      if(!onlyPdf.length) throw new Error("No PDF selected");

      for(const f of onlyPdf){
        const buf = await f.arrayBuffer();
        const pdf = await safeLoadPdfWithPdfjs(buf);
        files.push({ name: f.name || "document.pdf", bytes: buf, pages: pdf.numPages });
      }

      const MAX = 12;
      if(files.length > MAX) files = files.slice(0, MAX);

      updateFileList();
      updateUI();

    }catch(e){
      const detail = (e && e.message) ? e.message : String(e);
      setMsg((t().msg_fail || "Failed") + " (" + detail + ")", "err");
      hideProg();
      updateUI();
    }
  }

  function updateUI(){
    const n = files.length;

    selectedCount.textContent = String(n);
    selectedPill.textContent = t().selected(n);
    countText.textContent = String(n);

    if(n > 0){
      countBadge.style.display = "inline-flex";
      drop.classList.add("hasFiles");
      addBtn.disabled = false;
      clearBtn.disabled = false;
      toggleListBtn.disabled = false;
      compressBtn.disabled = false;
      qualityEl.disabled = false;
      scaleEl.disabled = false;
      metaEl.innerHTML = t().meta_loaded(n);

      compressBtn.textContent = (n >= 2) ? t().go_zip : t().go_one;
    }else{
      countBadge.style.display = "none";
      drop.classList.remove("hasFiles");
      addBtn.disabled = true;
      clearBtn.disabled = true;
      toggleListBtn.disabled = true;
      compressBtn.disabled = true;
      qualityEl.disabled = true;
      scaleEl.disabled = true;
      metaEl.innerHTML = t().meta_idle;
      compressBtn.textContent = t().go_one;
    }

    updateToggleText();
    if(!listOpen) fileList.classList.remove("show");
    if(n === 0) fileList.classList.remove("show");
  }

  // presets
  presetBtns.crisp.addEventListener("click", ()=> applyPreset("crisp"));
  presetBtns.balanced.addEventListener("click", ()=> applyPreset("balanced"));
  presetBtns.small.addEventListener("click", ()=> applyPreset("small"));

  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  function stamp(){
    return new Date().toISOString().replace(/[:.]/g,"-");
  }
  function buildPdfName(original){
    const base = (original || "document.pdf").replace(/\.[^.]+$/, "");
    return `${base}_compressed_${stamp()}.pdf`;
  }
  function buildZipName(){
    return `compressed_pdfs_${stamp()}.zip`;
  }

  async function renderPageToJpegBlob(pdf, pageNum, scale, quality){
    const page = await pdf.getPage(pageNum);
    const viewport = page.getViewport({ scale });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d", { alpha:false });

    canvas.width = Math.max(1, Math.floor(viewport.width));
    canvas.height = Math.max(1, Math.floor(viewport.height));

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    await page.render({ canvasContext: ctx, viewport }).promise;

    const blob = await new Promise((resolve) => canvas.toBlob(resolve, "image/jpeg", quality));
    if(!blob) throw new Error("canvas.toBlob failed");

    try { canvas.width = 1; canvas.height = 1; } catch(_){}
    return { blob, w: viewport.width, h: viewport.height };
  }

  async function compressOne(fileObj, q, scale){
    const pdf = await safeLoadPdfWithPdfjs(fileObj.bytes);

    const { PDFDocument } = window.PDFLib;
    const out = await PDFDocument.create();

    const total = pdf.numPages;
    for(let i=1;i<=total;i++){
      const { blob, w, h } = await renderPageToJpegBlob(pdf, i, scale, q);
      const jpgBytes = await blob.arrayBuffer();
      const jpg = await out.embedJpg(jpgBytes);

      const page = out.addPage([w, h]);
      page.drawImage(jpg, { x:0, y:0, width:w, height:h });
    }

    const bytes = await out.save({ useObjectStreams:true });
    return new Blob([bytes], { type:"application/pdf" });
  }

  compressBtn.addEventListener("click", async ()=>{
    try{
      if(!files.length) return setMsg(t().msg_need, "err");

      compressBtn.disabled = true;
      pickBtn.disabled = true;
      addBtn.disabled = true;
      clearBtn.disabled = true;
      toggleListBtn.disabled = true;
      qualityEl.disabled = true;
      scaleEl.disabled = true;

      setMsg(t().msg_work, "");
      setProg(1);

      const q = parseFloat(qualityEl.value || "0.75");
      const scale = parseFloat(scaleEl.value || "1.5");

      if(files.length === 1){
        setProg(10);
        const outBlob = await compressOne(files[0], q, scale);
        setProg(95);
        downloadBlob(outBlob, buildPdfName(files[0].name));
        setProg(100);
        setMsg(t().msg_done, "ok");
        return;
      }

      const zip = new window.JSZip();
      const total = files.length;

      for(let i=0;i<total;i++){
        setProg(Math.round((i)/total*85) + 10);

        const f = files[i];
        const outBlob = await compressOne(f, q, scale);
        const arr = await outBlob.arrayBuffer();
        zip.file(buildPdfName(f.name), arr);
      }

      setProg(96);
      const zipBlob = await zip.generateAsync({ type:"blob" });
      downloadBlob(zipBlob, buildZipName());
      setProg(100);
      setMsg(t().msg_done, "ok");

    }catch(e){
      const detail = (e && e.message) ? e.message : String(e);
      setMsg((t().msg_fail || "Failed") + " (" + detail + ")", "err");
      hideProg();
    }finally{
      const has = files.length > 0;
      compressBtn.disabled = !has;
      pickBtn.disabled = false;
      addBtn.disabled = !has;
      clearBtn.disabled = !has;
      toggleListBtn.disabled = !has;
      qualityEl.disabled = !has;
      scaleEl.disabled = !has;
    }
  });

  // init
  applyPreset(activePreset, { silent:true });
  setLang(LANG);
  updateUI();
})();
</script>
</body>
</html>